<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
        This file is autogenerated from docs/formatdomain.rst
        Do not edit this file. Changes will be lost.
      -->
  <!--
        This page was generated at Sun Feb 28 08:44:57 2021 UTC.
      -->
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="main.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="https://libvirt.org/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="https://libvirt.org/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="https://libvirt.org/favicon-16x16.png"/>
    <link rel="manifest" href="https://libvirt.org/manifest.json"/>
    <meta name="theme-color" content="#ffffff"/>
    <title>libvirt: Domain XML format</title>
    <meta name="description" content="libvirt, virtualization, virtualization API"/>
    <script type="text/javascript" src="js/main.js">
      <!--// forces non-empty element-->
    </script>
  </head>
  <body onload="pageload()">
    <div id="body">
      <div class="document" id="domain-xml-format">
<h1>Domain XML format : wget (2021-02-28 Sun)</h1>

<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="formatdomain.html#element-and-attribute-overview" id="id1">Element and attribute overview</a></p>
<ul>
<li><p><a class="reference internal" href="formatdomain.html#general-metadata" id="id2">General metadata</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#operating-system-booting" id="id3">Operating system booting</a></p>
<ul>
<li><p><a class="reference internal" href="formatdomain.html#bios-bootloader" id="id4">BIOS bootloader</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#host-bootloader" id="id5">Host bootloader</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#direct-kernel-boot" id="id6">Direct kernel boot</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#container-boot" id="id7">Container boot</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="formatdomain.html#smbios-system-information" id="id8">SMBIOS System Information</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#cpu-allocation" id="id9">CPU Allocation</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#iothreads-allocation" id="id10">IOThreads Allocation</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#cpu-tuning" id="id11">CPU Tuning</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#memory-allocation" id="id12">Memory Allocation</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#memory-backing" id="id13">Memory Backing</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#memory-tuning" id="id14">Memory Tuning</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#numa-node-tuning" id="id15">NUMA Node Tuning</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#block-i-o-tuning" id="id16">Block I/O Tuning</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#resource-partitioning" id="id17">Resource partitioning</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#cpu-model-and-topology" id="id18">CPU model and topology</a></p>
<ul>
<li><p><a class="reference internal" href="formatdomain.html#acpi-heterogeneous-memory-attribute-table" id="id19">ACPI Heterogeneous Memory Attribute Table</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="formatdomain.html#events-configuration" id="id20">Events configuration</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#power-management" id="id21">Power Management</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#hypervisor-features" id="id22">Hypervisor features</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#time-keeping" id="id23">Time keeping</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#performance-monitoring-events" id="id24">Performance monitoring events</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#devices" id="id25">Devices</a></p>
<ul>
<li><p><a class="reference internal" href="formatdomain.html#hard-drives-floppy-disks-cdroms" id="id26">Hard drives, floppy disks, CDROMs</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#filesystems" id="id27">Filesystems</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#device-addresses" id="id28">Device Addresses</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#virtio-related-options" id="id29">Virtio-related options</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#virtio-transitional-devices" id="id30">Virtio transitional devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#controllers" id="id31">Controllers</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#device-leases" id="id32">Device leases</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#host-device-assignment" id="id33">Host device assignment</a></p>
<ul>
<li><p><a class="reference internal" href="formatdomain.html#usb-pci-scsi-devices" id="id34">USB / PCI / SCSI devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#block-character-devices" id="id35">Block / character devices</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="formatdomain.html#redirected-devices" id="id36">Redirected devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#smartcard-devices" id="id37">Smartcard devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#network-interfaces" id="id38">Network interfaces</a></p>
<ul>
<li><p><a class="reference internal" href="formatdomain.html#virtual-network" id="id39">Virtual network</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#bridge-to-lan" id="id40">Bridge to LAN</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#userspace-slirp-stack" id="id41">Userspace SLIRP stack</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#generic-ethernet-connection" id="id42">Generic ethernet connection</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#direct-attachment-to-physical-interface" id="id43">Direct attachment to physical interface</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#pci-passthrough" id="id44">PCI Passthrough</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#vdpa-devices" id="id45">vDPA devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#teaming-a-virtio-hostdev-nic-pair" id="id46">Teaming a virtio/hostdev NIC pair</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#multicast-tunnel" id="id47">Multicast tunnel</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#tcp-tunnel" id="id48">TCP tunnel</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#udp-unicast-tunnel" id="id49">UDP unicast tunnel</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#setting-the-nic-model" id="id50">Setting the NIC model</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#setting-nic-driver-specific-options" id="id51">Setting NIC driver-specific options</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#setting-network-backend-specific-options" id="id52">Setting network backend-specific options</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#overriding-the-target-element" id="id53">Overriding the target element</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#specifying-boot-order" id="id54">Specifying boot order</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#interface-rom-bios-configuration" id="id55">Interface ROM BIOS configuration</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#setting-up-a-network-backend-in-a-driver-domain" id="id56">Setting up a network backend in a driver domain</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#quality-of-service" id="id57">Quality of service</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#setting-vlan-tag-on-supported-network-types-only" id="id58">Setting VLAN tag (on supported network types only)</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#isolating-guests-s-network-traffic-from-each-other" id="id59">Isolating guests's network traffic from each other</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#modifying-virtual-link-state" id="id60">Modifying virtual link state</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#mtu-configuration" id="id61">MTU configuration</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#coalesce-settings" id="id62">Coalesce settings</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#ip-configuration" id="id63">IP configuration</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#vhost-user-interface" id="id64">vhost-user interface</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#traffic-filtering-with-nwfilter" id="id65">Traffic filtering with NWFilter</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="formatdomain.html#input-devices" id="id66">Input devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#hub-devices" id="id67">Hub devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#graphical-framebuffers" id="id68">Graphical framebuffers</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#video-devices" id="id69">Video devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#consoles-serial-parallel-channel-devices" id="id70">Consoles, serial, parallel &amp; channel devices</a></p>
<ul>
<li><p><a class="reference internal" href="formatdomain.html#guest-interface" id="id71">Guest interface</a></p>
<ul>
<li><p><a class="reference internal" href="formatdomain.html#parallel-port" id="id72">Parallel port</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#serial-port" id="id73">Serial port</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#console" id="id74">Console</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#relationship-between-serial-ports-and-consoles" id="id75">Relationship between serial ports and consoles</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#channel" id="id76">Channel</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="formatdomain.html#host-interface" id="id77">Host interface</a></p>
<ul>
<li><p><a class="reference internal" href="formatdomain.html#domain-logfile" id="id78">Domain logfile</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#device-logfile" id="id79">Device logfile</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#virtual-console" id="id80">Virtual console</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#null-device" id="id81">Null device</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#pseudo-tty" id="id82">Pseudo TTY</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#host-device-proxy" id="id83">Host device proxy</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#named-pipe" id="id84">Named pipe</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#tcp-client-server" id="id85">TCP client/server</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#udp-network-console" id="id86">UDP network console</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#unix-domain-socket-client-server" id="id87">UNIX domain socket client/server</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#spice-channel" id="id88">Spice channel</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#nmdm-device" id="id89">Nmdm device</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="formatdomain.html#sound-devices" id="id90">Sound devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#audio-devices" id="id91">Audio devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#watchdog-device" id="id92">Watchdog device</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#memory-balloon-device" id="id93">Memory balloon device</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#random-number-generator-device" id="id94">Random number generator device</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#tpm-device" id="id95">TPM device</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#nvram-device" id="id96">NVRAM device</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#panic-device" id="id97">panic device</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#shared-memory-device" id="id98">Shared memory device</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#memory-devices" id="id99">Memory devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#iommu-devices" id="id100">IOMMU devices</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#vsock" id="id101">Vsock</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="formatdomain.html#security-label" id="id102">Security label</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#key-wrap" id="id103">Key Wrap</a></p></li>
<li><p><a class="reference internal" href="formatdomain.html#launch-security" id="id104">Launch Security</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="formatdomain.html#example-configs" id="id105">Example configs</a></p></li>
</ul>
</div>
<p>This section describes the XML format used to represent domains, there are
variations on the format based on the kind of domains run and the options used
to launch them. For hypervisor specific details consult the <a class="reference external" href="https://libvirt.org/drivers.html">driver
docs</a></p>
<p><span class="anchor"><a id="elements"/></span></p>
<div class="section" id="element-and-attribute-overview">
<h1><a class="toc-backref" href="formatdomain.html#id1">Element and attribute overview</a><a class="headerlink" href="formatdomain.html#element-and-attribute-overview" title="Link to this headline">¶</a></h1>
<p>The root element required for all virtual machines is named <span class="docutils literal">domain</span>. It has
two attributes, the <span class="docutils literal">type</span> specifies the hypervisor used for running the
domain. The allowed values are driver specific, but include "xen", "kvm", "qemu"
and "lxc". The second attribute is <span class="docutils literal">id</span> which is a unique integer identifier
for the running guest machine. Inactive machines have no id value.</p>
<p><span class="anchor"><a id="elementsMetadata"/></span></p>
<div class="section" id="general-metadata">
<h2><a class="toc-backref" href="formatdomain.html#id2">General metadata</a><a class="headerlink" href="formatdomain.html#general-metadata" title="Link to this headline">¶</a></h2>
<pre class="literal-block">&lt;domain type='kvm' id='1'&gt;
  &lt;name&gt;MyGuest&lt;/name&gt;
  &lt;uuid&gt;4dea22b3-1d52-d8f3-2516-782e98ab3fa0&lt;/uuid&gt;
  &lt;genid&gt;43dc0cf8-809b-4adb-9bea-a9abb5f3d90e&lt;/genid&gt;
  &lt;title&gt;A short description - title - of the domain&lt;/title&gt;
  &lt;description&gt;Some human readable description&lt;/description&gt;
  &lt;metadata&gt;
    &lt;app1:foo xmlns:app1="http://app1.org/app1/"&gt;..&lt;/app1:foo&gt;
    &lt;app2:bar xmlns:app2="http://app1.org/app2/"&gt;..&lt;/app2:bar&gt;
  &lt;/metadata&gt;
  ...</pre>
<dl>
<dt><span class="docutils literal">name</span></dt>
<dd><p>The content of the <span class="docutils literal">name</span> element provides a short name for the virtual
machine. This name should consist only of alphanumeric characters and is
required to be unique within the scope of a single host. It is often used to
form the filename for storing the persistent configuration file.
<span class="since">Since 0.0.1</span></p>
</dd>
<dt><span class="docutils literal">uuid</span></dt>
<dd><p>The content of the <span class="docutils literal">uuid</span> element provides a globally unique identifier for
the virtual machine. The format must be RFC 4122 compliant, eg
<span class="docutils literal"><span class="pre">3e3fce45-4f53-4fa7-bb32-11f34168b82b</span></span>. If omitted when defining/creating a
new machine, a random UUID is generated. It is also possible to provide the
UUID via a <a class="reference external" href="formatdomain.html#elementsSysinfo">sysinfo</a> specification. <span class="since">Since 0.0.1,
sysinfo since 0.8.7</span></p>
</dd>
<dt><span class="docutils literal">genid</span></dt>
<dd><p><span class="since">Since 4.4.0</span> , the <span class="docutils literal">genid</span> element can be used to add a Virtual
Machine Generation ID which exposes a 128-bit, cryptographically random,
integer value identifier, referred to as a Globally Unique Identifier (GUID)
using the same format as the <span class="docutils literal">uuid</span>. The value is used to help notify the
guest operating system when the virtual machine is re-executing something
that has already executed before, such as:</p>
<ul class="simple">
<li><p>VM starts executing a snapshot</p></li>
<li><p>VM is recovered from backup</p></li>
<li><p>VM is failover in a disaster recovery environment</p></li>
<li><p>VM is imported, copied, or cloned</p></li>
</ul>
<p>The guest operating system notices the change and is then able to react as
appropriate by marking its copies of distributed databases as dirty,
re-initializing its random number generator, etc.</p>
<p>The libvirt XML parser will accept both a provided GUID value or just
&lt;genid/&gt; in which case a GUID will be generated and saved in the XML. For the
transitions such as above, libvirt will change the GUID before re-executing.</p>
</dd>
<dt><span class="docutils literal">title</span></dt>
<dd><p>The optional element <span class="docutils literal">title</span> provides space for a short description of the
domain. The title should not contain any newlines. <span class="since">Since 0.9.10</span> .</p>
</dd>
<dt><span class="docutils literal">description</span></dt>
<dd><p>The content of the <span class="docutils literal">description</span> element provides a human readable
description of the virtual machine. This data is not used by libvirt in any
way, it can contain any information the user wants. <span class="since">Since 0.7.2</span></p>
</dd>
<dt><span class="docutils literal">metadata</span></dt>
<dd><p>The <span class="docutils literal">metadata</span> node can be used by applications to store custom metadata in
the form of XML nodes/trees. Applications must use custom namespaces on their
XML nodes/trees, with only one top-level element per namespace (if the
application needs structure, they should have sub-elements to their namespace
element). <span class="since">Since 0.9.10</span></p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsOS"/></span></p>
</div>
<div class="section" id="operating-system-booting">
<h2><a class="toc-backref" href="formatdomain.html#id3">Operating system booting</a><a class="headerlink" href="formatdomain.html#operating-system-booting" title="Link to this headline">¶</a></h2>
<p>There are a number of different ways to boot virtual machines each with their
own pros and cons.</p>
<p><span class="anchor"><a id="elementsOSBIOS"/></span></p>
<div class="section" id="bios-bootloader">
<h3><a class="toc-backref" href="formatdomain.html#id4">BIOS bootloader</a><a class="headerlink" href="formatdomain.html#bios-bootloader" title="Link to this headline">¶</a></h3>
<p>Booting via the BIOS is available for hypervisors supporting full
virtualization. In this case the BIOS has a boot order priority (floppy,
harddisk, cdrom, network) determining where to obtain/find the boot image.</p>
<pre class="literal-block">...
&lt;os firmware='efi'&gt;
  &lt;type&gt;hvm&lt;/type&gt;
  &lt;loader readonly='yes' secure='no' type='rom'&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
  &lt;nvram template='/usr/share/OVMF/OVMF_VARS.fd'&gt;/var/lib/libvirt/nvram/guest_VARS.fd&lt;/nvram&gt;
  &lt;boot dev='hd'/&gt;
  &lt;boot dev='cdrom'/&gt;
  &lt;bootmenu enable='yes' timeout='3000'/&gt;
  &lt;smbios mode='sysinfo'/&gt;
  &lt;bios useserial='yes' rebootTimeout='0'/&gt;
&lt;/os&gt;
...</pre>
<dl>
<dt><span class="docutils literal">firmware</span></dt>
<dd><p>The <span class="docutils literal">firmware</span> attribute allows management applications to automatically
fill <span class="docutils literal">&lt;loader/&gt;</span> and <span class="docutils literal">&lt;nvram/&gt;</span> elements and possibly enable some
features required by selected firmware. Accepted values are <span class="docutils literal">bios</span> and
<span class="docutils literal">efi</span>.
The selection process scans for files describing installed firmware images in
specified location and uses the most specific one which fulfils domain
requirements. The locations in order of preference (from generic to most
specific one) are:</p>
<ul class="simple">
<li><p><span class="docutils literal">/usr/share/qemu/firmware</span></p></li>
<li><p><span class="docutils literal">/etc/qemu/firmware</span></p></li>
<li><p><span class="docutils literal">$XDG_CONFIG_HOME/qemu/firmware</span></p></li>
</ul>
<p>For more information refer to firmware metadata specification as described in
<span class="docutils literal">docs/interop/firmware.json</span> in QEMU repository. Regular users do not need
to bother. <span class="since">Since 5.2.0 (QEMU and KVM only)</span>
For VMware guests, this is set to <span class="docutils literal">efi</span> when the guest uses UEFI, and it is
not set when using BIOS. <span class="since">Since 5.3.0 (VMware ESX and
Workstation/Player)</span></p>
</dd>
<dt><span class="docutils literal">type</span></dt>
<dd><p>The content of the <span class="docutils literal">type</span> element specifies the type of operating system to
be booted in the virtual machine. <span class="docutils literal">hvm</span> indicates that the OS is one
designed to run on bare metal, so requires full virtualization. <span class="docutils literal">linux</span>
(badly named!) refers to an OS that supports the Xen 3 hypervisor guest ABI.
There are also two optional attributes, <span class="docutils literal">arch</span> specifying the CPU
architecture to virtualization, and <span class="docutils literal">machine</span> referring to the machine
type. The <a class="reference external" href="https://libvirt.org/formatcaps.html">Capabilities XML</a> provides details on allowed
values for these. If <span class="docutils literal">arch</span> is omitted then for most hypervisor drivers,
the host native arch will be chosen. For the <span class="docutils literal">test</span>, <span class="docutils literal">ESX</span> and <span class="docutils literal">VMWare</span>
hypervisor drivers, however, the <span class="docutils literal">i686</span> arch will always be chosen even on
an <span class="docutils literal">x86_64</span> host. <span class="since">Since 0.0.1</span></p>
</dd>
<dt><span class="docutils literal">loader</span></dt>
<dd><p>The optional <span class="docutils literal">loader</span> tag refers to a firmware blob, which is specified by
absolute path, used to assist the domain creation process. It is used by Xen
fully virtualized domains as well as setting the QEMU BIOS file path for
QEMU/KVM domains. <span class="since">Xen since 0.1.0, QEMU/KVM since 0.9.12</span> Then,
<span class="since">since 1.2.8</span> it's possible for the element to have two optional
attributes: <span class="docutils literal">readonly</span> (accepted values are <span class="docutils literal">yes</span> and <span class="docutils literal">no</span>) to reflect
the fact that the image should be writable or read-only. The second attribute
<span class="docutils literal">type</span> accepts values <span class="docutils literal">rom</span> and <span class="docutils literal">pflash</span>. It tells the hypervisor where
in the guest memory the file should be mapped. For instance, if the loader
path points to an UEFI image, <span class="docutils literal">type</span> should be <span class="docutils literal">pflash</span>. Moreover, some
firmwares may implement the Secure boot feature. Attribute <span class="docutils literal">secure</span> can be
used then to control it. <span class="since">Since 2.1.0</span></p>
</dd>
<dt><span class="docutils literal">nvram</span></dt>
<dd><p>Some UEFI firmwares may want to use a non-volatile memory to store some
variables. In the host, this is represented as a file and the absolute path
to the file is stored in this element. Moreover, when the domain is started
up libvirt copies so called master NVRAM store file defined in <span class="docutils literal">qemu.conf</span>.
If needed, the <span class="docutils literal">template</span> attribute can be used to per domain override map
of master NVRAM stores from the config file. Note, that for transient domains
if the NVRAM file has been created by libvirt it is left behind and it is
management application's responsibility to save and remove file (if needed to
be persistent). <span class="since">Since 1.2.8</span></p>
</dd>
<dt><span class="docutils literal">boot</span></dt>
<dd><p>The <span class="docutils literal">dev</span> attribute takes one of the values "fd", "hd", "cdrom" or
"network" and is used to specify the next boot device to consider. The
<span class="docutils literal">boot</span> element can be repeated multiple times to setup a priority list of
boot devices to try in turn. Multiple devices of the same type are sorted
according to their targets while preserving the order of buses. After
defining the domain, its XML configuration returned by libvirt (through
virDomainGetXMLDesc) lists devices in the sorted order. Once sorted, the
first device is marked as bootable. Thus, e.g., a domain configured to boot
from "hd" with vdb, hda, vda, and hdc disks assigned to it will boot from vda
(the sorted list is vda, vdb, hda, hdc). Similar domain with hdc, vda, vdb,
and hda disks will boot from hda (sorted disks are: hda, hdc, vda, vdb). It
can be tricky to configure in the desired way, which is why per-device boot
elements (see <a class="reference external" href="formatdomain.html#elementsDisks">disks</a>, <a class="reference external" href="formatdomain.html#elementsNICS">network
interfaces</a>, and <a class="reference external" href="formatdomain.html#elementsHostDev">USB and PCI devices</a>
sections below) were introduced and they are the preferred way providing full
control over booting order. The <span class="docutils literal">boot</span> element and per-device boot elements
are mutually exclusive. <span class="since">Since 0.1.3, per-device boot since 0.8.8</span></p>
</dd>
<dt><span class="docutils literal">smbios</span></dt>
<dd><p>How to populate SMBIOS information visible in the guest. The <span class="docutils literal">mode</span>
attribute must be specified, and is either "emulate" (let the hypervisor
generate all values), "host" (copy all of Block 0 and Block 1, except for the
UUID, from the host's SMBIOS values; the
<a class="reference external" href="https://libvirt.org/html/libvirt-libvirt-host.html#virConnectGetSysinfo">virConnectGetSysinfo</a>
call can be used to see what values are copied), or "sysinfo" (use the values
in the <a class="reference external" href="formatdomain.html#elementsSysinfo">sysinfo</a> element). If not specified, the
hypervisor default is used. <span class="since">Since 0.8.7</span></p>
</dd>
</dl>
<p>Up till here the BIOS/UEFI configuration knobs are generic enough to be
implemented by majority (if not all) firmwares out there. However, from now on
not every single setting makes sense to all firmwares. For instance,
<span class="docutils literal">rebootTimeout</span> doesn't make sense for UEFI, <span class="docutils literal">useserial</span> might not be usable
with a BIOS firmware that doesn't produce any output onto serial line, etc.
Moreover, firmwares don't usually export their capabilities for libvirt (or
users) to check. And the set of their capabilities can change with every new
release. Hence users are advised to try the settings they use before relying on
them in production.</p>
<dl class="simple">
<dt><span class="docutils literal">bootmenu</span></dt>
<dd><p>Whether or not to enable an interactive boot menu prompt on guest startup.
The <span class="docutils literal">enable</span> attribute can be either "yes" or "no". If not specified, the
hypervisor default is used. <span class="since">Since 0.8.3</span> Additional attribute
<span class="docutils literal">timeout</span> takes the number of milliseconds the boot menu should wait until
it times out. Allowed values are numbers in range [0, 65535] inclusive and it
is ignored unless <span class="docutils literal">enable</span> is set to "yes". <span class="since">Since 1.2.8</span></p>
</dd>
<dt><span class="docutils literal">bios</span></dt>
<dd><p>This element has attribute <span class="docutils literal">useserial</span> with possible values <span class="docutils literal">yes</span> or
<span class="docutils literal">no</span>. It enables or disables Serial Graphics Adapter which allows users to
see BIOS messages on a serial port. Therefore, one needs to have <a class="reference external" href="formatdomain.html#elementCharSerial">serial
port</a> defined. <span class="since">Since 0.9.4</span> . <span class="since">Since
0.10.2 (QEMU only)</span> there is another attribute, <span class="docutils literal">rebootTimeout</span> that
controls whether and after how long the guest should start booting again in
case the boot fails (according to BIOS). The value is in milliseconds with
maximum of <span class="docutils literal">65535</span> and special value <span class="docutils literal"><span class="pre">-1</span></span> disables the reboot.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsOSBootloader"/></span></p>
</div>
<div class="section" id="host-bootloader">
<h3><a class="toc-backref" href="formatdomain.html#id5">Host bootloader</a><a class="headerlink" href="formatdomain.html#host-bootloader" title="Link to this headline">¶</a></h3>
<p>Hypervisors employing paravirtualization do not usually emulate a BIOS, and
instead the host is responsible to kicking off the operating system boot. This
may use a pseudo-bootloader in the host to provide an interface to choose a
kernel for the guest. An example is <span class="docutils literal">pygrub</span> with Xen. The Bhyve hypervisor
also uses a host bootloader, either <span class="docutils literal">bhyveload</span> or <span class="docutils literal"><span class="pre">grub-bhyve</span></span>.</p>
<pre class="literal-block">...
&lt;bootloader&gt;/usr/bin/pygrub&lt;/bootloader&gt;
&lt;bootloader_args&gt;--append single&lt;/bootloader_args&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">bootloader</span></dt>
<dd><p>The content of the <span class="docutils literal">bootloader</span> element provides a fully qualified path to
the bootloader executable in the host OS. This bootloader will be run to
choose which kernel to boot. The required output of the bootloader is
dependent on the hypervisor in use. <span class="since">Since 0.1.0</span></p>
</dd>
<dt><span class="docutils literal">bootloader_args</span></dt>
<dd><p>The optional <span class="docutils literal">bootloader_args</span> element allows command line arguments to be
passed to the bootloader. <span class="since">Since 0.2.3</span></p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsOSKernel"/></span></p>
</div>
<div class="section" id="direct-kernel-boot">
<h3><a class="toc-backref" href="formatdomain.html#id6">Direct kernel boot</a><a class="headerlink" href="formatdomain.html#direct-kernel-boot" title="Link to this headline">¶</a></h3>
<p>When installing a new guest OS it is often useful to boot directly from a kernel
and initrd stored in the host OS, allowing command line arguments to be passed
directly to the installer. This capability is usually available for both para
and full virtualized guests.</p>
<pre class="literal-block">...
&lt;os&gt;
  &lt;type&gt;hvm&lt;/type&gt;
  &lt;loader&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
  &lt;kernel&gt;/root/f8-i386-vmlinuz&lt;/kernel&gt;
  &lt;initrd&gt;/root/f8-i386-initrd&lt;/initrd&gt;
  &lt;cmdline&gt;console=ttyS0 ks=http://example.com/f8-i386/os/&lt;/cmdline&gt;
  &lt;dtb&gt;/root/ppc.dtb&lt;/dtb&gt;
  &lt;acpi&gt;
    &lt;table type='slic'&gt;/path/to/slic.dat&lt;/table&gt;
  &lt;/acpi&gt;
&lt;/os&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">type</span></dt>
<dd><p>This element has the same semantics as described earlier in the <a class="reference external" href="formatdomain.html#elementsOSBIOS">BIOS boot
section</a></p>
</dd>
<dt><span class="docutils literal">loader</span></dt>
<dd><p>This element has the same semantics as described earlier in the <a class="reference external" href="formatdomain.html#elementsOSBIOS">BIOS boot
section</a></p>
</dd>
<dt><span class="docutils literal">kernel</span></dt>
<dd><p>The contents of this element specify the fully-qualified path to the kernel
image in the host OS.</p>
</dd>
<dt><span class="docutils literal">initrd</span></dt>
<dd><p>The contents of this element specify the fully-qualified path to the
(optional) ramdisk image in the host OS.</p>
</dd>
<dt><span class="docutils literal">cmdline</span></dt>
<dd><p>The contents of this element specify arguments to be passed to the kernel (or
installer) at boot time. This is often used to specify an alternate primary
console (eg serial port), or the installation media source / kickstart file</p>
</dd>
<dt><span class="docutils literal">dtb</span></dt>
<dd><p>The contents of this element specify the fully-qualified path to the
(optional) device tree binary (dtb) image in the host OS. <span class="since">Since
1.0.4</span></p>
</dd>
<dt><span class="docutils literal">acpi</span></dt>
<dd><p>The <span class="docutils literal">table</span> element contains a fully-qualified path to the ACPI table. The
<span class="docutils literal">type</span> attribute contains the ACPI table type (currently only <span class="docutils literal">slic</span> is
supported) <span class="since">Since 1.3.5 (QEMU)</span> <span class="since">Since 5.9.0 (Xen)</span></p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsOSContainer"/></span></p>
</div>
<div class="section" id="container-boot">
<h3><a class="toc-backref" href="formatdomain.html#id7">Container boot</a><a class="headerlink" href="formatdomain.html#container-boot" title="Link to this headline">¶</a></h3>
<p>When booting a domain using container based virtualization, instead of a kernel
/ boot image, a path to the init binary is required, using the <span class="docutils literal">init</span> element.
By default this will be launched with no arguments. To specify the initial argv,
use the <span class="docutils literal">initarg</span> element, repeated as many time as is required. The
<span class="docutils literal">cmdline</span> element, if set will be used to provide an equivalent to
<span class="docutils literal">/proc/cmdline</span> but will not affect init argv.</p>
<p>To set environment variables, use the <span class="docutils literal">initenv</span> element, one for each
variable.</p>
<p>To set a custom work directory for the init, use the <span class="docutils literal">initdir</span> element.</p>
<p>To run the init command as a given user or group, use the <span class="docutils literal">inituser</span> or
<span class="docutils literal">initgroup</span> elements respectively. Both elements can be provided either a user
(resp. group) id or a name. Prefixing the user or group id with a <span class="docutils literal">+</span> will
force it to be considered like a numeric value. Without this, it will be first
tried as a user or group name.</p>
<pre class="literal-block">&lt;os&gt;
  &lt;type arch='x86_64'&gt;exe&lt;/type&gt;
  &lt;init&gt;/bin/systemd&lt;/init&gt;
  &lt;initarg&gt;--unit&lt;/initarg&gt;
  &lt;initarg&gt;emergency.service&lt;/initarg&gt;
  &lt;initenv name='MYENV'&gt;some value&lt;/initenv&gt;
  &lt;initdir&gt;/my/custom/cwd&lt;/initdir&gt;
  &lt;inituser&gt;tester&lt;/inituser&gt;
  &lt;initgroup&gt;1000&lt;/initgroup&gt;
&lt;/os&gt;</pre>
<p>If you want to enable user namespace, set the <span class="docutils literal">idmap</span> element. The <span class="docutils literal">uid</span> and
<span class="docutils literal">gid</span> elements have three attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">start</span></dt>
<dd><p>First user ID in container. It must be '0'.</p>
</dd>
<dt><span class="docutils literal">target</span></dt>
<dd><p>The first user ID in container will be mapped to this target user ID in host.</p>
</dd>
<dt><span class="docutils literal">count</span></dt>
<dd><p>How many users in container are allowed to map to host's user.</p>
</dd>
</dl>
<pre class="literal-block">&lt;idmap&gt;
  &lt;uid start='0' target='1000' count='10'/&gt;
  &lt;gid start='0' target='1000' count='10'/&gt;
&lt;/idmap&gt;</pre>
<p><span class="anchor"><a id="elementsSysinfo"/></span></p>
</div>
</div>
<div class="section" id="smbios-system-information">
<h2><a class="toc-backref" href="formatdomain.html#id8">SMBIOS System Information</a><a class="headerlink" href="formatdomain.html#smbios-system-information" title="Link to this headline">¶</a></h2>
<p>Some hypervisors allow control over what system information is presented to the
guest (for example, SMBIOS fields can be populated by a hypervisor and inspected
via the <span class="docutils literal">dmidecode</span> command in the guest). The optional <span class="docutils literal">sysinfo</span> element
covers all such categories of information. <span class="since">Since 0.8.7</span></p>
<pre class="literal-block">...
&lt;os&gt;
  &lt;smbios mode='sysinfo'/&gt;
  ...
&lt;/os&gt;
&lt;sysinfo type='smbios'&gt;
  &lt;bios&gt;
    &lt;entry name='vendor'&gt;LENOVO&lt;/entry&gt;
  &lt;/bios&gt;
  &lt;system&gt;
    &lt;entry name='manufacturer'&gt;Fedora&lt;/entry&gt;
    &lt;entry name='product'&gt;Virt-Manager&lt;/entry&gt;
    &lt;entry name='version'&gt;0.9.4&lt;/entry&gt;
  &lt;/system&gt;
  &lt;baseBoard&gt;
    &lt;entry name='manufacturer'&gt;LENOVO&lt;/entry&gt;
    &lt;entry name='product'&gt;20BE0061MC&lt;/entry&gt;
    &lt;entry name='version'&gt;0B98401 Pro&lt;/entry&gt;
    &lt;entry name='serial'&gt;W1KS427111E&lt;/entry&gt;
  &lt;/baseBoard&gt;
  &lt;chassis&gt;
    &lt;entry name='manufacturer'&gt;Dell Inc.&lt;/entry&gt;
    &lt;entry name='version'&gt;2.12&lt;/entry&gt;
    &lt;entry name='serial'&gt;65X0XF2&lt;/entry&gt;
    &lt;entry name='asset'&gt;40000101&lt;/entry&gt;
    &lt;entry name='sku'&gt;Type3Sku1&lt;/entry&gt;
  &lt;/chassis&gt;
  &lt;oemStrings&gt;
    &lt;entry&gt;myappname:some arbitrary data&lt;/entry&gt;
    &lt;entry&gt;otherappname:more arbitrary data&lt;/entry&gt;
  &lt;/oemStrings&gt;
&lt;/sysinfo&gt;
&lt;sysinfo type='fwcfg'&gt;
  &lt;entry name='opt/com.example/name'&gt;example value&lt;/entry&gt;
  &lt;entry name='opt/com.coreos/config' file='/tmp/provision.ign'/&gt;
&lt;/sysinfo&gt;
...</pre>
<p>The <span class="docutils literal">sysinfo</span> element has a mandatory attribute <span class="docutils literal">type</span> that determine the
layout of sub-elements, with supported values of:</p>
<dl>
<dt><span class="docutils literal">smbios</span></dt>
<dd><p>Sub-elements call out specific SMBIOS values, which will affect the guest if
used in conjunction with the <span class="docutils literal">smbios</span> sub-element of the
<a class="reference external" href="formatdomain.html#elementsOS">os</a> element. Each sub-element of <span class="docutils literal">sysinfo</span> names a SMBIOS
block, and within those elements can be a list of <span class="docutils literal">entry</span> elements that
describe a field within the block. The following blocks and entries are
recognized:</p>
<dl>
<dt><span class="docutils literal">bios</span></dt>
<dd><p>This is block 0 of SMBIOS, with entry names drawn from:</p>
<dl class="simple">
<dt><span class="docutils literal">vendor</span></dt>
<dd><p>BIOS Vendor's Name</p>
</dd>
<dt><span class="docutils literal">version</span></dt>
<dd><p>BIOS Version</p>
</dd>
<dt><span class="docutils literal">date</span></dt>
<dd><p>BIOS release date. If supplied, is in either mm/dd/yy or mm/dd/yyyy
format. If the year portion of the string is two digits, the year is
assumed to be 19yy.</p>
</dd>
<dt><span class="docutils literal">release</span></dt>
<dd><p>System BIOS Major and Minor release number values concatenated together
as one string separated by a period, for example, 10.22.</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">system</span></dt>
<dd><p>This is block 1 of SMBIOS, with entry names drawn from:</p>
<dl class="simple">
<dt><span class="docutils literal">manufacturer</span></dt>
<dd><p>Manufacturer of BIOS</p>
</dd>
<dt><span class="docutils literal">product</span></dt>
<dd><p>Product Name</p>
</dd>
<dt><span class="docutils literal">version</span></dt>
<dd><p>Version of the product</p>
</dd>
<dt><span class="docutils literal">serial</span></dt>
<dd><p>Serial number</p>
</dd>
<dt><span class="docutils literal">uuid</span></dt>
<dd><p>Universal Unique ID number. If this entry is provided alongside a
top-level <a class="reference external" href="formatdomain.html#elementsMetadata">uuid</a> element, then the two values
must match.</p>
</dd>
<dt><span class="docutils literal">sku</span></dt>
<dd><p>SKU number to identify a particular configuration.</p>
</dd>
<dt><span class="docutils literal">family</span></dt>
<dd><p>Identify the family a particular computer belongs to.</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">baseBoard</span></dt>
<dd><p>This is block 2 of SMBIOS. This element can be repeated multiple times to
describe all the base boards; however, not all hypervisors necessarily
support the repetition. The element can have the following children:</p>
<dl class="simple">
<dt><span class="docutils literal">manufacturer</span></dt>
<dd><p>Manufacturer of BIOS</p>
</dd>
<dt><span class="docutils literal">product</span></dt>
<dd><p>Product Name</p>
</dd>
<dt><span class="docutils literal">version</span></dt>
<dd><p>Version of the product</p>
</dd>
<dt><span class="docutils literal">serial</span></dt>
<dd><p>Serial number</p>
</dd>
<dt><span class="docutils literal">asset</span></dt>
<dd><p>Asset tag</p>
</dd>
<dt><span class="docutils literal">location</span></dt>
<dd><p>Location in chassis</p>
</dd>
</dl>
<p>NB: Incorrectly supplied entries for the <span class="docutils literal">bios</span>, <span class="docutils literal">system</span> or
<span class="docutils literal">baseBoard</span> blocks will be ignored without error. Other than <span class="docutils literal">uuid</span>
validation and <span class="docutils literal">date</span> format checking, all values are passed as strings
to the hypervisor driver.</p>
</dd>
<dt><span class="docutils literal">chassis</span></dt>
<dd><p><span class="since">Since 4.1.0,</span> this is block 3 of SMBIOS, with entry names drawn
from:</p>
<dl class="simple">
<dt><span class="docutils literal">manufacturer</span></dt>
<dd><p>Manufacturer of Chassis</p>
</dd>
<dt><span class="docutils literal">version</span></dt>
<dd><p>Version of the Chassis</p>
</dd>
<dt><span class="docutils literal">serial</span></dt>
<dd><p>Serial number</p>
</dd>
<dt><span class="docutils literal">asset</span></dt>
<dd><p>Asset tag</p>
</dd>
<dt><span class="docutils literal">sku</span></dt>
<dd><p>SKU number</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">oemStrings</span></dt>
<dd><p>This is block 11 of SMBIOS. This element should appear once and can have
multiple <span class="docutils literal">entry</span> child elements, each providing arbitrary string data.
There are no restrictions on what data can be provided in the entries,
however, if the data is intended to be consumed by an application in the
guest, it is recommended to use the application name as a prefix in the
string. ( <span class="since">Since 4.1.0</span> )</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">fwcfg</span></dt>
<dd><p>Some hypervisors provide unified way to tweak how firmware configures itself,
or may contain tables to be installed for the guest OS, for instance boot
order, ACPI, SMBIOS, etc.</p>
<p>It even allows users to define their own config blobs. In case of QEMU,
these then appear under domain's sysfs (if the guest kernel has FW_CFG_SYSFS
config option enabled), under <span class="docutils literal">/sys/firmware/qemu_fw_cfg</span>. Note, that
these values apply regardless the <span class="docutils literal">&lt;smbios/&gt;</span> mode under <span class="docutils literal">&lt;os/&gt;</span>.
<span class="since">Since 6.5.0</span></p>
<p><strong>Please note that because of limited number of data slots use of fwcfg is
strongly discouraged and &lt;oemStrings/&gt; should be used instead</strong>.</p>
<pre class="literal-block">&lt;sysinfo type='fwcfg'&gt;
  &lt;entry name='opt/com.example/name'&gt;example value&lt;/entry&gt;
  &lt;entry name='opt/com.example/config' file='/tmp/provision.ign'/&gt;
&lt;/sysinfo&gt;</pre>
<p>The <span class="docutils literal">sysinfo</span> element can have multiple <span class="docutils literal">entry</span> child elements. Each
element then has mandatory <span class="docutils literal">name</span> attribute, which defines the name of the
blob and must begin with <span class="docutils literal">"opt/"</span> and to avoid clashing with other names is
advised to be in form <span class="docutils literal"><span class="pre">"opt/$RFQDN/$name"</span></span> where <span class="docutils literal">$RFQDN</span> is a reverse
fully qualified domain name you control. Then, the element can either contain
the value (to set the blob value directly), or <span class="docutils literal">file</span> attribute (to set the
blob value from the file).</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsCPUAllocation"/></span></p>
</div>
<div class="section" id="cpu-allocation">
<h2><a class="toc-backref" href="formatdomain.html#id9">CPU Allocation</a><a class="headerlink" href="formatdomain.html#cpu-allocation" title="Link to this headline">¶</a></h2>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;vcpu placement='static' cpuset="1-4,^3,6" current="1"&gt;2&lt;/vcpu&gt;
  &lt;vcpus&gt;
    &lt;vcpu id='0' enabled='yes' hotpluggable='no' order='1'/&gt;
    &lt;vcpu id='1' enabled='no' hotpluggable='yes'/&gt;
  &lt;/vcpus&gt;
  ...
&lt;/domain&gt;</pre>
<dl>
<dt><span class="docutils literal">vcpu</span></dt>
<dd><p>The content of this element defines the maximum number of virtual CPUs
allocated for the guest OS, which must be between 1 and the maximum supported
by the hypervisor.</p>
<dl class="simple">
<dt><span class="docutils literal">cpuset</span></dt>
<dd><p>The optional attribute <span class="docutils literal">cpuset</span> is a comma-separated list of physical
CPU numbers that domain process and virtual CPUs can be pinned to by
default. (NB: The pinning policy of domain process and virtual CPUs can be
specified separately by <span class="docutils literal">cputune</span>. If the attribute <span class="docutils literal">emulatorpin</span> of
<span class="docutils literal">cputune</span> is specified, the <span class="docutils literal">cpuset</span> specified by <span class="docutils literal">vcpu</span> here will
be ignored. Similarly, for virtual CPUs which have the <span class="docutils literal">vcpupin</span>
specified, the <span class="docutils literal">cpuset</span> specified by <span class="docutils literal">cpuset</span> here will be ignored.
For virtual CPUs which don't have <span class="docutils literal">vcpupin</span> specified, each will be
pinned to the physical CPUs specified by <span class="docutils literal">cpuset</span> here). Each element in
that list is either a single CPU number, a range of CPU numbers, or a
caret followed by a CPU number to be excluded from a previous range.
<span class="since">Since 0.4.4</span></p>
</dd>
<dt><span class="docutils literal">current</span></dt>
<dd><p>The optional attribute <span class="docutils literal">current</span> can be used to specify whether fewer
than the maximum number of virtual CPUs should be enabled. <span class="since">Since
0.8.5</span></p>
</dd>
<dt><span class="docutils literal">placement</span></dt>
<dd><p>The optional attribute <span class="docutils literal">placement</span> can be used to indicate the CPU
placement mode for domain process. The value can be either "static" or
"auto", but defaults to <span class="docutils literal">placement</span> of <span class="docutils literal">numatune</span> or "static" if
<span class="docutils literal">cpuset</span> is specified. Using "auto" indicates the domain process will be
pinned to the advisory nodeset from querying numad and the value of
attribute <span class="docutils literal">cpuset</span> will be ignored if it's specified. If both <span class="docutils literal">cpuset</span>
and <span class="docutils literal">placement</span> are not specified or if <span class="docutils literal">placement</span> is "static", but
no <span class="docutils literal">cpuset</span> is specified, the domain process will be pinned to all the
available physical CPUs. <span class="since">Since 0.9.11 (QEMU and KVM only)</span></p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">vcpus</span></dt>
<dd><p>The vcpus element allows to control state of individual vCPUs. The <span class="docutils literal">id</span>
attribute specifies the vCPU id as used by libvirt in other places such as
vCPU pinning, scheduler information and NUMA assignment. Note that the vCPU
ID as seen in the guest may differ from libvirt ID in certain cases. Valid
IDs are from 0 to the maximum vCPU count as set by the <span class="docutils literal">vcpu</span> element minus
1. The <span class="docutils literal">enabled</span> attribute allows to control the state of the vCPU. Valid
values are <span class="docutils literal">yes</span> and <span class="docutils literal">no</span>. <span class="docutils literal">hotpluggable</span> controls whether given vCPU
can be hotplugged and hotunplugged in cases when the CPU is enabled at boot.
Note that all disabled vCPUs must be hotpluggable. Valid values are <span class="docutils literal">yes</span>
and <span class="docutils literal">no</span>. <span class="docutils literal">order</span> allows to specify the order to add the online vCPUs.
For hypervisors/platforms that require to insert multiple vCPUs at once the
order may be duplicated across all vCPUs that need to be enabled at once.
Specifying order is not necessary, vCPUs are then added in an arbitrary
order. If order info is used, it must be used for all online vCPUs.
Hypervisors may clear or update ordering information during certain
operations to assure valid configuration. Note that hypervisors may create
hotpluggable vCPUs differently from boot vCPUs thus special initialization
may be necessary. Hypervisors may require that vCPUs enabled on boot which
are not hotpluggable are clustered at the beginning starting with ID 0. It
may be also required that vCPU 0 is always present and non-hotpluggable. Note
that providing state for individual CPUs may be necessary to enable support
of addressable vCPU hotplug and this feature may not be supported by all
hypervisors. For QEMU the following conditions are required. vCPU 0 needs to
be enabled and non-hotpluggable. On PPC64 along with it vCPUs that are in the
same core need to be enabled as well. All non-hotpluggable CPUs present at
boot need to be grouped after vCPU 0. <span class="since">Since 2.2.0 (QEMU only)</span></p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsIOThreadsAllocation"/></span></p>
</div>
<div class="section" id="iothreads-allocation">
<h2><a class="toc-backref" href="formatdomain.html#id10">IOThreads Allocation</a><a class="headerlink" href="formatdomain.html#iothreads-allocation" title="Link to this headline">¶</a></h2>
<p>IOThreads are dedicated event loop threads for supported disk devices to perform
block I/O requests in order to improve scalability especially on an SMP
host/guest with many LUNs. <span class="since">Since 1.2.8 (QEMU only)</span></p>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;iothreads&gt;4&lt;/iothreads&gt;
  ...
&lt;/domain&gt;</pre>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;iothreadids&gt;
    &lt;iothread id="2"/&gt;
    &lt;iothread id="4"/&gt;
    &lt;iothread id="6"/&gt;
    &lt;iothread id="8"/&gt;
  &lt;/iothreadids&gt;
  ...
&lt;/domain&gt;</pre>
<dl class="simple">
<dt><span class="docutils literal">iothreads</span></dt>
<dd><p>The content of this optional element defines the number of IOThreads to be
assigned to the domain for use by supported target storage devices. There
should be only 1 or 2 IOThreads per host CPU. There may be more than one
supported device assigned to each IOThread. <span class="since">Since 1.2.8</span></p>
</dd>
<dt><span class="docutils literal">iothreadids</span></dt>
<dd><p>The optional <span class="docutils literal">iothreadids</span> element provides the capability to specifically
define the IOThread ID's for the domain. By default, IOThread ID's are
sequentially numbered starting from 1 through the number of <span class="docutils literal">iothreads</span>
defined for the domain. The <span class="docutils literal">id</span> attribute is used to define the IOThread
ID. The <span class="docutils literal">id</span> attribute must be a positive integer greater than 0. If there
are less <span class="docutils literal">iothreadids</span> defined than <span class="docutils literal">iothreads</span> defined for the domain,
then libvirt will sequentially fill <span class="docutils literal">iothreadids</span> starting at 1 avoiding
any predefined <span class="docutils literal">id</span>. If there are more <span class="docutils literal">iothreadids</span> defined than
<span class="docutils literal">iothreads</span> defined for the domain, then the <span class="docutils literal">iothreads</span> value will be
adjusted accordingly. <span class="since">Since 1.2.15</span></p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsCPUTuning"/></span></p>
</div>
<div class="section" id="cpu-tuning">
<h2><a class="toc-backref" href="formatdomain.html#id11">CPU Tuning</a><a class="headerlink" href="formatdomain.html#cpu-tuning" title="Link to this headline">¶</a></h2>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;cputune&gt;
    &lt;vcpupin vcpu="0" cpuset="1-4,^2"/&gt;
    &lt;vcpupin vcpu="1" cpuset="0,1"/&gt;
    &lt;vcpupin vcpu="2" cpuset="2,3"/&gt;
    &lt;vcpupin vcpu="3" cpuset="0,4"/&gt;
    &lt;emulatorpin cpuset="1-3"/&gt;
    &lt;iothreadpin iothread="1" cpuset="5,6"/&gt;
    &lt;iothreadpin iothread="2" cpuset="7,8"/&gt;
    &lt;shares&gt;2048&lt;/shares&gt;
    &lt;period&gt;1000000&lt;/period&gt;
    &lt;quota&gt;-1&lt;/quota&gt;
    &lt;global_period&gt;1000000&lt;/global_period&gt;
    &lt;global_quota&gt;-1&lt;/global_quota&gt;
    &lt;emulator_period&gt;1000000&lt;/emulator_period&gt;
    &lt;emulator_quota&gt;-1&lt;/emulator_quota&gt;
    &lt;iothread_period&gt;1000000&lt;/iothread_period&gt;
    &lt;iothread_quota&gt;-1&lt;/iothread_quota&gt;
    &lt;vcpusched vcpus='0-4,^3' scheduler='fifo' priority='1'/&gt;
    &lt;iothreadsched iothreads='2' scheduler='batch'/&gt;
    &lt;cachetune vcpus='0-3'&gt;
      &lt;cache id='0' level='3' type='both' size='3' unit='MiB'/&gt;
      &lt;cache id='1' level='3' type='both' size='3' unit='MiB'/&gt;
      &lt;monitor level='3' vcpus='1'/&gt;
      &lt;monitor level='3' vcpus='0-3'/&gt;
    &lt;/cachetune&gt;
    &lt;cachetune vcpus='4-5'&gt;
      &lt;monitor level='3' vcpus='4'/&gt;
      &lt;monitor level='3' vcpus='5'/&gt;
    &lt;/cachetune&gt;
    &lt;memorytune vcpus='0-3'&gt;
      &lt;node id='0' bandwidth='60'/&gt;
    &lt;/memorytune&gt;

  &lt;/cputune&gt;
  ...
&lt;/domain&gt;</pre>
<dl>
<dt><span class="docutils literal">cputune</span></dt>
<dd><p>The optional <span class="docutils literal">cputune</span> element provides details regarding the CPU tunable
parameters for the domain. Note: for the qemu driver, the optional
<span class="docutils literal">vcpupin</span> and <span class="docutils literal">emulatorpin</span> pinning settings are honored after the
emulator is launched and NUMA constraints considered. This means that it is
expected that other physical CPUs of the host will be used during this time
by the domain, which will be reflected by the output of <span class="docutils literal">virsh <span class="pre">cpu-stats</span></span>.
<span class="since">Since 0.9.0</span></p>
</dd>
<dt><span class="docutils literal">vcpupin</span></dt>
<dd><p>The optional <span class="docutils literal">vcpupin</span> element specifies which of host's physical CPUs the
domain vCPU will be pinned to. If this is omitted, and attribute <span class="docutils literal">cpuset</span>
of element <span class="docutils literal">vcpu</span> is not specified, the vCPU is pinned to all the physical
CPUs by default. It contains two required attributes, the attribute <span class="docutils literal">vcpu</span>
specifies vCPU id, and the attribute <span class="docutils literal">cpuset</span> is same as attribute
<span class="docutils literal">cpuset</span> of element <span class="docutils literal">vcpu</span>. (NB: Only qemu driver support) <span class="since">Since
0.9.0</span></p>
</dd>
<dt><span class="docutils literal">emulatorpin</span></dt>
<dd><p>The optional <span class="docutils literal">emulatorpin</span> element specifies which of host physical CPUs
the "emulator", a subset of a domain not including vCPU or iothreads will be
pinned to. If this is omitted, and attribute <span class="docutils literal">cpuset</span> of element <span class="docutils literal">vcpu</span>
is not specified, "emulator" is pinned to all the physical CPUs by default.
It contains one required attribute <span class="docutils literal">cpuset</span> specifying which physical CPUs
to pin to.</p>
</dd>
<dt><span class="docutils literal">iothreadpin</span></dt>
<dd><p>The optional <span class="docutils literal">iothreadpin</span> element specifies which of host physical CPUs
the IOThreads will be pinned to. If this is omitted and attribute <span class="docutils literal">cpuset</span>
of element <span class="docutils literal">vcpu</span> is not specified, the IOThreads are pinned to all the
physical CPUs by default. There are two required attributes, the attribute
<span class="docutils literal">iothread</span> specifies the IOThread ID and the attribute <span class="docutils literal">cpuset</span>
specifying which physical CPUs to pin to. See the <span class="docutils literal">iothreadids</span>
<a class="reference external" href="formatdomain.html#elementsIOThreadsAllocation">description</a> for valid <span class="docutils literal">iothread</span> values.
<span class="since">Since 1.2.9</span></p>
</dd>
<dt><span class="docutils literal">shares</span></dt>
<dd><p>The optional <span class="docutils literal">shares</span> element specifies the proportional weighted share for
the domain. If this is omitted, it defaults to the OS provided defaults. NB,
There is no unit for the value, it's a relative measure based on the setting
of other VM, e.g. A VM configured with value 2048 will get twice as much CPU
time as a VM configured with value 1024. <span class="since">Since 0.9.0</span></p>
</dd>
<dt><span class="docutils literal">period</span></dt>
<dd><p>The optional <span class="docutils literal">period</span> element specifies the enforcement interval (unit:
microseconds). Within <span class="docutils literal">period</span>, each vCPU of the domain will not be allowed
to consume more than <span class="docutils literal">quota</span> worth of runtime. The value should be in range
[1000, 1000000]. A period with value 0 means no value. <span class="since">Only QEMU
driver support since 0.9.4, LXC since 0.9.10</span></p>
</dd>
<dt><span class="docutils literal">quota</span></dt>
<dd><p>The optional <span class="docutils literal">quota</span> element specifies the maximum allowed bandwidth (unit:
microseconds). A domain with <span class="docutils literal">quota</span> as any negative value indicates that
the domain has infinite bandwidth for vCPU threads, which means that it is
not bandwidth controlled. The value should be in range [1000,
17592186044415] or less than 0. A quota with value 0 means no value. You
can use this feature to ensure that all vCPUs run at the same speed.
<span class="since">Only QEMU driver support since 0.9.4, LXC since 0.9.10</span></p>
</dd>
<dt><span class="docutils literal">global_period</span></dt>
<dd><p>The optional <span class="docutils literal">global_period</span> element specifies the enforcement CFS
scheduler interval (unit: microseconds) for the whole domain in contrast with
<span class="docutils literal">period</span> which enforces the interval per vCPU. The value should be in range
1000, 1000000]. A <span class="docutils literal">global_period</span> with value 0 means no value. <span class="since">Only
QEMU driver support since 1.3.3</span></p>
</dd>
<dt><span class="docutils literal">global_quota</span></dt>
<dd><p>The optional <span class="docutils literal">global_quota</span> element specifies the maximum allowed bandwidth
(unit: microseconds) within a period for the whole domain. A domain with
<span class="docutils literal">global_quota</span> as any negative value indicates that the domain has infinite
bandwidth, which means that it is not bandwidth controlled. The value should
be in range [1000, 17592186044415] or less than 0. A <span class="docutils literal">global_quota</span> with
value 0 means no value. <span class="since">Only QEMU driver support since 1.3.3</span></p>
</dd>
<dt><span class="docutils literal">emulator_period</span></dt>
<dd><p>The optional <span class="docutils literal">emulator_period</span> element specifies the enforcement interval
(unit: microseconds). Within <span class="docutils literal">emulator_period</span>, emulator threads (those
excluding vCPUs) of the domain will not be allowed to consume more than
<span class="docutils literal">emulator_quota</span> worth of runtime. The value should be in range [1000,
1000000]. A period with value 0 means no value. <span class="since">Only QEMU driver
support since 0.10.0</span></p>
</dd>
<dt><span class="docutils literal">emulator_quota</span></dt>
<dd><p>The optional <span class="docutils literal">emulator_quota</span> element specifies the maximum allowed
bandwidth (unit: microseconds) for domain's emulator threads (those excluding
vCPUs). A domain with <span class="docutils literal">emulator_quota</span> as any negative value indicates that
the domain has infinite bandwidth for emulator threads (those excluding
vCPUs), which means that it is not bandwidth controlled. The value should be
in range [1000, 17592186044415] or less than 0. A quota with value 0 means
no value. <span class="since">Only QEMU driver support since 0.10.0</span></p>
</dd>
<dt><span class="docutils literal">iothread_period</span></dt>
<dd><p>The optional <span class="docutils literal">iothread_period</span> element specifies the enforcement interval
(unit: microseconds) for IOThreads. Within <span class="docutils literal">iothread_period</span>, each IOThread
of the domain will not be allowed to consume more than <span class="docutils literal">iothread_quota</span>
worth of runtime. The value should be in range [1000, 1000000]. An
iothread_period with value 0 means no value. <span class="since">Only QEMU driver support
since 2.1.0</span></p>
</dd>
<dt><span class="docutils literal">iothread_quota</span></dt>
<dd><p>The optional <span class="docutils literal">iothread_quota</span> element specifies the maximum allowed
bandwidth (unit: microseconds) for IOThreads. A domain with
<span class="docutils literal">iothread_quota</span> as any negative value indicates that the domain IOThreads
have infinite bandwidth, which means that it is not bandwidth controlled. The
value should be in range [1000, 17592186044415] or less than 0. An
<span class="docutils literal">iothread_quota</span> with value 0 means no value. You can use this feature to
ensure that all IOThreads run at the same speed. <span class="since">Only QEMU driver
support since 2.1.0</span></p>
</dd>
<dt><span class="docutils literal">vcpusched</span>, <span class="docutils literal">iothreadsched</span> and <span class="docutils literal">emulatorsched</span></dt>
<dd><p>The optional <span class="docutils literal">vcpusched</span>, <span class="docutils literal">iothreadsched</span> and <span class="docutils literal">emulatorsched</span> elements
specify the scheduler type (values <span class="docutils literal">batch</span>, <span class="docutils literal">idle</span>, <span class="docutils literal">fifo</span>, <span class="docutils literal">rr</span>) for
particular vCPU, IOThread and emulator threads respectively. For <span class="docutils literal">vcpusched</span>
and <span class="docutils literal">iothreadsched</span> the attributes <span class="docutils literal">vcpus</span> and <span class="docutils literal">iothreads</span> select which
vCPUs/IOThreads this setting applies to, leaving them out sets the default.
The element <span class="docutils literal">emulatorsched</span> does not have that attribute. Valid <span class="docutils literal">vcpus</span>
values start at 0 through one less than the number of vCPU's defined for the
domain. Valid <span class="docutils literal">iothreads</span> values are described in the <span class="docutils literal">iothreadids</span>
<a class="reference external" href="formatdomain.html#elementsIOThreadsAllocation">description</a>. If no <span class="docutils literal">iothreadids</span> are
defined, then libvirt numbers IOThreads from 1 to the number of <span class="docutils literal">iothreads</span>
available for the domain. For real-time schedulers (<span class="docutils literal">fifo</span>, <span class="docutils literal">rr</span>),
priority must be specified as well (and is ignored for non-real-time ones).
The value range for the priority depends on the host kernel (usually 1-99).
<span class="since">Since 1.2.13</span> <span class="docutils literal">emulatorsched</span> <span class="since">since 5.3.0</span></p>
</dd>
<dt><span class="docutils literal">cachetune</span> <span class="since">Since 4.1.0</span></dt>
<dd><p>Optional <span class="docutils literal">cachetune</span> element can control allocations for CPU caches using
the resctrl on the host. Whether or not is this supported can be gathered
from capabilities where some limitations like minimum size and required
granularity are reported as well. The required attribute <span class="docutils literal">vcpus</span> specifies
to which vCPUs this allocation applies. A vCPU can only be member of one
<span class="docutils literal">cachetune</span> element allocation. The vCPUs specified by cachetune can be
identical with those in memorytune, however they are not allowed to overlap.
Supported subelements are:</p>
<dl>
<dt><span class="docutils literal">cache</span></dt>
<dd><p>This optional element controls the allocation of CPU cache and has the
following attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">level</span></dt>
<dd><p>Host cache level from which to allocate.</p>
</dd>
<dt><span class="docutils literal">id</span></dt>
<dd><p>Host cache id from which to allocate.</p>
</dd>
<dt><span class="docutils literal">type</span></dt>
<dd><p>Type of allocation. Can be <span class="docutils literal">code</span> for code (instructions), <span class="docutils literal">data</span>
for data or <span class="docutils literal">both</span> for both code and data (unified). Currently the
allocation can be done only with the same type as the host supports,
meaning you cannot request <span class="docutils literal">both</span> for host with CDP (code/data
prioritization) enabled.</p>
</dd>
<dt><span class="docutils literal">size</span></dt>
<dd><p>The size of the region to allocate. The value by default is in bytes,
but the <span class="docutils literal">unit</span> attribute can be used to scale the value.</p>
</dd>
<dt><span class="docutils literal">unit</span> (optional)</dt>
<dd><p>If specified it is the unit such as KiB, MiB, GiB, or TiB (described in
the <span class="docutils literal">memory</span> element for <a class="reference external" href="formatdomain.html#elementsMemoryAllocation">Memory
Allocation</a>) in which <span class="docutils literal">size</span> is
specified, defaults to bytes.</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">monitor</span> <span class="since">Since 4.10.0</span></dt>
<dd><p>The optional element <span class="docutils literal">monitor</span> creates the cache monitor(s) for current
cache allocation and has the following required attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">level</span></dt>
<dd><p>Host cache level the monitor belongs to.</p>
</dd>
<dt><span class="docutils literal">vcpus</span></dt>
<dd><p>vCPU list the monitor applies to. A monitor's vCPU list can only be the
member(s) of the vCPU list of the associated allocation. The default
monitor has the same vCPU list as the associated allocation. For
non-default monitors, overlapping vCPUs are not permitted.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">memorytune</span> <span class="since">Since 4.7.0</span></dt>
<dd><p>Optional <span class="docutils literal">memorytune</span> element can control allocations for memory bandwidth
using the resctrl on the host. Whether or not is this supported can be
gathered from capabilities where some limitations like minimum bandwidth and
required granularity are reported as well. The required attribute <span class="docutils literal">vcpus</span>
specifies to which vCPUs this allocation applies. A vCPU can only be member
of one <span class="docutils literal">memorytune</span> element allocation. The <span class="docutils literal">vcpus</span> specified by
<span class="docutils literal">memorytune</span> can be identical to those specified by <span class="docutils literal">cachetune</span>. However
they are not allowed to overlap each other. Supported subelements are:</p>
<dl>
<dt><span class="docutils literal">node</span></dt>
<dd><p>This element controls the allocation of CPU memory bandwidth and has the
following attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">id</span></dt>
<dd><p>Host node id from which to allocate memory bandwidth.</p>
</dd>
<dt><span class="docutils literal">bandwidth</span></dt>
<dd><p>The memory bandwidth to allocate from this node. The value by default
is in percentage.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p><span class="anchor"><a id="elementsMemoryAllocation"/></span></p>
</div>
<div class="section" id="memory-allocation">
<h2><a class="toc-backref" href="formatdomain.html#id12">Memory Allocation</a><a class="headerlink" href="formatdomain.html#memory-allocation" title="Link to this headline">¶</a></h2>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;maxMemory slots='16' unit='KiB'&gt;1524288&lt;/maxMemory&gt;
  &lt;memory unit='KiB'&gt;524288&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;524288&lt;/currentMemory&gt;
  ...
&lt;/domain&gt;</pre>
<dl class="simple">
<dt><span class="docutils literal">memory</span></dt>
<dd><p>The maximum allocation of memory for the guest at boot time. The memory
allocation includes possible additional memory devices specified at start or
hotplugged later. The units for this value are determined by the optional
attribute <span class="docutils literal">unit</span>, which defaults to "KiB" (kibibytes, 2<sup>10</sup> or
blocks of 1024 bytes). Valid units are "b" or "bytes" for bytes, "KB" for
kilobytes (10<sup>3</sup> or 1,000 bytes), "k" or "KiB" for kibibytes (1024
bytes), "MB" for megabytes (10<sup>6</sup> or 1,000,000 bytes), "M" or "MiB" for
mebibytes (2<sup>20</sup> or 1,048,576 bytes), "GB" for gigabytes (10<sup>9</sup> or
1,000,000,000 bytes), "G" or "GiB" for gibibytes (2<sup>30</sup> or 1,073,741,824
bytes), "TB" for terabytes (10<sup>12</sup> or 1,000,000,000,000 bytes), or "T"
or "TiB" for tebibytes (2<sup>40</sup> or 1,099,511,627,776 bytes). However, the
value will be rounded up to the nearest kibibyte by libvirt, and may be
further rounded to the granularity supported by the hypervisor. Some
hypervisors also enforce a minimum, such as 4000KiB. In case
<a class="reference external" href="formatdomain.html#elementsCPU">NUMA</a> is configured for the guest the <span class="docutils literal">memory</span> element
can be omitted. In the case of crash, optional attribute <span class="docutils literal">dumpCore</span> can be
used to control whether the guest memory should be included in the generated
coredump or not (values "on", "off"). <span class="docutils literal">unit</span> <span class="since">since 0.9.11</span> ,
<span class="docutils literal">dumpCore</span> <span class="since">since 0.10.2 (QEMU only)</span></p>
</dd>
<dt><span class="docutils literal">maxMemory</span></dt>
<dd><p>The run time maximum memory allocation of the guest. The initial memory
specified by either the <span class="docutils literal">&lt;memory&gt;</span> element or the NUMA cell size
configuration can be increased by hot-plugging of memory to the limit
specified by this element. The <span class="docutils literal">unit</span> attribute behaves the same as for
<span class="docutils literal">&lt;memory&gt;</span>. The <span class="docutils literal">slots</span> attribute specifies the number of slots available
for adding memory to the guest. The bounds are hypervisor specific. Note that
due to alignment of the memory chunks added via memory hotplug the full size
allocation specified by this element may be impossible to achieve.
<span class="since">Since 1.2.14 supported by the QEMU driver.</span></p>
</dd>
<dt><span class="docutils literal">currentMemory</span></dt>
<dd><p>The actual allocation of memory for the guest. This value can be less than
the maximum allocation, to allow for ballooning up the guests memory on the
fly. If this is omitted, it defaults to the same value as the <span class="docutils literal">memory</span>
element. The <span class="docutils literal">unit</span> attribute behaves the same as for <span class="docutils literal">memory</span>.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsMemoryBacking"/></span></p>
</div>
<div class="section" id="memory-backing">
<h2><a class="toc-backref" href="formatdomain.html#id13">Memory Backing</a><a class="headerlink" href="formatdomain.html#memory-backing" title="Link to this headline">¶</a></h2>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;memoryBacking&gt;
    &lt;hugepages&gt;
      &lt;page size="1" unit="G" nodeset="0-3,5"/&gt;
      &lt;page size="2" unit="M" nodeset="4"/&gt;
    &lt;/hugepages&gt;
    &lt;nosharepages/&gt;
    &lt;locked/&gt;
    &lt;source type="file|anonymous|memfd"/&gt;
    &lt;access mode="shared|private"/&gt;
    &lt;allocation mode="immediate|ondemand"/&gt;
    &lt;discard/&gt;
  &lt;/memoryBacking&gt;
  ...
&lt;/domain&gt;</pre>
<p>The optional <span class="docutils literal">memoryBacking</span> element may contain several elements that
influence how virtual memory pages are backed by host pages.</p>
<dl class="simple">
<dt><span class="docutils literal">hugepages</span></dt>
<dd><p>This tells the hypervisor that the guest should have its memory allocated
using hugepages instead of the normal native page size. <span class="since">Since 1.2.5</span>
it's possible to set hugepages more specifically per numa node. The <span class="docutils literal">page</span>
element is introduced. It has one compulsory attribute <span class="docutils literal">size</span> which
specifies which hugepages should be used (especially useful on systems
supporting hugepages of different sizes). The default unit for the <span class="docutils literal">size</span>
attribute is kilobytes (multiplier of 1024). If you want to use different
unit, use optional <span class="docutils literal">unit</span> attribute. For systems with NUMA, the optional
<span class="docutils literal">nodeset</span> attribute may come handy as it ties given guest's NUMA nodes to
certain hugepage sizes. From the example snippet, one gigabyte hugepages are
used for every NUMA node except node number four. For the correct syntax see
<a class="reference external" href="formatdomain.html#elementsNUMATuning">this</a>.</p>
</dd>
<dt><span class="docutils literal">nosharepages</span></dt>
<dd><p>Instructs hypervisor to disable shared pages (memory merge, KSM) for this
domain. <span class="since">Since 1.0.6</span></p>
</dd>
<dt><span class="docutils literal">locked</span></dt>
<dd><p>When set and supported by the hypervisor, memory pages belonging to the
domain will be locked in host's memory and the host will not be allowed to
swap them out, which might be required for some workloads such as real-time.
For QEMU/KVM guests, the memory used by the QEMU process itself will be
locked too: unlike guest memory, this is an amount libvirt has no way of
figuring out in advance, so it has to remove the limit on locked memory
altogether. Thus, enabling this option opens up to a potential security risk:
the host will be unable to reclaim the locked memory back from the guest when
it's running out of memory, which means a malicious guest allocating large
amounts of locked memory could cause a denial-of-service attack on the host.
Because of this, using this option is discouraged unless your workload
demands it; even then, it's highly recommended to set a <span class="docutils literal">hard_limit</span> (see
<a class="reference external" href="formatdomain.html#elementsMemoryTuning">memory tuning</a>) on memory allocation suitable for
the specific environment at the same time to mitigate the risks described
above. <span class="since">Since 1.0.6</span></p>
</dd>
<dt><span class="docutils literal">source</span></dt>
<dd><p>Using the <span class="docutils literal">type</span> attribute, it's possible to provide "file" to utilize file
memorybacking or keep the default "anonymous". <span class="since">Since 4.10.0</span> , you
may choose "memfd" backing. (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal">access</span></dt>
<dd><p>Using the <span class="docutils literal">mode</span> attribute, specify if the memory is to be "shared" or
"private". This can be overridden per numa node by <span class="docutils literal">memAccess</span>.</p>
</dd>
<dt><span class="docutils literal">allocation</span></dt>
<dd><p>Using the <span class="docutils literal">mode</span> attribute, specify when to allocate the memory by
supplying either "immediate" or "ondemand".</p>
</dd>
<dt><span class="docutils literal">discard</span></dt>
<dd><p>When set and supported by hypervisor the memory content is discarded just
before guest shuts down (or when DIMM module is unplugged). Please note that
this is just an optimization and is not guaranteed to work in all cases (e.g.
when hypervisor crashes). <span class="since">Since 4.4.0</span> (QEMU/KVM only)</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsMemoryTuning"/></span></p>
</div>
<div class="section" id="memory-tuning">
<h2><a class="toc-backref" href="formatdomain.html#id14">Memory Tuning</a><a class="headerlink" href="formatdomain.html#memory-tuning" title="Link to this headline">¶</a></h2>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;memtune&gt;
    &lt;hard_limit unit='G'&gt;1&lt;/hard_limit&gt;
    &lt;soft_limit unit='M'&gt;128&lt;/soft_limit&gt;
    &lt;swap_hard_limit unit='G'&gt;2&lt;/swap_hard_limit&gt;
    &lt;min_guarantee unit='bytes'&gt;67108864&lt;/min_guarantee&gt;
  &lt;/memtune&gt;
  ...
&lt;/domain&gt;</pre>
<dl class="simple">
<dt><span class="docutils literal">memtune</span></dt>
<dd><p>The optional <span class="docutils literal">memtune</span> element provides details regarding the memory
tunable parameters for the domain. If this is omitted, it defaults to the OS
provided defaults. For QEMU/KVM, the parameters are applied to the QEMU
process as a whole. Thus, when counting them, one needs to add up guest RAM,
guest video RAM, and some memory overhead of QEMU itself. The last piece is
hard to determine so one needs guess and try. For each tunable, it is
possible to designate which unit the number is in on input, using the same
values as for <span class="docutils literal">&lt;memory&gt;</span>. For backwards compatibility, output is always in
KiB. <span class="docutils literal">unit</span> <span class="since">since 0.9.11</span> Possible values for all *_limit
parameters are in range from 0 to VIR_DOMAIN_MEMORY_PARAM_UNLIMITED.</p>
</dd>
<dt><span class="docutils literal">hard_limit</span></dt>
<dd><p>The optional <span class="docutils literal">hard_limit</span> element is the maximum memory the guest can use.
The units for this value are kibibytes (i.e. blocks of 1024 bytes). Users of
QEMU and KVM are strongly advised not to set this limit as domain may get
killed by the kernel if the guess is too low, and determining the memory
needed for a process to run is an <a class="reference external" href="https://en.wikipedia.org/wiki/Undecidable_problem">undecidable
problem</a>; that said, if
you already set <span class="docutils literal">locked</span> in <a class="reference external" href="formatdomain.html#elementsMemoryBacking">memory backing</a>
because your workload demands it, you'll have to take into account the
specifics of your deployment and figure out a value for <span class="docutils literal">hard_limit</span> that
is large enough to support the memory requirements of your guest, but small
enough to protect your host against a malicious guest locking all memory.</p>
</dd>
<dt><span class="docutils literal">soft_limit</span></dt>
<dd><p>The optional <span class="docutils literal">soft_limit</span> element is the memory limit to enforce during
memory contention. The units for this value are kibibytes (i.e. blocks of
1024 bytes)</p>
</dd>
<dt><span class="docutils literal">swap_hard_limit</span></dt>
<dd><p>The optional <span class="docutils literal">swap_hard_limit</span> element is the maximum memory plus swap the
guest can use. The units for this value are kibibytes (i.e. blocks of 1024
bytes). This has to be more than hard_limit value provided</p>
</dd>
<dt><span class="docutils literal">min_guarantee</span></dt>
<dd><p>The optional <span class="docutils literal">min_guarantee</span> element is the guaranteed minimum memory
allocation for the guest. The units for this value are kibibytes (i.e. blocks
of 1024 bytes). This element is only supported by VMware ESX and OpenVZ
drivers.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsNUMATuning"/></span></p>
</div>
<div class="section" id="numa-node-tuning">
<h2><a class="toc-backref" href="formatdomain.html#id15">NUMA Node Tuning</a><a class="headerlink" href="formatdomain.html#numa-node-tuning" title="Link to this headline">¶</a></h2>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;numatune&gt;
    &lt;memory mode="strict" nodeset="1-4,^3"/&gt;
    &lt;memnode cellid="0" mode="strict" nodeset="1"/&gt;
    &lt;memnode cellid="2" mode="preferred" nodeset="2"/&gt;
  &lt;/numatune&gt;
  ...
&lt;/domain&gt;</pre>
<dl class="simple">
<dt><span class="docutils literal">numatune</span></dt>
<dd><p>The optional <span class="docutils literal">numatune</span> element provides details of how to tune the
performance of a NUMA host via controlling NUMA policy for domain process.
NB, only supported by QEMU driver. <span class="since">Since 0.9.3</span></p>
</dd>
<dt><span class="docutils literal">memory</span></dt>
<dd><p>The optional <span class="docutils literal">memory</span> element specifies how to allocate memory for the
domain process on a NUMA host. It contains several optional attributes.
Attribute <span class="docutils literal">mode</span> is either 'interleave', 'strict', or 'preferred', defaults
to 'strict'. Attribute <span class="docutils literal">nodeset</span> specifies the NUMA nodes, using the same
syntax as attribute <span class="docutils literal">cpuset</span> of element <span class="docutils literal">vcpu</span>. Attribute <span class="docutils literal">placement</span> (
<span class="since">since 0.9.12</span> ) can be used to indicate the memory placement mode for
domain process, its value can be either "static" or "auto", defaults to
<span class="docutils literal">placement</span> of <span class="docutils literal">vcpu</span>, or "static" if <span class="docutils literal">nodeset</span> is specified. "auto"
indicates the domain process will only allocate memory from the advisory
nodeset returned from querying numad, and the value of attribute <span class="docutils literal">nodeset</span>
will be ignored if it's specified. If <span class="docutils literal">placement</span> of <span class="docutils literal">vcpu</span> is 'auto',
and <span class="docutils literal">numatune</span> is not specified, a default <span class="docutils literal">numatune</span> with <span class="docutils literal">placement</span>
'auto' and <span class="docutils literal">mode</span> 'strict' will be added implicitly. <span class="since">Since 0.9.3</span></p>
</dd>
<dt><span class="docutils literal">memnode</span></dt>
<dd><p>Optional <span class="docutils literal">memnode</span> elements can specify memory allocation policies per each
guest NUMA node. For those nodes having no corresponding <span class="docutils literal">memnode</span> element,
the default from element <span class="docutils literal">memory</span> will be used. Attribute <span class="docutils literal">cellid</span>
addresses guest NUMA node for which the settings are applied. Attributes
<span class="docutils literal">mode</span> and <span class="docutils literal">nodeset</span> have the same meaning and syntax as in <span class="docutils literal">memory</span>
element. This setting is not compatible with automatic placement.
<span class="since">QEMU Since 1.2.7</span></p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsBlockTuning"/></span></p>
</div>
<div class="section" id="block-i-o-tuning">
<h2><a class="toc-backref" href="formatdomain.html#id16">Block I/O Tuning</a><a class="headerlink" href="formatdomain.html#block-i-o-tuning" title="Link to this headline">¶</a></h2>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;blkiotune&gt;
    &lt;weight&gt;800&lt;/weight&gt;
    &lt;device&gt;
      &lt;path&gt;/dev/sda&lt;/path&gt;
      &lt;weight&gt;1000&lt;/weight&gt;
    &lt;/device&gt;
    &lt;device&gt;
      &lt;path&gt;/dev/sdb&lt;/path&gt;
      &lt;weight&gt;500&lt;/weight&gt;
      &lt;read_bytes_sec&gt;10000&lt;/read_bytes_sec&gt;
      &lt;write_bytes_sec&gt;10000&lt;/write_bytes_sec&gt;
      &lt;read_iops_sec&gt;20000&lt;/read_iops_sec&gt;
      &lt;write_iops_sec&gt;20000&lt;/write_iops_sec&gt;
    &lt;/device&gt;
  &lt;/blkiotune&gt;
  ...
&lt;/domain&gt;</pre>
<dl>
<dt><span class="docutils literal">blkiotune</span></dt>
<dd><p>The optional <span class="docutils literal">blkiotune</span> element provides the ability to tune Blkio cgroup
tunable parameters for the domain. If this is omitted, it defaults to the OS
provided defaults. <span class="since">Since 0.8.8</span></p>
</dd>
<dt><span class="docutils literal">weight</span></dt>
<dd><p>The optional <span class="docutils literal">weight</span> element is the overall I/O weight of the guest. The
value should be in the range [100, 1000]. After kernel 2.6.39, the value
could be in the range [10, 1000].</p>
</dd>
<dt><span class="docutils literal">device</span></dt>
<dd><p>The domain may have multiple <span class="docutils literal">device</span> elements that further tune the
weights for each host block device in use by the domain. Note that multiple
<a class="reference external" href="formatdomain.html#elementsDisks">guest disks</a> can share a single host block device, if
they are backed by files within the same host file system, which is why this
tuning parameter is at the global domain level rather than associated with
each guest disk device (contrast this to the <a class="reference external" href="formatdomain.html#elementsDisks">&lt;iotune&gt;</a>
element which can apply to an individual <span class="docutils literal">&lt;disk&gt;</span>). Each <span class="docutils literal">device</span> element
has two mandatory sub-elements, <span class="docutils literal">path</span> describing the absolute path of the
device, and <span class="docutils literal">weight</span> giving the relative weight of that device, in the
range [100, 1000]. After kernel 2.6.39, the value could be in the range [10,
1000]. <span class="since">Since 0.9.8</span>
Additionally, the following optional sub-elements can be used:</p>
<dl class="simple">
<dt><span class="docutils literal">read_bytes_sec</span></dt>
<dd><p>Read throughput limit in bytes per second. <span class="since">Since 1.2.2</span></p>
</dd>
<dt><span class="docutils literal">write_bytes_sec</span></dt>
<dd><p>Write throughput limit in bytes per second. <span class="since">Since 1.2.2</span></p>
</dd>
<dt><span class="docutils literal">read_iops_sec</span></dt>
<dd><p>Read I/O operations per second limit. <span class="since">Since 1.2.2</span></p>
</dd>
<dt><span class="docutils literal">write_iops_sec</span></dt>
<dd><p>Write I/O operations per second limit. <span class="since">Since 1.2.2</span></p>
</dd>
</dl>
</dd>
</dl>
<p><span class="anchor"><a id="resPartition"/></span></p>
</div>
<div class="section" id="resource-partitioning">
<h2><a class="toc-backref" href="formatdomain.html#id17">Resource partitioning</a><a class="headerlink" href="formatdomain.html#resource-partitioning" title="Link to this headline">¶</a></h2>
<p>Hypervisors may allow for virtual machines to be placed into resource
partitions, potentially with nesting of said partitions. The <span class="docutils literal">resource</span>
element groups together configuration related to resource partitioning. It
currently supports a child element <span class="docutils literal">partition</span> whose content defines the
absolute path of the resource partition in which to place the domain. If no
partition is listed, then the domain will be placed in a default partition. It
is the responsibility of the app/admin to ensure that the partition exists prior
to starting the guest. Only the (hypervisor specific) default partition can be
assumed to exist by default.</p>
<pre class="literal-block">...
&lt;resource&gt;
  &lt;partition&gt;/virtualmachines/production&lt;/partition&gt;
&lt;/resource&gt;
...</pre>
<p>Resource partitions are currently supported by the QEMU and LXC drivers, which
map partition paths to cgroups directories, in all mounted controllers.
<span class="since">Since 1.0.5</span></p>
<p><span class="anchor"><a id="elementsCPU"/></span></p>
</div>
<div class="section" id="cpu-model-and-topology">
<h2><a class="toc-backref" href="formatdomain.html#id18">CPU model and topology</a><a class="headerlink" href="formatdomain.html#cpu-model-and-topology" title="Link to this headline">¶</a></h2>
<p>Requirements for CPU model, its features and topology can be specified using the
following collection of elements. <span class="since">Since 0.7.5</span></p>
<pre class="literal-block">...
&lt;cpu match='exact'&gt;
  &lt;model fallback='allow'&gt;core2duo&lt;/model&gt;
  &lt;vendor&gt;Intel&lt;/vendor&gt;
  &lt;topology sockets='1' dies='1' cores='2' threads='1'/&gt;
  &lt;cache level='3' mode='emulate'/&gt;
  &lt;feature policy='disable' name='lahf_lm'/&gt;
&lt;/cpu&gt;
...</pre>
<pre class="literal-block">&lt;cpu mode='host-model'&gt;
  &lt;model fallback='forbid'/&gt;
  &lt;topology sockets='1' dies='1' cores='2' threads='1'/&gt;
&lt;/cpu&gt;
...</pre>
<pre class="literal-block">&lt;cpu mode='host-passthrough' migratable='off'&gt;
  &lt;cache mode='passthrough'/&gt;
  &lt;feature policy='disable' name='lahf_lm'/&gt;
...</pre>
<pre class="literal-block">&lt;cpu mode='maximum' migratable='off'&gt;
  &lt;cache mode='passthrough'/&gt;
  &lt;feature policy='disable' name='lahf_lm'/&gt;
...</pre>
<p>In case no restrictions need to be put on CPU model and its features, a simpler
<span class="docutils literal">cpu</span> element can be used. <span class="since">Since 0.7.6</span></p>
<pre class="literal-block">...
&lt;cpu&gt;
  &lt;topology sockets='1' dies='1' cores='2' threads='1'/&gt;
&lt;/cpu&gt;
...</pre>
<dl>
<dt><span class="docutils literal">cpu</span></dt>
<dd><p>The <span class="docutils literal">cpu</span> element is the main container for describing guest CPU
requirements. Its <span class="docutils literal">match</span> attribute specifies how strictly the virtual CPU
provided to the guest matches these requirements. <span class="since">Since 0.7.6</span> the
<span class="docutils literal">match</span> attribute can be omitted if <span class="docutils literal">topology</span> is the only element within
<span class="docutils literal">cpu</span>. Possible values for the <span class="docutils literal">match</span> attribute are:</p>
<dl class="simple">
<dt><span class="docutils literal">minimum</span></dt>
<dd><p>The specified CPU model and features describes the minimum requested CPU.
A better CPU will be provided to the guest if it is possible with the
requested hypervisor on the current host. This is a constrained
<span class="docutils literal"><span class="pre">host-model</span></span> mode; the domain will not be created if the provided
virtual CPU does not meet the requirements.</p>
</dd>
<dt><span class="docutils literal">exact</span></dt>
<dd><p>The virtual CPU provided to the guest should exactly match the
specification. If such CPU is not supported, libvirt will refuse to start
the domain.</p>
</dd>
<dt><span class="docutils literal">strict</span></dt>
<dd><p>The domain will not be created unless the host CPU exactly matches the
specification. This is not very useful in practice and should only be used
if there is a real reason.</p>
</dd>
</dl>
<p><span class="since">Since 0.8.5</span> the <span class="docutils literal">match</span> attribute can be omitted and will default
to <span class="docutils literal">exact</span>. Sometimes the hypervisor is not able to create a virtual CPU
exactly matching the specification passed by libvirt. <span class="since">Since 3.2.0</span> ,
an optional <span class="docutils literal">check</span> attribute can be used to request a specific way of
checking whether the virtual CPU matches the specification. It is usually
safe to omit this attribute when starting a domain and stick with the default
value. Once the domain starts, libvirt will automatically change the
<span class="docutils literal">check</span> attribute to the best supported value to ensure the virtual CPU
does not change when the domain is migrated to another host. The following
values can be used:</p>
<dl class="simple">
<dt><span class="docutils literal">none</span></dt>
<dd><p>Libvirt does no checking and it is up to the hypervisor to refuse to start
the domain if it cannot provide the requested CPU. With QEMU this means no
checking is done at all since the default behavior of QEMU is to emit
warnings, but start the domain anyway.</p>
</dd>
<dt><span class="docutils literal">partial</span></dt>
<dd><p>Libvirt will check the guest CPU specification before starting a domain,
but the rest is left on the hypervisor. It can still provide a different
virtual CPU.</p>
</dd>
<dt><span class="docutils literal">full</span></dt>
<dd><p>The virtual CPU created by the hypervisor will be checked against the CPU
specification and the domain will not be started unless the two CPUs
match.</p>
</dd>
</dl>
<p><span class="since">Since 0.9.10</span> , an optional <span class="docutils literal">mode</span> attribute may be used to make it
easier to configure a guest CPU to be as close to host CPU as possible.
Possible values for the <span class="docutils literal">mode</span> attribute are:</p>
<dl>
<dt><span class="docutils literal">custom</span></dt>
<dd><p>In this mode, the <span class="docutils literal">cpu</span> element describes the CPU that should be
presented to the guest. This is the default when no <span class="docutils literal">mode</span> attribute is
specified. This mode makes it so that a persistent guest will see the same
hardware no matter what host the guest is booted on.</p>
</dd>
<dt><span class="docutils literal"><span class="pre">host-model</span></span></dt>
<dd><p>The <span class="docutils literal"><span class="pre">host-model</span></span> mode is essentially a shortcut to copying host CPU
definition from capabilities XML into domain XML. Since the CPU definition
is copied just before starting a domain, exactly the same XML can be used
on different hosts while still providing the best guest CPU each host
supports. The <span class="docutils literal">match</span> attribute can't be used in this mode. Specifying
CPU model is not supported either, but <span class="docutils literal">model</span>'s <span class="docutils literal">fallback</span> attribute
may still be used. Using the <span class="docutils literal">feature</span> element, specific flags may be
enabled or disabled specifically in addition to the host model. This may
be used to fine tune features that can be emulated. <span class="since">(Since 1.1.1)</span>
. Libvirt does not model every aspect of each CPU so the guest CPU will
not match the host CPU exactly. On the other hand, the ABI provided to the
guest is reproducible. During migration, complete CPU model definition is
transferred to the destination host so the migrated guest will see exactly
the same CPU model for the running instance of the guest, even if the
destination host contains more capable CPUs or newer kernel; but shutting
down and restarting the guest may present different hardware to the guest
according to the capabilities of the new host. Prior to libvirt 3.2.0 and
QEMU 2.9.0 detection of the host CPU model via QEMU is not supported. Thus
the CPU configuration created using <span class="docutils literal"><span class="pre">host-model</span></span> may not work as
expected. <span class="since">Since 3.2.0 and QEMU 2.9.0</span> this mode works the way it
was designed and it is indicated by the <span class="docutils literal">fallback</span> attribute set to
<span class="docutils literal">forbid</span> in the host-model CPU definition advertised in <a class="reference external" href="https://libvirt.org/formatdomaincaps.html#elementsCPU">domain
capabilities XML</a>. When <span class="docutils literal">fallback</span>
attribute is set to <span class="docutils literal">allow</span> in the domain capabilities XML, it is
recommended to use <span class="docutils literal">custom</span> mode with just the CPU model from the host
capabilities XML. <span class="since">Since 1.2.11</span> PowerISA allows processors to run
VMs in binary compatibility mode supporting an older version of ISA.
Libvirt on PowerPC architecture uses the <span class="docutils literal"><span class="pre">host-model</span></span> to signify a guest
mode CPU running in binary compatibility mode. Example: When a user needs
a power7 VM to run in compatibility mode on a Power8 host, this can be
described in XML as follows :</p>
<pre class="literal-block">&lt;cpu mode='host-model'&gt;
  &lt;model&gt;power7&lt;/model&gt;
&lt;/cpu&gt;
...</pre>
</dd>
<dt><span class="docutils literal"><span class="pre">host-passthrough</span></span></dt>
<dd><p>With this mode, the CPU visible to the guest should be exactly the same as
the host CPU even in the aspects that libvirt does not understand. Though
the downside of this mode is that the guest environment cannot be
reproduced on different hardware. Thus, if you hit any bugs, you are on
your own. Further details of that CPU can be changed using <span class="docutils literal">feature</span>
elements. Migration of a guest using host-passthrough is dangerous if the
source and destination hosts are not identical in both hardware, QEMU
version, microcode version and configuration. If such a migration is
attempted then the guest may hang or crash upon resuming execution on the
destination host. Depending on hypervisor version the virtual CPU may or
may not contain features which may block migration even to an identical
host. <span class="since">Since 6.5.0</span> optional <span class="docutils literal">migratable</span> attribute may be used
to explicitly request such features to be removed from (<span class="docutils literal">on</span>) or kept in
(<span class="docutils literal">off</span>) the virtual CPU. This attribute does not make migration to
another host safer: even with <span class="docutils literal"><span class="pre">migratable='on'</span></span> migration will be
dangerous unless both hosts are identical as described above.</p>
</dd>
<dt><span class="docutils literal">maximum</span></dt>
<dd><p>When running a guest with hardware virtualization this CPU model is
functionally identical to <span class="docutils literal"><span class="pre">host-passthrough</span></span>, so refer to the docs
above.</p>
<p>When running a guest with CPU emulation, this CPU model will enable
the maximum set of features that the emulation engine is able to support.
Note that even with <span class="docutils literal"><span class="pre">migratable='on'</span></span> migration will be dangerous
unless both hosts are running identical versions of the emulation code.</p>
<p><span class="since">Since 7.1.0</span> with the QEMU driver.</p>
</dd>
</dl>
<p>Both <span class="docutils literal"><span class="pre">host-model</span></span> and <span class="docutils literal"><span class="pre">host-passthrough</span></span> modes make sense when a domain
can run directly on the host CPUs (for example, domains with type <span class="docutils literal">kvm</span>).
The actual host CPU is irrelevant for domains with emulated virtual CPUs
(such as domains with type <span class="docutils literal">qemu</span>). However, for backward compatibility
<span class="docutils literal"><span class="pre">host-model</span></span> may be implemented even for domains running on emulated CPUs
in which case the best CPU the hypervisor is able to emulate may be used
rather then trying to mimic the host CPU model.</p>
<p>If an application does not care about a specific CPU, just wants the
best featureset without a need for migration compatibility, the
<span class="docutils literal">maximum</span> model is a good choice on hypervisors where it is available.</p>
</dd>
<dt><span class="docutils literal">model</span></dt>
<dd><p>The content of the <span class="docutils literal">model</span> element specifies CPU model requested by the
guest. The list of available CPU models and their definition can be found in
directory <span class="docutils literal">cpu_map</span>, installed in libvirt's data directory. If a hypervisor
is not able to use the exact CPU model, libvirt automatically falls back to a
closest model supported by the hypervisor while maintaining the list of CPU
features. <span class="since">Since 0.9.10</span> , an optional <span class="docutils literal">fallback</span> attribute can be
used to forbid this behavior, in which case an attempt to start a domain
requesting an unsupported CPU model will fail. Supported values for
<span class="docutils literal">fallback</span> attribute are: <span class="docutils literal">allow</span> (this is the default), and <span class="docutils literal">forbid</span>.
The optional <span class="docutils literal">vendor_id</span> attribute ( <span class="since">Since 0.10.0</span> ) can be used to
set the vendor id seen by the guest. It must be exactly 12 characters long.
If not set the vendor id of the host is used. Typical possible values are
"AuthenticAMD" and "GenuineIntel".</p>
</dd>
<dt><span class="docutils literal">vendor</span></dt>
<dd><p><span class="since">Since 0.8.3</span> the content of the <span class="docutils literal">vendor</span> element specifies CPU
vendor requested by the guest. If this element is missing, the guest can be
run on a CPU matching given features regardless on its vendor. The list of
supported vendors can be found in <span class="docutils literal"><span class="pre">cpu_map/*_vendors.xml</span></span>.</p>
</dd>
<dt><span class="docutils literal">topology</span></dt>
<dd><p>The <span class="docutils literal">topology</span> element specifies requested topology of virtual CPU provided
to the guest. Four attributes, <span class="docutils literal">sockets</span>, <span class="docutils literal">dies</span>, <span class="docutils literal">cores</span>, and
<span class="docutils literal">threads</span>, accept non-zero positive integer values. They refer to the
number of CPU sockets per NUMA node, number of dies per socket, number of
cores per die, and number of threads per core, respectively. The <span class="docutils literal">dies</span>
attribute is optional and will default to 1 if omitted, while the other
attributes are all mandatory. Hypervisors may require that the maximum number
of vCPUs specified by the <span class="docutils literal">cpus</span> element equals to the number of vcpus
resulting from the topology.</p>
</dd>
<dt><span class="docutils literal">feature</span></dt>
<dd><p>The <span class="docutils literal">cpu</span> element can contain zero or more <span class="docutils literal">feature</span> elements used to
fine-tune features provided by the selected CPU model. The list of known
feature names can be found in the same file as CPU models. The meaning of
each <span class="docutils literal">feature</span> element depends on its <span class="docutils literal">policy</span> attribute, which has to be
set to one of the following values:</p>
<dl class="simple">
<dt><span class="docutils literal">force</span></dt>
<dd><p>The virtual CPU will claim the feature is supported regardless of it being
supported by host CPU.</p>
</dd>
<dt><span class="docutils literal">require</span></dt>
<dd><p>Guest creation will fail unless the feature is supported by the host CPU
or the hypervisor is able to emulate it.</p>
</dd>
<dt><span class="docutils literal">optional</span></dt>
<dd><p>The feature will be supported by virtual CPU if and only if it is
supported by host CPU.</p>
</dd>
<dt><span class="docutils literal">disable</span></dt>
<dd><p>The feature will not be supported by virtual CPU.</p>
</dd>
<dt><span class="docutils literal">forbid</span></dt>
<dd><p>Guest creation will fail if the feature is supported by host CPU.</p>
</dd>
</dl>
<p><span class="since">Since 0.8.5</span> the <span class="docutils literal">policy</span> attribute can be omitted and will default
to <span class="docutils literal">require</span>.</p>
<p>Individual CPU feature names are specified as part of the <span class="docutils literal">name</span> attribute.
For example, to explicitly specify the 'pcid' feature with Intel IvyBridge
CPU model:</p>
<pre class="literal-block">...
&lt;cpu match='exact'&gt;
  &lt;model fallback='forbid'&gt;IvyBridge&lt;/model&gt;
  &lt;vendor&gt;Intel&lt;/vendor&gt;
  &lt;feature policy='require' name='pcid'/&gt;
&lt;/cpu&gt;
...</pre>
</dd>
<dt><span class="docutils literal">cache</span></dt>
<dd><p><span class="since">Since 3.3.0</span> the <span class="docutils literal">cache</span> element describes the virtual CPU cache.
If the element is missing, the hypervisor will use a sensible default.</p>
<dl>
<dt><span class="docutils literal">level</span></dt>
<dd><p>This optional attribute specifies which cache level is described by the
element. Missing attribute means the element describes all CPU cache
levels at once. Mixing <span class="docutils literal">cache</span> elements with the <span class="docutils literal">level</span> attribute set
and those without the attribute is forbidden.</p>
</dd>
<dt><span class="docutils literal">mode</span></dt>
<dd><p>The following values are supported:</p>
<dl class="simple">
<dt><span class="docutils literal">emulate</span></dt>
<dd><p>The hypervisor will provide a fake CPU cache data.</p>
</dd>
<dt><span class="docutils literal">passthrough</span></dt>
<dd><p>The real CPU cache data reported by the host CPU will be passed through
to the virtual CPU.</p>
</dd>
<dt><span class="docutils literal">disable</span></dt>
<dd><p>The virtual CPU will report no CPU cache of the specified level (or no
cache at all if the <span class="docutils literal">level</span> attribute is missing).</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p>Guest NUMA topology can be specified using the <span class="docutils literal">numa</span> element. <span class="since">Since
0.9.8</span></p>
<pre class="literal-block">...
&lt;cpu&gt;
  ...
  &lt;numa&gt;
    &lt;cell id='0' cpus='0-3' memory='512000' unit='KiB' discard='yes'/&gt;
    &lt;cell id='1' cpus='4-7' memory='512000' unit='KiB' memAccess='shared'/&gt;
  &lt;/numa&gt;
  ...
&lt;/cpu&gt;
...</pre>
<p>Each <span class="docutils literal">cell</span> element specifies a NUMA cell or a NUMA node. <span class="docutils literal">cpus</span> specifies
the CPU or range of CPUs that are part of the node. <span class="since">Since 6.5.0</span> For the
qemu driver, if the emulator binary supports disjointed <span class="docutils literal">cpus</span> ranges in each
<span class="docutils literal">cell</span>, the sum of all CPUs declared in each <span class="docutils literal">cell</span> will be matched with the
maximum number of virtual CPUs declared in the <span class="docutils literal">vcpu</span> element. This is done by
filling any remaining CPUs into the first NUMA <span class="docutils literal">cell</span>. Users are encouraged to
supply a complete NUMA topology, where the sum of the NUMA CPUs matches the
maximum virtual CPUs number declared in <span class="docutils literal">vcpus</span>, to make the domain consistent
across qemu and libvirt versions. <span class="docutils literal">memory</span> specifies the node memory in
kibibytes (i.e. blocks of 1024 bytes). <span class="since">Since 6.6.0</span> the <span class="docutils literal">cpus</span>
attribute is optional and if omitted a CPU-less NUMA node is created.
<span class="since">Since 1.2.11</span> one can use an additional
<a class="reference external" href="formatdomain.html#elementsMemoryAllocation">unit</a> attribute to define units in which
<span class="docutils literal">memory</span> is specified. <span class="since">Since 1.2.7</span> all cells should have <span class="docutils literal">id</span>
attribute in case referring to some cell is necessary in the code, otherwise the
cells are assigned <span class="docutils literal">id</span>s in the increasing order starting from 0. Mixing
cells with and without the <span class="docutils literal">id</span> attribute is not recommended as it may result
in unwanted behaviour. <span class="since">Since 1.2.9</span> the optional attribute <span class="docutils literal">memAccess</span>
can control whether the memory is to be mapped as "shared" or "private". This is
valid only for hugepages-backed memory and nvdimm modules. Each <span class="docutils literal">cell</span> element
can have an optional <span class="docutils literal">discard</span> attribute which fine tunes the discard feature
for given numa node as described under <a class="reference external" href="formatdomain.html#elementsMemoryBacking">Memory
Backing</a>. Accepted values are <span class="docutils literal">yes</span> and <span class="docutils literal">no</span>.
<span class="since">Since 4.4.0</span></p>
<p>This guest NUMA specification is currently available only for QEMU/KVM and Xen.</p>
<p>A NUMA hardware architecture supports the notion of distances between NUMA
cells. <span class="since">Since 3.10.0</span> it is possible to define the distance between NUMA
cells using the <span class="docutils literal">distances</span> element within a NUMA <span class="docutils literal">cell</span> description. The
<span class="docutils literal">sibling</span> sub-element is used to specify the distance value between sibling
NUMA cells. For more details, see the chapter explaining the system's SLIT
(System Locality Information Table) within the ACPI (Advanced Configuration and
Power Interface) specification.</p>
<pre class="literal-block">...
&lt;cpu&gt;
  ...
  &lt;numa&gt;
    &lt;cell id='0' cpus='0,4-7' memory='512000' unit='KiB'&gt;
      &lt;distances&gt;
        &lt;sibling id='0' value='10'/&gt;
        &lt;sibling id='1' value='21'/&gt;
        &lt;sibling id='2' value='31'/&gt;
        &lt;sibling id='3' value='41'/&gt;
      &lt;/distances&gt;
    &lt;/cell&gt;
    &lt;cell id='1' cpus='1,8-10,12-15' memory='512000' unit='KiB' memAccess='shared'&gt;
      &lt;distances&gt;
        &lt;sibling id='0' value='21'/&gt;
        &lt;sibling id='1' value='10'/&gt;
        &lt;sibling id='2' value='21'/&gt;
        &lt;sibling id='3' value='31'/&gt;
      &lt;/distances&gt;
    &lt;/cell&gt;
    &lt;cell id='2' cpus='2,11' memory='512000' unit='KiB' memAccess='shared'&gt;
      &lt;distances&gt;
        &lt;sibling id='0' value='31'/&gt;
        &lt;sibling id='1' value='21'/&gt;
        &lt;sibling id='2' value='10'/&gt;
        &lt;sibling id='3' value='21'/&gt;
      &lt;/distances&gt;
    &lt;/cell&gt;
    &lt;cell id='3' cpus='3' memory='512000' unit='KiB'&gt;
      &lt;distances&gt;
        &lt;sibling id='0' value='41'/&gt;
        &lt;sibling id='1' value='31'/&gt;
        &lt;sibling id='2' value='21'/&gt;
        &lt;sibling id='3' value='10'/&gt;
      &lt;/distances&gt;
    &lt;/cell&gt;
  &lt;/numa&gt;
  ...
&lt;/cpu&gt;
...</pre>
<p>Describing distances between NUMA cells is currently only supported by Xen and
QEMU. If no <span class="docutils literal">distances</span> are given to describe the SLIT data between different
cells, it will default to a scheme using 10 for local and 20 for remote
distances.</p>
<p><span class="anchor"><a id="hmat"/></span></p>
<div class="section" id="acpi-heterogeneous-memory-attribute-table">
<h3><a class="toc-backref" href="formatdomain.html#id19">ACPI Heterogeneous Memory Attribute Table</a><a class="headerlink" href="formatdomain.html#acpi-heterogeneous-memory-attribute-table" title="Link to this headline">¶</a></h3>
<pre class="literal-block">...
&lt;cpu&gt;
  ...
  &lt;numa&gt;
    &lt;cell id='0' cpus='0-3' memory='512000' unit='KiB' discard='yes'/&gt;
    &lt;cell id='1' cpus='4-7' memory='512000' unit='KiB' memAccess='shared'/&gt;
    &lt;cell id='3' cpus='0-3' memory='2097152' unit='KiB'&gt;
      &lt;cache level='1' associativity='direct' policy='writeback'&gt;
        &lt;size value='10' unit='KiB'/&gt;
        &lt;line value='8' unit='B'/&gt;
      &lt;/cache&gt;
    &lt;/cell&gt;
    &lt;interconnects&gt;
      &lt;latency initiator='0' target='0' type='access' value='5'/&gt;
      &lt;latency initiator='0' target='0' cache='1' type='access' value='10'/&gt;
      &lt;bandwidth initiator='0' target='0' type='access' value='204800' unit='KiB'/&gt;
    &lt;/interconnects&gt;
  &lt;/numa&gt;
  ...
&lt;/cpu&gt;
...</pre>
<p><span class="since">Since 6.6.0</span> the <span class="docutils literal">cell</span> element can have a <span class="docutils literal">cache</span> child element
which describes memory side cache for memory proximity domains. The <span class="docutils literal">cache</span>
element has a <span class="docutils literal">level</span> attribute describing the cache level and thus the
element can be repeated multiple times to describe different levels of the
cache.</p>
<p>The <span class="docutils literal">cache</span> element then has following mandatory attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">level</span></dt>
<dd><p>Level of the cache this description refers to.</p>
</dd>
<dt><span class="docutils literal">associativity</span></dt>
<dd><p>Describes cache associativity (accepted values are <span class="docutils literal">none</span>, <span class="docutils literal">direct</span> and
<span class="docutils literal">full</span>).</p>
</dd>
<dt><span class="docutils literal">policy</span></dt>
<dd><p>Describes cache write associativity (accepted values are <span class="docutils literal">none</span>,
<span class="docutils literal">writeback</span> and <span class="docutils literal">writethrough</span>).</p>
</dd>
</dl>
<p>The <span class="docutils literal">cache</span> element has two mandatory child elements then: <span class="docutils literal">size</span> and
<span class="docutils literal">line</span> which describe cache size and cache line size. Both elements accept two
attributes: <span class="docutils literal">value</span> and <span class="docutils literal">unit</span> which set the value of corresponding cache
attribute.</p>
<p>The NUMA description has an optional <span class="docutils literal">interconnects</span> element that describes
the normalized memory read/write latency, read/write bandwidth between Initiator
Proximity Domains (Processor or I/O) and Target Proximity Domains (Memory).</p>
<p>The <span class="docutils literal">interconnects</span> element can have zero or more <span class="docutils literal">latency</span> child elements
to describe latency between two memory nodes and zero or more <span class="docutils literal">bandwidth</span>
child elements to describe bandwidth between two memory nodes. Both these have
the following mandatory attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">initiator</span></dt>
<dd><p>Refers to the source NUMA node</p>
</dd>
<dt><span class="docutils literal">target</span></dt>
<dd><p>Refers to the target NUMA node</p>
</dd>
<dt><span class="docutils literal">type</span></dt>
<dd><p>The type of the access. Accepted values: <span class="docutils literal">access</span>, <span class="docutils literal">read</span>, <span class="docutils literal">write</span></p>
</dd>
<dt><span class="docutils literal">value</span></dt>
<dd><p>The actual value. For latency this is delay in nanoseconds, for bandwidth
this value is in kibibytes per second. Use additional <span class="docutils literal">unit</span> attribute to
change the units.</p>
</dd>
</dl>
<p>To describe latency from one NUMA node to a cache of another NUMA node the
<span class="docutils literal">latency</span> element has optional <span class="docutils literal">cache</span> attribute which in combination with
<span class="docutils literal">target</span> attribute creates full reference to distant NUMA node's cache level.
For instance, <span class="docutils literal"><span class="pre">target='0'</span> <span class="pre">cache='1'</span></span> refers to the first level cache of NUMA
node 0.</p>
<p><span class="anchor"><a id="elementsEvents"/></span></p>
</div>
</div>
<div class="section" id="events-configuration">
<h2><a class="toc-backref" href="formatdomain.html#id20">Events configuration</a><a class="headerlink" href="formatdomain.html#events-configuration" title="Link to this headline">¶</a></h2>
<p>It is sometimes necessary to override the default actions taken on various
events. Not all hypervisors support all events and actions. The actions may be
taken as a result of calls to libvirt APIs
<a class="reference external" href="https://libvirt.org/html/libvirt-libvirt-domain.html#virDomainReboot">virDomainReboot</a> ,
<a class="reference external" href="https://libvirt.org/html/libvirt-libvirt-domain.html#virDomainShutdown">virDomainShutdown</a> , or
<a class="reference external" href="https://libvirt.org/html/libvirt-libvirt-domain.html#virDomainShutdownFlags">virDomainShutdownFlags</a>
. Using <span class="docutils literal">virsh reboot</span> or <span class="docutils literal">virsh shutdown</span> would also trigger the event.</p>
<pre class="literal-block">...
&lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
&lt;on_reboot&gt;restart&lt;/on_reboot&gt;
&lt;on_crash&gt;restart&lt;/on_crash&gt;
&lt;on_lockfailure&gt;poweroff&lt;/on_lockfailure&gt;
...</pre>
<p>The following collections of elements allow the actions to be specified when a
guest OS triggers a lifecycle operation. A common use case is to force a reboot
to be treated as a poweroff when doing the initial OS installation. This allows
the VM to be re-configured for the first post-install bootup.</p>
<dl class="simple">
<dt><span class="docutils literal">on_poweroff</span></dt>
<dd><p>The content of this element specifies the action to take when the guest
requests a poweroff.</p>
</dd>
<dt><span class="docutils literal">on_reboot</span></dt>
<dd><p>The content of this element specifies the action to take when the guest
requests a reboot.</p>
</dd>
<dt><span class="docutils literal">on_crash</span></dt>
<dd><p>The content of this element specifies the action to take when the guest
crashes.</p>
</dd>
</dl>
<p>Each of these states allow for the same four possible actions.</p>
<dl class="simple">
<dt><span class="docutils literal">destroy</span></dt>
<dd><p>The domain will be terminated completely and all resources released.</p>
</dd>
<dt><span class="docutils literal">restart</span></dt>
<dd><p>The domain will be terminated and then restarted with the same configuration.</p>
</dd>
<dt><span class="docutils literal">preserve</span></dt>
<dd><p>The domain will be terminated and its resource preserved to allow analysis.</p>
</dd>
<dt><span class="docutils literal"><span class="pre">rename-restart</span></span></dt>
<dd><p>The domain will be terminated and then restarted with a new name.</p>
</dd>
</dl>
<p>QEMU/KVM supports the <span class="docutils literal">on_poweroff</span> and <span class="docutils literal">on_reboot</span> events handling the
<span class="docutils literal">destroy</span> and <span class="docutils literal">restart</span> actions. The <span class="docutils literal">preserve</span> action for an
<span class="docutils literal">on_reboot</span> event is treated as a <span class="docutils literal">destroy</span> and the <span class="docutils literal"><span class="pre">rename-restart</span></span>
action for an <span class="docutils literal">on_poweroff</span> event is treated as a <span class="docutils literal">restart</span> event.</p>
<p>The <span class="docutils literal">on_crash</span> event supports these additional actions <span class="since">since 0.8.4</span> .</p>
<dl class="simple">
<dt><span class="docutils literal"><span class="pre">coredump-destroy</span></span></dt>
<dd><p>The crashed domain's core will be dumped, and then the domain will be
terminated completely and all resources released</p>
</dd>
<dt><span class="docutils literal"><span class="pre">coredump-restart</span></span></dt>
<dd><p>The crashed domain's core will be dumped, and then the domain will be
restarted with the same configuration</p>
</dd>
</dl>
<p><span class="since">Since 3.9.0</span> , the lifecycle events can be configured via the
<a class="reference external" href="https://libvirt.org/html/libvirt-libvirt-domain.html#virDomainSetLifecycleAction">virDomainSetLifecycleAction</a>
API.</p>
<p>The <span class="docutils literal">on_lockfailure</span> element ( <span class="since">since 1.0.0</span> ) may be used to configure
what action should be taken when a lock manager loses resource locks. The
following actions are recognized by libvirt, although not all of them need to be
supported by individual lock managers. When no action is specified, each lock
manager will take its default action.</p>
<dl class="simple">
<dt><span class="docutils literal">poweroff</span></dt>
<dd><p>The domain will be forcefully powered off.</p>
</dd>
<dt><span class="docutils literal">restart</span></dt>
<dd><p>The domain will be powered off and started up again to reacquire its locks.</p>
</dd>
<dt><span class="docutils literal">pause</span></dt>
<dd><p>The domain will be paused so that it can be manually resumed when lock issues
are solved.</p>
</dd>
<dt><span class="docutils literal">ignore</span></dt>
<dd><p>Keep the domain running as if nothing happened.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsPowerManagement"/></span></p>
</div>
<div class="section" id="power-management">
<h2><a class="toc-backref" href="formatdomain.html#id21">Power Management</a><a class="headerlink" href="formatdomain.html#power-management" title="Link to this headline">¶</a></h2>
<p><span class="since">Since 0.10.2</span> it is possible to forcibly enable or disable BIOS
advertisements to the guest OS. (NB: Only qemu driver support)</p>
<pre class="literal-block">...
&lt;pm&gt;
  &lt;suspend-to-disk enabled='no'/&gt;
  &lt;suspend-to-mem enabled='yes'/&gt;
&lt;/pm&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">pm</span></dt>
<dd><p>These elements enable ('yes') or disable ('no') BIOS support for S3
(suspend-to-mem) and S4 (suspend-to-disk) ACPI sleep states. If nothing is
specified, then the hypervisor will be left with its default value.
Note: This setting cannot prevent the guest OS from performing a suspend as
the guest OS itself can choose to circumvent the unavailability of the sleep
states (e.g. S4 by turning off completely).</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsFeatures"/></span></p>
</div>
<div class="section" id="hypervisor-features">
<h2><a class="toc-backref" href="formatdomain.html#id22">Hypervisor features</a><a class="headerlink" href="formatdomain.html#hypervisor-features" title="Link to this headline">¶</a></h2>
<p>Hypervisors may allow certain CPU / machine features to be toggled on/off.</p>
<pre class="literal-block">...
&lt;features&gt;
  &lt;pae/&gt;
  &lt;acpi/&gt;
  &lt;apic/&gt;
  &lt;hap/&gt;
  &lt;privnet/&gt;
  &lt;hyperv&gt;
    &lt;relaxed state='on'/&gt;
    &lt;vapic state='on'/&gt;
    &lt;spinlocks state='on' retries='4096'/&gt;
    &lt;vpindex state='on'/&gt;
    &lt;runtime state='on'/&gt;
    &lt;synic state='on'/&gt;
    &lt;stimer state='on'&gt;
      &lt;direct state='on'/&gt;
    &lt;/stimer&gt;
    &lt;reset state='on'/&gt;
    &lt;vendor_id state='on' value='KVM Hv'/&gt;
    &lt;frequencies state='on'/&gt;
    &lt;reenlightenment state='on'/&gt;
    &lt;tlbflush state='on'/&gt;
    &lt;ipi state='on'/&gt;
    &lt;evmcs state='on'/&gt;
  &lt;/hyperv&gt;
  &lt;kvm&gt;
    &lt;hidden state='on'/&gt;
    &lt;hint-dedicated state='on'/&gt;
    &lt;poll-control state='on'/&gt;
  &lt;/kvm&gt;
  &lt;xen&gt;
    &lt;e820_host state='on'/&gt;
    &lt;passthrough state='on' mode='share_pt'/&gt;
  &lt;/xen&gt;
  &lt;pvspinlock state='on'/&gt;
  &lt;gic version='2'/&gt;
  &lt;ioapic driver='qemu'/&gt;
  &lt;hpt resizing='required'&gt;
    &lt;maxpagesize unit='MiB'&gt;16&lt;/maxpagesize&gt;
  &lt;/hpt&gt;
  &lt;vmcoreinfo state='on'/&gt;
  &lt;smm state='on'&gt;
    &lt;tseg unit='MiB'&gt;48&lt;/tseg&gt;
  &lt;/smm&gt;
  &lt;htm state='on'/&gt;
  &lt;ccf-assist state='on'/&gt;
  &lt;msrs unknown='ignore'/&gt;
  &lt;cfpc value='workaround'/&gt;
  &lt;sbbc value='workaround'/&gt;
  &lt;ibs value='fixed-na'/&gt;
&lt;/features&gt;
...</pre>
<p>All features are listed within the <span class="docutils literal">features</span> element, omitting a togglable
feature tag turns it off. The available features can be found by asking for the
<a class="reference external" href="https://libvirt.org/formatcaps.html">capabilities XML</a> and <a class="reference external" href="https://libvirt.org/formatdomaincaps.html">domain capabilities
XML</a>, but a common set for fully virtualized domains
are:</p>
<dl>
<dt><span class="docutils literal">pae</span></dt>
<dd><p>Physical address extension mode allows 32-bit guests to address more than 4
GB of memory.</p>
</dd>
<dt><span class="docutils literal">acpi</span></dt>
<dd><p>ACPI is useful for power management, for example, with KVM guests it is
required for graceful shutdown to work.</p>
</dd>
<dt><span class="docutils literal">apic</span></dt>
<dd><p>APIC allows the use of programmable IRQ management. <span class="since">Since 0.10.2
(QEMU only)</span> there is an optional attribute <span class="docutils literal">eoi</span> with values <span class="docutils literal">on</span> and
<span class="docutils literal">off</span> which toggles the availability of EOI (End of Interrupt) for the
guest.</p>
</dd>
<dt><span class="docutils literal">hap</span></dt>
<dd><p>Depending on the <span class="docutils literal">state</span> attribute (values <span class="docutils literal">on</span>, <span class="docutils literal">off</span>) enable or
disable use of Hardware Assisted Paging. The default is <span class="docutils literal">on</span> if the
hypervisor detects availability of Hardware Assisted Paging.</p>
</dd>
<dt><span class="docutils literal">viridian</span></dt>
<dd><p>Enable Viridian hypervisor extensions for paravirtualizing guest operating
systems</p>
</dd>
<dt><span class="docutils literal">privnet</span></dt>
<dd><p>Always create a private network namespace. This is automatically set if any
interface devices are defined. This feature is only relevant for container
based virtualization drivers, such as LXC.</p>
</dd>
<dt><span class="docutils literal">hyperv</span></dt>
<dd><p>Enable various features improving behavior of guests running Microsoft
Windows.</p>
<table>
<colgroup>
<col style="width: 8%"/>
<col style="width: 38%"/>
<col style="width: 24%"/>
<col style="width: 30%"/>
</colgroup>
<thead>
<tr><th class="head"><p>Feature</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Since</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>relaxed</p></td>
<td><p>Relax constraints on timers</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">1.0.0 (QEMU 2.0)</span></p></td>
</tr>
<tr><td><p>vapic</p></td>
<td><p>Enable virtual APIC</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">1.1.0 (QEMU 2.0)</span></p></td>
</tr>
<tr><td><p>spinlocks</p></td>
<td><p>Enable spinlock support</p></td>
<td><p>on, off; retries - at least 4095</p></td>
<td><p><span class="since">1.1.0 (QEMU 2.0)</span></p></td>
</tr>
<tr><td><p>vpindex</p></td>
<td><p>Virtual processor index</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">1.3.3 (QEMU 2.5)</span></p></td>
</tr>
<tr><td><p>runtime</p></td>
<td><p>Processor time spent on running guest code and on behalf of guest code</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">1.3.3 (QEMU 2.5)</span></p></td>
</tr>
<tr><td><p>synic</p></td>
<td><p>Enable Synthetic Interrupt Controller (SynIC)</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">1.3.3 (QEMU 2.6)</span></p></td>
</tr>
<tr><td><p>stimer</p></td>
<td><p>Enable SynIC timers, optionally with Direct Mode support</p></td>
<td><p>on, off; direct - on,off</p></td>
<td><p><span class="since">1.3.3 (QEMU 2.6), direct mode 5.7.0 (QEMU 4.1)</span></p></td>
</tr>
<tr><td><p>reset</p></td>
<td><p>Enable hypervisor reset</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">1.3.3 (QEMU 2.5)</span></p></td>
</tr>
<tr><td><p>vendor_id</p></td>
<td><p>Set hypervisor vendor id</p></td>
<td><p>on, off; value - string, up to 12 characters</p></td>
<td><p><span class="since">1.3.3 (QEMU 2.5)</span></p></td>
</tr>
<tr><td><p>frequencies</p></td>
<td><p>Expose frequency MSRs</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">4.7.0 (QEMU 2.12)</span></p></td>
</tr>
<tr><td><p>reenlightenment</p></td>
<td><p>Enable re-enlightenment notification on migration</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">4.7.0 (QEMU 3.0)</span></p></td>
</tr>
<tr><td><p>tlbflush</p></td>
<td><p>Enable PV TLB flush support</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">4.7.0 (QEMU 3.0)</span></p></td>
</tr>
<tr><td><p>ipi</p></td>
<td><p>Enable PV IPI support</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">4.10.0 (QEMU 3.1)</span></p></td>
</tr>
<tr><td><p>evmcs</p></td>
<td><p>Enable Enlightened VMCS</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">4.10.0 (QEMU 3.1)</span></p></td>
</tr>
</tbody>
</table>
</dd>
<dt><span class="docutils literal">pvspinlock</span></dt>
<dd><p>Notify the guest that the host supports paravirtual spinlocks for example by
exposing the pvticketlocks mechanism. This feature can be explicitly disabled
by using <span class="docutils literal"><span class="pre">state='off'</span></span> attribute.</p>
</dd>
<dt><span class="docutils literal">kvm</span></dt>
<dd><p>Various features to change the behavior of the KVM hypervisor.</p>
<table>
<colgroup>
<col style="width: 11%"/>
<col style="width: 61%"/>
<col style="width: 6%"/>
<col style="width: 22%"/>
</colgroup>
<thead>
<tr><th class="head"><p>Feature</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Since</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>hidden</p></td>
<td><p>Hide the KVM hypervisor from standard MSR based discovery</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">1.2.8 (QEMU 2.1.0)</span></p></td>
</tr>
<tr><td><p>hint-dedicated</p></td>
<td><p>Allows a guest to enable optimizations when running on dedicated vCPUs</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">5.7.0 (QEMU 2.12.0)</span></p></td>
</tr>
<tr><td><p>poll-control</p></td>
<td><p>Decrease IO completion latency by introducing a grace period of busy waiting</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">6.10.0 (QEMU 4.2)</span></p></td>
</tr>
</tbody>
</table>
</dd>
<dt><span class="docutils literal">xen</span></dt>
<dd><p>Various features to change the behavior of the Xen hypervisor.</p>
<table>
<colgroup>
<col style="width: 9%"/>
<col style="width: 38%"/>
<col style="width: 42%"/>
<col style="width: 11%"/>
</colgroup>
<thead>
<tr><th class="head"><p>Feature</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Since</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>e820_host</p></td>
<td><p>Expose the host e820 to the guest (PV only)</p></td>
<td><p>on, off</p></td>
<td><p><span class="since">6.3.0</span></p></td>
</tr>
<tr><td><p>passthrough</p></td>
<td><p>Enable IOMMU mappings allowing PCI passthrough</p></td>
<td><p>on, off; mode - optional string sync_pt or share_pt</p></td>
<td><p><span class="since">6.3.0</span></p></td>
</tr>
</tbody>
</table>
</dd>
<dt><span class="docutils literal">pmu</span></dt>
<dd><p>Depending on the <span class="docutils literal">state</span> attribute (values <span class="docutils literal">on</span>, <span class="docutils literal">off</span>, default <span class="docutils literal">on</span>)
enable or disable the performance monitoring unit for the guest.
<span class="since">Since 1.2.12</span></p>
</dd>
<dt><span class="docutils literal">vmport</span></dt>
<dd><p>Depending on the <span class="docutils literal">state</span> attribute (values <span class="docutils literal">on</span>, <span class="docutils literal">off</span>, default <span class="docutils literal">on</span>)
enable or disable the emulation of VMware IO port, for vmmouse etc.
<span class="since">Since 1.2.16</span></p>
</dd>
<dt><span class="docutils literal">gic</span></dt>
<dd><p>Enable for architectures using a General Interrupt Controller instead of APIC
in order to handle interrupts. For example, the 'aarch64' architecture uses
<span class="docutils literal">gic</span> instead of <span class="docutils literal">apic</span>. The optional attribute <span class="docutils literal">version</span> specifies the
GIC version; however, it may not be supported by all hypervisors. Accepted
values are <span class="docutils literal">2</span>, <span class="docutils literal">3</span> and <span class="docutils literal">host</span>. <span class="since">Since 1.2.16</span></p>
</dd>
<dt><span class="docutils literal">smm</span></dt>
<dd><p>Depending on the <span class="docutils literal">state</span> attribute (values <span class="docutils literal">on</span>, <span class="docutils literal">off</span>, default <span class="docutils literal">on</span>)
enable or disable System Management Mode. <span class="since">Since 2.1.0</span></p>
<p>Optional sub-element <span class="docutils literal">tseg</span> can be used to specify the amount of memory
dedicated to SMM's extended TSEG. That offers a fourth option size apart from
the existing ones (1 MiB, 2 MiB and 8 MiB) that the guest OS (or rather
loader) can choose from. The size can be specified as a value of that
element, optional attribute <span class="docutils literal">unit</span> can be used to specify the unit of the
aforementioned value (defaults to 'MiB'). If set to 0 the extended size is
not advertised and only the default ones (see above) are available.</p>
<p><strong>If the VM is booting you should leave this option alone, unless you are
very certain you know what you are doing.</strong></p>
<p>This value is configurable due to the fact that the calculation cannot be
done right with the guarantee that it will work correctly. In QEMU, the
user-configurable extended TSEG feature was unavailable up to and including
<span class="docutils literal"><span class="pre">pc-q35-2.9</span></span>. Starting with <span class="docutils literal"><span class="pre">pc-q35-2.10</span></span> the feature is available, with
default size 16 MiB. That should suffice for up to roughly 272 vCPUs, 5 GiB
guest RAM in total, no hotplug memory range, and 32 GiB of 64-bit PCI MMIO
aperture. Or for 48 vCPUs, with 1TB of guest RAM, no hotplug DIMM range, and
32GB of 64-bit PCI MMIO aperture. The values may also vary based on the
loader the VM is using.</p>
<p>Additional size might be needed for significantly higher vCPU counts or
increased address space (that can be memory, maxMemory, 64-bit PCI MMIO
aperture size; roughly 8 MiB of TSEG per 1 TiB of address space) which can
also be rounded up.</p>
<p>Due to the nature of this setting being similar to "how much RAM should the
guest have" users are advised to either consult the documentation of the
guest OS or loader (if there is any), or test this by trial-and-error
changing the value until the VM boots successfully. Yet another guiding value
for users might be the fact that 48 MiB should be enough for pretty large
guests (240 vCPUs and 4TB guest RAM), but it is on purpose not set as default
as 48 MiB of unavailable RAM might be too much for small guests (e.g. with
512 MiB of RAM).</p>
<p>See <a class="reference external" href="formatdomain.html#elementsMemoryAllocation">Memory Allocation</a> for more details about
the <span class="docutils literal">unit</span> attribute. <span class="since">Since 4.5.0</span> (QEMU only)</p>
</dd>
<dt><span class="docutils literal">ioapic</span></dt>
<dd><p>Tune the I/O APIC. Possible values for the <span class="docutils literal">driver</span> attribute are: <span class="docutils literal">kvm</span>
(default for KVM domains) and <span class="docutils literal">qemu</span> which puts I/O APIC in userspace which
is also known as a split I/O APIC mode. <span class="since">Since 3.4.0</span> (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal">hpt</span></dt>
<dd><p>Configure the HPT (Hash Page Table) of a pSeries guest. Possible values for
the <span class="docutils literal">resizing</span> attribute are <span class="docutils literal">enabled</span>, which causes HPT resizing to be
enabled if both the guest and the host support it; <span class="docutils literal">disabled</span>, which causes
HPT resizing to be disabled regardless of guest and host support; and
<span class="docutils literal">required</span>, which prevents the guest from starting unless both the guest
and the host support HPT resizing. If the attribute is not defined, the
hypervisor default will be used. <span class="since">Since 3.10.0</span> (QEMU/KVM only).</p>
<p>The optional <span class="docutils literal">maxpagesize</span> subelement can be used to limit the usable page
size for HPT guests. Common values are 64 KiB, 16 MiB and 16 GiB; when not
specified, the hypervisor default will be used. <span class="since">Since 4.5.0</span>
(QEMU/KVM only).</p>
</dd>
<dt><span class="docutils literal">vmcoreinfo</span></dt>
<dd><p>Enable QEMU vmcoreinfo device to let the guest kernel save debug details.
<span class="since">Since 4.4.0</span> (QEMU only)</p>
</dd>
<dt><span class="docutils literal">htm</span></dt>
<dd><p>Configure HTM (Hardware Transational Memory) availability for pSeries guests.
Possible values for the <span class="docutils literal">state</span> attribute are <span class="docutils literal">on</span> and <span class="docutils literal">off</span>. If the
attribute is not defined, the hypervisor default will be used. <span class="since">Since
4.6.0</span> (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal"><span class="pre">nested-hv</span></span></dt>
<dd><p>Configure nested HV availability for pSeries guests. This needs to be enabled
from the host (L0) in order to be effective; having HV support in the (L1)
guest is very desiderable if it's planned to run nested (L2) guests inside
it, because it will result in those nested guests having much better
performance than they would when using KVM PR or TCG. Possible values for the
<span class="docutils literal">state</span> attribute are <span class="docutils literal">on</span> and <span class="docutils literal">off</span>. If the attribute is not defined,
the hypervisor default will be used. <span class="since">Since 4.10.0</span> (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal">msrs</span></dt>
<dd><p>Some guests might require ignoring unknown Model Specific Registers (MSRs)
reads and writes. It's possible to switch this by setting <span class="docutils literal">unknown</span>
attribute of <span class="docutils literal">msrs</span> to <span class="docutils literal">ignore</span>. If the attribute is not defined, or set
to <span class="docutils literal">fault</span>, unknown reads and writes will not be ignored. <span class="since">Since
5.1.0</span> (bhyve only)</p>
</dd>
<dt><span class="docutils literal"><span class="pre">ccf-assist</span></span></dt>
<dd><p>Configure ccf-assist (Count Cache Flush Assist) availability for pSeries
guests. Possible values for the <span class="docutils literal">state</span> attribute are <span class="docutils literal">on</span> and <span class="docutils literal">off</span>.
If the attribute is not defined, the hypervisor default will be used.
<span class="since">Since 5.9.0</span> (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal">cfpc</span></dt>
<dd><p>Configure cfpc (Cache Flush on Privilege Change) availability for pSeries
guests. Possible values for the <span class="docutils literal">value</span> attribute are <span class="docutils literal">broken</span> (no
protection), <span class="docutils literal">workaround</span> (software workaround available) and <span class="docutils literal">fixed</span>
(fixed in hardware). If the attribute is not defined, the hypervisor default
will be used. <span class="since">Since 6.3.0</span> (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal">sbbc</span></dt>
<dd><p>Configure sbbc (Speculation Barrier Bounds Checking) availability for pSeries
guests. Possible values for the <span class="docutils literal">value</span> attribute are <span class="docutils literal">broken</span> (no
protection), <span class="docutils literal">workaround</span> (software workaround available) and <span class="docutils literal">fixed</span>
(fixed in hardware). If the attribute is not defined, the hypervisor default
will be used. <span class="since">Since 6.3.0</span> (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal">ibs</span></dt>
<dd><p>Configure ibs (Indirect Branch Speculation) availability for pSeries guests.
Possible values for the <span class="docutils literal">value</span> attribute are <span class="docutils literal">broken</span> (no protection),
<span class="docutils literal">workaround</span> (count cache flush), <span class="docutils literal"><span class="pre">fixed-ibs</span></span> (fixed by serializing
indirect branches), <span class="docutils literal"><span class="pre">fixed-ccd</span></span> (fixed by disabling the cache count) and
<span class="docutils literal"><span class="pre">fixed-na</span> (fixed in           hardware - no longer applicable)</span>. If the
attribute is not defined, the hypervisor default will be used. <span class="since">Since
6.3.0</span> (QEMU/KVM only)</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsTime"/></span></p>
</div>
<div class="section" id="time-keeping">
<h2><a class="toc-backref" href="formatdomain.html#id23">Time keeping</a><a class="headerlink" href="formatdomain.html#time-keeping" title="Link to this headline">¶</a></h2>
<p>The guest clock is typically initialized from the host clock. Most operating
systems expect the hardware clock to be kept in UTC, and this is the default.
Windows, however, expects it to be in so called 'localtime'.</p>
<pre class="literal-block">...
&lt;clock offset='localtime'&gt;
  &lt;timer name='rtc' tickpolicy='catchup' track='guest'&gt;
    &lt;catchup threshold='123' slew='120' limit='10000'/&gt;
  &lt;/timer&gt;
  &lt;timer name='pit' tickpolicy='delay'/&gt;
&lt;/clock&gt;
...</pre>
<dl>
<dt><span class="docutils literal">clock</span></dt>
<dd><p>The <span class="docutils literal">offset</span> attribute takes four possible values, allowing fine grained
control over how the guest clock is synchronized to the host. NB, not all
hypervisors support all modes.</p>
<dl class="simple">
<dt><span class="docutils literal">utc</span></dt>
<dd><p>The guest clock will always be synchronized to UTC when booted.
<span class="since">Since 0.9.11</span> 'utc' mode can be converted to 'variable' mode,
which can be controlled by using the <span class="docutils literal">adjustment</span> attribute. If the
value is 'reset', the conversion is never done (not all hypervisors can
synchronize to UTC on each boot; use of 'reset' will cause an error on
those hypervisors). A numeric value forces the conversion to 'variable'
mode using the value as the initial adjustment. The default <span class="docutils literal">adjustment</span>
is hypervisor specific.</p>
</dd>
<dt><span class="docutils literal">localtime</span></dt>
<dd><p>The guest clock will be synchronized to the host's configured timezone
when booted, if any. <span class="since">Since 0.9.11,</span> the <span class="docutils literal">adjustment</span> attribute
behaves the same as in 'utc' mode.</p>
</dd>
<dt><span class="docutils literal">timezone</span></dt>
<dd><p>The guest clock will be synchronized to the requested timezone using the
<span class="docutils literal">timezone</span> attribute. <span class="since">Since 0.7.7</span></p>
</dd>
<dt><span class="docutils literal">variable</span></dt>
<dd><p>The guest clock will have an arbitrary offset applied relative to UTC or
localtime, depending on the <span class="docutils literal">basis</span> attribute. The delta relative to UTC
(or localtime) is specified in seconds, using the <span class="docutils literal">adjustment</span>
attribute. The guest is free to adjust the RTC over time and expect that
it will be honored at next reboot. This is in contrast to 'utc' and
'localtime' mode (with the optional attribute adjustment='reset'), where
the RTC adjustments are lost at each reboot. <span class="since">Since 0.7.7</span>
<span class="since">Since 0.9.11</span> the <span class="docutils literal">basis</span> attribute can be either 'utc'
(default) or 'localtime'.</p>
</dd>
</dl>
<p>A <span class="docutils literal">clock</span> may have zero or more <span class="docutils literal">timer</span> sub-elements. <span class="since">Since
0.8.0</span></p>
</dd>
<dt><span class="docutils literal">timer</span></dt>
<dd><p>Each timer element requires a <span class="docutils literal">name</span> attribute, and has other optional
attributes that depend on the <span class="docutils literal">name</span> specified. Various hypervisors support
different combinations of attributes.</p>
<dl>
<dt><span class="docutils literal">name</span></dt>
<dd><p>The <span class="docutils literal">name</span> attribute selects which timer is being modified, and can be
one of "platform" (currently unsupported), "hpet" (xen, qemu, lxc),
"kvmclock" (qemu), "pit" (qemu), "rtc" (qemu, lxc), "tsc" (xen, qemu -
<span class="since">since 3.2.0</span> ), "hypervclock" (qemu - <span class="since">since 1.2.2</span> ) or
"armvtimer" (qemu - <span class="since">since 6.1.0</span> ). The <span class="docutils literal">hypervclock</span> timer adds
support for the reference time counter and the reference page for iTSC
feature for guests running the Microsoft Windows operating system.</p>
</dd>
<dt><span class="docutils literal">track</span></dt>
<dd><p>The <span class="docutils literal">track</span> attribute specifies what the timer tracks, and can be
"boot", "guest", or "wall", or "realtime". Only valid for <span class="docutils literal"><span class="pre">name="rtc"</span></span> or
<span class="docutils literal"><span class="pre">name="platform"</span></span>.</p>
</dd>
<dt><span class="docutils literal">tickpolicy</span></dt>
<dd><p>The <span class="docutils literal">tickpolicy</span> attribute determines what happens when QEMU misses a
deadline for injecting a tick to the guest. This can happen, for example,
because the guest was paused.</p>
<dl class="simple">
<dt><span class="docutils literal">delay</span></dt>
<dd><p>Continue to deliver ticks at the normal rate. The guest OS will not
notice anything is amiss, as from its point of view time will have
continued to flow normally. The time in the guest should now be behind
the time in the host by exactly the amount of time during which ticks
have been missed.</p>
</dd>
<dt><span class="docutils literal">catchup</span></dt>
<dd><p>Deliver ticks at a higher rate to catch up with the missed ticks. The
guest OS will not notice anything is amiss, as from its point of view
time will have continued to flow normally. Once the timer has managed
to catch up with all the missing ticks, the time in the guest and in
the host should match.</p>
</dd>
<dt><span class="docutils literal">merge</span></dt>
<dd><p>Merge the missed tick(s) into one tick and inject. The guest time may
be delayed, depending on how the OS reacts to the merging of ticks</p>
</dd>
<dt><span class="docutils literal">discard</span></dt>
<dd><p>Throw away the missed ticks and continue with future injection
normally. The guest OS will see the timer jump ahead by a potentially
quite significant amount all at once, as if the intervening chunk of
time had simply not existed; needless to say, such a sudden jump can
easily confuse a guest OS which is not specifically prepared to deal
with it. Assuming the guest OS can deal correctly with the time jump,
the time in the guest and in the host should now match.</p>
</dd>
</dl>
<p>If the policy is "catchup", there can be further details in the
<span class="docutils literal">catchup</span> sub-element.</p>
<dl class="simple">
<dt><span class="docutils literal">catchup</span></dt>
<dd><p>The <span class="docutils literal">catchup</span> element has three optional attributes, each a positive
integer. The attributes are <span class="docutils literal">threshold</span>, <span class="docutils literal">slew</span>, and <span class="docutils literal">limit</span>.</p>
</dd>
</dl>
<p>Note that hypervisors are not required to support all policies across all
time sources</p>
</dd>
<dt><span class="docutils literal">frequency</span></dt>
<dd><p>The <span class="docutils literal">frequency</span> attribute is an unsigned integer specifying the
frequency at which <span class="docutils literal"><span class="pre">name="tsc"</span></span> runs.</p>
</dd>
<dt><span class="docutils literal">mode</span></dt>
<dd><p>The <span class="docutils literal">mode</span> attribute controls how the <span class="docutils literal"><span class="pre">name="tsc"</span></span> timer is managed,
and can be "auto", "native", "emulate", "paravirt", or "smpsafe". Other
timers are always emulated.</p>
</dd>
<dt><span class="docutils literal">present</span></dt>
<dd><p>The <span class="docutils literal">present</span> attribute can be "yes" or "no" to specify whether a
particular timer is available to the guest.</p>
</dd>
</dl>
</dd>
</dl>
<p><span class="anchor"><a id="elementsPerf"/></span></p>
</div>
<div class="section" id="performance-monitoring-events">
<h2><a class="toc-backref" href="formatdomain.html#id24">Performance monitoring events</a><a class="headerlink" href="formatdomain.html#performance-monitoring-events" title="Link to this headline">¶</a></h2>
<p>Some platforms allow monitoring of performance of the virtual machine and the
code executed inside. To enable the performance monitoring events you can either
specify them in the <span class="docutils literal">perf</span> element or enable them via
<span class="docutils literal">virDomainSetPerfEvents</span> API. The performance values are then retrieved using
the virConnectGetAllDomainStats API. <span class="since">Since 2.0.0</span></p>
<pre class="literal-block">...
&lt;perf&gt;
  &lt;event name='cmt' enabled='yes'/&gt;
  &lt;event name='mbmt' enabled='no'/&gt;
  &lt;event name='mbml' enabled='yes'/&gt;
  &lt;event name='cpu_cycles' enabled='no'/&gt;
  &lt;event name='instructions' enabled='yes'/&gt;
  &lt;event name='cache_references' enabled='no'/&gt;
  &lt;event name='cache_misses' enabled='no'/&gt;
  &lt;event name='branch_instructions' enabled='no'/&gt;
  &lt;event name='branch_misses' enabled='no'/&gt;
  &lt;event name='bus_cycles' enabled='no'/&gt;
  &lt;event name='stalled_cycles_frontend' enabled='no'/&gt;
  &lt;event name='stalled_cycles_backend' enabled='no'/&gt;
  &lt;event name='ref_cpu_cycles' enabled='no'/&gt;
  &lt;event name='cpu_clock' enabled='no'/&gt;
  &lt;event name='task_clock' enabled='no'/&gt;
  &lt;event name='page_faults' enabled='no'/&gt;
  &lt;event name='context_switches' enabled='no'/&gt;
  &lt;event name='cpu_migrations' enabled='no'/&gt;
  &lt;event name='page_faults_min' enabled='no'/&gt;
  &lt;event name='page_faults_maj' enabled='no'/&gt;
  &lt;event name='alignment_faults' enabled='no'/&gt;
  &lt;event name='emulation_faults' enabled='no'/&gt;
&lt;/perf&gt;
...</pre>
<table>
<colgroup>
<col style="width: 11%"/>
<col style="width: 76%"/>
<col style="width: 13%"/>
</colgroup>
<thead>
<tr><th class="head"><p>event name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>stats parameter name</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><span class="docutils literal">cmt</span></p></td>
<td><p>usage of l3 cache in bytes by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.cmt</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">mbmt</span></p></td>
<td><p>total system bandwidth from one level of cache</p></td>
<td><p><span class="docutils literal">perf.mbmt</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">mbml</span></p></td>
<td><p>bandwidth of memory traffic for a memory controller</p></td>
<td><p><span class="docutils literal">perf.mbml</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">cpu_cycles</span></p></td>
<td><p>the count of CPU cycles (total/elapsed)</p></td>
<td><p><span class="docutils literal">perf.cpu_cycles</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">instructions</span></p></td>
<td><p>the count of instructions by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.instructions</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">cache_references</span></p></td>
<td><p>the count of cache hits by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.cache_references</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">cache_misses</span></p></td>
<td><p>the count of cache misses by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.cache_misses</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">branch_instructions</span></p></td>
<td><p>the count of branch instructions by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.branch_instructions</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">branch_misses</span></p></td>
<td><p>the count of branch misses by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.branch_misses</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">bus_cycles</span></p></td>
<td><p>the count of bus cycles by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.bus_cycles</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">stalled_cycles_frontend</span></p></td>
<td><p>the count of stalled CPU cycles in the frontend of the instruction processor pipeline by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.stalled_cycles_frontend</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">stalled_cycles_backend</span></p></td>
<td><p>the count of stalled CPU cycles in the backend of the instruction processor pipeline by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.stalled_cycles_backend</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">ref_cpu_cycles</span></p></td>
<td><p>the count of total CPU cycles not affected by CPU frequency scaling by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.ref_cpu_cycles</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">cpu_clock</span></p></td>
<td><p>the count of CPU clock time, as measured by a monotonic high-resolution per-CPU timer, by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.cpu_clock</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">task_clock</span></p></td>
<td><p>the count of task clock time, as measured by a monotonic high-resolution CPU timer, specific to the task that is run by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.task_clock</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">page_faults</span></p></td>
<td><p>the count of page faults by applications running on the platform. This includes minor, major, invalid and other types of page faults</p></td>
<td><p><span class="docutils literal">perf.page_faults</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">context_switches</span></p></td>
<td><p>the count of context switches by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.context_switches</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">cpu_migrations</span></p></td>
<td><p>the count of CPU migrations, that is, where the process moved from one logical processor to another, by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.cpu_migrations</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">page_faults_min</span></p></td>
<td><p>the count of minor page faults, that is, where the page was present in the page cache, and therefore the fault avoided loading it from storage, by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.page_faults_min</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">page_faults_maj</span></p></td>
<td><p>the count of major page faults, that is, where the page was not present in the page cache, and therefore had to be fetched from storage, by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.page_faults_maj</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">alignment_faults</span></p></td>
<td><p>the count of alignment faults, that is when the load or store is not aligned properly, by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.alignment_faults</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">emulation_faults</span></p></td>
<td><p>the count of emulation faults, that is when the kernel traps on unimplemented instrucions and emulates them for user space, by applications running on the platform</p></td>
<td><p><span class="docutils literal">perf.emulation_faults</span></p></td>
</tr>
</tbody>
</table>
<p><span class="anchor"><a id="elementsDevices"/></span></p>
</div>
<div class="section" id="devices">
<h2><a class="toc-backref" href="formatdomain.html#id25">Devices</a><a class="headerlink" href="formatdomain.html#devices" title="Link to this headline">¶</a></h2>
<p>The final set of XML elements are all used to describe devices provided to the
guest domain. All devices occur as children of the main <span class="docutils literal">devices</span> element.
<span class="since">Since 0.1.3</span></p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;emulator&gt;/usr/lib/xen/bin/qemu-dm&lt;/emulator&gt;
&lt;/devices&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">emulator</span></dt>
<dd><p>The contents of the <span class="docutils literal">emulator</span> element specify the fully qualified path to
the device model emulator binary. The <a class="reference external" href="https://libvirt.org/formatcaps.html">capabilities XML</a>
specifies the recommended default emulator to use for each particular domain
type / architecture combination.</p>
</dd>
</dl>
<p>To help users identifying devices they care about, every device can have direct
child <span class="docutils literal">alias</span> element which then has <span class="docutils literal">name</span> attribute where users can store
identifier for the device. The identifier has to have "ua-" prefix and must be
unique within the domain. Additionally, the identifier must consist only of the
following characters: <span class="docutils literal"><span class="pre">[a-zA-Z0-9_-]</span></span>. <span class="since">Since 3.9.0</span></p>
<pre class="literal-block">&lt;devices&gt;
  &lt;disk type='file'&gt;
    &lt;alias name='ua-myDisk'/&gt;
  &lt;/disk&gt;
  &lt;interface type='network' trustGuestRxFilters='yes'&gt;
    &lt;alias name='ua-myNIC'/&gt;
  &lt;/interface&gt;
  ...
&lt;/devices&gt;</pre>
<p><span class="anchor"><a id="elementsDisks"/></span></p>
<div class="section" id="hard-drives-floppy-disks-cdroms">
<h3><a class="toc-backref" href="formatdomain.html#id26">Hard drives, floppy disks, CDROMs</a><a class="headerlink" href="formatdomain.html#hard-drives-floppy-disks-cdroms" title="Link to this headline">¶</a></h3>
<p>Any device that looks like a disk, be it a floppy, harddisk, cdrom, or
paravirtualized driver is specified via the <span class="docutils literal">disk</span> element.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;disk type='file' snapshot='external'&gt;
    &lt;driver name="tap" type="aio" cache="default"/&gt;
    &lt;source file='/var/lib/xen/images/fv0' startupPolicy='optional'&gt;
      &lt;seclabel relabel='no'/&gt;
    &lt;/source&gt;
    &lt;target dev='hda' bus='ide'/&gt;
    &lt;iotune&gt;
      &lt;total_bytes_sec&gt;10000000&lt;/total_bytes_sec&gt;
      &lt;read_iops_sec&gt;400000&lt;/read_iops_sec&gt;
      &lt;write_iops_sec&gt;100000&lt;/write_iops_sec&gt;
    &lt;/iotune&gt;
    &lt;boot order='2'/&gt;
    &lt;encryption type='...'&gt;
      ...
    &lt;/encryption&gt;
    &lt;shareable/&gt;
    &lt;serial&gt;
      ...
    &lt;/serial&gt;
  &lt;/disk&gt;
    ...
  &lt;disk type='network'&gt;
    &lt;driver name="qemu" type="raw" io="threads" ioeventfd="on" event_idx="off"/&gt;
    &lt;source protocol="sheepdog" name="image_name"&gt;
      &lt;host name="hostname" port="7000"/&gt;
    &lt;/source&gt;
    &lt;target dev="hdb" bus="ide"/&gt;
    &lt;boot order='1'/&gt;
    &lt;transient/&gt;
    &lt;address type='drive' controller='0' bus='1' unit='0'/&gt;
  &lt;/disk&gt;
  &lt;disk type='network'&gt;
    &lt;driver name="qemu" type="raw"/&gt;
    &lt;source protocol="rbd" name="image_name2"&gt;
      &lt;host name="hostname" port="7000"/&gt;
      &lt;snapshot name="snapname"/&gt;
      &lt;config file="/path/to/file"/&gt;
      &lt;auth username='myuser'&gt;
        &lt;secret type='ceph' usage='mypassid'/&gt;
      &lt;/auth&gt;
    &lt;/source&gt;
    &lt;target dev="hdc" bus="ide"/&gt;
  &lt;/disk&gt;
  &lt;disk type='block' device='cdrom'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;target dev='hdd' bus='ide' tray='open'/&gt;
    &lt;readonly/&gt;
  &lt;/disk&gt;
  &lt;disk type='network' device='cdrom'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source protocol="http" name="url_path" query="foo=bar&amp;amp;baz=flurb&gt;
      &lt;host name="hostname" port="80"/&gt;
      &lt;cookies&gt;
        &lt;cookie name="test"&gt;somevalue&lt;/cookie&gt;
      &lt;/cookies&gt;
      &lt;readahead size='65536'/&gt;
      &lt;timeout seconds='6'/&gt;
    &lt;/source&gt;
    &lt;target dev='hde' bus='ide' tray='open'/&gt;
    &lt;readonly/&gt;
  &lt;/disk&gt;
  &lt;disk type='network' device='cdrom'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source protocol="https" name="url_path"&gt;
      &lt;host name="hostname" port="443"/&gt;
      &lt;ssl verify="no"/&gt;
    &lt;/source&gt;
    &lt;target dev='hdf' bus='ide' tray='open'/&gt;
    &lt;readonly/&gt;
  &lt;/disk&gt;
  &lt;disk type='network' device='cdrom'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source protocol="ftp" name="url_path"&gt;
      &lt;host name="hostname" port="21"/&gt;
    &lt;/source&gt;
    &lt;target dev='hdg' bus='ide' tray='open'/&gt;
    &lt;readonly/&gt;
  &lt;/disk&gt;
  &lt;disk type='network' device='cdrom'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source protocol="ftps" name="url_path"&gt;
      &lt;host name="hostname" port="990"/&gt;
    &lt;/source&gt;
    &lt;target dev='hdh' bus='ide' tray='open'/&gt;
    &lt;readonly/&gt;
  &lt;/disk&gt;
  &lt;disk type='network' device='cdrom'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source protocol="tftp" name="url_path"&gt;
      &lt;host name="hostname" port="69"/&gt;
    &lt;/source&gt;
    &lt;target dev='hdi' bus='ide' tray='open'/&gt;
    &lt;readonly/&gt;
  &lt;/disk&gt;
  &lt;disk type='block' device='lun'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source dev='/dev/sda'&gt;
      &lt;slices&gt;
        &lt;slice type='storage' offset='12345' size='123'/&gt;
      &lt;/slices&gt;
      &lt;reservations managed='no'&gt;
        &lt;source type='unix' path='/path/to/qemu-pr-helper' mode='client'/&gt;
      &lt;/reservations&gt;
    &lt;/source&gt;
    &lt;target dev='sda' bus='scsi'/&gt;
    &lt;address type='drive' controller='0' bus='0' target='3' unit='0'/&gt;
  &lt;/disk&gt;
  &lt;disk type='block' device='disk'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source dev='/dev/sda'/&gt;
    &lt;geometry cyls='16383' heads='16' secs='63' trans='lba'/&gt;
    &lt;blockio logical_block_size='512' physical_block_size='4096'/&gt;
    &lt;target dev='hdj' bus='ide'/&gt;
  &lt;/disk&gt;
  &lt;disk type='volume' device='disk'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source pool='blk-pool0' volume='blk-pool0-vol0'/&gt;
    &lt;target dev='hdk' bus='ide'/&gt;
  &lt;/disk&gt;
  &lt;disk type='network' device='disk'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source protocol='iscsi' name='iqn.2013-07.com.example:iscsi-nopool/2'&gt;
      &lt;host name='example.com' port='3260'/&gt;
      &lt;auth username='myuser'&gt;
        &lt;secret type='iscsi' usage='libvirtiscsi'/&gt;
      &lt;/auth&gt;
    &lt;/source&gt;
    &lt;target dev='vda' bus='virtio'/&gt;
  &lt;/disk&gt;
  &lt;disk type='network' device='lun'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source protocol='iscsi' name='iqn.2013-07.com.example:iscsi-nopool/1'&gt;
      &lt;host name='example.com' port='3260'/&gt;
      &lt;auth username='myuser'&gt;
        &lt;secret type='iscsi' usage='libvirtiscsi'/&gt;
      &lt;/auth&gt;
    &lt;/source&gt;
    &lt;target dev='sdb' bus='scsi'/&gt;
  &lt;/disk&gt;
  &lt;disk type='network' device='disk'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source protocol='nfs' name='PATH'&gt;
      &lt;host name='example.com'/&gt;
      &lt;identity user='USER' group='GROUP'/&gt;
    &lt;/source&gt;
    &lt;target dev='vda' bus='virtio'/&gt;
  &lt;/disk&gt;
  &lt;disk type='network' device='lun'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source protocol='iscsi' name='iqn.2013-07.com.example:iscsi-nopool/0'&gt;
      &lt;host name='example.com' port='3260'/&gt;
      &lt;initiator&gt;
        &lt;iqn name='iqn.2013-07.com.example:client'/&gt;
      &lt;/initiator&gt;
    &lt;/source&gt;
    &lt;target dev='sdb' bus='scsi'/&gt;
  &lt;/disk&gt;
  &lt;disk type='volume' device='disk'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source pool='iscsi-pool' volume='unit:0:0:1' mode='host'/&gt;
    &lt;target dev='vdb' bus='virtio'/&gt;
  &lt;/disk&gt;
  &lt;disk type='volume' device='disk'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source pool='iscsi-pool' volume='unit:0:0:2' mode='direct'/&gt;
    &lt;target dev='vdc' bus='virtio'/&gt;
  &lt;/disk&gt;
  &lt;disk type='file' device='disk'&gt;
    &lt;driver name='qemu' type='qcow2' queues='4'/&gt;
    &lt;source file='/var/lib/libvirt/images/domain.qcow'/&gt;
    &lt;backingStore type='file'&gt;
      &lt;format type='qcow2'/&gt;
      &lt;source file='/var/lib/libvirt/images/snapshot.qcow'/&gt;
      &lt;backingStore type='block'&gt;
        &lt;format type='raw'/&gt;
        &lt;source dev='/dev/mapper/base'/&gt;
        &lt;backingStore/&gt;
      &lt;/backingStore&gt;
    &lt;/backingStore&gt;
    &lt;target dev='vdd' bus='virtio'/&gt;
  &lt;/disk&gt;
  &lt;disk type='nvme' device='disk'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source type='pci' managed='yes' namespace='1'&gt;
      &lt;address domain='0x0000' bus='0x01' slot='0x00' function='0x0'/&gt;
    &lt;/source&gt;
    &lt;target dev='vde' bus='virtio'/&gt;
  &lt;/disk&gt;
  &lt;disk type='vhostuser' device='disk'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source type='unix' path='/tmp/vhost-blk.sock'&gt;
      &lt;reconnect enabled='yes' timeout='10'/&gt;
    &lt;/source&gt;
    &lt;target dev='vdf' bus='virtio'/&gt;
  &lt;/disk&gt;
&lt;/devices&gt;
...</pre>
<dl>
<dt><span class="docutils literal">disk</span></dt>
<dd><p>The <span class="docutils literal">disk</span> element is the main container for describing disks and supports
the following attributes:</p>
<dl>
<dt><span class="docutils literal">type</span></dt>
<dd><p>Valid values are "file", "block", "dir" ( <span class="since">since 0.7.5</span> ),
"network" ( <span class="since">since 0.8.7</span> ), or "volume" ( <span class="since">since 1.0.5</span> ),
or "nvme" ( <span class="since">since 6.0.0</span> ), or "vhostuser" ( <span class="since">since 7.1.0</span> )
and refer to the underlying source for the disk. <span class="since">Since 0.0.3</span></p>
</dd>
<dt><span class="docutils literal">device</span></dt>
<dd><p>Indicates how the disk is to be exposed to the guest OS. Possible values
for this attribute are "floppy", "disk", "cdrom", and "lun", defaulting to
"disk".</p>
<p>Using "lun" ( <span class="since">since 0.9.10</span> ) is only valid when the <span class="docutils literal">type</span> is
"block" or "network" for <span class="docutils literal"><span class="pre">protocol='iscsi'</span></span> or when the <span class="docutils literal">type</span> is
"volume" when using an iSCSI source <span class="docutils literal">pool</span> for <span class="docutils literal">mode</span> "host" or as an
<a class="reference external" href="https://wiki.libvirt.org/page/NPIV_in_libvirt">NPIV</a> virtual Host Bus
Adapter (vHBA) using a Fibre Channel storage pool. Configured in this
manner, the LUN behaves identically to "disk", except that generic SCSI
commands from the guest are accepted and passed through to the physical
device. Also note that device='lun' will only be recognized for actual raw
devices, but never for individual partitions or LVM partitions (in those
cases, the kernel will reject the generic SCSI commands, making it
identical to device='disk'). <span class="since">Since 0.1.4</span></p>
</dd>
<dt><span class="docutils literal">model</span></dt>
<dd><p>Indicates the emulated device model of the disk. Typically this is
indicated solely by the <span class="docutils literal">bus</span> property but for <span class="docutils literal">bus</span> "virtio" the
model can be specified further with "virtio-transitional",
"virtio-non-transitional", or "virtio". See <a class="reference external" href="formatdomain.html#elementsVirtioTransitional">Virtio transitional
devices</a> for more details. <span class="since">Since
5.2.0</span></p>
</dd>
<dt><span class="docutils literal">rawio</span></dt>
<dd><p>Indicates whether the disk needs rawio capability. Valid settings are
"yes" or "no" (default is "no"). If any one disk in a domain has
rawio='yes', rawio capability will be enabled for all disks in the domain
(because, in the case of QEMU, this capability can only be set on a
per-process basis). This attribute is only valid when device is "lun". NB,
<span class="docutils literal">rawio</span> intends to confine the capability per-device, however, current
QEMU implementation gives the domain process broader capability than that
(per-process basis, affects all the domain disks). To confine the
capability as much as possible for QEMU driver as this stage, <span class="docutils literal">sgio</span> is
recommended, it's more secure than <span class="docutils literal">rawio</span>. <span class="since">Since 0.9.10</span></p>
</dd>
<dt><span class="docutils literal">sgio</span></dt>
<dd><p>If supported by the hypervisor and OS, indicates whether unprivileged
SG_IO commands are filtered for the disk. Valid settings are "filtered" or
"unfiltered" where the default is "filtered". Only available when the
<span class="docutils literal">device</span> is 'lun'. <span class="since">Since 1.0.2</span></p>
</dd>
<dt><span class="docutils literal">snapshot</span></dt>
<dd><p>Indicates the default behavior of the disk during disk snapshots:
"<span class="docutils literal">internal</span>" requires a file format such as qcow2 that can store both
the snapshot and the data changes since the snapshot; "<span class="docutils literal">external</span>" will
separate the snapshot from the live data; and "<span class="docutils literal">no</span>" means the disk will
not participate in snapshots. Read-only disks default to "<span class="docutils literal">no</span>", while
the default for other disks depends on the hypervisor's capabilities. Some
hypervisors allow a per-snapshot choice as well, during <a class="reference external" href="https://libvirt.org/formatsnapshot.html">domain snapshot
creation</a>. Not all snapshot modes are supported;
for example, enabling snapshots with a transient disk generally does not
make sense. <span class="since">Since 0.9.5</span></p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">source</span></dt>
<dd><p>Representation of the disk <span class="docutils literal">source</span> depends on the disk <span class="docutils literal">type</span> attribute
value as follows:</p>
<dl>
<dt><span class="docutils literal">file</span></dt>
<dd><p>The <span class="docutils literal">file</span> attribute specifies the fully-qualified path to the file
holding the disk. <span class="since">Since 0.0.3</span></p>
</dd>
<dt><span class="docutils literal">block</span></dt>
<dd><p>The <span class="docutils literal">dev</span> attribute specifies the fully-qualified path to the host
device to serve as the disk. <span class="since">Since 0.0.3</span></p>
</dd>
<dt><span class="docutils literal">dir</span></dt>
<dd><p>The <span class="docutils literal">dir</span> attribute specifies the fully-qualified path to the directory
to use as the disk. <span class="since">Since 0.7.5</span></p>
</dd>
<dt><span class="docutils literal">network</span></dt>
<dd><p>The <span class="docutils literal">protocol</span> attribute specifies the protocol to access to the
requested image. Possible values are "nbd", "iscsi", "rbd", "sheepdog",
"gluster", "vxhs", "nfs", "http", "https", "ftp", ftps", or "tftp".</p>
<p>For any <span class="docutils literal">protocol</span> other than <span class="docutils literal">nbd</span> an additional attribute <span class="docutils literal">name</span>
is mandatory to specify which volume/image will be used.</p>
<p>For "nbd", the <span class="docutils literal">name</span> attribute is optional. TLS transport for NBD can
be enabled by setting the <span class="docutils literal">tls</span> attribute to <span class="docutils literal">yes</span>. For the QEMU
hypervisor, usage of a TLS environment can also be globally controlled on
the host by the <span class="docutils literal">nbd_tls</span> and <span class="docutils literal">nbd_tls_x509_cert_dir</span> in
/etc/libvirt/qemu.conf. ('tls' <span class="since">Since 4.5.0</span> )</p>
<p>For protocols <span class="docutils literal">http</span> and <span class="docutils literal">https</span> an optional attribute <span class="docutils literal">query</span>
specifies the query string. ( <span class="since">Since 6.2.0</span> )</p>
<p>For "iscsi" ( <span class="since">since 1.0.4</span> ), the <span class="docutils literal">name</span> attribute may include a
logical unit number, separated from the target's name by a slash (e.g.,
<span class="docutils literal"><span class="pre">iqn.2013-07.com.example:iscsi-pool/1</span></span>). If not specified, the default
LUN is zero.</p>
<p>For "vxhs" ( <span class="since">since 3.8.0</span> ), the <span class="docutils literal">name</span> is the UUID of the
volume, assigned by the HyperScale server. Additionally, an optional
attribute <span class="docutils literal">tls</span> (QEMU only) can be used to control whether a VxHS block
device would utilize a hypervisor configured TLS X.509 certificate
environment in order to encrypt the data channel. For the QEMU hypervisor,
usage of a TLS environment can also be globally controlled on the host by
the <span class="docutils literal">vxhs_tls</span> and <span class="docutils literal">vxhs_tls_x509_cert_dir</span> or
<span class="docutils literal">default_tls_x509_cert_dir</span> settings in the file /etc/libvirt/qemu.conf.
If <span class="docutils literal">vxhs_tls</span> is enabled, then unless the domain <span class="docutils literal">tls</span> attribute is
set to "no", libvirt will use the host configured TLS environment. If the
<span class="docutils literal">tls</span> attribute is set to "yes", then regardless of the qemu.conf
setting, TLS authentication will be attempted.</p>
<p><span class="since">Since 0.8.7</span></p>
</dd>
<dt><span class="docutils literal">volume</span></dt>
<dd><p>The underlying disk source is represented by attributes <span class="docutils literal">pool</span> and
<span class="docutils literal">volume</span>. Attribute <span class="docutils literal">pool</span> specifies the name of the <a class="reference external" href="https://libvirt.org/formatstorage.html">storage
pool</a> (managed by libvirt) where the disk source
resides. Attribute <span class="docutils literal">volume</span> specifies the name of storage volume
(managed by libvirt) used as the disk source. The value for the <span class="docutils literal">volume</span>
attribute will be the output from the "Name" column of a
<span class="docutils literal">virsh <span class="pre">vol-list</span> <span class="pre">[pool-name]</span></span> command.</p>
<p>Use the attribute <span class="docutils literal">mode</span> ( <span class="since">since 1.1.1</span> ) to indicate how to
represent the LUN as the disk source. Valid values are "direct" and
"host". If <span class="docutils literal">mode</span> is not specified, the default is to use "host". Using
"direct" as the <span class="docutils literal">mode</span> value indicates to use the <a class="reference external" href="https://libvirt.org/formatstorage.html">storage
pool's</a> <span class="docutils literal">source</span> element <span class="docutils literal">host</span> attribute as
the disk source to generate the libiscsi URI (e.g.
'file=iscsi://example.com:3260/iqn.2013-07.com.example:iscsi-pool/1').
Using "host" as the <span class="docutils literal">mode</span> value indicates to use the LUN's path as it
shows up on host (e.g.
'file=/dev/disk/by-path/ip-example.com:3260-iscsi-iqn.2013-07.com.example:iscsi-pool-lun-1').
Using a LUN from an iSCSI source pool provides the same features as a
<span class="docutils literal">disk</span> configured using <span class="docutils literal">type</span> 'block' or 'network' and <span class="docutils literal">device</span> of
'lun' with respect to how the LUN is presented to and may be used by the
guest. <span class="since">Since 1.0.5</span></p>
</dd>
<dt><span class="docutils literal">nvme</span></dt>
<dd><p>To specify disk source for NVMe disk the <span class="docutils literal">source</span> element has the
following attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">type</span></dt>
<dd><p>The type of address specified in <span class="docutils literal">address</span> sub-element. Currently,
only <span class="docutils literal">pci</span> value is accepted.</p>
</dd>
<dt><span class="docutils literal">managed</span></dt>
<dd><p>This attribute instructs libvirt to detach NVMe controller
automatically on domain startup (<span class="docutils literal">yes</span>) or expect the controller to
be detached by system administrator (<span class="docutils literal">no</span>).</p>
</dd>
<dt><span class="docutils literal">namespace</span></dt>
<dd><p>The namespace ID which should be assigned to the domain. According to
NVMe standard, namespace numbers start from 1, including.</p>
</dd>
</dl>
<p>The difference between <span class="docutils literal">&lt;disk <span class="pre">type='nvme'&gt;</span></span> and <span class="docutils literal">&lt;hostdev/&gt;</span> is that
the latter is plain host device assignment with all its limitations (e.g.
no live migration), while the former makes hypervisor to run the NVMe disk
through hypervisor's block layer thus enabling all features provided by
the layer (e.g. snapshots, domain migration, etc.). Moreover, since the
NVMe disk is unbinded from its PCI driver, the host kernel storage stack
is not involved (compared to passing say <span class="docutils literal">/dev/nvme0n1</span> via
<span class="docutils literal">&lt;disk <span class="pre">type='block'&gt;</span></span> and therefore lower latencies can be achieved.</p>
</dd>
<dt><span class="docutils literal">vhostuser</span></dt>
<dd><p>Enables the hypervisor to connect to another process using vhost-user
protocol. Requires shared memory configured for the VM, for more details
see <span class="docutils literal">access</span> mode for <a class="reference external" href="formatdomain.html#elementsMemoryBacking">memoryBacking</a> element.</p>
<p>The <span class="docutils literal">source</span> element has following mandatory attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">type</span></dt>
<dd><p>The type of char device. Currently only <span class="docutils literal">unix</span> type is supported.</p>
</dd>
<dt><span class="docutils literal">path</span></dt>
<dd><p>Path to the unix socket to be used as disk source.</p>
</dd>
</dl>
<p>Note that the vhost server replaces both the disk frontend and backend
thus almost all of the disk properties can't be configured via the
<span class="docutils literal">&lt;disk&gt;</span> XML for this disk type. Additionally features such as blockjobs,
incremental backups and snapshots are not supported for this disk type.</p>
</dd>
</dl>
<p>With "file", "block", and "volume", one or more optional sub-elements
<span class="docutils literal">seclabel</span>, <a class="reference external" href="formatdomain.html#seclabel">described below</a> (and <span class="since">since 0.9.9</span> ),
can be used to override the domain security labeling policy for just that
source file. (NB, for "volume" type disk, <span class="docutils literal">seclabel</span> is only valid when the
specified storage volume is of 'file' or 'block' type).</p>
<p>The <span class="docutils literal">source</span> element may also have the <span class="docutils literal">index</span> attribute with same
semantics the <span class="docutils literal">index</span> attribute of <span class="docutils literal">backingStore</span>.</p>
<p>The <span class="docutils literal">source</span> element may contain the following sub elements:</p>
<dl>
<dt><span class="docutils literal">host</span></dt>
<dd><p>When the disk <span class="docutils literal">type</span> is "network", the <span class="docutils literal">source</span> may have zero or more
<span class="docutils literal">host</span> sub-elements used to specify the hosts to connect. The <span class="docutils literal">host</span>
element supports 4 attributes, viz. "name", "port", "transport" and
"socket", which specify the hostname, the port number, transport type and
path to socket, respectively. The meaning of this element and the number
of the elements depend on the protocol attribute.</p>
<table>
<colgroup>
<col style="width: 6%"/>
<col style="width: 40%"/>
<col style="width: 43%"/>
<col style="width: 12%"/>
</colgroup>
<thead>
<tr><th class="head"><p>Protocol</p></th>
<th class="head"><p>Meaning</p></th>
<th class="head"><p>Number of hosts</p></th>
<th class="head"><p>Default port</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>nbd</p></td>
<td><p>a server running nbd-server</p></td>
<td><p>only one</p></td>
<td><p>10809</p></td>
</tr>
<tr><td><p>iscsi</p></td>
<td><p>an iSCSI server</p></td>
<td><p>only one</p></td>
<td><p>3260</p></td>
</tr>
<tr><td><p>rbd</p></td>
<td><p>monitor servers of RBD</p></td>
<td><p>one or more</p></td>
<td><p>librados default</p></td>
</tr>
<tr><td><p>sheepdog</p></td>
<td><p>one of the sheepdog servers (default is localhost:7000)</p></td>
<td><p>zero or one</p></td>
<td><p>7000</p></td>
</tr>
<tr><td><p>gluster</p></td>
<td><p>a server running glusterd daemon</p></td>
<td><p>one or more ( <span class="since">Since 2.1.0</span> ), just one prior to that</p></td>
<td><p>24007</p></td>
</tr>
<tr><td><p>vxhs</p></td>
<td><p>a server running Veritas HyperScale daemon</p></td>
<td><p>only one</p></td>
<td><p>9999</p></td>
</tr>
<tr><td><p>nfs</p></td>
<td><p>a server running Network File System</p></td>
<td><p>only one ( <span class="since">Since 7.0.0</span> )</p></td>
<td><p>must be omitted</p></td>
</tr>
</tbody>
</table>
<p>gluster supports "tcp", "rdma", "unix" as valid values for the transport
attribute. nbd supports "tcp" and "unix". Others only support "tcp". If
nothing is specified, "tcp" is assumed. If the transport is "unix", the
socket attribute specifies the path to an AF_UNIX socket. nfs only
supports the use of a "tcp" transport, and does not support using a
port at all so it must be omitted.</p>
</dd>
<dt><span class="docutils literal">snapshot</span></dt>
<dd><p>The <span class="docutils literal">name</span> attribute of <span class="docutils literal">snapshot</span> element can optionally specify an
internal snapshot name to be used as the source for storage protocols.
Supported for 'rbd' <span class="since">since 1.2.11 (QEMU only).</span></p>
</dd>
<dt><span class="docutils literal">config</span></dt>
<dd><p>The <span class="docutils literal">file</span> attribute for the <span class="docutils literal">config</span> element provides a fully
qualified path to a configuration file to be provided as a parameter to
the client of a networked storage protocol. Supported for 'rbd'
<span class="since">since 1.2.11 (QEMU only).</span></p>
</dd>
<dt><span class="docutils literal">auth</span></dt>
<dd><p><span class="since">Since libvirt 3.9.0</span> , the <span class="docutils literal">auth</span> element is supported for a
disk <span class="docutils literal">type</span> "network" that is using a <span class="docutils literal">source</span> element with the
<span class="docutils literal">protocol</span> attributes "rbd" or "iscsi". If present, the <span class="docutils literal">auth</span> element
provides the authentication credentials needed to access the source. It
includes a mandatory attribute <span class="docutils literal">username</span>, which identifies the username
to use during authentication, as well as a sub-element <span class="docutils literal">secret</span> with
mandatory attribute <span class="docutils literal">type</span>, to tie back to a <a class="reference external" href="https://libvirt.org/formatsecret.html">libvirt secret
object</a> that holds the actual password or other
credentials (the domain XML intentionally does not expose the password,
only the reference to the object that does manage the password). Known
secret types are "ceph" for Ceph RBD network sources and "iscsi" for CHAP
authentication of iSCSI targets. Both will require either a <span class="docutils literal">uuid</span>
attribute with the UUID of the secret object or a <span class="docutils literal">usage</span> attribute
matching the key that was specified in the secret object.</p>
</dd>
<dt><span class="docutils literal">encryption</span></dt>
<dd><p><span class="since">Since libvirt 3.9.0</span> , the <span class="docutils literal">encryption</span> can be a sub-element of
the <span class="docutils literal">source</span> element for encrypted storage sources. If present,
specifies how the storage source is encrypted See the <a class="reference external" href="https://libvirt.org/formatstorageencryption.html">Storage
Encryption</a> page for more information.
Note that the 'qcow' format of encryption is broken and thus is no longer
supported for use with disk images. ( <span class="since">Since libvirt 4.5.0</span> )</p>
</dd>
<dt><span class="docutils literal">reservations</span></dt>
<dd><p><span class="since">Since libvirt 4.4.0</span> , the <span class="docutils literal">reservations</span> can be a sub-element
of the <span class="docutils literal">source</span> element for storage sources (QEMU driver only). If
present it enables persistent reservations for SCSI based disks. The
element has one mandatory attribute <span class="docutils literal">managed</span> with accepted values
<span class="docutils literal">yes</span> and <span class="docutils literal">no</span>. If <span class="docutils literal">managed</span> is enabled libvirt prepares and manages
any resources needed. When the persistent reservations are unmanaged, then
the hypervisor acts as a client and the path to the server socket must be
provided in the child element <span class="docutils literal">source</span>, which currently accepts only the
following attributes: <span class="docutils literal">type</span> with one value <span class="docutils literal">unix</span>, <span class="docutils literal">path</span> path to
the socket, and finally <span class="docutils literal">mode</span> which accepts one value <span class="docutils literal">client</span>
specifying the role of hypervisor. It's recommended to allow libvirt
manage the persistent reservations.</p>
</dd>
<dt><span class="docutils literal">initiator</span></dt>
<dd><p><span class="since">Since libvirt 4.7.0</span> , the <span class="docutils literal">initiator</span> element is supported for
a disk <span class="docutils literal">type</span> "network" that is using a <span class="docutils literal">source</span> element with the
<span class="docutils literal">protocol</span> attribute "iscsi". If present, the <span class="docutils literal">initiator</span> element
provides the initiator IQN needed to access the source via mandatory
attribute <span class="docutils literal">name</span>.</p>
</dd>
<dt><span class="docutils literal">address</span></dt>
<dd><p>For disk of type <span class="docutils literal">nvme</span> this element specifies the PCI address of the
host NVMe controller. <span class="since">Since 6.0.0</span></p>
</dd>
<dt><span class="docutils literal">slices</span></dt>
<dd><p>The <span class="docutils literal">slices</span> element using its <span class="docutils literal">slice</span> sub-elements allows configuring
offset and size of either the location of the image format
(<span class="docutils literal">slice <span class="pre">type='storage'</span></span>) inside the storage source or the guest data
inside the image format container (future expansion). The <span class="docutils literal">offset</span> and
<span class="docutils literal">size</span> values are in bytes. <span class="since">Since 6.1.0</span></p>
</dd>
<dt><span class="docutils literal">ssl</span></dt>
<dd><p>For <span class="docutils literal">https</span> and <span class="docutils literal">ftps</span> accessed storage it's possible to tweak the SSL
transport parameters with this element. The <span class="docutils literal">verify</span> attribute allows to
turn on or off SSL certificate validation. Supported values are <span class="docutils literal">yes</span>
and <span class="docutils literal">no</span>. <span class="since">Since 6.2.0</span></p>
</dd>
<dt><span class="docutils literal">cookies</span></dt>
<dd><p>For <span class="docutils literal">http</span> and <span class="docutils literal">https</span> accessed storage it's possible to pass one or
more cookies. The cookie name and value must conform to the HTTP
specification. <span class="since">Since 6.2.0</span></p>
</dd>
<dt><span class="docutils literal">readahead</span></dt>
<dd><p>Specifies the size of the readahead buffer for protocols which support it.
(all 'curl' based drivers in qemu). The size is in bytes. Note that '0' is
considered as if the value is not provided. <span class="since">Since 6.2.0</span></p>
</dd>
<dt><span class="docutils literal">timeout</span></dt>
<dd><p>Specifies the connection timeout for protocols which support it. Note that
'0' is considered as if the value is not provided. <span class="since">Since 6.2.0</span></p>
</dd>
<dt><span class="docutils literal">identity</span></dt>
<dd><p>When using an <span class="docutils literal">nfs</span> protocol, this is used to provide information on the
configuration of the user and group. The element has two attributes,
<span class="docutils literal">user</span> and <span class="docutils literal">group</span>. The user can provide these elements as user or
group strings, or as user and group ID numbers directly if the string
is formatted using a "+" at the beginning of the ID number. If either
of these attributes is omitted, then that field is assumed to be the
default value for the current system. If both <span class="docutils literal">user</span> and <span class="docutils literal">group</span>
are intended to be default, then the entire element may be omitted.</p>
</dd>
<dt><span class="docutils literal">reconnect</span></dt>
<dd><p>For disk type <span class="docutils literal">vhostuser</span> configures reconnect timeout if the connection
is lost. It has two mandatory attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">enabled</span></dt>
<dd><p>If the reconnect feature is enabled, accepts <span class="docutils literal">yes</span> and <span class="docutils literal">no</span></p>
</dd>
<dt><span class="docutils literal">timeout</span></dt>
<dd><p>The amount of seconds after which hypervisor tries to reconnect.</p>
</dd>
</dl>
</dd>
</dl>
<p>For a "file" or "volume" disk type which represents a cdrom or floppy (the
<span class="docutils literal">device</span> attribute), it is possible to define policy what to do with the
disk if the source file is not accessible. (NB, <span class="docutils literal">startupPolicy</span> is not
valid for "volume" disk unless the specified storage volume is of "file"
type). This is done by the <span class="docutils literal">startupPolicy</span> attribute ( <span class="since">since 0.9.7</span>
), accepting these values:</p>
<table>
<colgroup>
<col style="width: 12%"/>
<col style="width: 88%"/>
</colgroup>
<tbody>
<tr><td><p>mandatory</p></td>
<td><p>fail if missing for any reason (the default)</p></td>
</tr>
<tr><td><p>requisite</p></td>
<td><p>fail if missing on boot up, drop if missing on migrate/restore/revert</p></td>
</tr>
<tr><td><p>optional</p></td>
<td><p>drop if missing at any start attempt</p></td>
</tr>
</tbody>
</table>
<p><span class="since">Since 1.1.2</span> the <span class="docutils literal">startupPolicy</span> is extended to support hard disks
besides cdrom and floppy. On guest cold bootup, if a certain disk is not
accessible or its disk chain is broken, with startupPolicy 'optional' the
guest will drop this disk. This feature doesn't support migration currently.</p>
</dd>
<dt><span class="docutils literal">backingStore</span></dt>
<dd><p>This element describes the backing store used by the disk specified by
sibling <span class="docutils literal">source</span> element. <span class="since">Since 1.2.4.</span> If the hypervisor driver
does not support the
<a class="reference external" href="https://libvirt.org/formatdomaincaps.html#featureBackingStoreInput">backingStoreInput</a> (
<span class="since">Since 5.10.0</span> ) domain feature the <span class="docutils literal">backingStore</span> is ignored on
input and only used for output to describe the detected backing chains of
running domains. If <span class="docutils literal">backingStoreInput</span> is supported the <span class="docutils literal">backingStore</span>
is used as the backing image of <span class="docutils literal">source</span> or other <span class="docutils literal">backingStore</span>
overriding any backing image information recorded in the image metadata. An
empty <span class="docutils literal">backingStore</span> element means the sibling source is self-contained and
is not based on any backing store. For the detected backing chain information
to be accurate, the backing format must be correctly specified in the
metadata of each file of the chain (files created by libvirt satisfy this
property, but using existing external files for snapshot or block copy
operations requires the end user to pre-create the file correctly). The
following attributes are supported in <span class="docutils literal">backingStore</span>:</p>
<dl class="simple">
<dt><span class="docutils literal">type</span></dt>
<dd><p>The <span class="docutils literal">type</span> attribute represents the type of disk used by the backing
store, see disk type attribute above for more details and possible values.</p>
</dd>
<dt><span class="docutils literal">index</span></dt>
<dd><p>This attribute is only valid in output (and ignored on input) and it can
be used to refer to a specific part of the disk chain when doing block
operations (such as via the <span class="docutils literal">virDomainBlockRebase</span> API). For example,
<span class="docutils literal">vda[2]</span> refers to the backing store with <span class="docutils literal"><span class="pre">index='2'</span></span> of the disk with
<span class="docutils literal">vda</span> target.</p>
</dd>
</dl>
<p>Moreover, <span class="docutils literal">backingStore</span> supports the following sub-elements:</p>
<dl>
<dt><span class="docutils literal">format</span></dt>
<dd><p>The <span class="docutils literal">format</span> element contains <span class="docutils literal">type</span> attribute which specifies the
internal format of the backing store, such as <span class="docutils literal">raw</span> or <span class="docutils literal">qcow2</span>.</p>
<p>The <span class="docutils literal">format</span> element can contain <span class="docutils literal">metadata_cache</span> subelement, which
has identical semantics to the identically named subelement of <span class="docutils literal">driver</span>
of a <span class="docutils literal">disk</span>.</p>
</dd>
<dt><span class="docutils literal">source</span></dt>
<dd><p>This element has the same structure as the <span class="docutils literal">source</span> element in <span class="docutils literal">disk</span>.
It specifies which file, device, or network location contains the data of
the described backing store.</p>
</dd>
<dt><span class="docutils literal">backingStore</span></dt>
<dd><p>If the backing store is not self-contained, the next element in the chain
is described by nested <span class="docutils literal">backingStore</span> element.</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">mirror</span></dt>
<dd><p>This element is present if the hypervisor has started a long-running block
job operation, where the mirror location in the <span class="docutils literal">source</span> sub-element will
eventually have the same contents as the source, and with the file format in
the sub-element <span class="docutils literal">format</span> (which might differ from the format of the
source). The details of the <span class="docutils literal">source</span> sub-element are determined by the
<span class="docutils literal">type</span> attribute of the mirror, similar to what is done for the overall
<span class="docutils literal">disk</span> device element. The <span class="docutils literal">job</span> attribute mentions which API started the
operation ("copy" for the <span class="docutils literal">virDomainBlockRebase</span> API, or "active-commit"
for the <span class="docutils literal">virDomainBlockCommit</span> API), <span class="since">since 1.2.7</span> . The attribute
<span class="docutils literal">ready</span>, if present, tracks progress of the job: <span class="docutils literal">yes</span> if the disk is
known to be ready to pivot, or, <span class="since">since 1.2.7</span> , <span class="docutils literal">abort</span> or <span class="docutils literal">pivot</span>
if the job is in the process of completing. If <span class="docutils literal">ready</span> is not present, the
disk is probably still copying. For now, this element only valid in output;
it is ignored on input. The <span class="docutils literal">source</span> sub-element exists for all two-phase
jobs <span class="since">since 1.2.6</span> . Older libvirt supported only block copy to a
file, <span class="since">since 0.9.12</span> ; for compatibility with older clients, such jobs
include redundant information in the attributes <span class="docutils literal">file</span> and <span class="docutils literal">format</span> in
the <span class="docutils literal">mirror</span> element.</p>
</dd>
<dt><span class="docutils literal">target</span></dt>
<dd><p>The <span class="docutils literal">target</span> element controls the bus / device under which the disk is
exposed to the guest OS. The <span class="docutils literal">dev</span> attribute indicates the "logical" device
name. The actual device name specified is not guaranteed to map to the device
name in the guest OS. Treat it as a device ordering hint. The optional
<span class="docutils literal">bus</span> attribute specifies the type of disk device to emulate; possible
values are driver specific, with typical values being "ide", "scsi",
"virtio", "xen", "usb", "sata", or "sd" <span class="since">"sd" since 1.1.2</span> . If
omitted, the bus type is inferred from the style of the device name (e.g. a
device named 'sda' will typically be exported using a SCSI bus). The optional
attribute <span class="docutils literal">tray</span> indicates the tray status of the removable disks (i.e.
CDROM or Floppy disk), the value can be either "open" or "closed", defaults
to "closed". NB, the value of <span class="docutils literal">tray</span> could be updated while the domain is
running. The optional attribute <span class="docutils literal">removable</span> sets the removable flag for USB
disks, and its value can be either "on" or "off", defaulting to "off".
<span class="since">Since 0.0.3</span>; <span class="docutils literal">bus</span> attribute <span class="since">since 0.4.3</span>; <span class="docutils literal">tray</span>
attribute <span class="since">since 0.9.11</span>; "usb" attribute value
<span class="since">since after 0.4.4</span>; "sata" attribute value <span class="since">since 0.9.7</span>;
"removable" attribute value <span class="since">since 1.1.3</span></p>
</dd>
<dt><span class="docutils literal">iotune</span></dt>
<dd><p>The optional <span class="docutils literal">iotune</span> element provides the ability to provide additional
per-device I/O tuning, with values that can vary for each device (contrast
this to the <a class="reference external" href="formatdomain.html#elementsBlockTuning">&lt;blkiotune&gt;</a> element, which applies
globally to the domain). Currently, the only tuning available is Block I/O
throttling for qemu. This element has optional sub-elements; any sub-element
not specified or given with a value of 0 implies no limit. <span class="since">Since
0.9.8</span></p>
<dl>
<dt><span class="docutils literal">total_bytes_sec</span></dt>
<dd><p>The optional <span class="docutils literal">total_bytes_sec</span> element is the total throughput limit in
bytes per second. This cannot appear with <span class="docutils literal">read_bytes_sec</span> or
<span class="docutils literal">write_bytes_sec</span>.</p>
</dd>
<dt><span class="docutils literal">read_bytes_sec</span></dt>
<dd><p>The optional <span class="docutils literal">read_bytes_sec</span> element is the read throughput limit in
bytes per second.</p>
</dd>
<dt><span class="docutils literal">write_bytes_sec</span></dt>
<dd><p>The optional <span class="docutils literal">write_bytes_sec</span> element is the write throughput limit in
bytes per second.</p>
</dd>
<dt><span class="docutils literal">total_iops_sec</span></dt>
<dd><p>The optional <span class="docutils literal">total_iops_sec</span> element is the total I/O operations per
second. This cannot appear with <span class="docutils literal">read_iops_sec</span> or <span class="docutils literal">write_iops_sec</span>.</p>
</dd>
<dt><span class="docutils literal">read_iops_sec</span></dt>
<dd><p>The optional <span class="docutils literal">read_iops_sec</span> element is the read I/O operations per
second.</p>
</dd>
<dt><span class="docutils literal">write_iops_sec</span></dt>
<dd><p>The optional <span class="docutils literal">write_iops_sec</span> element is the write I/O operations per
second.</p>
</dd>
<dt><span class="docutils literal">total_bytes_sec_max</span></dt>
<dd><p>The optional <span class="docutils literal">total_bytes_sec_max</span> element is the maximum total
throughput limit in bytes per second. This cannot appear with
<span class="docutils literal">read_bytes_sec_max</span> or <span class="docutils literal">write_bytes_sec_max</span>.</p>
</dd>
<dt><span class="docutils literal">read_bytes_sec_max</span></dt>
<dd><p>The optional <span class="docutils literal">read_bytes_sec_max</span> element is the maximum read throughput
limit in bytes per second.</p>
</dd>
<dt><span class="docutils literal">write_bytes_sec_max</span></dt>
<dd><p>The optional <span class="docutils literal">write_bytes_sec_max</span> element is the maximum write
throughput limit in bytes per second.</p>
</dd>
<dt><span class="docutils literal">total_iops_sec_max</span></dt>
<dd><p>The optional <span class="docutils literal">total_iops_sec_max</span> element is the maximum total I/O
operations per second. This cannot appear with <span class="docutils literal">read_iops_sec_max</span> or
<span class="docutils literal">write_iops_sec_max</span>.</p>
</dd>
<dt><span class="docutils literal">read_iops_sec_max</span></dt>
<dd><p>The optional <span class="docutils literal">read_iops_sec_max</span> element is the maximum read I/O
operations per second.</p>
</dd>
<dt><span class="docutils literal">write_iops_sec_max</span></dt>
<dd><p>The optional <span class="docutils literal">write_iops_sec_max</span> element is the maximum write I/O
operations per second.</p>
</dd>
<dt><span class="docutils literal">size_iops_sec</span></dt>
<dd><p>The optional <span class="docutils literal">size_iops_sec</span> element is the size of I/O operations per
second.</p>
<p><span class="since">Throughput limits since 1.2.11 and QEMU 1.7</span></p>
</dd>
<dt><span class="docutils literal">group_name</span></dt>
<dd><p>The optional <span class="docutils literal">group_name</span> provides the cability to share I/O throttling
quota between multiple drives. This prevents end-users from circumventing
a hosting provider's throttling policy by splitting 1 large drive in N
small drives and getting N times the normal throttling quota. Any name may
be used.</p>
<p><span class="since">group_name since 3.0.0 and QEMU 2.4</span></p>
</dd>
<dt><span class="docutils literal">total_bytes_sec_max_length</span></dt>
<dd><p>The optional <span class="docutils literal">total_bytes_sec_max_length</span> element is the maximum
duration in seconds for the <span class="docutils literal">total_bytes_sec_max</span> burst period. Only
valid when the <span class="docutils literal">total_bytes_sec_max</span> is set.</p>
</dd>
<dt><span class="docutils literal">read_bytes_sec_max_length</span></dt>
<dd><p>The optional <span class="docutils literal">read_bytes_sec_max_length</span> element is the maximum duration
in seconds for the <span class="docutils literal">read_bytes_sec_max</span> burst period. Only valid when
the <span class="docutils literal">read_bytes_sec_max</span> is set.</p>
</dd>
<dt><span class="docutils literal">write_bytes_sec_max</span></dt>
<dd><p>The optional <span class="docutils literal">write_bytes_sec_max_length</span> element is the maximum
duration in seconds for the <span class="docutils literal">write_bytes_sec_max</span> burst period. Only
valid when the <span class="docutils literal">write_bytes_sec_max</span> is set.</p>
</dd>
<dt><span class="docutils literal">total_iops_sec_max_length</span></dt>
<dd><p>The optional <span class="docutils literal">total_iops_sec_max_length</span> element is the maximum duration
in seconds for the <span class="docutils literal">total_iops_sec_max</span> burst period. Only valid when
the <span class="docutils literal">total_iops_sec_max</span> is set.</p>
</dd>
<dt><span class="docutils literal">read_iops_sec_max_length</span></dt>
<dd><p>The optional <span class="docutils literal">read_iops_sec_max_length</span> element is the maximum duration
in seconds for the <span class="docutils literal">read_iops_sec_max</span> burst period. Only valid when the
<span class="docutils literal">read_iops_sec_max</span> is set.</p>
</dd>
<dt><span class="docutils literal">write_iops_sec_max</span></dt>
<dd><p>The optional <span class="docutils literal">write_iops_sec_max_length</span> element is the maximum duration
in seconds for the <span class="docutils literal">write_iops_sec_max</span> burst period. Only valid when
the <span class="docutils literal">write_iops_sec_max</span> is set.</p>
<p><span class="since">Throughput length since 2.4.0 and QEMU 2.6</span></p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">driver</span></dt>
<dd><p>The optional driver element allows specifying further details related to the
hypervisor driver used to provide the disk. <span class="since">Since 0.1.8</span></p>
<ul>
<li><p>If the hypervisor supports multiple backend drivers, then the <span class="docutils literal">name</span>
attribute selects the primary backend driver name, while the optional
<span class="docutils literal">type</span> attribute provides the sub-type. For example, xen supports a name
of "tap", "tap2", "phy", or "file", with a type of "aio", while qemu only
supports a name of "qemu", but multiple types including "raw", "bochs",
"qcow2", and "qed".</p></li>
<li><p>The optional <span class="docutils literal">cache</span> attribute controls the cache mechanism, possible
values are "default", "none", "writethrough", "writeback", "directsync"
(like "writethrough", but it bypasses the host page cache) and "unsafe"
(host may cache all disk io, and sync requests from guest are ignored).
<span class="since">Since 0.6.0, "directsync" since 0.9.5, "unsafe" since 0.9.7</span></p></li>
<li><p>The optional <span class="docutils literal">error_policy</span> attribute controls how the hypervisor will
behave on a disk read or write error, possible values are "stop",
"report", "ignore", and "enospace". <span class="since">Since 0.8.0, "report" since
0.9.7</span> The default is left to the discretion of the hypervisor. There is
also an optional <span class="docutils literal">rerror_policy</span> that controls behavior for read errors
only. <span class="since">Since 0.9.7</span> . If no rerror_policy is given, error_policy is
used for both read and write errors. If rerror_policy is given, it
overrides the <span class="docutils literal">error_policy</span> for read errors. Also note that "enospace"
is not a valid policy for read errors, so if <span class="docutils literal">error_policy</span> is set to
"enospace" and no <span class="docutils literal">rerror_policy</span> is given, the read error policy will
be left at its default.</p></li>
<li><p>The optional <span class="docutils literal">io</span> attribute controls specific policies on I/O; qemu
guests support "threads" and "native" <span class="since">Since 0.8.8</span> , io_uring
<span class="since">Since 6.3.0 (QEMU 5.0)</span> .</p></li>
<li><p>The optional <span class="docutils literal">ioeventfd</span> attribute allows users to set <a class="reference external" href="https://patchwork.kernel.org/patch/43390/">domain I/O
asynchronous handling</a> for
disk device. The default is left to the discretion of the hypervisor.
Accepted values are "on" and "off". Enabling this allows qemu to execute
VM while a separate thread handles I/O. Typically guests experiencing high
system CPU utilization during I/O will benefit from this. On the other
hand, on overloaded host it could increase guest I/O latency.
<span class="since">Since 0.9.3 (QEMU and KVM only)</span> <strong>In general you should leave
this option alone, unless you are very certain you know what you are
doing.</strong></p></li>
<li><p>The optional <span class="docutils literal">event_idx</span> attribute controls some aspects of device event
processing. The value can be either 'on' or 'off' - if it is on, it will
reduce the number of interrupts and exits for the guest. The default is
determined by QEMU; usually if the feature is supported, default is on. In
case there is a situation where this behavior is suboptimal, this
attribute provides a way to force the feature off. <span class="since">Since 0.9.5
(QEMU and KVM only)</span> <strong>In general you should leave this option alone,
unless you are very certain you know what you are doing.</strong></p></li>
<li><p>The optional <span class="docutils literal">copy_on_read</span> attribute controls whether to copy read
backing file into the image file. The value can be either "on" or "off".
Copy-on-read avoids accessing the same backing file sectors repeatedly and
is useful when the backing file is over a slow network. By default
copy-on-read is off. <span class="since">Since 0.9.10 (QEMU and KVM only)</span></p></li>
<li><p>The optional <span class="docutils literal">discard</span> attribute controls whether discard requests (also
known as "trim" or "unmap") are ignored or passed to the filesystem. The
value can be either "unmap" (allow the discard request to be passed) or
"ignore" (ignore the discard request). <span class="since">Since 1.0.6 (QEMU and KVM
only)</span></p></li>
<li><p>The optional <span class="docutils literal">detect_zeroes</span> attribute controls whether to detect zero
write requests. The value can be "off", "on" or "unmap". First two values
turn the detection off and on, respectively. The third value ("unmap")
turns the detection on and additionally tries to discard such areas from
the image based on the value of <span class="docutils literal">discard</span> above (it will act as "on" if
<span class="docutils literal">discard</span> is set to "ignore"). NB enabling the detection is a compute
intensive operation, but can save file space and/or time on slow media.
<span class="since">Since 2.0.0</span></p></li>
<li><p>The optional <span class="docutils literal">iothread</span> attribute assigns the disk to an IOThread as
defined by the range for the domain
<a class="reference external" href="formatdomain.html#elementsIOThreadsAllocation">iothreads</a> value. Multiple disks may be
assigned to the same IOThread and are numbered from 1 to the domain
iothreads value. Available for a disk device <span class="docutils literal">target</span> configured to use
"virtio" <span class="docutils literal">bus</span> and "pci" or "ccw" <span class="docutils literal">address</span> types. <span class="since">Since 1.2.8
(QEMU 2.1)</span></p></li>
<li><p>The optional <span class="docutils literal">queues</span> attribute specifies the number of virt queues for
virtio-blk. ( <span class="since">Since 3.9.0</span> )</p></li>
<li><p>For virtio disks, <a class="reference external" href="formatdomain.html#elementsVirtio">Virtio-specific options</a> can also
be set. ( <span class="since">Since 3.5.0</span> )</p></li>
<li><p>The optional <span class="docutils literal">metadata_cache</span> subelement controls aspects related to the
format specific caching of storage image metadata. Note that this setting
applies only on the top level image; the identically named subelement of
<span class="docutils literal">backingStore</span>'s <span class="docutils literal">format</span> element can be used to specify cache
settings for the backing image.</p>
<p><span class="since">Since 7.0.0</span> the maximum size of the metadata cache of <span class="docutils literal">qcow2</span>
format driver of the <span class="docutils literal">qemu</span> hypervisor can be controlled via the
<span class="docutils literal">max_size</span> subelement (see example below).</p>
<p>In the majority of cases the default configuration used by the hypervisor
is sufficient so modifying this setting should not be necessary. For
specifics on how the metadata cache of <span class="docutils literal">qcow2</span> in <span class="docutils literal">qemu</span> behaves refer
to the <span class="docutils literal">qemu</span>
<a class="reference external" href="https://git.qemu.org/?p=qemu.git;a=blob;f=docs/qcow2-cache.txt">qcow2 cache docs</a></p>
<p><strong>Example:</strong></p>
</li>
</ul>
</dd>
</dl>
<pre class="literal-block">&lt;disk type='file' device='disk'&gt;
  &lt;driver name='qemu' type='qcow2'&gt;
    &lt;metadata_cache&gt;
      &lt;max_size unit='bytes'&gt;1234&lt;/max_size&gt;
    &lt;/metadata_cache&gt;
  &lt;/driver&gt;
  &lt;source file='/var/lib/libvirt/images/domain.qcow'/&gt;
  &lt;backingStore type='file'&gt;
    &lt;format type='qcow2'&gt;
      &lt;metadata_cache&gt;
        &lt;max_size unit='bytes'&gt;1234&lt;/max_size&gt;
      &lt;/metadata_cache&gt;
    &lt;/format&gt;
    &lt;source file='/var/lib/libvirt/images/snapshot.qcow'/&gt;
    &lt;backingStore/&gt;
  &lt;/backingStore&gt;
  &lt;target dev='vdd' bus='virtio'/&gt;
&lt;/disk&gt;</pre>
<dl>
<dt><span class="docutils literal">backenddomain</span></dt>
<dd><p>The optional <span class="docutils literal">backenddomain</span> element allows specifying a backend domain
(aka driver domain) hosting the disk. Use the <span class="docutils literal">name</span> attribute to specify
the backend domain name. <span class="since">Since 1.2.13 (Xen only)</span></p>
</dd>
<dt><span class="docutils literal">boot</span></dt>
<dd><p>Specifies that the disk is bootable. The <span class="docutils literal">order</span> attribute determines the
order in which devices will be tried during boot sequence. On the S390
architecture only the first boot device is used. The optional <span class="docutils literal">loadparm</span>
attribute is an 8 character string which can be queried by guests on S390 via
sclp or diag 308. Linux guests on S390 can use <span class="docutils literal">loadparm</span> to select a boot
entry. <span class="since">Since 3.5.0</span> The per-device <span class="docutils literal">boot</span> elements cannot be used
together with general boot elements in <a class="reference external" href="formatdomain.html#elementsOSBIOS">BIOS bootloader</a>
section. <span class="since">Since 0.8.8</span></p>
</dd>
<dt><span class="docutils literal">encryption</span></dt>
<dd><p>Starting with <span class="since">libvirt 3.9.0</span> the <span class="docutils literal">encryption</span> element is preferred
to be a sub-element of the <span class="docutils literal">source</span> element. If present, specifies how the
volume is encrypted using "qcow". See the <a class="reference external" href="https://libvirt.org/formatstorageencryption.html">Storage
Encryption</a> page for more information.</p>
</dd>
<dt><span class="docutils literal">readonly</span></dt>
<dd><p>If present, this indicates the device cannot be modified by the guest. For
now, this is the default for disks with attribute <span class="docutils literal"><span class="pre">device='cdrom'</span></span>.</p>
</dd>
<dt><span class="docutils literal">shareable</span></dt>
<dd><p>If present, this indicates the device is expected to be shared between
domains (assuming the hypervisor and OS support this), which means that
caching should be deactivated for that device.</p>
</dd>
<dt><span class="docutils literal">transient</span></dt>
<dd><p>If present, this indicates that changes to the device contents should be
reverted automatically when the guest exits. With some hypervisors, marking a
disk transient prevents the domain from participating in migration,
snapshots, or blockjobs. Only supported in vmx hypervisor
(<span class="since">Since 0.9.5</span>) and <span class="docutils literal">qemu</span> hypervisor (<span class="since">Since 6.9.0</span>).</p>
</dd>
<dt><span class="docutils literal">serial</span></dt>
<dd><p>If present, this specify serial number of virtual hard drive. For example, it
may look like <span class="docutils literal"><span class="pre">&lt;serial&gt;WD-WMAP9A966149&lt;/serial&gt;</span></span>. Not supported for
scsi-block devices, that is those using disk <span class="docutils literal">type</span> 'block' using
<span class="docutils literal">device</span> 'lun' on <span class="docutils literal">bus</span> 'scsi'. <span class="since">Since 0.7.1</span></p>
</dd>
<dt><span class="docutils literal">wwn</span></dt>
<dd><p>If present, this element specifies the WWN (World Wide Name) of a virtual
hard disk or CD-ROM drive. It must be composed of 16 hexadecimal digits.
<span class="since">Since 0.10.1</span></p>
</dd>
<dt><span class="docutils literal">vendor</span></dt>
<dd><p>If present, this element specifies the vendor of a virtual hard disk or
CD-ROM device. It must not be longer than 8 printable characters.
<span class="since">Since 1.0.1</span></p>
</dd>
<dt><span class="docutils literal">product</span></dt>
<dd><p>If present, this element specifies the product of a virtual hard disk or
CD-ROM device. It must not be longer than 16 printable characters.
<span class="since">Since 1.0.1</span></p>
</dd>
<dt><span class="docutils literal">address</span></dt>
<dd><p>If present, the <span class="docutils literal">address</span> element ties the disk to a given slot of a
controller (the actual <span class="docutils literal">&lt;controller&gt;</span> device can often be inferred by
libvirt, although it can be <a class="reference external" href="formatdomain.html#elementsControllers">explicitly specified</a>).
The <span class="docutils literal">type</span> attribute is mandatory, and is typically "pci" or "drive". For a
"pci" controller, additional attributes for <span class="docutils literal">bus</span>, <span class="docutils literal">slot</span>, and
<span class="docutils literal">function</span> must be present, as well as optional <span class="docutils literal">domain</span> and
<span class="docutils literal">multifunction</span>. Multifunction defaults to 'off'; any other value requires
QEMU 0.1.3 and <span class="since">libvirt 0.9.7</span> . For a "drive" controller, additional
attributes <span class="docutils literal">controller</span>, <span class="docutils literal">bus</span>, <span class="docutils literal">target</span> ( <span class="since">libvirt 0.9.11</span> ),
and <span class="docutils literal">unit</span> are available, each defaulting to 0.</p>
</dd>
<dt><span class="docutils literal">auth</span></dt>
<dd><p>Starting with <span class="since">libvirt 3.9.0</span> the <span class="docutils literal">auth</span> element is preferred to be
a sub-element of the <span class="docutils literal">source</span> element. The element is still read and
managed as a <span class="docutils literal">disk</span> sub-element. It is invalid to use <span class="docutils literal">auth</span> as both a
sub-element of <span class="docutils literal">disk</span> and <span class="docutils literal">source</span>. The <span class="docutils literal">auth</span> element was introduced
as a <span class="docutils literal">disk</span> sub-element in <span class="since">libvirt 0.9.7.</span></p>
</dd>
<dt><span class="docutils literal">geometry</span></dt>
<dd><p>The optional <span class="docutils literal">geometry</span> element provides the ability to override geometry
settings. This mostly useful for S390 DASD-disks or older DOS-disks.
<span class="since">0.10.0</span></p>
<dl class="simple">
<dt><span class="docutils literal">cyls</span></dt>
<dd><p>The <span class="docutils literal">cyls</span> attribute is the number of cylinders.</p>
</dd>
<dt><span class="docutils literal">heads</span></dt>
<dd><p>The <span class="docutils literal">heads</span> attribute is the number of heads.</p>
</dd>
<dt><span class="docutils literal">secs</span></dt>
<dd><p>The <span class="docutils literal">secs</span> attribute is the number of sectors per track.</p>
</dd>
<dt><span class="docutils literal">trans</span></dt>
<dd><p>The optional <span class="docutils literal">trans</span> attribute is the BIOS-Translation-Modus (none, lba
or auto)</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">blockio</span></dt>
<dd><p>If present, the <span class="docutils literal">blockio</span> element allows to override any of the block
device properties listed below. <span class="since">Since 0.10.2 (QEMU and KVM)</span></p>
<dl class="simple">
<dt><span class="docutils literal">logical_block_size</span></dt>
<dd><p>The logical block size the disk will report to the guest OS. For Linux
this would be the value returned by the BLKSSZGET ioctl and describes the
smallest units for disk I/O.</p>
</dd>
<dt><span class="docutils literal">physical_block_size</span></dt>
<dd><p>The physical block size the disk will report to the guest OS. For Linux
this would be the value returned by the BLKPBSZGET ioctl and describes the
disk's hardware sector size which can be relevant for the alignment of
disk data.</p>
</dd>
</dl>
</dd>
</dl>
<p><span class="anchor"><a id="elementsFilesystems"/></span></p>
</div>
<div class="section" id="filesystems">
<h3><a class="toc-backref" href="formatdomain.html#id27">Filesystems</a><a class="headerlink" href="formatdomain.html#filesystems" title="Link to this headline">¶</a></h3>
<p>A directory on the host that can be accessed directly from the guest.
<span class="since">since 0.3.3, since 0.8.5 for QEMU/KVM</span></p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;filesystem type='template'&gt;
    &lt;source name='my-vm-template'/&gt;
    &lt;target dir='/'/&gt;
  &lt;/filesystem&gt;
  &lt;filesystem type='mount' accessmode='passthrough' multidevs='remap'&gt;
    &lt;driver type='path' wrpolicy='immediate'/&gt;
    &lt;source dir='/export/to/guest'/&gt;
    &lt;target dir='/import/from/host'/&gt;
    &lt;readonly/&gt;
  &lt;/filesystem&gt;
  &lt;filesystem type='mount' accessmode='mapped' fmode='644' dmode='755'&gt;
    &lt;driver type='path'/&gt;
    &lt;source dir='/export/to/guest'/&gt;
    &lt;target dir='/import/from/host'/&gt;
    &lt;readonly/&gt;
  &lt;/filesystem&gt;
  &lt;filesystem type='file' accessmode='passthrough'&gt;
    &lt;driver type='loop' format='raw'/&gt;
    &lt;source file='/export/to/guest.img'/&gt;
    &lt;target dir='/import/from/host'/&gt;
    &lt;readonly/&gt;
  &lt;/filesystem&gt;
  &lt;filesystem type='mount' accessmode='passthrough'&gt;
      &lt;driver type='virtiofs' queue='1024'/&gt;
      &lt;binary path='/usr/libexec/virtiofsd' xattr='on'&gt;
         &lt;cache mode='always'/&gt;
         &lt;lock posix='on' flock='on'/&gt;
      &lt;/binary&gt;
      &lt;source dir='/path'/&gt;
      &lt;target dir='mount_tag'/&gt;
  &lt;/filesystem&gt;
  ...
&lt;/devices&gt;
...</pre>
<dl>
<dt><span class="docutils literal">filesystem</span></dt>
<dd><p>The filesystem attribute <span class="docutils literal">type</span> specifies the type of the <span class="docutils literal">source</span>. The
possible values are:</p>
<dl class="simple">
<dt><span class="docutils literal">mount</span></dt>
<dd><p>A host directory to mount in the guest. Used by LXC, OpenVZ <span class="since">(since
0.6.2)</span> and QEMU/KVM <span class="since">(since 0.8.5)</span> . This is the default <span class="docutils literal">type</span>
if one is not specified. This mode also has an optional sub-element
<span class="docutils literal">driver</span>, with an attribute <span class="docutils literal"><span class="pre">type='path'</span></span> or <span class="docutils literal"><span class="pre">type='handle'</span></span>
<span class="since">(since 0.9.7)</span> . The driver block has an optional attribute
<span class="docutils literal">wrpolicy</span> that further controls interaction with the host page cache;
omitting the attribute gives default behavior, while the value
<span class="docutils literal">immediate</span> means that a host writeback is immediately triggered for all
pages touched during a guest file write operation <span class="since">(since 0.9.10)</span>
. <span class="since">Since 6.2.0</span> , <span class="docutils literal"><span class="pre">type='virtiofs'</span></span> is also supported. Using
virtiofs requires setting up shared memory, see the guide:
<a class="reference external" href="https://libvirt.org/kbase/virtiofs.html">Virtio-FS</a></p>
</dd>
<dt><span class="docutils literal">template</span></dt>
<dd><p>OpenVZ filesystem template. Only used by OpenVZ driver.</p>
</dd>
<dt><span class="docutils literal">file</span></dt>
<dd><p>A host file will be treated as an image and mounted in the guest. The
filesystem format will be autodetected. Only used by LXC driver.</p>
</dd>
<dt><span class="docutils literal">block</span></dt>
<dd><p>A host block device to mount in the guest. The filesystem format will be
autodetected. Only used by LXC driver <span class="since">(since 0.9.5)</span> .</p>
</dd>
<dt><span class="docutils literal">ram</span></dt>
<dd><p>An in-memory filesystem, using memory from the host OS. The source element
has a single attribute <span class="docutils literal">usage</span> which gives the memory usage limit in
KiB, unless units are specified by the <span class="docutils literal">units</span> attribute. Only used by
LXC driver. <span class="since">(since 0.9.13)</span></p>
</dd>
<dt><span class="docutils literal">bind</span></dt>
<dd><p>A directory inside the guest will be bound to another directory inside the
guest. Only used by LXC driver <span class="since">(since 0.9.13)</span></p>
</dd>
</dl>
<p>The filesystem element has an optional attribute <span class="docutils literal">accessmode</span> which
specifies the security mode for accessing the source <span class="since">(since 0.8.5)</span> .
Currently this only works with <span class="docutils literal"><span class="pre">type='mount'</span></span> for the QEMU/KVM driver. For
driver type <span class="docutils literal">virtiofs</span>, only <span class="docutils literal">passthrough</span> is supported. For other driver
types, the possible values are:</p>
<dl class="simple">
<dt><span class="docutils literal">passthrough</span></dt>
<dd><p>The <span class="docutils literal">source</span> is accessed with the permissions of the user inside the
guest. This is the default <span class="docutils literal">accessmode</span> if one is not specified. <a class="reference external" href="https://lists.gnu.org/archive/html/qemu-devel/2010-05/msg02673.html">More
info</a></p>
</dd>
<dt><span class="docutils literal">mapped</span></dt>
<dd><p>The <span class="docutils literal">source</span> is accessed with the permissions of the hypervisor (QEMU
process). <a class="reference external" href="https://lists.gnu.org/archive/html/qemu-devel/2010-05/msg02673.html">More
info</a></p>
</dd>
<dt><span class="docutils literal">squash</span></dt>
<dd><p>Similar to 'passthrough', the exception is that failure of privileged
operations like 'chown' are ignored. This makes a passthrough-like mode
usable for people who run the hypervisor as non-root. <a class="reference external" href="https://lists.gnu.org/archive/html/qemu-devel/2010-09/msg00121.html">More
info</a></p>
</dd>
</dl>
<p><span class="since">Since 5.2.0</span> , the filesystem element has an optional attribute
<span class="docutils literal">model</span> with supported values "virtio-transitional",
"virtio-non-transitional", or "virtio". See <a class="reference external" href="formatdomain.html#elementsVirtioTransitional">Virtio transitional
devices</a> for more details.</p>
<p>The filesystem element has optional attributes <span class="docutils literal">fmode</span> and <span class="docutils literal">dmode</span>.
These two attributes control the creation mode for files and directories
when used with the <span class="docutils literal">mapped</span> value for <span class="docutils literal">accessmode</span> (<span class="since">since 6.10.0,
requires QEMU 2.10</span> ).  If not specified, QEMU creates files with mode
<span class="docutils literal">600</span> and directories with mode <span class="docutils literal">700</span>. The setuid, setgid, and sticky
bit are unsupported.</p>
<p>The filesystem element has an optional attribute <span class="docutils literal">multidevs</span> which
specifies how to deal with a filesystem export containing more than one
device, in order to avoid file ID collisions on guest when using 9pfs (
<span class="since">since 6.3.0, requires QEMU 4.2</span> ). This attribute is not available
for virtiofs. The possible values are:</p>
<dl class="simple">
<dt><span class="docutils literal">default</span></dt>
<dd><p>Use QEMU's default setting (which currently is <span class="docutils literal">warn</span>).</p>
</dd>
<dt><span class="docutils literal">remap</span></dt>
<dd><p>This setting allows guest to access multiple devices per export without
encountering misbehaviours. Inode numbers from host are automatically
remapped on guest to actively prevent file ID collisions if guest accesses
one export containing multiple devices.</p>
</dd>
<dt><span class="docutils literal">forbid</span></dt>
<dd><p>Only allow to access one device per export by guest. Attempts to access
additional devices on the same export will cause the individual filesystem
access by guest to fail with an error and being logged (once) as error on
host side.</p>
</dd>
<dt><span class="docutils literal">warn</span></dt>
<dd><p>This setting resembles the behaviour of 9pfs prior to QEMU 4.2, that is no
action is performed to prevent any potential file ID collisions if an
export contains multiple devices, with the only exception: a warning is
logged (once) on host side now. This setting may lead to misbehaviours on
guest side if more than one device is exported per export, due to the
potential file ID collisions this may cause on guest side in that case.</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">driver</span></dt>
<dd><p>The optional driver element allows specifying further details related to the
hypervisor driver used to provide the filesystem. <span class="since">Since 1.0.6</span></p>
<ul class="simple">
<li><p>If the hypervisor supports multiple backend drivers, then the <span class="docutils literal">type</span>
attribute selects the primary backend driver name, while the <span class="docutils literal">format</span>
attribute provides the format type. For example, LXC supports a type of
"loop", with a format of "raw" or "nbd" with any format. QEMU supports a
type of "path" or "handle", but no formats. Virtuozzo driver supports a
type of "ploop" with a format of "ploop".</p></li>
<li><p>For virtio-backed devices, <a class="reference external" href="formatdomain.html#elementsVirtio">Virtio-specific options</a>
can also be set. ( <span class="since">Since 3.5.0</span> )</p></li>
<li><p>For <span class="docutils literal">virtiofs</span>, the <span class="docutils literal">queue</span> attribute can be used to specify the queue
size (i.e. how many requests can the queue fit). ( <span class="since">Since 6.2.0</span> )</p></li>
</ul>
</dd>
<dt><span class="docutils literal">binary</span></dt>
<dd><p>The optional <span class="docutils literal">binary</span> element can tune the options for virtiofsd. All of
the following attributes and elements are optional. The attribute <span class="docutils literal">path</span>
can be used to override the path to the daemon. Attribute <span class="docutils literal">xattr</span> enables
the use of filesystem extended attributes. Caching can be tuned via the
<span class="docutils literal">cache</span> element, possible <span class="docutils literal">mode</span> values being <span class="docutils literal">none</span> and <span class="docutils literal">always</span>.
Locking can be controlled via the <span class="docutils literal">lock</span> element - attributes <span class="docutils literal">posix</span> and
<span class="docutils literal">flock</span> both accepting values <span class="docutils literal">on</span> or <span class="docutils literal">off</span>. ( <span class="since">Since 6.2.0</span> )</p>
</dd>
<dt><span class="docutils literal">source</span></dt>
<dd><p>The resource on the host that is being accessed in the guest. The <span class="docutils literal">name</span>
attribute must be used with <span class="docutils literal"><span class="pre">type='template'</span></span>, and the <span class="docutils literal">dir</span> attribute
must be used with <span class="docutils literal"><span class="pre">type='mount'</span></span>. The <span class="docutils literal">usage</span> attribute is used with
<span class="docutils literal"><span class="pre">type='ram'</span></span> to set the memory limit in KiB, unless units are specified by
the <span class="docutils literal">units</span> attribute.</p>
</dd>
<dt><span class="docutils literal">target</span></dt>
<dd><p>Where the <span class="docutils literal">source</span> can be accessed in the guest. For most drivers this is
an automatic mount point, but for QEMU/KVM this is merely an arbitrary string
tag that is exported to the guest as a hint for where to mount.</p>
</dd>
<dt><span class="docutils literal">readonly</span></dt>
<dd><p>Enables exporting filesystem as a readonly mount for guest, by default
read-write access is given (currently only works for QEMU/KVM driver).</p>
</dd>
<dt><span class="docutils literal">space_hard_limit</span></dt>
<dd><p>Maximum space available to this guest's filesystem. <span class="since">Since 0.9.13</span></p>
</dd>
<dt><span class="docutils literal">space_soft_limit</span></dt>
<dd><p>Maximum space available to this guest's filesystem. The container is
permitted to exceed its soft limits for a grace period of time. Afterwards
the hard limit is enforced. <span class="since">Since 0.9.13</span></p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsAddress"/></span></p>
</div>
<div class="section" id="device-addresses">
<h3><a class="toc-backref" href="formatdomain.html#id28">Device Addresses</a><a class="headerlink" href="formatdomain.html#device-addresses" title="Link to this headline">¶</a></h3>
<p>Many devices have an optional <span class="docutils literal">&lt;address&gt;</span> sub-element to describe where the
device is placed on the virtual bus presented to the guest. If an address (or
any optional attribute within an address) is omitted on input, libvirt will
generate an appropriate address; but an explicit address is required if more
control over layout is required. See below for device examples including an
address element.</p>
<p>Every address has a mandatory attribute <span class="docutils literal">type</span> that describes which bus the
device is on. The choice of which address to use for a given device is
constrained in part by the device and the architecture of the guest. For
example, a <span class="docutils literal">&lt;disk&gt;</span> device uses <span class="docutils literal"><span class="pre">type='drive'</span></span>, while a <span class="docutils literal">&lt;console&gt;</span> device
would use <span class="docutils literal"><span class="pre">type='pci'</span></span> on i686 or x86_64 guests, or <span class="docutils literal"><span class="pre">type='spapr-vio'</span></span> on
PowerPC64 pseries guests. Each address type has further optional attributes that
control where on the bus the device will be placed:</p>
<dl class="simple">
<dt><span class="docutils literal">pci</span></dt>
<dd><p>PCI addresses have the following additional attributes: <span class="docutils literal">domain</span> (a 2-byte
hex integer, not currently used by qemu), <span class="docutils literal">bus</span> (a hex value between 0 and
0xff, inclusive), <span class="docutils literal">slot</span> (a hex value between 0x0 and 0x1f, inclusive), and
<span class="docutils literal">function</span> (a value between 0 and 7, inclusive). Also available is the
<span class="docutils literal">multifunction</span> attribute, which controls turning on the multifunction bit
for a particular slot/function in the PCI control register ( <span class="since">since
0.9.7, requires QEMU 0.13</span> ). <span class="docutils literal">multifunction</span> defaults to 'off', but should
be set to 'on' for function 0 of a slot that will have multiple functions
used. ( <span class="since">Since 4.10.0</span> ), PCI address extensions depending on the
architecture are supported. For example, PCI addresses for S390 guests will
have a <span class="docutils literal">zpci</span> child element, with two attributes: <span class="docutils literal">uid</span> (a hex value
between 0x0001 and 0xffff, inclusive), and <span class="docutils literal">fid</span> (a hex value between
0x00000000 and 0xffffffff, inclusive) used by PCI devices on S390 for
User-defined Identifiers and Function Identifiers.
<span class="since">Since 1.3.5</span> , some hypervisor drivers may accept an
<span class="docutils literal">&lt;address <span class="pre">type='pci'/&gt;</span></span> element with no other attributes as an explicit
request to assign a PCI address for the device rather than some other type of
address that may also be appropriate for that same device (e.g. virtio-mmio).
The relationship between the PCI addresses configured in the domain XML and
those seen by the guest OS can sometime seem confusing: a separate document
describes <a class="reference external" href="https://libvirt.org/pci-addresses.html">how PCI addresses work</a> in more detail.</p>
</dd>
<dt><span class="docutils literal">drive</span></dt>
<dd><p>Drive addresses have the following additional attributes: <span class="docutils literal">controller</span> (a
2-digit controller number), <span class="docutils literal">bus</span> (a 2-digit bus number), <span class="docutils literal">target</span> (a
2-digit target number), and <span class="docutils literal">unit</span> (a 2-digit unit number on the bus).</p>
</dd>
<dt><span class="docutils literal"><span class="pre">virtio-serial</span></span></dt>
<dd><p>Each virtio-serial address has the following additional attributes:
<span class="docutils literal">controller</span> (a 2-digit controller number), <span class="docutils literal">bus</span> (a 2-digit bus number),
and <span class="docutils literal">slot</span> (a 2-digit slot within the bus).</p>
</dd>
<dt><span class="docutils literal">ccid</span></dt>
<dd><p>A CCID address, for smart-cards, has the following additional attributes:
<span class="docutils literal">bus</span> (a 2-digit bus number), and <span class="docutils literal">slot</span> attribute (a 2-digit slot within
the bus). <span class="since">Since 0.8.8.</span></p>
</dd>
<dt><span class="docutils literal">usb</span></dt>
<dd><p>USB addresses have the following additional attributes: <span class="docutils literal">bus</span> (a hex value
between 0 and 0xfff, inclusive), and <span class="docutils literal">port</span> (a dotted notation of up to
four octets, such as 1.2 or 2.1.3.1).</p>
</dd>
<dt><span class="docutils literal"><span class="pre">spapr-vio</span></span></dt>
<dd><p>On PowerPC pseries guests, devices can be assigned to the SPAPR-VIO bus. It
has a flat 32-bit address space; by convention, devices are generally
assigned at a non-zero multiple of 0x00001000, but other addresses are valid
and permitted by libvirt. Each address has the following additional
attribute: <span class="docutils literal">reg</span> (the hex value address of the starting register).
<span class="since">Since 0.9.9.</span></p>
</dd>
<dt><span class="docutils literal">ccw</span></dt>
<dd><p>S390 guests with a <span class="docutils literal">machine</span> value of s390-ccw-virtio use the native CCW
bus for I/O devices. CCW bus addresses have the following additional
attributes: <span class="docutils literal">cssid</span> (a hex value between 0 and 0xfe, inclusive), <span class="docutils literal">ssid</span>
(a value between 0 and 3, inclusive) and <span class="docutils literal">devno</span> (a hex value between 0 and
0xffff, inclusive). Partially specified bus addresses are not allowed. If
omitted, libvirt will assign a free bus address with cssid=0xfe and ssid=0.
Virtio-ccw devices must have their cssid set to 0xfe. <span class="since">Since 1.0.4</span></p>
</dd>
<dt><span class="docutils literal"><span class="pre">virtio-mmio</span></span></dt>
<dd><p>This places the device on the virtio-mmio transport, which is currently only
available for some <span class="docutils literal">armv7l</span> and <span class="docutils literal">aarch64</span> virtual machines. virtio-mmio
addresses do not have any additional attributes. <span class="since">Since 1.1.3</span>
If the guest architecture is <span class="docutils literal">aarch64</span> and the machine type is <span class="docutils literal">virt</span>,
libvirt will automatically assign PCI addresses to devices; however, the
presence of a single device with virtio-mmio address in the guest
configuration will cause libvirt to assign virtio-mmio addresses to all
further devices. <span class="since">Since 3.0.0</span></p>
</dd>
<dt><span class="docutils literal">isa</span></dt>
<dd><p>ISA addresses have the following additional attributes: <span class="docutils literal">iobase</span> and
<span class="docutils literal">irq</span>. <span class="since">Since 1.2.1</span></p>
</dd>
<dt><span class="docutils literal">unassigned</span></dt>
<dd><p>For PCI hostdevs, <span class="docutils literal">&lt;address <span class="pre">type='unassigned'/&gt;</span></span> allows the admin to
include a PCI hostdev in the domain XML definition, without making it
available for the guest. This allows for configurations in which Libvirt
manages the device as a regular PCI hostdev, regardless of whether the guest
will have access to it. <span class="docutils literal">&lt;address <span class="pre">type='unassigned'/&gt;</span></span> is an invalid
address type for all other device types. <span class="since">Since 6.0.0</span></p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsVirtio"/></span></p>
</div>
<div class="section" id="virtio-related-options">
<h3><a class="toc-backref" href="formatdomain.html#id29">Virtio-related options</a><a class="headerlink" href="formatdomain.html#virtio-related-options" title="Link to this headline">¶</a></h3>
<p>QEMU's virtio devices have some attributes related to the virtio transport under
the <span class="docutils literal">driver</span> element: The <span class="docutils literal">iommu</span> attribute enables the use of emulated
IOMMU by the device. The attribute <span class="docutils literal">ats</span> controls the Address Translation
Service support for PCIe devices. This is needed to make use of IOTLB support
(see <a class="reference external" href="formatdomain.html#elementsIommu">IOMMU device</a>). Possible values are <span class="docutils literal">on</span> or <span class="docutils literal">off</span>.
<span class="since">Since 3.5.0</span></p>
<p>The attribute <span class="docutils literal">packed</span> controls if QEMU should try to use packed virtqueues.
Compared to regular split queues, packed queues consist of only a single
descriptor ring replacing available and used ring, index and descriptor buffer.
This can result in better cache utilization and performance. If packed
virtqueues are actually used depends on the feature negotiation between QEMU,
vhost backends and guest drivers. Possible values are <span class="docutils literal">on</span> or <span class="docutils literal">off</span>.
<span class="since">Since 6.3.0 (QEMU and KVM only)</span></p>
<p><span class="anchor"><a id="elementsVirtioTransitional"/></span></p>
</div>
<div class="section" id="virtio-transitional-devices">
<h3><a class="toc-backref" href="formatdomain.html#id30">Virtio transitional devices</a><a class="headerlink" href="formatdomain.html#virtio-transitional-devices" title="Link to this headline">¶</a></h3>
<p><span class="since">Since 5.2.0</span> , some of QEMU's virtio devices, when used with PCI/PCIe
machine types, accept the following <span class="docutils literal">model</span> values:</p>
<dl class="simple">
<dt><span class="docutils literal"><span class="pre">virtio-transitional</span></span></dt>
<dd><p>This device can work both with virtio 0.9 and virtio 1.0 guest drivers, so
it's the best choice when compatibility with older guest operating systems is
desired. libvirt will plug the device into a conventional PCI slot.</p>
</dd>
<dt><span class="docutils literal"><span class="pre">virtio-non-transitional</span></span></dt>
<dd><p>This device can only work with virtio 1.0 guest drivers, and it's the
recommended option unless compatibility with older guest operating systems is
necessary. libvirt will plug the device into either a PCI Express slot or a
conventional PCI slot based on the machine type, resulting in a more
optimized PCI topology.</p>
</dd>
<dt><span class="docutils literal">virtio</span></dt>
<dd><p>This device will work like a <span class="docutils literal"><span class="pre">virtio-non-transitional</span></span> device when plugged
into a PCI Express slot, and like a <span class="docutils literal"><span class="pre">virtio-transitional</span></span> device otherwise;
libvirt will pick one or the other based on the machine type. This is the
best choice when compatibility with libvirt versions older than 5.2.0 is
necessary, but it's otherwise not recommended to use it.</p>
</dd>
</dl>
<p>While the information outlined above applies to most virtio devices, there are a
few exceptions:</p>
<ul class="simple">
<li><p>for SCSI controllers, there is no <span class="docutils literal">virtio</span> model available due to
historical reasons: use <span class="docutils literal"><span class="pre">virtio-scsi</span></span> instead, which behaves the same as
<span class="docutils literal">virtio</span> does for other devices. Both <span class="docutils literal"><span class="pre">virtio-transitional</span></span> and
<span class="docutils literal"><span class="pre">virtio-non-transitional</span></span> work with SCSI controllers;</p></li>
<li><p>some devices, such as GPUs and input devices (keyboard, tablet and mouse),
are only defined in the virtio 1.0 spec and as such don't have a transitional
variant: the only accepted model is <span class="docutils literal">virtio</span>, which will result in a
non-transitional device.</p></li>
</ul>
<p>For more details see the <a class="reference external" href="https://lists.gnu.org/archive/html/qemu-devel/2018-12/msg00923.html">qemu patch
posting</a>
and the <a class="reference external" href="https://docs.oasis-open.org/virtio/virtio/v1.0/virtio-v1.0.html">virtio-1.0
spec</a>.</p>
<p><span class="anchor"><a id="elementsControllers"/></span></p>
</div>
<div class="section" id="controllers">
<h3><a class="toc-backref" href="formatdomain.html#id31">Controllers</a><a class="headerlink" href="formatdomain.html#controllers" title="Link to this headline">¶</a></h3>
<p>Depending on the guest architecture, some device buses can appear more than
once, with a group of virtual devices tied to a virtual controller. Normally,
libvirt can automatically infer such controllers without requiring explicit XML
markup, but sometimes it is necessary to provide an explicit controller element,
notably when planning the <a class="reference external" href="https://libvirt.org/pci-hotplug.html">PCI topology</a> for guests where
device hotplug is expected.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;controller type='ide' index='0'/&gt;
  &lt;controller type='virtio-serial' index='0' ports='16' vectors='4'/&gt;
  &lt;controller type='virtio-serial' index='1'&gt;
    &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x0a' function='0x0'/&gt;
  &lt;/controller&gt;
  &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
    &lt;driver iothread='4'/&gt;
    &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x0b' function='0x0'/&gt;
  &lt;/controller&gt;
  &lt;controller type='xenbus' maxGrantFrames='64' maxEventChannels='2047'/&gt;
  ...
&lt;/devices&gt;
...</pre>
<p>Each controller has a mandatory attribute <span class="docutils literal">type</span>, which must be one of 'ide',
'fdc', 'scsi', 'sata', 'usb', 'ccid', 'virtio-serial' or 'pci', and a mandatory
attribute <span class="docutils literal">index</span> which is the decimal integer describing in which order the
bus controller is encountered (for use in <span class="docutils literal">controller</span> attributes of
<span class="docutils literal">&lt;address&gt;</span> elements). <span class="since">Since 1.3.5</span> the index is optional; if not
specified, it will be auto-assigned to be the lowest unused index for the given
controller type. Some controller types have additional attributes that control
specific features, such as:</p>
<dl class="simple">
<dt><span class="docutils literal"><span class="pre">virtio-serial</span></span></dt>
<dd><p>The <span class="docutils literal"><span class="pre">virtio-serial</span></span> controller has two additional optional attributes
<span class="docutils literal">ports</span> and <span class="docutils literal">vectors</span>, which control how many devices can be connected
through the controller. <span class="since">Since 5.2.0</span> , it supports an optional
attribute <span class="docutils literal">model</span> which can be 'virtio', 'virtio-transitional', or
'virtio-non-transitional'. See <a class="reference external" href="formatdomain.html#elementsVirtioTransitional">Virtio transitional
devices</a> for more details.</p>
</dd>
<dt><span class="docutils literal">scsi</span></dt>
<dd><p>A <span class="docutils literal">scsi</span> controller has an optional attribute <span class="docutils literal">model</span>, which is one of
'auto', 'buslogic', 'ibmvscsi', 'lsilogic', 'lsisas1068', 'lsisas1078',
'virtio-scsi', 'vmpvscsi', 'virtio-transitional', 'virtio-non-transitional',
'ncr53c90' (as builtin implicit controller only), 'am53c974', 'dc390'.
See <a class="reference external" href="formatdomain.html#elementsVirtioTransitional">Virtio transitional devices</a> for more
details.</p>
</dd>
<dt><span class="docutils literal">usb</span></dt>
<dd><p>A <span class="docutils literal">usb</span> controller has an optional attribute <span class="docutils literal">model</span>, which is one of
"piix3-uhci", "piix4-uhci", "ehci", "ich9-ehci1", "ich9-uhci1", "ich9-uhci2",
"ich9-uhci3", "vt82c686b-uhci", "pci-ohci", "nec-xhci", "qusb1" (xen pvusb
with qemu backend, version 1.1), "qusb2" (xen pvusb with qemu backend,
version 2.0) or "qemu-xhci". Additionally, <span class="since">since 0.10.0</span> , if the USB
bus needs to be explicitly disabled for the guest, <span class="docutils literal"><span class="pre">model='none'</span></span> may be
used. <span class="since">Since 1.0.5</span> , no default USB controller will be built on s390.
<span class="since">Since 1.3.5</span> , USB controllers accept a <span class="docutils literal">ports</span> attribute to
configure how many devices can be connected to the controller.</p>
</dd>
<dt><span class="docutils literal">ide</span></dt>
<dd><p><span class="since">Since 3.10.0</span> for the vbox driver, the <span class="docutils literal">ide</span> controller has an
optional attribute <span class="docutils literal">model</span>, which is one of "piix3", "piix4" or "ich6".</p>
</dd>
<dt><span class="docutils literal">xenbus</span></dt>
<dd><p><span class="since">Since 5.2.0</span> , the <span class="docutils literal">xenbus</span> controller has an optional attribute
<span class="docutils literal">maxGrantFrames</span>, which specifies the maximum number of grant frames the
controller makes available for connected devices. <span class="since">Since 6.3.0</span> , the
xenbus controller supports the optional <span class="docutils literal">maxEventChannels</span> attribute, which
specifies maximum number of event channels (PV interrupts) that can be used
by the guest.</p>
</dd>
</dl>
<p>Note: The PowerPC64 "spapr-vio" addresses do not have an associated controller.</p>
<p>For controllers that are themselves devices on a PCI or USB bus, an optional
sub-element <span class="docutils literal">&lt;address&gt;</span> can specify the exact relationship of the controller
to its master bus, with semantics <a class="reference external" href="formatdomain.html#elementsAddress">given above</a>.</p>
<p>An optional sub-element <span class="docutils literal">driver</span> can specify the driver specific options:</p>
<dl class="simple">
<dt><span class="docutils literal">queues</span></dt>
<dd><p>The optional <span class="docutils literal">queues</span> attribute specifies the number of queues for the
controller. For best performance, it's recommended to specify a value
matching the number of vCPUs. <span class="since">Since 1.0.5 (QEMU and KVM only)</span></p>
</dd>
<dt><span class="docutils literal">cmd_per_lun</span></dt>
<dd><p>The optional <span class="docutils literal">cmd_per_lun</span> attribute specifies the maximum number of
commands that can be queued on devices controlled by the host. <span class="since">Since
1.2.7 (QEMU and KVM only)</span></p>
</dd>
<dt><span class="docutils literal">max_sectors</span></dt>
<dd><p>The optional <span class="docutils literal">max_sectors</span> attribute specifies the maximum amount of data
in bytes that will be transferred to or from the device in a single command.
The transfer length is measured in sectors, where a sector is 512 bytes.
<span class="since">Since 1.2.7 (QEMU and KVM only)</span></p>
</dd>
<dt><span class="docutils literal">ioeventfd</span></dt>
<dd><p>The optional <span class="docutils literal">ioeventfd</span> attribute specifies whether the controller should
use <a class="reference external" href="https://patchwork.kernel.org/patch/43390/">I/O asynchronous handling</a>
or not. Accepted values are "on" and "off". <span class="since">Since 1.2.18</span></p>
</dd>
<dt><span class="docutils literal">iothread</span></dt>
<dd><p>Supported for controller type <span class="docutils literal">scsi</span> using model <span class="docutils literal"><span class="pre">virtio-scsi</span></span> for
<span class="docutils literal">address</span> types <span class="docutils literal">pci</span> and <span class="docutils literal">ccw</span> <span class="since">since 1.3.5 (QEMU 2.4)</span> . The
optional <span class="docutils literal">iothread</span> attribute assigns the controller to an IOThread as
defined by the range for the domain
<a class="reference external" href="formatdomain.html#elementsIOThreadsAllocation">iothreads</a> value. Each SCSI <span class="docutils literal">disk</span>
assigned to use the specified <span class="docutils literal">controller</span> will utilize the same IOThread.
If a specific IOThread is desired for a specific SCSI <span class="docutils literal">disk</span>, then multiple
controllers must be defined each having a specific <span class="docutils literal">iothread</span> value. The
<span class="docutils literal">iothread</span> value must be within the range 1 to the domain iothreads value.</p>
</dd>
<dt>virtio options</dt>
<dd><p>For virtio controllers, <a class="reference external" href="formatdomain.html#elementsVirtio">Virtio-specific options</a> can
also be set. ( <span class="since">Since 3.5.0</span> )</p>
</dd>
</dl>
<p>USB companion controllers have an optional sub-element <span class="docutils literal">&lt;master&gt;</span> to specify
the exact relationship of the companion to its master controller. A companion
controller is on the same bus as its master, so the companion <span class="docutils literal">index</span> value
should be equal. Not all controller models can be used as companion controllers
and libvirt might provide some sensible defaults (settings of
<span class="docutils literal">master startport</span> and <span class="docutils literal">function</span> of an address) for some particular models.
Preferred companion controllers are <span class="docutils literal"><span class="pre">ich-uhci[123]</span></span>.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;controller type='usb' index='0' model='ich9-ehci1'&gt;
    &lt;address type='pci' domain='0' bus='0' slot='4' function='7'/&gt;
  &lt;/controller&gt;
  &lt;controller type='usb' index='0' model='ich9-uhci1'&gt;
    &lt;master startport='0'/&gt;
    &lt;address type='pci' domain='0' bus='0' slot='4' function='0' multifunction='on'/&gt;
  &lt;/controller&gt;
  ...
&lt;/devices&gt;
...</pre>
<p>PCI controllers have an optional <span class="docutils literal">model</span> attribute; possible values for this
attribute are</p>
<ul class="simple">
<li><p><span class="docutils literal"><span class="pre">pci-root</span></span>, <span class="docutils literal"><span class="pre">pci-bridge</span></span> ( <span class="since">since 1.0.5</span> )</p></li>
<li><p><span class="docutils literal"><span class="pre">pcie-root</span></span>, <span class="docutils literal"><span class="pre">dmi-to-pci-bridge</span></span> ( <span class="since">since 1.1.2</span> )</p></li>
<li><p><span class="docutils literal"><span class="pre">pcie-root-port</span></span>, <span class="docutils literal"><span class="pre">pcie-switch-upstream-port</span></span>,
<span class="docutils literal"><span class="pre">pcie-switch-downstream-port</span></span> ( <span class="since">since 1.2.19</span> )</p></li>
<li><p><span class="docutils literal"><span class="pre">pci-expander-bus</span></span>, <span class="docutils literal"><span class="pre">pcie-expander-bus</span></span> ( <span class="since">since 1.3.4</span> )</p></li>
<li><p><span class="docutils literal"><span class="pre">pcie-to-pci-bridge</span></span> ( <span class="since">since 4.3.0</span> )</p></li>
</ul>
<p>The root controllers (<span class="docutils literal"><span class="pre">pci-root</span></span> and <span class="docutils literal"><span class="pre">pcie-root</span></span>) have an optional
<span class="docutils literal">pcihole64</span> element specifying how big (in kilobytes, or in the unit specified
by <span class="docutils literal">pcihole64</span>'s <span class="docutils literal">unit</span> attribute) the 64-bit PCI hole should be. Some
guests (like Windows XP or Windows Server 2003) might crash when QEMU and
Seabios are recent enough to support 64-bit PCI holes, unless this is disabled
(set to 0). <span class="since">Since 1.1.2 (QEMU only)</span></p>
<p>PCI controllers also have an optional subelement <span class="docutils literal">&lt;model&gt;</span> with an attribute
<span class="docutils literal">name</span>. The name attribute holds the name of the specific device that qemu is
emulating (e.g. "i82801b11-bridge") rather than simply the class of device
("pcie-to-pci-bridge", "pci-bridge"), which is set in the controller element's
model <strong>attribute</strong>. In almost all cases, you should not manually add a
<span class="docutils literal">&lt;model&gt;</span> subelement to a controller, nor should you modify one that is
automatically generated by libvirt. <span class="since">Since 1.2.19 (QEMU only).</span></p>
<p>PCI controllers also have an optional subelement <span class="docutils literal">&lt;target&gt;</span> with the
attributes and subelements listed below. These are configurable items that 1)
are visible to the guest OS so must be preserved for guest ABI compatibility,
and 2) are usually left to default values or derived automatically by libvirt.
In almost all cases, you should not manually add a <span class="docutils literal">&lt;target&gt;</span> subelement to a
controller, nor should you modify the values in the those that are automatically
generated by libvirt. <span class="since">Since 1.2.19 (QEMU only).</span></p>
<dl>
<dt><span class="docutils literal">chassisNr</span></dt>
<dd><p>PCI controllers that have attribute model="pci-bridge", can also have a
<span class="docutils literal">chassisNr</span> attribute in the <span class="docutils literal">&lt;target&gt;</span> subelement, which is used to
control QEMU's "chassis_nr" option for the pci-bridge device (normally
libvirt automatically sets this to the same value as the index attribute of
the pci controller). If set, chassisNr must be between 1 and 255.</p>
</dd>
<dt><span class="docutils literal">chassis</span></dt>
<dd><p>pcie-root-port and pcie-switch-downstream-port controllers can also have a
<span class="docutils literal">chassis</span> attribute in the <span class="docutils literal">&lt;target&gt;</span> subelement, which is used to set
the controller's "chassis" configuration value, which is visible to the
virtual machine. If set, chassis must be between 0 and 255.</p>
</dd>
<dt><span class="docutils literal">port</span></dt>
<dd><p>pcie-root-port and pcie-switch-downstream-port controllers can also have a
<span class="docutils literal">port</span> attribute in the <span class="docutils literal">&lt;target&gt;</span> subelement, which is used to set the
controller's "port" configuration value, which is visible to the virtual
machine. If set, port must be between 0 and 255.</p>
</dd>
<dt><span class="docutils literal">hotplug</span></dt>
<dd><p>pcie-root-port and pcie-switch-downstream-port controllers can also have a
<span class="docutils literal">hotplug</span> attribute in the <span class="docutils literal">&lt;target&gt;</span> subelement, which is used to
disable hotplug/unplug of devices on a particular controller. The default
setting of <span class="docutils literal">hotplug</span> is <span class="docutils literal">on</span>; it should be set to <span class="docutils literal">off</span> to disable
hotplug/unplug of devices on a particular controller. <span class="since">Since 6.3.0</span></p>
</dd>
<dt><span class="docutils literal">busNr</span></dt>
<dd><p>pci-expander-bus and pcie-expander-bus controllers can have an optional
<span class="docutils literal">busNr</span> attribute (1-254). This will be the bus number of the new bus; All
bus numbers between that specified and 255 will be available only for
assignment to PCI/PCIe controllers plugged into the hierarchy starting with
this expander bus, and bus numbers less than the specified value will be
available to the next lower expander-bus (or the root-bus if there are no
lower expander buses). If you do not specify a busNumber, libvirt will find
the lowest existing busNumber in all other expander buses (or use 256 if
there are no others) and auto-assign the busNr of that found bus - 2, which
provides one bus number for the pci-expander-bus and one for the pci-bridge
that is automatically attached to it (if you plan on adding more pci-bridges
to the hierarchy of the bus, you should manually set busNr to a lower value).</p>
<p>A similar algorithm is used for automatically determining the busNr attribute
for pcie-expander-bus, but since the pcie-expander-bus doesn't have any
built-in pci-bridge, the 2nd bus-number is just being reserved for the
pcie-root-port that must necessarily be connected to the bus in order to
actually plug in an endpoint device. If you intend to plug multiple devices
into a pcie-expander-bus, you must connect a pcie-switch-upstream-port to the
pcie-root-port that is plugged into the pcie-expander-bus, and multiple
pcie-switch-downstream-ports to the pcie-switch-upstream-port, and of course
for this to work properly, you will need to decrease the pcie-expander-bus'
busNr accordingly so that there are enough unused bus numbers above it to
accommodate giving out one bus number for the upstream-port and one for each
downstream-port (in addition to the pcie-root-port and the pcie-expander-bus
itself).</p>
</dd>
<dt><span class="docutils literal">node</span></dt>
<dd><p>Some PCI controllers (<span class="docutils literal"><span class="pre">pci-expander-bus</span></span> for the pc machine type,
<span class="docutils literal"><span class="pre">pcie-expander-bus</span></span> for the q35 machine type and, <span class="since">since 3.6.0</span> ,
<span class="docutils literal"><span class="pre">pci-root</span></span> for the pseries machine type) can have an optional <span class="docutils literal">&lt;node&gt;</span>
subelement within the <span class="docutils literal">&lt;target&gt;</span> subelement, which is used to set the NUMA
node reported to the guest OS for that bus - the guest OS will then know that
all devices on that bus are a part of the specified NUMA node (it is up to
the user of the libvirt API to attach host devices to the correct
pci-expander-bus when assigning them to the domain).</p>
</dd>
<dt><span class="docutils literal">index</span></dt>
<dd><p>pci-root controllers for pSeries guests use this attribute to record the
order they will show up in the guest. <span class="since">Since 3.6.0</span></p>
</dd>
</dl>
<p>For machine types which provide an implicit PCI bus, the pci-root controller
with index=0 is auto-added and required to use PCI devices. pci-root has no
address. PCI bridges are auto-added if there are too many devices to fit on the
one bus provided by pci-root, or a PCI bus number greater than zero was
specified. PCI bridges can also be specified manually, but their addresses
should only refer to PCI buses provided by already specified PCI controllers.
Leaving gaps in the PCI controller indexes might lead to an invalid
configuration.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;controller type='pci' index='0' model='pci-root'/&gt;
  &lt;controller type='pci' index='1' model='pci-bridge'&gt;
    &lt;address type='pci' domain='0' bus='0' slot='5' function='0' multifunction='off'/&gt;
  &lt;/controller&gt;
&lt;/devices&gt;
...</pre>
<p>For machine types which provide an implicit PCI Express (PCIe) bus (for example,
the machine types based on the Q35 chipset), the pcie-root controller with
index=0 is auto-added to the domain's configuration. pcie-root has also no
address, provides 31 slots (numbered 1-31) that can be used to attach PCIe or
PCI devices (although libvirt will never auto-assign a PCI device to a PCIe
slot, it will allow manual specification of such an assignment). Devices
connected to pcie-root cannot be hotplugged. If traditional PCI devices are
present in the guest configuration, a <span class="docutils literal"><span class="pre">pcie-to-pci-bridge</span></span> controller will
automatically be added: this controller, which plugs into a <span class="docutils literal"><span class="pre">pcie-root-port</span></span>,
provides 31 usable PCI slots (1-31) with hotplug support ( <span class="since">since 4.3.0</span>
). If the QEMU binary doesn't support the corresponding device, then a
<span class="docutils literal"><span class="pre">dmi-to-pci-bridge</span></span> controller will be added instead, usually at the defacto
standard location of slot=0x1e. A dmi-to-pci-bridge controller plugs into a PCIe
slot (as provided by pcie-root), and itself provides 31 standard PCI slots
(which also do not support device hotplug). In order to have hot-pluggable PCI
slots in the guest system, a pci-bridge controller will also be automatically
created and connected to one of the slots of the auto-created dmi-to-pci-bridge
controller; all guest PCI devices with addresses that are auto-determined by
libvirt will be placed on this pci-bridge device. ( <span class="since">since 1.1.2</span> ).</p>
<p>Domains with an implicit pcie-root can also add controllers with
<span class="docutils literal"><span class="pre">model='pcie-root-port'</span></span>, <span class="docutils literal"><span class="pre">model='pcie-switch-upstream-port'</span></span>, and
<span class="docutils literal"><span class="pre">model='pcie-switch-downstream-port'</span></span>. pcie-root-port is a simple type of
bridge device that can connect only to one of the 31 slots on the pcie-root bus
on its upstream side, and makes a single (PCIe, hotpluggable) port available on
the downstream side (at slot='0'). pcie-root-port can be used to provide a
single slot to later hotplug a PCIe device (but is not itself hotpluggable - it
must be in the configuration when the domain is started). ( <span class="since">since
1.2.19</span> )</p>
<p>pcie-switch-upstream-port is a more flexible (but also more complex) device that
can only plug into a pcie-root-port or pcie-switch-downstream-port on the
upstream side (and only before the domain is started - it is not hot-pluggable),
and provides 32 ports on the downstream side (slot='0' - slot='31') that accept
only pcie-switch-downstream-port devices; each pcie-switch-downstream-port
device can only plug into a pcie-switch-upstream-port on its upstream side
(again, not hot-pluggable), and on its downstream side provides a single
hotpluggable pcie port that can accept any standard pci or pcie device (or
another pcie-switch-upstream-port), i.e. identical in function to a
pcie-root-port. ( <span class="since">since 1.2.19</span> )</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;controller type='pci' index='0' model='pcie-root'/&gt;
  &lt;controller type='pci' index='1' model='pcie-root-port'&gt;
    &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x0'/&gt;
  &lt;/controller&gt;
  &lt;controller type='pci' index='2' model='pcie-to-pci-bridge'&gt;
    &lt;address type='pci' domain='0x0000' bus='0x01' slot='0x00' function='0x0'/&gt;
  &lt;/controller&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsLease"/></span></p>
</div>
<div class="section" id="device-leases">
<h3><a class="toc-backref" href="formatdomain.html#id32">Device leases</a><a class="headerlink" href="formatdomain.html#device-leases" title="Link to this headline">¶</a></h3>
<p>When using a lock manager, it may be desirable to record device leases against a
VM. The lock manager will ensure the VM won't start unless the leases can be
acquired.</p>
<pre class="literal-block">...
&lt;devices&gt;
  ...
  &lt;lease&gt;
    &lt;lockspace&gt;somearea&lt;/lockspace&gt;
    &lt;key&gt;somekey&lt;/key&gt;
    &lt;target path='/some/lease/path' offset='1024'/&gt;
  &lt;/lease&gt;
  ...
&lt;/devices&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">lockspace</span></dt>
<dd><p>This is an arbitrary string, identifying the lockspace within which the key
is held. Lock managers may impose extra restrictions on the format, or length
of the lockspace name.</p>
</dd>
<dt><span class="docutils literal">key</span></dt>
<dd><p>This is an arbitrary string, uniquely identifying the lease to be acquired.
Lock managers may impose extra restrictions on the format, or length of the
key.</p>
</dd>
<dt><span class="docutils literal">target</span></dt>
<dd><p>This is the fully qualified path of the file associated with the lockspace.
The offset specifies where the lease is stored within the file. If the lock
manager does not require an offset, just pass 0.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsHostDev"/></span></p>
</div>
<div class="section" id="host-device-assignment">
<h3><a class="toc-backref" href="formatdomain.html#id33">Host device assignment</a><a class="headerlink" href="formatdomain.html#host-device-assignment" title="Link to this headline">¶</a></h3>
<p><span class="anchor"><a id="elementsHostDevSubsys"/></span></p>
<div class="section" id="usb-pci-scsi-devices">
<h4><a class="toc-backref" href="formatdomain.html#id34">USB / PCI / SCSI devices</a><a class="headerlink" href="formatdomain.html#usb-pci-scsi-devices" title="Link to this headline">¶</a></h4>
<p>USB, PCI and SCSI devices attached to the host can be passed through to the
guest using the <span class="docutils literal">hostdev</span> element. <span class="since">since after 0.4.4 for USB, 0.6.0
for PCI (KVM only) and 1.0.6 for SCSI (KVM only)</span> :</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;hostdev mode='subsystem' type='usb'&gt;
    &lt;source startupPolicy='optional'&gt;
      &lt;vendor id='0x1234'/&gt;
      &lt;product id='0xbeef'/&gt;
    &lt;/source&gt;
    &lt;boot order='2'/&gt;
  &lt;/hostdev&gt;
&lt;/devices&gt;
...</pre>
<p>or:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;hostdev mode='subsystem' type='pci' managed='yes'&gt;
    &lt;source writeFiltering='no'&gt;
      &lt;address domain='0x0000' bus='0x06' slot='0x02' function='0x0'/&gt;
    &lt;/source&gt;
    &lt;boot order='1'/&gt;
    &lt;rom bar='on' file='/etc/fake/boot.bin'/&gt;
  &lt;/hostdev&gt;
&lt;/devices&gt;
...</pre>
<p>or:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;hostdev mode='subsystem' type='scsi' sgio='filtered' rawio='yes'&gt;
    &lt;source&gt;
      &lt;adapter name='scsi_host0'/&gt;
      &lt;address bus='0' target='0' unit='0'/&gt;
    &lt;/source&gt;
    &lt;readonly/&gt;
    &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
  &lt;/hostdev&gt;
&lt;/devices&gt;
...</pre>
<p>or:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;hostdev mode='subsystem' type='scsi'&gt;
    &lt;source protocol='iscsi' name='iqn.2014-08.com.example:iscsi-nopool/1'&gt;
      &lt;host name='example.com' port='3260'/&gt;
      &lt;auth username='myuser'&gt;
        &lt;secret type='iscsi' usage='libvirtiscsi'/&gt;
      &lt;/auth&gt;
      &lt;initiator&gt;
        &lt;iqn name='iqn.2020-07.com.example:test'/&gt;
      &lt;/initiator&gt;
    &lt;/source&gt;
    &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
  &lt;/hostdev&gt;
&lt;/devices&gt;
...</pre>
<p>or:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;hostdev mode='subsystem' type='scsi_host'&gt;
    &lt;source protocol='vhost' wwpn='naa.50014057667280d8'/&gt;
  &lt;/hostdev&gt;
&lt;/devices&gt;
...</pre>
<p>or:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;hostdev mode='subsystem' type='mdev' model='vfio-pci'&gt;
  &lt;source&gt;
    &lt;address uuid='c2177883-f1bb-47f0-914d-32a22e3a8804'/&gt;
  &lt;/source&gt;
  &lt;/hostdev&gt;
  &lt;hostdev mode='subsystem' type='mdev' model='vfio-ccw'&gt;
  &lt;source&gt;
    &lt;address uuid='9063cba3-ecef-47b6-abcf-3fef4fdcad85'/&gt;
  &lt;/source&gt;
  &lt;address type='ccw' cssid='0xfe' ssid='0x0' devno='0x0001'/&gt;
  &lt;/hostdev&gt;
&lt;/devices&gt;
...</pre>
<dl>
<dt><span class="docutils literal">hostdev</span></dt>
<dd><p>The <span class="docutils literal">hostdev</span> element is the main container for describing host devices.
For each device, the <span class="docutils literal">mode</span> is always "subsystem" and the <span class="docutils literal">type</span> is one
of the following values with additional attributes noted.</p>
<dl>
<dt><span class="docutils literal">usb</span></dt>
<dd><p>USB devices are detached from the host on guest startup and reattached
after the guest exits or the device is hot-unplugged.</p>
</dd>
<dt><span class="docutils literal">pci</span></dt>
<dd><p>For PCI devices, when <span class="docutils literal">managed</span> is "yes" it is detached from the host
before being passed on to the guest and reattached to the host after the
guest exits. If <span class="docutils literal">managed</span> is omitted or "no", the user is responsible to
call <span class="docutils literal">virNodeDeviceDetachFlags</span> (or <span class="docutils literal">virsh <span class="pre">nodedev-detach</span></span> before
starting the guest or hot-plugging the device and
<span class="docutils literal">virNodeDeviceReAttach</span> (or <span class="docutils literal">virsh <span class="pre">nodedev-reattach</span></span>) after hot-unplug
or stopping the guest.</p>
</dd>
<dt><span class="docutils literal">scsi</span></dt>
<dd><p>For SCSI devices, user is responsible to make sure the device is not used
by host. If supported by the hypervisor and OS, the optional <span class="docutils literal">sgio</span> (
<span class="since">since 1.0.6</span> ) attribute indicates whether unprivileged SG_IO
commands are filtered for the disk. Valid settings are "filtered" or
"unfiltered", where the default is "filtered". The optional <span class="docutils literal">rawio</span> (
<span class="since">since 1.2.9</span> ) attribute indicates whether the lun needs the rawio
capability. Valid settings are "yes" or "no". See the rawio description
within the <a class="reference external" href="formatdomain.html#elementsDisks">disk</a> section. If a disk lun in the domain
already has the rawio capability, then this setting not required.</p>
</dd>
<dt><span class="docutils literal">scsi_host</span></dt>
<dd><p><span class="since">since 2.5.0</span> For SCSI devices, user is responsible to make sure
the device is not used by host. This <span class="docutils literal">type</span> passes all LUNs presented by
a single HBA to the guest. <span class="since">Since 5.2.0,</span> the <span class="docutils literal">model</span> attribute
can be specified further with "virtio-transitional",
"virtio-non-transitional", or "virtio". See <a class="reference external" href="formatdomain.html#elementsVirtioTransitional">Virtio transitional
devices</a> for more details.</p>
</dd>
<dt><span class="docutils literal">mdev</span></dt>
<dd><p>For mediated devices ( <span class="since">Since 3.2.0</span> ) the <span class="docutils literal">model</span> attribute
specifies the device API which determines how the host's vfio driver will
expose the device to the guest. Currently, <span class="docutils literal"><span class="pre">model='vfio-pci'</span></span>,
<span class="docutils literal"><span class="pre">model='vfio-ccw'</span></span> ( <span class="since">Since 4.4.0</span> ) and <span class="docutils literal"><span class="pre">model='vfio-ap'</span></span> (
<span class="since">Since 4.9.0</span> ) is supported. <a class="reference external" href="https://libvirt.org/drvnodedev.html#MDEV">MDEV</a>
section provides more information about mediated devices as well as how to
create mediated devices on the host. <span class="since">Since 4.6.0 (QEMU 2.12)</span> an
optional <span class="docutils literal">display</span> attribute may be used to enable or disable support
for an accelerated remote desktop backed by a mediated device (such as
NVIDIA vGPU or Intel GVT-g) as an alternative to emulated <a class="reference external" href="formatdomain.html#elementsVideo">video
devices</a>. This attribute is limited to
<span class="docutils literal"><span class="pre">model='vfio-pci'</span></span> only. Supported values are either <span class="docutils literal">on</span> or <span class="docutils literal">off</span>
(default is 'off'). It is required to use a <a class="reference external" href="formatdomain.html#elementsGraphics">graphical
framebuffer</a> in order to use this attribute,
currently only supported with VNC, Spice and egl-headless graphics
devices. <span class="since">Since version 5.10.0</span> , there is an optional <span class="docutils literal">ramfb</span>
attribute for devices with <span class="docutils literal"><span class="pre">model='vfio-pci'</span></span>. Supported values are
either <span class="docutils literal">on</span> or <span class="docutils literal">off</span> (default is 'off'). When enabled, this attribute
provides a memory framebuffer device to the guest. This framebuffer will
be used as a boot display when a vgpu device is the primary display.</p>
<p>Note: There are also some implications on the usage of guest's address
type depending on the <span class="docutils literal">model</span> attribute, see the <span class="docutils literal">address</span> element
below.</p>
</dd>
</dl>
<p>Note: The <span class="docutils literal">managed</span> attribute is only used with <span class="docutils literal"><span class="pre">type='pci'</span></span> and is
ignored by all the other device types, thus setting <span class="docutils literal">managed</span> explicitly
with other than a PCI device has the same effect as omitting it. Similarly,
<span class="docutils literal">model</span> attribute is only supported by mediated devices and ignored by all
other device types.</p>
</dd>
<dt><span class="docutils literal">source</span></dt>
<dd><p>The source element describes the device as seen from the host using the
following mechanism to describe:</p>
<dl>
<dt><span class="docutils literal">usb</span></dt>
<dd><p>The USB device can either be addressed by vendor / product id using the
<span class="docutils literal">vendor</span> and <span class="docutils literal">product</span> elements or by the device's address on the host
using the <span class="docutils literal">address</span> element.</p>
<p><span class="since">Since 1.0.0</span> , the <span class="docutils literal">source</span> element of USB devices may contain
<span class="docutils literal">startupPolicy</span> attribute which can be used to define policy what to do
if the specified host USB device is not found. The attribute accepts the
following values:</p>
<table>
<colgroup>
<col style="width: 12%"/>
<col style="width: 88%"/>
</colgroup>
<tbody>
<tr><td><p>mandatory</p></td>
<td><p>fail if missing for any reason (the default)</p></td>
</tr>
<tr><td><p>requisite</p></td>
<td><p>fail if missing on boot up, drop if missing on migrate/restore/revert</p></td>
</tr>
<tr><td><p>optional</p></td>
<td><p>drop if missing at any start attempt</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><span class="docutils literal">pci</span></dt>
<dd><p>PCI devices can only be described by their <span class="docutils literal">address</span>.
<span class="since">Since 6.8.0 (Xen only)</span> , the <span class="docutils literal">source</span> element of a PCI device
may contain the <span class="docutils literal">writeFiltering</span> attribute to control write access to
the PCI configuration space. By default Xen only allows writes of known
safe values to the configuration space. Setting <span class="docutils literal"><span class="pre">writeFiltering='no'</span></span>
will allow all writes to the device's PCI configuration space.</p>
</dd>
<dt><span class="docutils literal">scsi</span></dt>
<dd><p>SCSI devices are described by both the <span class="docutils literal">adapter</span> and <span class="docutils literal">address</span>
elements. The <span class="docutils literal">address</span> element includes a <span class="docutils literal">bus</span> attribute (a 2-digit
bus number), a <span class="docutils literal">target</span> attribute (a 10-digit target number), and a
<span class="docutils literal">unit</span> attribute (a 20-digit unit number on the bus). Not all
hypervisors support larger <span class="docutils literal">target</span> and <span class="docutils literal">unit</span> values. It is up to
each hypervisor to determine the maximum value supported for the adapter.</p>
<p><span class="since">Since 1.2.8</span> , the <span class="docutils literal">source</span> element of a SCSI device may contain
the <span class="docutils literal">protocol</span> attribute. When the attribute is set to "iscsi", the host
device XML follows the network <a class="reference external" href="formatdomain.html#elementsDisks">disk</a> device using the
same <span class="docutils literal">name</span> attribute and optionally using the <span class="docutils literal">auth</span> element to
provide the authentication credentials to the iSCSI server.</p>
<p><span class="since">Since 6.7.0</span>, the optional <span class="docutils literal">initiator</span> sub-element controls the
IQN of the initiator ran by the hypervisor via it's <span class="docutils literal">&lt;iqn <span class="pre">name='iqn...'</span></span>
subelement.</p>
</dd>
<dt><span class="docutils literal">scsi_host</span></dt>
<dd><p><span class="since">Since 2.5.0</span> , multiple LUNs behind a single SCSI HBA are
described by a <span class="docutils literal">protocol</span> attribute set to "vhost" and a <span class="docutils literal">wwpn</span>
attribute that is the vhost_scsi wwpn (16 hexadecimal digits with a prefix
of "naa.") established in the host configfs.</p>
</dd>
<dt><span class="docutils literal">mdev</span></dt>
<dd><p>Mediated devices ( <span class="since">Since 3.2.0</span> ) are described by the <span class="docutils literal">address</span>
element. The <span class="docutils literal">address</span> element contains a single mandatory attribute
<span class="docutils literal">uuid</span>.</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">vendor</span>, <span class="docutils literal">product</span></dt>
<dd><p>The <span class="docutils literal">vendor</span> and <span class="docutils literal">product</span> elements each have an <span class="docutils literal">id</span> attribute that
specifies the USB vendor and product id. The ids can be given in decimal,
hexadecimal (starting with 0x) or octal (starting with 0) form.</p>
</dd>
<dt><span class="docutils literal">boot</span></dt>
<dd><p>Specifies that the device is bootable. The <span class="docutils literal">order</span> attribute determines the
order in which devices will be tried during boot sequence. The per-device
<span class="docutils literal">boot</span> elements cannot be used together with general boot elements in <a class="reference external" href="formatdomain.html#elementsOSBIOS">BIOS
bootloader</a> section. <span class="since">Since 0.8.8</span> for PCI
devices, <span class="since">Since 1.0.1</span> for USB devices.</p>
</dd>
<dt><span class="docutils literal">rom</span></dt>
<dd><p>The <span class="docutils literal">rom</span> element is used to change how a PCI device's ROM is presented to
the guest. The optional <span class="docutils literal">bar</span> attribute can be set to "on" or "off", and
determines whether or not the device's ROM will be visible in the guest's
memory map. (In PCI documentation, the "rombar" setting controls the presence
of the Base Address Register for the ROM). If no rom bar is specified, the
qemu default will be used (older versions of qemu used a default of "off",
while newer qemus have a default of "on"). <span class="since">Since 0.9.7 (QEMU and KVM
only)</span> . The optional <span class="docutils literal">file</span> attribute contains an absolute path to a
binary file to be presented to the guest as the device's ROM BIOS. This can
be useful, for example, to provide a PXE boot ROM for a virtual function of
an sr-iov capable ethernet device (which has no boot ROMs for the VFs).
<span class="since">Since 0.9.10 (QEMU and KVM only)</span> . The optional <span class="docutils literal">enabled</span>
attribute can be set to <span class="docutils literal">no</span> to disable PCI ROM loading completely for the
device; if PCI ROM loading is disabled through this attribute, attempts to
tweak the loading process further using the <span class="docutils literal">bar</span> or <span class="docutils literal">file</span> attributes
will be rejected. <span class="since">Since 4.3.0 (QEMU and KVM only)</span> .</p>
</dd>
<dt><span class="docutils literal">address</span></dt>
<dd><p>The <span class="docutils literal">address</span> element for USB devices has a <span class="docutils literal">bus</span> and <span class="docutils literal">device</span>
attribute to specify the USB bus and device number the device appears at on
the host. The values of these attributes can be given in decimal, hexadecimal
(starting with 0x) or octal (starting with 0) form. For PCI devices the
element carries 4 attributes allowing to designate the device as can be found
with the <span class="docutils literal">lspci</span> or with <span class="docutils literal">virsh <span class="pre">nodedev-list</span></span>. For SCSI devices a 'drive'
address type must be used. For mediated devices, which are software-only
devices defining an allocation of resources on the physical parent device,
the address type used must conform to the <span class="docutils literal">model</span> attribute of element
<span class="docutils literal">hostdev</span>, e.g. any address type other than PCI for <span class="docutils literal"><span class="pre">vfio-pci</span></span> device API
or any address type other than CCW for <span class="docutils literal"><span class="pre">vfio-ccw</span></span> device API will result in
an error. <a class="reference external" href="formatdomain.html#elementsAddress">See above</a> for more details on the address
element.</p>
</dd>
<dt><span class="docutils literal">driver</span></dt>
<dd><p>PCI devices can have an optional <span class="docutils literal">driver</span> subelement that specifies which
backend driver to use for PCI device assignment. Use the <span class="docutils literal">name</span> attribute
to select either "vfio" (for the new VFIO device assignment backend, which is
compatible with UEFI SecureBoot) or "kvm" (the legacy device assignment
handled directly by the KVM kernel module) <span class="since">Since 1.0.5 (QEMU and KVM
only, requires kernel 3.6 or newer)</span> . When specified, device assignment will
fail if the requested method of device assignment isn't available on the
host. When not specified, the default is "vfio" on systems where the VFIO
driver is available and loaded, and "kvm" on older systems, or those where
the VFIO driver hasn't been loaded <span class="since">Since 1.1.3</span> (prior to that the
default was always "kvm").</p>
</dd>
<dt><span class="docutils literal">readonly</span></dt>
<dd><p>Indicates that the device is readonly, only supported by SCSI host device
now. <span class="since">Since 1.0.6 (QEMU and KVM only)</span></p>
</dd>
<dt><span class="docutils literal">shareable</span></dt>
<dd><p>If present, this indicates the device is expected to be shared between
domains (assuming the hypervisor and OS support this). Only supported by SCSI
host device. <span class="since">Since 1.0.6</span></p>
<p>Note: Although <span class="docutils literal">shareable</span> was introduced <span class="since">in 1.0.6</span> , it did not
work as as expected until <span class="since">1.2.2</span> .</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsHostDevCaps"/></span></p>
</div>
<div class="section" id="block-character-devices">
<h4><a class="toc-backref" href="formatdomain.html#id35">Block / character devices</a><a class="headerlink" href="formatdomain.html#block-character-devices" title="Link to this headline">¶</a></h4>
<p>Block / character devices from the host can be passed through to the guest using
the <span class="docutils literal">hostdev</span> element. This is only possible with container based
virtualization. Devices are specified by a fully qualified path. <span class="since">since
after 1.0.1 for LXC</span> :</p>
<pre class="literal-block">...
&lt;hostdev mode='capabilities' type='storage'&gt;
  &lt;source&gt;
    &lt;block&gt;/dev/sdf1&lt;/block&gt;
  &lt;/source&gt;
&lt;/hostdev&gt;
...</pre>
<pre class="literal-block">...
&lt;hostdev mode='capabilities' type='misc'&gt;
  &lt;source&gt;
    &lt;char&gt;/dev/input/event3&lt;/char&gt;
  &lt;/source&gt;
&lt;/hostdev&gt;
...</pre>
<pre class="literal-block">...
&lt;hostdev mode='capabilities' type='net'&gt;
  &lt;source&gt;
    &lt;interface&gt;eth0&lt;/interface&gt;
  &lt;/source&gt;
&lt;/hostdev&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">hostdev</span></dt>
<dd><p>The <span class="docutils literal">hostdev</span> element is the main container for describing host devices.
For block/character device passthrough <span class="docutils literal">mode</span> is always "capabilities" and
<span class="docutils literal">type</span> is "storage" for a block device, "misc" for a character device and
"net" for a host network interface.</p>
</dd>
<dt><span class="docutils literal">source</span></dt>
<dd><p>The source element describes the device as seen from the host. For block
devices, the path to the block device in the host OS is provided in the
nested "block" element, while for character devices the "char" element is
used. For network interfaces, the name of the interface is provided in the
"interface" element.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsRedir"/></span></p>
</div>
</div>
<div class="section" id="redirected-devices">
<h3><a class="toc-backref" href="formatdomain.html#id36">Redirected devices</a><a class="headerlink" href="formatdomain.html#redirected-devices" title="Link to this headline">¶</a></h3>
<p>USB device redirection through a character device is supported <span class="since">since
after 0.9.5 (KVM only)</span> :</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;redirdev bus='usb' type='spicevmc'/&gt;
  &lt;redirdev bus='usb' type='tcp'&gt;
    &lt;source mode='connect' host='localhost' service='4000'/&gt;
    &lt;boot order='1'/&gt;
  &lt;/redirdev&gt;
  &lt;redirfilter&gt;
    &lt;usbdev class='0x08' vendor='0x1234' product='0xbeef' version='2.56' allow='yes'/&gt;
    &lt;usbdev allow='no'/&gt;
  &lt;/redirfilter&gt;
&lt;/devices&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">redirdev</span></dt>
<dd><p>The <span class="docutils literal">redirdev</span> element is the main container for describing redirected
devices. <span class="docutils literal">bus</span> must be "usb" for a USB device. An additional attribute
<span class="docutils literal">type</span> is required, matching one of the supported <a class="reference external" href="formatdomain.html#elementsConsole">serial
device</a> types, to describe the host side of the tunnel;
<span class="docutils literal"><span class="pre">type='tcp'</span></span> or <span class="docutils literal"><span class="pre">type='spicevmc'</span></span> (which uses the usbredir channel of a
<a class="reference external" href="formatdomain.html#elementsGraphics">SPICE graphics device</a>) are typical. The redirdev
element has an optional sub-element <span class="docutils literal">&lt;address&gt;</span> which can tie the device to
a particular controller. Further sub-elements, such as <span class="docutils literal">&lt;source&gt;</span>, may be
required according to the given type, although a <span class="docutils literal">&lt;target&gt;</span> sub-element is
not required (since the consumer of the character device is the hypervisor
itself, rather than a device visible in the guest).</p>
</dd>
<dt><span class="docutils literal">boot</span></dt>
<dd><p>Specifies that the device is bootable. The <span class="docutils literal">order</span> attribute determines the
order in which devices will be tried during boot sequence. The per-device
<span class="docutils literal">boot</span> elements cannot be used together with general boot elements in <a class="reference external" href="formatdomain.html#elementsOSBIOS">BIOS
bootloader</a> section. ( <span class="since">Since 1.0.1</span> )</p>
</dd>
<dt><span class="docutils literal">redirfilter</span></dt>
<dd><p>The<span class="docutils literal">redirfilter</span>element is used for creating the filter rule to filter
out certain devices from redirection. It uses sub-element <span class="docutils literal">&lt;usbdev&gt;</span> to
define each filter rule. <span class="docutils literal">class</span> attribute is the USB Class code, for
example, 0x08 represents mass storage devices. The USB device can be
addressed by vendor / product id using the <span class="docutils literal">vendor</span> and <span class="docutils literal">product</span>
attributes. <span class="docutils literal">version</span> is the device revision from the bcdDevice field (not
the version of the USB protocol). These four attributes are optional and
<span class="docutils literal"><span class="pre">-1</span></span> can be used to allow any value for them. <span class="docutils literal">allow</span> attribute is
mandatory, 'yes' means allow, 'no' for deny.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsSmartcard"/></span></p>
</div>
<div class="section" id="smartcard-devices">
<h3><a class="toc-backref" href="formatdomain.html#id37">Smartcard devices</a><a class="headerlink" href="formatdomain.html#smartcard-devices" title="Link to this headline">¶</a></h3>
<p>A virtual smartcard device can be supplied to the guest via the <span class="docutils literal">smartcard</span>
element. A USB smartcard reader device on the host cannot be used on a guest
with simple device passthrough, since it will then not be available on the host,
possibly locking the host computer when it is "removed". Therefore, some
hypervisors provide a specialized virtual device that can present a smartcard
interface to the guest, with several modes for describing how credentials are
obtained from the host or even a from a channel created to a third-party
smartcard provider. <span class="since">Since 0.8.8</span></p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;smartcard mode='host'/&gt;
  &lt;smartcard mode='host-certificates'&gt;
    &lt;certificate&gt;cert1&lt;/certificate&gt;
    &lt;certificate&gt;cert2&lt;/certificate&gt;
    &lt;certificate&gt;cert3&lt;/certificate&gt;
    &lt;database&gt;/etc/pki/nssdb/&lt;/database&gt;
  &lt;/smartcard&gt;
  &lt;smartcard mode='passthrough' type='tcp'&gt;
    &lt;source mode='bind' host='127.0.0.1' service='2001'/&gt;
    &lt;protocol type='raw'/&gt;
    &lt;address type='ccid' controller='0' slot='0'/&gt;
  &lt;/smartcard&gt;
  &lt;smartcard mode='passthrough' type='spicevmc'/&gt;
&lt;/devices&gt;
...</pre>
<p>The <span class="docutils literal">&lt;smartcard&gt;</span> element has a mandatory attribute <span class="docutils literal">mode</span>. The following
modes are supported; in each mode, the guest sees a device on its USB bus that
behaves like a physical USB CCID (Chip/Smart Card Interface Device) card.</p>
<dl class="simple">
<dt><span class="docutils literal">host</span></dt>
<dd><p>The simplest operation, where the hypervisor relays all requests from the
guest into direct access to the host's smartcard via NSS. No other attributes
or sub-elements are required. See below about the use of an optional
<span class="docutils literal">&lt;address&gt;</span> sub-element.</p>
</dd>
<dt><span class="docutils literal"><span class="pre">host-certificates</span></span></dt>
<dd><p>Rather than requiring a smartcard to be plugged into the host, it is possible
to provide three NSS certificate names residing in a database on the host.
These certificates can be generated via the command
<span class="docutils literal">certutil <span class="pre">-d</span> /etc/pki/nssdb <span class="pre">-x</span> <span class="pre">-t</span>       CT,CT,CT <span class="pre">-S</span> <span class="pre">-s</span> CN=cert1 <span class="pre">-n</span> cert1</span>,
and the resulting three certificate names must be supplied as the content of
each of three <span class="docutils literal">&lt;certificate&gt;</span> sub-elements. An additional sub-element
<span class="docutils literal">&lt;database&gt;</span> can specify the absolute path to an alternate directory
(matching the <span class="docutils literal"><span class="pre">-d</span></span> option of the <span class="docutils literal">certutil</span> command when creating the
certificates); if not present, it defaults to /etc/pki/nssdb.</p>
</dd>
<dt><span class="docutils literal">passthrough</span></dt>
<dd><p>Rather than having the hypervisor directly communicate with the host, it is
possible to tunnel all requests through a secondary character device to a
third-party provider (which may in turn be talking to a smartcard or using
three certificate files). In this mode of operation, an additional attribute
<span class="docutils literal">type</span> is required, matching one of the supported <a class="reference external" href="formatdomain.html#elementsConsole">serial
device</a> types, to describe the host side of the tunnel;
<span class="docutils literal"><span class="pre">type='tcp'</span></span> or <span class="docutils literal"><span class="pre">type='spicevmc'</span></span> (which uses the smartcard channel of a
<a class="reference external" href="formatdomain.html#elementsGraphics">SPICE graphics device</a>) are typical. Further
sub-elements, such as <span class="docutils literal">&lt;source&gt;</span>, may be required according to the given
type, although a <span class="docutils literal">&lt;target&gt;</span> sub-element is not required (since the consumer
of the character device is the hypervisor itself, rather than a device
visible in the guest).</p>
</dd>
</dl>
<p>Each mode supports an optional sub-element <span class="docutils literal">&lt;address&gt;</span>, which fine-tunes the
correlation between the smartcard and a ccid bus controller, <a class="reference external" href="formatdomain.html#elementsAddress">documented
above</a>. For now, qemu only supports at most one smartcard,
with an address of bus=0 slot=0.</p>
<p><span class="anchor"><a id="elementsNICS"/></span></p>
</div>
<div class="section" id="network-interfaces">
<h3><a class="toc-backref" href="formatdomain.html#id38">Network interfaces</a><a class="headerlink" href="formatdomain.html#network-interfaces" title="Link to this headline">¶</a></h3>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='direct' trustGuestRxFilters='yes'&gt;
    &lt;source dev='eth0'/&gt;
    &lt;mac address='52:54:00:5d:c7:9e'/&gt;
    &lt;boot order='1'/&gt;
    &lt;rom bar='off'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>There are several possibilities for specifying a network interface visible to
the guest. Each subsection below provides more details about common setup
options.</p>
<p><span class="since">Since 1.2.10</span> ), the <span class="docutils literal">interface</span> element property
<span class="docutils literal">trustGuestRxFilters</span> provides the capability for the host to detect and trust
reports from the guest regarding changes to the interface mac address and
receive filters by setting the attribute to <span class="docutils literal">yes</span>. The default setting for the
attribute is <span class="docutils literal">no</span> for security reasons and support depends on the guest
network device model as well as the type of connection on the host - currently
it is only supported for the virtio device model and for macvtap connections on
the host.</p>
<p>Each <span class="docutils literal">&lt;interface&gt;</span> element has an optional <span class="docutils literal">&lt;address&gt;</span> sub-element that can
tie the interface to a particular pci slot, with attribute <span class="docutils literal"><span class="pre">type='pci'</span></span> as
<a class="reference external" href="formatdomain.html#elementsAddress">documented above</a>.</p>
<p><span class="since">Since 6.6.0</span> , one can force libvirt to keep the provided MAC address
when it's in the reserved VMware range by adding a <span class="docutils literal"><span class="pre">type="static"</span></span> attribute
to the <span class="docutils literal">&lt;mac/&gt;</span> element. Note that this attribute is useless if the provided
MAC address is outside of the reserved VMWare ranges.</p>
<p><span class="anchor"><a id="elementsNICSVirtual"/></span></p>
<div class="section" id="virtual-network">
<h4><a class="toc-backref" href="formatdomain.html#id39">Virtual network</a><a class="headerlink" href="formatdomain.html#virtual-network" title="Link to this headline">¶</a></h4>
<p><strong>This is the recommended config for general guest connectivity on hosts with
dynamic / wireless networking configs.</strong> (or multi-host environments where the
host hardware details are described separately in a <span class="docutils literal">&lt;network&gt;</span> definition
<span class="since">Since 0.9.4</span> ).</p>
<p>Provides a connection whose details are described by the named network
definition. Depending on the virtual network's "forward mode" configuration, the
network may be totally isolated (no <span class="docutils literal">&lt;forward&gt;</span> element given), NAT'ing to an
explicit network device or to the default route (<span class="docutils literal">&lt;forward <span class="pre">mode='nat'&gt;</span></span>),
routed with no NAT (<span class="docutils literal">&lt;forward <span class="pre">mode='route'/&gt;</span></span>), or connected directly to one
of the host's network interfaces (via macvtap) or bridge devices
((<span class="docutils literal">&lt;forward       <span class="pre">mode='bridge|private|vepa|passthrough'/&gt;</span></span> <span class="since">Since
0.9.4</span> )</p>
<p>For networks with a forward mode of bridge, private, vepa, and passthrough, it
is assumed that the host has any necessary DNS and DHCP services already setup
outside the scope of libvirt. In the case of isolated, nat, and routed networks,
DHCP and DNS are provided on the virtual network by libvirt, and the IP range
can be determined by examining the virtual network config with
'<span class="docutils literal">virsh <span class="pre">net-dumpxml</span> [networkname]</span>'. There is one virtual network called
'default' setup out of the box which does NAT'ing to the default route and has
an IP range of <span class="docutils literal">192.168.122.0/255.255.255.0</span>. Each guest will have an
associated tun device created with a name of vnetN, which can also be overridden
with the &lt;target&gt; element (see <a class="reference external" href="formatdomain.html#elementsNICSTargetOverride">overriding the target
element</a>).</p>
<p>When the source of an interface is a network, a <span class="docutils literal">portgroup</span> can be specified
along with the name of the network; one network may have multiple portgroups
defined, with each portgroup containing slightly different configuration
information for different classes of network connections. <span class="since">Since 0.9.4</span> .</p>
<p>When a guest is running an interface of type <span class="docutils literal">network</span> may include a
<span class="docutils literal">portid</span> attribute. This provides the UUID of an associated virNetworkPortPtr
object that records the association between the domain interface and the
network. This attribute is read-only since port objects are create and deleted
automatically during startup and shutdown. <span class="since">Since 5.1.0</span></p>
<p>Also, similar to <span class="docutils literal">direct</span> network connections (described below), a connection
of type <span class="docutils literal">network</span> may specify a <span class="docutils literal">virtualport</span> element, with configuration
data to be forwarded to a vepa (802.1Qbg) or 802.1Qbh compliant switch (
<span class="since">Since 0.8.2</span> ), or to an Open vSwitch virtual switch ( <span class="since">Since
0.9.11</span> ).</p>
<p>Since the actual type of switch may vary depending on the configuration in the
<span class="docutils literal">&lt;network&gt;</span> on the host, it is acceptable to omit the virtualport <span class="docutils literal">type</span>
attribute, and specify attributes from multiple different virtualport types (and
also to leave out certain attributes); at domain startup time, a complete
<span class="docutils literal">&lt;virtualport&gt;</span> element will be constructed by merging together the type and
attributes defined in the network and the portgroup referenced by the interface.
The newly-constructed virtualport is a combination of them. The attributes from
lower virtualport can't make change on the ones defined in higher virtualport.
Interface takes the highest priority, portgroup is lowest priority. (
<span class="since">Since 0.10.0</span> ). For example, in order to work properly with both an
802.1Qbh switch and an Open vSwitch switch, you may choose to specify no type,
but both a <span class="docutils literal">profileid</span> (in case the switch is 802.1Qbh) and an <span class="docutils literal">interfaceid</span>
(in case the switch is Open vSwitch) (you may also omit the other attributes,
such as managerid, typeid, or profileid, to be filled in from the network's
<span class="docutils literal">&lt;virtualport&gt;</span>). If you want to limit a guest to connecting only to certain
types of switches, you can specify the virtualport type, but still omit some/all
of the parameters - in this case if the host's network has a different type of
virtualport, connection of the interface will fail.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
  &lt;/interface&gt;
  ...
  &lt;interface type='network'&gt;
    &lt;source network='default' portgroup='engineering'/&gt;
    &lt;target dev='vnet7'/&gt;
    &lt;mac address="00:11:22:33:44:55"/&gt;
    &lt;virtualport&gt;
      &lt;parameters instanceid='09b11c53-8b5c-4eeb-8f00-d84eaa0aaa4f'/&gt;
    &lt;/virtualport&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNICSBridge"/></span></p>
</div>
<div class="section" id="bridge-to-lan">
<h4><a class="toc-backref" href="formatdomain.html#id40">Bridge to LAN</a><a class="headerlink" href="formatdomain.html#bridge-to-lan" title="Link to this headline">¶</a></h4>
<p><strong>This is the recommended config for general guest connectivity on hosts with
static wired networking configs.</strong></p>
<p>Provides a bridge from the VM directly to the LAN. This assumes there is a
bridge device on the host which has one or more of the hosts physical NICs
attached. The guest VM will have an associated tun device created with a name of
vnetN, which can also be overridden with the &lt;target&gt; element (see <a class="reference external" href="formatdomain.html#elementsNICSTargetOverride">overriding
the target element</a>). The tun device will be
attached to the bridge. The IP range / network configuration is whatever is used
on the LAN. This provides the guest VM full incoming &amp; outgoing net access just
like a physical machine.</p>
<p>On Linux systems, the bridge device is normally a standard Linux host bridge. On
hosts that support Open vSwitch, it is also possible to connect to an Open
vSwitch bridge device by adding a <span class="docutils literal">&lt;virtualport <span class="pre">type='openvswitch'/&gt;</span></span> to the
interface definition. ( <span class="since">Since 0.9.11</span> ). The Open vSwitch type
virtualport accepts two parameters in its <span class="docutils literal">&lt;parameters&gt;</span> element - an
<span class="docutils literal">interfaceid</span> which is a standard uuid used to uniquely identify this
particular interface to Open vSwitch (if you do not specify one, a random
interfaceid will be generated for you when you first define the interface), and
an optional <span class="docutils literal">profileid</span> which is sent to Open vSwitch as the interfaces
"port-profile".</p>
<pre class="literal-block">...
&lt;devices&gt;
  ...
  &lt;interface type='bridge'&gt;
    &lt;source bridge='br0'/&gt;
  &lt;/interface&gt;
  &lt;interface type='bridge'&gt;
    &lt;source bridge='br1'/&gt;
    &lt;target dev='vnet7'/&gt;
    &lt;mac address="00:11:22:33:44:55"/&gt;
  &lt;/interface&gt;
  &lt;interface type='bridge'&gt;
    &lt;source bridge='ovsbr'/&gt;
    &lt;virtualport type='openvswitch'&gt;
      &lt;parameters profileid='menial' interfaceid='09b11c53-8b5c-4eeb-8f00-d84eaa0aaa4f'/&gt;
    &lt;/virtualport&gt;
  &lt;/interface&gt;
  ...
&lt;/devices&gt;
...</pre>
<p>On hosts that support Open vSwitch on the kernel side and have the Midonet Host
Agent configured, it is also possible to connect to the 'midonet' bridge device
by adding a <span class="docutils literal">&lt;virtualport <span class="pre">type='midonet'/&gt;</span></span> to the interface definition. (
<span class="since">Since 1.2.13</span> ). The Midonet virtualport type requires an
<span class="docutils literal">interfaceid</span> attribute in its <span class="docutils literal">&lt;parameters&gt;</span> element. This interface id is
the UUID that specifies which port in the virtual network topology will be bound
to the interface.</p>
<pre class="literal-block">...
&lt;devices&gt;
  ...
  &lt;interface type='bridge'&gt;
    &lt;source bridge='br0'/&gt;
  &lt;/interface&gt;
  &lt;interface type='bridge'&gt;
    &lt;source bridge='br1'/&gt;
    &lt;target dev='vnet7'/&gt;
    &lt;mac address="00:11:22:33:44:55"/&gt;
  &lt;/interface&gt;
  &lt;interface type='bridge'&gt;
    &lt;source bridge='midonet'/&gt;
    &lt;virtualport type='midonet'&gt;
      &lt;parameters interfaceid='0b2d64da-3d0e-431e-afdd-804415d6ebbb'/&gt;
    &lt;/virtualport&gt;
  &lt;/interface&gt;
  ...
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNICSSlirp"/></span></p>
</div>
<div class="section" id="userspace-slirp-stack">
<h4><a class="toc-backref" href="formatdomain.html#id41">Userspace SLIRP stack</a><a class="headerlink" href="formatdomain.html#userspace-slirp-stack" title="Link to this headline">¶</a></h4>
<p>Provides a virtual LAN with NAT to the outside world. The virtual network has
DHCP &amp; DNS services and will give the guest VM addresses starting from
<span class="docutils literal">10.0.2.15</span>. The default router will be <span class="docutils literal">10.0.2.2</span> and the DNS server will
be <span class="docutils literal">10.0.2.3</span>. This networking is the only option for unprivileged users who
need their VMs to have outgoing access. <span class="since">Since 3.8.0</span> it is possible to
override the default network address by including an <span class="docutils literal">ip</span> element specifying
an IPv4 address in its one mandatory attribute, <span class="docutils literal">address</span>. Optionally, a
second <span class="docutils literal">ip</span> element with a <span class="docutils literal">family</span> attribute set to "ipv6" can be specified
to add an IPv6 address to the interface. <span class="docutils literal">address</span>. Optionally, address
<span class="docutils literal">prefix</span> can be specified.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='user'/&gt;
  ...
  &lt;interface type='user'&gt;
    &lt;mac address="00:11:22:33:44:55"/&gt;
    &lt;ip family='ipv4' address='172.17.2.0' prefix='24'/&gt;
    &lt;ip family='ipv6' address='2001:db8:ac10:fd01::' prefix='64'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNICSEthernet"/></span></p>
</div>
<div class="section" id="generic-ethernet-connection">
<h4><a class="toc-backref" href="formatdomain.html#id42">Generic ethernet connection</a><a class="headerlink" href="formatdomain.html#generic-ethernet-connection" title="Link to this headline">¶</a></h4>
<p>Provides a means to use a new or existing tap device (or veth device pair,
depending on the needs of the hypervisor driver) that is partially or wholly
setup external to libvirt (either prior to the guest starting, or while the
guest is being started via an optional script specified in the config).</p>
<p>The name of the tap device can optionally be specified with the <span class="docutils literal">dev</span>
attribute of the <span class="docutils literal">&lt;target&gt;</span> element. If no target dev is specified, libvirt
will create a new standard tap device with a name of the pattern "vnetN", where
"N" is replaced with a number. If a target dev is specified and that device
doesn't exist, then a new standard tap device will be created with the exact dev
name given. If the specified target dev does exist, then that existing device
will be used. Usually some basic setup of the device is done by libvirt,
including setting a MAC address, and the IFF_UP flag, but if the <span class="docutils literal">dev</span> is a
pre-existing device, and the <span class="docutils literal">managed</span> attribute of the <span class="docutils literal">target</span> element is
also set to "no" (the default value is "yes"), even this basic setup will not be
performed - libvirt will simply pass the device on to the hypervisor with no
setup at all. <span class="since">Since 5.7.0</span> Using managed='no' with a pre-created tap
device is useful because it permits a virtual machine managed by an unprivileged
libvirtd to have emulated network devices based on tap devices.</p>
<p>After creating/opening the tap device, an optional shell script (given in the
<span class="docutils literal">path</span> attribute of the <span class="docutils literal">&lt;script&gt;</span> element) will be run. <span class="since">Since
0.2.1</span> Also, after detaching/closing the tap device, an optional shell script
(given in the <span class="docutils literal">path</span> attribute of the <span class="docutils literal">&lt;downscript&gt;</span> element) will be run.
<span class="since">Since 6.4.0</span> These can be used to do whatever extra host network
integration is required.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='ethernet'&gt;
    &lt;script path='/etc/qemu-ifup-mynet'/&gt;
    &lt;downscript path='/etc/qemu-ifdown-mynet'/&gt;
  &lt;/interface&gt;
  ...
  &lt;interface type='ethernet'&gt;
    &lt;target dev='mytap1' managed='no'/&gt;
    &lt;model type='virtio'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNICSDirect"/></span></p>
</div>
<div class="section" id="direct-attachment-to-physical-interface">
<h4><a class="toc-backref" href="formatdomain.html#id43">Direct attachment to physical interface</a><a class="headerlink" href="formatdomain.html#direct-attachment-to-physical-interface" title="Link to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Provides direct attachment of the virtual machine's NIC to the given physical
interface of the host. <span class="since">Since 0.7.7 (QEMU and KVM only)</span></div>
<div class="line">This setup requires the Linux macvtap driver to be available. <span class="since">(Since
Linux 2.6.34.)</span> One of the modes 'vepa' ( <a class="reference external" href="https://www.ieee802.org/1/files/public/docs2009/new-evb-congdon-vepa-modular-0709-v01.pdf">'Virtual Ethernet Port
Aggregator'</a>),
'bridge' or 'private' can be chosen for the operation mode of the macvtap
device, 'vepa' being the default mode. The individual modes cause the delivery
of packets to behave as follows:</div>
</div>
<p>If the model type is set to <span class="docutils literal">virtio</span> and interface's <span class="docutils literal">trustGuestRxFilters</span>
attribute is set to <span class="docutils literal">yes</span>, changes made to the interface mac address,
unicast/multicast receive filters, and vlan settings in the guest will be
monitored and propagated to the associated macvtap device on the host (
<span class="since">Since 1.2.10</span> ). If <span class="docutils literal">trustGuestRxFilters</span> is not set, or is not
supported for the device model in use, an attempted change to the mac address
originating from the guest side will result in a non-working network connection.</p>
<dl class="simple">
<dt><span class="docutils literal">vepa</span></dt>
<dd><p>All VMs' packets are sent to the external bridge. Packets whose destination
is a VM on the same host as where the packet originates from are sent back to
the host by the VEPA capable bridge (today's bridges are typically not VEPA
capable).</p>
</dd>
<dt><span class="docutils literal">bridge</span></dt>
<dd><p>Packets whose destination is on the same host as where they originate from
are directly delivered to the target macvtap device. Both origin and
destination devices need to be in bridge mode for direct delivery. If either
one of them is in <span class="docutils literal">vepa</span> mode, a VEPA capable bridge is required.</p>
</dd>
<dt><span class="docutils literal">private</span></dt>
<dd><p>All packets are sent to the external bridge and will only be delivered to a
target VM on the same host if they are sent through an external router or
gateway and that device sends them back to the host. This procedure is
followed if either the source or destination device is in <span class="docutils literal">private</span> mode.</p>
</dd>
<dt><span class="docutils literal">passthrough</span></dt>
<dd><p>This feature attaches a virtual function of a SRIOV capable NIC directly to a
VM without losing the migration capability. All packets are sent to the VF/IF
of the configured network device. Depending on the capabilities of the device
additional prerequisites or limitations may apply; for example, on Linux this
requires kernel 2.6.38 or newer. <span class="since">Since 0.9.2</span></p>
</dd>
</dl>
<pre class="literal-block">...
&lt;devices&gt;
  ...
  &lt;interface type='direct' trustGuestRxFilters='no'&gt;
    &lt;source dev='eth0' mode='vepa'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>The network access of direct attached virtual machines can be managed by the
hardware switch to which the physical interface of the host machine is connected
to.</p>
<p>The interface can have additional parameters as shown below, if the switch is
conforming to the IEEE 802.1Qbg standard. The parameters of the virtualport
element are documented in more detail in the IEEE 802.1Qbg standard. The values
are network specific and should be provided by the network administrator. In
802.1Qbg terms, the Virtual Station Interface (VSI) represents the virtual
interface of a virtual machine. <span class="since">Since 0.8.2</span></p>
<p>Please note that IEEE 802.1Qbg requires a non-zero value for the VLAN ID.</p>
<dl class="simple">
<dt><span class="docutils literal">managerid</span></dt>
<dd><p>The VSI Manager ID identifies the database containing the VSI type and
instance definitions. This is an integer value and the value 0 is reserved.</p>
</dd>
<dt><span class="docutils literal">typeid</span></dt>
<dd><p>The VSI Type ID identifies a VSI type characterizing the network access. VSI
types are typically managed by network administrator. This is an integer
value.</p>
</dd>
<dt><span class="docutils literal">typeidversion</span></dt>
<dd><p>The VSI Type Version allows multiple versions of a VSI Type. This is an
integer value.</p>
</dd>
<dt><span class="docutils literal">instanceid</span></dt>
<dd><p>The VSI Instance ID Identifier is generated when a VSI instance (i.e. a
virtual interface of a virtual machine) is created. This is a globally unique
identifier.</p>
</dd>
</dl>
<pre class="literal-block">...
&lt;devices&gt;
  ...
  &lt;interface type='direct'&gt;
    &lt;source dev='eth0.2' mode='vepa'/&gt;
    &lt;virtualport type="802.1Qbg"&gt;
      &lt;parameters managerid="11" typeid="1193047" typeidversion="2" instanceid="09b11c53-8b5c-4eeb-8f00-d84eaa0aaa4f"/&gt;
    &lt;/virtualport&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>The interface can have additional parameters as shown below if the switch is
conforming to the IEEE 802.1Qbh standard. The values are network specific and
should be provided by the network administrator. <span class="since">Since 0.8.2</span></p>
<dl class="simple">
<dt><span class="docutils literal">profileid</span></dt>
<dd><p>The profile ID contains the name of the port profile that is to be applied to
this interface. This name is resolved by the port profile database into the
network parameters from the port profile, and those network parameters will
be applied to this interface.</p>
</dd>
</dl>
<pre class="literal-block">...
&lt;devices&gt;
  ...
  &lt;interface type='direct'&gt;
    &lt;source dev='eth0' mode='private'/&gt;
    &lt;virtualport type='802.1Qbh'&gt;
      &lt;parameters profileid='finance'/&gt;
    &lt;/virtualport&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNICSHostdev"/></span></p>
</div>
<div class="section" id="pci-passthrough">
<h4><a class="toc-backref" href="formatdomain.html#id44">PCI Passthrough</a><a class="headerlink" href="formatdomain.html#pci-passthrough" title="Link to this headline">¶</a></h4>
<p>A PCI network device (specified by the &lt;source&gt; element) is directly assigned to
the guest using generic device passthrough, after first optionally setting the
device's MAC address to the configured value, and associating the device with an
802.1Qbh capable switch using an optionally specified &lt;virtualport&gt; element (see
the examples of virtualport given above for type='direct' network devices). Note
that - due to limitations in standard single-port PCI ethernet card driver
design - only SR-IOV (Single Root I/O Virtualization) virtual function (VF)
devices can be assigned in this manner; to assign a standard single-port PCI or
PCIe ethernet card to a guest, use the traditional &lt;hostdev&gt; device definition
and <span class="since">Since 0.9.11</span></p>
<p>To use VFIO device assignment rather than traditional/legacy KVM device
assignment (VFIO is a new method of device assignment that is compatible with
UEFI Secure Boot), a type='hostdev' interface can have an optional <span class="docutils literal">driver</span>
sub-element with a <span class="docutils literal">name</span> attribute set to "vfio". To use legacy KVM device
assignment you can set <span class="docutils literal">name</span> to "kvm" (or simply omit the <span class="docutils literal">&lt;driver&gt;</span>
element, since "kvm" is currently the default). <span class="since">Since 1.0.5 (QEMU and
KVM only, requires kernel 3.6 or newer)</span></p>
<p>Note that this "intelligent passthrough" of network devices is very similar to
the functionality of a standard &lt;hostdev&gt; device, the difference being that this
method allows specifying a MAC address and &lt;virtualport&gt; for the passed-through
device. If these capabilities are not required, if you have a standard
single-port PCI, PCIe, or USB network card that doesn't support SR-IOV (and
hence would anyway lose the configured MAC address during reset after being
assigned to the guest domain), or if you are using a version of libvirt older
than 0.9.11, you should use standard &lt;hostdev&gt; to assign the device to the guest
instead of &lt;interface type='hostdev'/&gt;.</p>
<p>Similar to the functionality of a standard &lt;hostdev&gt; device, when <span class="docutils literal">managed</span> is
"yes", it is detached from the host before being passed on to the guest, and
reattached to the host after the guest exits. If <span class="docutils literal">managed</span> is omitted or "no",
the user is responsible to call <span class="docutils literal">virNodeDeviceDettach</span> (or
<span class="docutils literal">virsh <span class="pre">nodedev-detach</span></span>) before starting the guest or hot-plugging the device,
and <span class="docutils literal">virNodeDeviceReAttach</span> (or <span class="docutils literal">virsh <span class="pre">nodedev-reattach</span></span>) after hot-unplug
or stopping the guest.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='hostdev' managed='yes'&gt;
    &lt;driver name='vfio'/&gt;
    &lt;source&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07' function='0x0'/&gt;
    &lt;/source&gt;
    &lt;mac address='52:54:00:6d:90:02'/&gt;
    &lt;virtualport type='802.1Qbh'&gt;
      &lt;parameters profileid='finance'/&gt;
    &lt;/virtualport&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNICSVDPA"/></span></p>
</div>
<div class="section" id="vdpa-devices">
<h4><a class="toc-backref" href="formatdomain.html#id45">vDPA devices</a><a class="headerlink" href="formatdomain.html#vdpa-devices" title="Link to this headline">¶</a></h4>
<p>A vDPA network device can be used to provide wire speed network performance
within a domain. A vDPA device is a specialized type of network device that
uses a datapath that complies with the virtio specification but has a
vendor-specific control path.  To use such a device with libvirt, the host
device must already be bound to the appropriate device-specific vDPA driver.
This creates a vDPA char device (e.g. /dev/vhost-vdpa-0) that can be used to
assign the device to a libvirt domain.  <span class="since">Since 6.9.0 (QEMU only,
requires QEMU 5.1.0 or newer)</span></p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='vdpa'&gt;
    &lt;source dev='/dev/vhost-vdpa-0'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsTeaming"/></span></p>
</div>
<div class="section" id="teaming-a-virtio-hostdev-nic-pair">
<h4><a class="toc-backref" href="formatdomain.html#id46">Teaming a virtio/hostdev NIC pair</a><a class="headerlink" href="formatdomain.html#teaming-a-virtio-hostdev-nic-pair" title="Link to this headline">¶</a></h4>
<p><span class="since">Since 6.1.0 (QEMU and KVM only, requires QEMU 4.2.0 or newer and a guest
virtio-net driver supporting the "failover" feature, such as the one included in
Linux kernel 4.18 and newer) ` The ``&lt;teaming&gt;`</span> element of two interfaces can
be used to connect them as a team/bond device in the guest (assuming proper
support in the hypervisor and the guest network driver).</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='mybridge'/&gt;
    &lt;mac address='00:11:22:33:44:55'/&gt;
    &lt;model type='virtio'/&gt;
    &lt;teaming type='persistent'/&gt;
    &lt;alias name='ua-backup0'/&gt;
  &lt;/interface&gt;
  &lt;interface type='network'&gt;
    &lt;source network='hostdev-pool'/&gt;
    &lt;mac address='00:11:22:33:44:55'/&gt;
    &lt;model type='virtio'/&gt;
    &lt;teaming type='transient' persistent='ua-backup0'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>The second interface in this example is referencing a network that is
a pool of SRIOV VFs (i.e. a "hostdev network"). You could instead
directly reference an SRIOV VF device:</p>
<pre class="literal-block">...
  &lt;interface type='hostdev'&gt;
    &lt;source&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07' function='0x0'/&gt;
    &lt;/source&gt;
    &lt;mac address='00:11:22:33:44:55:66'/&gt;
    &lt;teaming type='transient' persistent='ua-backup0'/&gt;
  &lt;/interface&gt;
...</pre>
<p>The <span class="docutils literal">&lt;teaming&gt;</span> element required attribute <span class="docutils literal">type</span> will be set to either
<span class="docutils literal">"persistent"</span> to indicate a device that should always be present in the
domain, or <span class="docutils literal">"transient"</span> to indicate a device that may periodically be
removed, then later re-added to the domain. When type="transient", there should
be a second attribute to <span class="docutils literal">&lt;teaming&gt;</span> called <span class="docutils literal">"persistent"</span> - this attribute
should be set to the alias name of the other device in the pair (the one that
has <span class="docutils literal">&lt;teaming       <span class="pre">type="persistent'/&gt;</span></span>).</p>
<p>In the particular case of QEMU, libvirt's <span class="docutils literal">&lt;teaming&gt;</span> element is used to setup
a virtio-net "failover" device pair. For this setup, the persistent device must
be an interface with <span class="docutils literal">&lt;model       <span class="pre">type="virtio"/&gt;</span></span>, and the transient device
must be <span class="docutils literal">&lt;interface <span class="pre">type='hostdev'/&gt;</span></span> (or <span class="docutils literal">&lt;interface <span class="pre">type='network'/&gt;</span></span>
where the referenced network defines a pool of SRIOV VFs). The guest will then
have a simple network team/bond device made of the virtio NIC + hostdev NIC
pair. In this configuration, the higher-performing hostdev NIC will normally be
preferred for all network traffic, but when the domain is migrated, QEMU will
automatically unplug the VF from the guest, and then hotplug a similar device
once migration is completed; while migration is taking place, network traffic
will use the virtio NIC. (Of course the emulated virtio NIC and the hostdev NIC
must be connected to the same subnet for bonding to work properly).</p>
<p><span class="since">Since 7.1.0</span> The <span class="docutils literal">&lt;teaming&gt;</span> element can also be added to a
plain <span class="docutils literal">&lt;hostdev&gt;</span> device.</p>
<pre class="literal-block">...
  &lt;hostdev mode='subsystem' type='pci' managed='no'&gt;
    &lt;source&gt;
      &lt;address domain='0x0000' bus='0x00' slot='0x07' function='0x0'/&gt;
    &lt;/source&gt;
    &lt;teaming type='transient' persistent='ua-backup0'/&gt;
  &lt;/hostdev&gt;
...</pre>
<p>This device must be a network device, but not necessarily an SRIOV
VF. Using plain <span class="docutils literal">&lt;hostdev&gt;</span> rather than <span class="docutils literal">&lt;interface <span class="pre">type='hostdev'&gt;</span></span> or <span class="docutils literal">&lt;interface <span class="pre">type='network'&gt;</span></span> is useful if the
device that will be assigned with VFIO is a standard NIC (not a VF) or
if libvirt doesn't have the necessary resources and privileges to set
the VF's MAC address (e.g. if libvirt is running unprivileged, or in a
container). This of course means that the user (or another
application) is responsible for setting the MAC address of the device
in a way such that it will survive guest driver initialization. For
standard NICs (i.e. not an SRIOV VF) this probably means that the
NIC's factory-programmed MAC address will need to be used for the
teaming pair (since any driver init in the guest will reset the MAC
back to factory). If it is an SRIOV VF, then its MAC address will need
to be set via the VF's PF, e.g. if you are going to use VF 2 of the PF
enp2s0f1, you would use something like this command:</p>
<pre class="literal-block">ip link set enp2s0f1 vf 2 mac 52:54:00:11:22:33</pre>
<p>NB1: Since you must know the alias name of the virtio NIC when configuring the
hostdev NIC, it will need to be manually set in the virtio NIC's configuration
(as with all other manually set alias names, this means it must start with
"ua-").</p>
<p>NB2: Currently the only implementation of the guest OS virtio-net driver
supporting virtio-net failover requires that the MAC addresses of the virtio and
hostdev NIC must match. Since that may not always be a requirement in the
future, libvirt doesn't enforce this limitation - it is up to the
person/management application that is creating the configuration to assure the
MAC addresses of the two devices match.</p>
<p>NB3: Since the PCI addresses of the SRIOV VFs on the hosts that are the source
and destination of the migration will almost certainly be different, either
higher level management software will need to modify the <span class="docutils literal">&lt;source&gt;</span> of the
hostdev NIC (<span class="docutils literal">&lt;interface <span class="pre">type='hostdev'&gt;</span></span>) at the start of migration, or (a
simpler solution) the configuration will need to use a libvirt "hostdev" virtual
network that maintains a pool of such devices, as is implied in the example's
use of the libvirt network named "hostdev-pool" - as long as the hostdev network
pools on both hosts have the same name, libvirt itself will take care of
allocating an appropriate device on both ends of the migration. Similarly the
XML for the virtio interface must also either work correctly unmodified on both
the source and destination of the migration (e.g. by connecting to the same
bridge device on both hosts, or by using the same virtual network), or the
management software must properly modify the interface XML during migration so
that the virtio device remains connected to the same network segment before and
after migration.</p>
<p><span class="anchor"><a id="elementsNICSMulticast"/></span></p>
</div>
<div class="section" id="multicast-tunnel">
<h4><a class="toc-backref" href="formatdomain.html#id47">Multicast tunnel</a><a class="headerlink" href="formatdomain.html#multicast-tunnel" title="Link to this headline">¶</a></h4>
<p>A multicast group is setup to represent a virtual network. Any VMs whose network
devices are in the same multicast group can talk to each other even across
hosts. This mode is also available to unprivileged users. There is no default
DNS or DHCP support and no outgoing network access. To provide outgoing network
access, one of the VMs should have a 2nd NIC which is connected to one of the
first 4 network types and do the appropriate routing. The multicast protocol is
compatible with that used by user mode linux guests too. The source address used
must be from the multicast address block.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='mcast'&gt;
    &lt;mac address='52:54:00:6d:90:01'/&gt;
    &lt;source address='230.0.0.1' port='5558'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNICSTCP"/></span></p>
</div>
<div class="section" id="tcp-tunnel">
<h4><a class="toc-backref" href="formatdomain.html#id48">TCP tunnel</a><a class="headerlink" href="formatdomain.html#tcp-tunnel" title="Link to this headline">¶</a></h4>
<p>A TCP client/server architecture provides a virtual network. One VM provides the
server end of the network, all other VMS are configured as clients. All network
traffic is routed between the VMs via the server. This mode is also available to
unprivileged users. There is no default DNS or DHCP support and no outgoing
network access. To provide outgoing network access, one of the VMs should have a
2nd NIC which is connected to one of the first 4 network types and do the
appropriate routing.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='server'&gt;
    &lt;mac address='52:54:00:22:c9:42'/&gt;
    &lt;source address='192.168.0.1' port='5558'/&gt;
  &lt;/interface&gt;
  ...
  &lt;interface type='client'&gt;
    &lt;mac address='52:54:00:8b:c9:51'/&gt;
    &lt;source address='192.168.0.1' port='5558'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNICSUDP"/></span></p>
</div>
<div class="section" id="udp-unicast-tunnel">
<h4><a class="toc-backref" href="formatdomain.html#id49">UDP unicast tunnel</a><a class="headerlink" href="formatdomain.html#udp-unicast-tunnel" title="Link to this headline">¶</a></h4>
<p>A UDP unicast architecture provides a virtual network which enables connections
between QEMU instances using QEMU's UDP infrastructure. The xml "source" address
is the endpoint address to which the UDP socket packets will be sent from the
host running QEMU. The xml "local" address is the address of the interface from
which the UDP socket packets will originate from the QEMU host. <span class="since">Since
1.2.20</span></p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='udp'&gt;
    &lt;mac address='52:54:00:22:c9:42'/&gt;
    &lt;source address='127.0.0.1' port='11115'&gt;
      &lt;local address='127.0.0.1' port='11116'/&gt;
    &lt;/source&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNICSModel"/></span></p>
</div>
<div class="section" id="setting-the-nic-model">
<h4><a class="toc-backref" href="formatdomain.html#id50">Setting the NIC model</a><a class="headerlink" href="formatdomain.html#setting-the-nic-model" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet1'/&gt;
    &lt;model type='ne2k_pci'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>For hypervisors which support this, you can set the model of emulated network
interface card.</p>
<p>The values for <span class="docutils literal">type</span> aren't defined specifically by libvirt, but by what the
underlying hypervisor supports (if any). For QEMU and KVM you can get a list of
supported models with these commands:</p>
<pre class="literal-block">qemu -net nic,model=? /dev/null
qemu-kvm -net nic,model=? /dev/null</pre>
<p>Typical values for QEMU and KVM include: ne2k_isa i82551 i82557b i82559er
ne2k_pci pcnet rtl8139 e1000 virtio. <span class="since">Since 5.2.0</span> ,
<span class="docutils literal"><span class="pre">virtio-transitional</span></span> and <span class="docutils literal"><span class="pre">virtio-non-transitional</span></span> values are supported.
See <a class="reference external" href="formatdomain.html#elementsVirtioTransitional">Virtio transitional devices</a> for more
details.</p>
<p><span class="anchor"><a id="elementsDriverBackendOptions"/></span></p>
</div>
<div class="section" id="setting-nic-driver-specific-options">
<h4><a class="toc-backref" href="formatdomain.html#id51">Setting NIC driver-specific options</a><a class="headerlink" href="formatdomain.html#setting-nic-driver-specific-options" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet1'/&gt;
    &lt;model type='virtio'/&gt;
    &lt;driver name='vhost' txmode='iothread' ioeventfd='on' event_idx='off' queues='5' rx_queue_size='256' tx_queue_size='256'&gt;
      &lt;host csum='off' gso='off' tso4='off' tso6='off' ecn='off' ufo='off' mrg_rxbuf='off'/&gt;
      &lt;guest csum='off' tso4='off' tso6='off' ecn='off' ufo='off'/&gt;
    &lt;/driver&gt;
    &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>Some NICs may have tunable driver-specific options. These are set as attributes
of the <span class="docutils literal">driver</span> sub-element of the interface definition. Currently the
following attributes are available for the <span class="docutils literal">"virtio"</span> NIC driver:</p>
<dl class="simple">
<dt><span class="docutils literal">name</span></dt>
<dd><p>The optional <span class="docutils literal">name</span> attribute forces which type of backend driver to use.
The value can be either 'qemu' (a user-space backend) or 'vhost' (a kernel
backend, which requires the vhost module to be provided by the kernel); an
attempt to require the vhost driver without kernel support will be rejected.
If this attribute is not present, then the domain defaults to 'vhost' if
present, but silently falls back to 'qemu' without error. <span class="since">Since 0.8.8
(QEMU and KVM only)</span>
For interfaces of type='hostdev' (PCI passthrough devices) the <span class="docutils literal">name</span>
attribute can optionally be set to "vfio" or "kvm". "vfio" tells libvirt to
use VFIO device assignment rather than traditional KVM device assignment
(VFIO is a new method of device assignment that is compatible with UEFI
Secure Boot), and "kvm" tells libvirt to use the legacy device assignment
performed directly by the kvm kernel module (the default is currently "kvm",
but is subject to change). <span class="since">Since 1.0.5 (QEMU and KVM only, requires
kernel 3.6 or newer)</span>
For interfaces of type='vhostuser', the <span class="docutils literal">name</span> attribute is ignored. The
backend driver used is always vhost-user.</p>
</dd>
<dt><span class="docutils literal">txmode</span></dt>
<dd><p>The <span class="docutils literal">txmode</span> attribute specifies how to handle transmission of packets when
the transmit buffer is full. The value can be either 'iothread' or 'timer'.
<span class="since">Since 0.8.8 (QEMU and KVM only)</span>
If set to 'iothread', packet tx is all done in an iothread in the bottom half
of the driver (this option translates into adding "tx=bh" to the qemu
commandline -device virtio-net-pci option).
If set to 'timer', tx work is done in qemu, and if there is more tx data than
can be sent at the present time, a timer is set before qemu moves on to do
other things; when the timer fires, another attempt is made to send more
data.
The resulting difference, according to the qemu developer who added the
option is: "bh makes tx more asynchronous and reduces latency, but
potentially causes more processor bandwidth contention since the CPU doing
the tx isn't necessarily the CPU where the guest generated the packets."
<strong>In general you should leave this option alone, unless you are very certain
you know what you are doing.</strong></p>
</dd>
<dt><span class="docutils literal">ioeventfd</span></dt>
<dd><p>This optional attribute allows users to set <a class="reference external" href="https://patchwork.kernel.org/patch/43390/">domain I/O asynchronous
handling</a> for interface device.
The default is left to the discretion of the hypervisor. Accepted values are
"on" and "off". Enabling this allows qemu to execute VM while a separate
thread handles I/O. Typically guests experiencing high system CPU utilization
during I/O will benefit from this. On the other hand, on overloaded host it
could increase guest I/O latency. <span class="since">Since 0.9.3 (QEMU and KVM only)</span>
<strong>In general you should leave this option alone, unless you are very certain
you know what you are doing.</strong></p>
</dd>
<dt><span class="docutils literal">event_idx</span></dt>
<dd><p>The <span class="docutils literal">event_idx</span> attribute controls some aspects of device event processing.
The value can be either 'on' or 'off' - if it is on, it will reduce the
number of interrupts and exits for the guest. The default is determined by
QEMU; usually if the feature is supported, default is on. In case there is a
situation where this behavior is suboptimal, this attribute provides a way to
force the feature off. <span class="since">Since 0.9.5 (QEMU and KVM only)</span>
<strong>In general you should leave this option alone, unless you are very certain
you know what you are doing.</strong></p>
</dd>
<dt><span class="docutils literal">queues</span></dt>
<dd><p>The optional <span class="docutils literal">queues</span> attribute controls the number of queues to be used
for either <a class="reference external" href="https://www.linux-kvm.org/page/Multiqueue">Multiqueue
virtio-net</a> or
<a class="reference external" href="formatdomain.html#elementVhostuser">vhost-user</a> network interfaces. Use of multiple packet
processing queues requires the interface having the
<span class="docutils literal">&lt;model <span class="pre">type='virtio'/&gt;</span></span> element. Each queue will potentially be handled by
a different processor, resulting in much higher throughput.
<span class="since">virtio-net since 1.0.6 (QEMU and KVM only)</span> <span class="since">vhost-user since
1.2.17 (QEMU and KVM only)</span></p>
</dd>
<dt><span class="docutils literal">rx_queue_size</span></dt>
<dd><p>The optional <span class="docutils literal">rx_queue_size</span> attribute controls the size of virtio ring for
each queue as described above. The default value is hypervisor dependent and
may change across its releases. Moreover, some hypervisors may pose some
restrictions on actual value. For instance, latest QEMU (as of 2016-09-01)
requires value to be a power of two from [256, 1024] range. <span class="since">Since
2.3.0 (QEMU and KVM only)</span>
<strong>In general you should leave this option alone, unless you are very certain
you know what you are doing.</strong></p>
</dd>
<dt><span class="docutils literal">tx_queue_size</span></dt>
<dd><p>The optional <span class="docutils literal">tx_queue_size</span> attribute controls the size of virtio ring for
each queue as described above. The default value is hypervisor dependent and
may change across its releases. Moreover, some hypervisors may pose some
restrictions on actual value. For instance, QEMU v2.9 requires value to be a
power of two from [256, 1024] range. In addition to that, this may work only
for a subset of interface types, e.g. aforementioned QEMU enables this option
only for <span class="docutils literal">vhostuser</span> type. <span class="since">Since 3.7.0 (QEMU and KVM only)</span>
<strong>In general you should leave this option alone, unless you are very certain
you know what you are doing.</strong></p>
</dd>
<dt>virtio options</dt>
<dd><p>For virtio interfaces, <a class="reference external" href="formatdomain.html#elementsVirtio">Virtio-specific options</a> can also
be set. ( <span class="since">Since 3.5.0</span> )</p>
</dd>
</dl>
<p>Offloading options for the host and guest can be configured using the following
sub-elements:</p>
<dl class="simple">
<dt><span class="docutils literal">host</span></dt>
<dd><p>The <span class="docutils literal">csum</span>, <span class="docutils literal">gso</span>, <span class="docutils literal">tso4</span>, <span class="docutils literal">tso6</span>, <span class="docutils literal">ecn</span> and <span class="docutils literal">ufo</span> attributes
with possible values <span class="docutils literal">on</span> and <span class="docutils literal">off</span> can be used to turn off host
offloading options. By default, the supported offloads are enabled by QEMU.
<span class="since">Since 1.2.9 (QEMU only)</span> The <span class="docutils literal">mrg_rxbuf</span> attribute can be used to
control mergeable rx buffers on the host side. Possible values are <span class="docutils literal">on</span>
(default) and <span class="docutils literal">off</span>. <span class="since">Since 1.2.13 (QEMU only)</span></p>
</dd>
<dt><span class="docutils literal">guest</span></dt>
<dd><p>The <span class="docutils literal">csum</span>, <span class="docutils literal">tso4</span>, <span class="docutils literal">tso6</span>, <span class="docutils literal">ecn</span> and <span class="docutils literal">ufo</span> attributes with
possible values <span class="docutils literal">on</span> and <span class="docutils literal">off</span> can be used to turn off guest offloading
options. By default, the supported offloads are enabled by QEMU.
<span class="since">Since 1.2.9 (QEMU only)</span></p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsBackendOptions"/></span></p>
</div>
<div class="section" id="setting-network-backend-specific-options">
<h4><a class="toc-backref" href="formatdomain.html#id52">Setting network backend-specific options</a><a class="headerlink" href="formatdomain.html#setting-network-backend-specific-options" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet1'/&gt;
    &lt;model type='virtio'/&gt;
    &lt;backend tap='/dev/net/tun' vhost='/dev/vhost-net'/&gt;
    &lt;driver name='vhost' txmode='iothread' ioeventfd='on' event_idx='off' queues='5'/&gt;
    &lt;tune&gt;
      &lt;sndbuf&gt;1600&lt;/sndbuf&gt;
    &lt;/tune&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>For tuning the backend of the network, the <span class="docutils literal">backend</span> element can be used. The
<span class="docutils literal">vhost</span> attribute can override the default vhost device path
(<span class="docutils literal"><span class="pre">/dev/vhost-net</span></span>) for devices with <span class="docutils literal">virtio</span> model. The <span class="docutils literal">tap</span> attribute
overrides the tun/tap device path (default: <span class="docutils literal">/dev/net/tun</span>) for network and
bridge interfaces. This does not work in session mode. <span class="since">Since 1.2.9</span></p>
<p>For tap devices there is also <span class="docutils literal">sndbuf</span> element which can adjust the size of
send buffer in the host. <span class="since">Since 0.8.8</span></p>
<p><span class="anchor"><a id="elementsNICSTargetOverride"/></span></p>
</div>
<div class="section" id="overriding-the-target-element">
<h4><a class="toc-backref" href="formatdomain.html#id53">Overriding the target element</a><a class="headerlink" href="formatdomain.html#overriding-the-target-element" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet1'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>If no target is specified, certain hypervisors will automatically generate a
name for the created tun device. This name can be manually specified, however
the name <em>should not start with either 'vnet', 'vif', 'macvtap', or 'macvlan'</em>,
which are prefixes reserved by libvirt and certain hypervisors. Manually
specified targets using these prefixes may be ignored.</p>
<p>Note that for LXC containers, this defines the name of the interface on the host
side. <span class="since">Since 1.2.7</span> , to define the name of the device on the guest side,
the <span class="docutils literal">guest</span> element should be used, as in the following snippet:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;guest dev='myeth'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNICSBoot"/></span></p>
</div>
<div class="section" id="specifying-boot-order">
<h4><a class="toc-backref" href="formatdomain.html#id54">Specifying boot order</a><a class="headerlink" href="formatdomain.html#specifying-boot-order" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet1'/&gt;
    &lt;boot order='1'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>For hypervisors which support this, you can set a specific NIC to be used for
network boot. The <span class="docutils literal">order</span> attribute determines the order in which devices will
be tried during boot sequence. The per-device <span class="docutils literal">boot</span> elements cannot be used
together with general boot elements in <a class="reference external" href="formatdomain.html#elementsOSBIOS">BIOS bootloader</a>
section. <span class="since">Since 0.8.8</span></p>
<p><span class="anchor"><a id="elementsNICSROM"/></span></p>
</div>
<div class="section" id="interface-rom-bios-configuration">
<h4><a class="toc-backref" href="formatdomain.html#id55">Interface ROM BIOS configuration</a><a class="headerlink" href="formatdomain.html#interface-rom-bios-configuration" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet1'/&gt;
    &lt;rom bar='on' file='/etc/fake/boot.bin'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>For hypervisors which support this, you can change how a PCI Network device's
ROM is presented to the guest. The <span class="docutils literal">bar</span> attribute can be set to "on" or
"off", and determines whether or not the device's ROM will be visible in the
guest's memory map. (In PCI documentation, the "rombar" setting controls the
presence of the Base Address Register for the ROM). If no rom bar is specified,
the qemu default will be used (older versions of qemu used a default of "off",
while newer qemus have a default of "on"). The optional <span class="docutils literal">file</span> attribute is
used to point to a binary file to be presented to the guest as the device's ROM
BIOS. This can be useful to provide an alternative boot ROM for a network
device. <span class="since">Since 0.9.10 (QEMU and KVM only)</span> .</p>
<p><span class="anchor"><a id="elementDomain"/></span></p>
</div>
<div class="section" id="setting-up-a-network-backend-in-a-driver-domain">
<h4><a class="toc-backref" href="formatdomain.html#id56">Setting up a network backend in a driver domain</a><a class="headerlink" href="formatdomain.html#setting-up-a-network-backend-in-a-driver-domain" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  ...
  &lt;interface type='bridge'&gt;
    &lt;source bridge='br0'/&gt;
    &lt;backenddomain name='netvm'/&gt;
  &lt;/interface&gt;
  ...
&lt;/devices&gt;
...</pre>
<p>The optional <span class="docutils literal">backenddomain</span> element allows specifying a backend domain (aka
driver domain) for the interface. Use the <span class="docutils literal">name</span> attribute to specify the
backend domain name. You can use it to create a direct network link between
domains (so data will not go through host system). Use with type 'ethernet' to
create plain network link, or with type 'bridge' to connect to a bridge inside
the backend domain. <span class="since">Since 1.2.13 (Xen only)</span></p>
<p><span class="anchor"><a id="elementQoS"/></span></p>
</div>
<div class="section" id="quality-of-service">
<h4><a class="toc-backref" href="formatdomain.html#id57">Quality of service</a><a class="headerlink" href="formatdomain.html#quality-of-service" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet0'/&gt;
    &lt;bandwidth&gt;
      &lt;inbound average='1000' peak='5000' floor='200' burst='1024'/&gt;
      &lt;outbound average='128' peak='256' burst='256'/&gt;
    &lt;/bandwidth&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>This part of interface XML provides setting quality of service. Incoming and
outgoing traffic can be shaped independently. The <span class="docutils literal">bandwidth</span> element and its
child elements are described in the <a class="reference external" href="https://libvirt.org/formatnetwork.html#elementQoS">QoS</a>
section of the Network XML.</p>
<p><span class="anchor"><a id="elementVlanTag"/></span></p>
</div>
<div class="section" id="setting-vlan-tag-on-supported-network-types-only">
<h4><a class="toc-backref" href="formatdomain.html#id58">Setting VLAN tag (on supported network types only)</a><a class="headerlink" href="formatdomain.html#setting-vlan-tag-on-supported-network-types-only" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='bridge'&gt;
    &lt;vlan&gt;
      &lt;tag id='42'/&gt;
    &lt;/vlan&gt;
    &lt;source bridge='ovsbr0'/&gt;
    &lt;virtualport type='openvswitch'&gt;
      &lt;parameters interfaceid='09b11c53-8b5c-4eeb-8f00-d84eaa0aaa4f'/&gt;
    &lt;/virtualport&gt;
  &lt;/interface&gt;
  &lt;interface type='bridge'&gt;
    &lt;vlan trunk='yes'&gt;
      &lt;tag id='42'/&gt;
      &lt;tag id='123' nativeMode='untagged'/&gt;
    &lt;/vlan&gt;
    ...
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>If (and only if) the network connection used by the guest supports VLAN tagging
transparent to the guest, an optional <span class="docutils literal">&lt;vlan&gt;</span> element can specify one or more
VLAN tags to apply to the guest's network traffic <span class="since">Since 0.10.0</span> .
Network connections that support guest-transparent VLAN tagging include 1)
type='bridge' interfaces connected to an Open vSwitch bridge <span class="since">Since
0.10.0</span> , 2) SRIOV Virtual Functions (VF) used via type='hostdev' (direct device
assignment) <span class="since">Since 0.10.0</span> , and 3) SRIOV VFs used via type='direct' with
mode='passthrough' (macvtap "passthru" mode) <span class="since">Since 1.3.5</span> . All other
connection types, including standard linux bridges and libvirt's own virtual
networks, <strong>do not</strong> support it. 802.1Qbh (vn-link) and 802.1Qbg (VEPA) switches
provide their own way (outside of libvirt) to tag guest traffic onto a specific
VLAN. Each tag is given in a separate <span class="docutils literal">&lt;tag&gt;</span> subelement of <span class="docutils literal">&lt;vlan&gt;</span> (for
example: <span class="docutils literal">&lt;tag       <span class="pre">id='42'/&gt;</span></span>). For VLAN trunking of multiple tags (which is
supported only on Open vSwitch connections), multiple <span class="docutils literal">&lt;tag&gt;</span> subelements can
be specified, which implies that the user wants to do VLAN trunking on the
interface for all the specified tags. In the case that VLAN trunking of a single
tag is desired, the optional attribute <span class="docutils literal"><span class="pre">trunk='yes'</span></span> can be added to the
toplevel <span class="docutils literal">&lt;vlan&gt;</span> element to differentiate trunking of a single tag from
normal tagging.</p>
<p>For network connections using Open vSwitch it is also possible to configure
'native-tagged' and 'native-untagged' VLAN modes <span class="since">Since 1.1.0.</span> This is
done with the optional <span class="docutils literal">nativeMode</span> attribute on the <span class="docutils literal">&lt;tag&gt;</span> subelement:
<span class="docutils literal">nativeMode</span> may be set to 'tagged' or 'untagged'. The <span class="docutils literal">id</span> attribute of the
<span class="docutils literal">&lt;tag&gt;</span> subelement containing <span class="docutils literal">nativeMode</span> sets which VLAN is considered to
be the "native" VLAN for this interface, and the <span class="docutils literal">nativeMode</span> attribute
determines whether or not traffic for that VLAN will be tagged.</p>
<p><span class="anchor"><a id="elementPort"/></span></p>
</div>
<div class="section" id="isolating-guests-s-network-traffic-from-each-other">
<h4><a class="toc-backref" href="formatdomain.html#id59">Isolating guests's network traffic from each other</a><a class="headerlink" href="formatdomain.html#isolating-guests-s-network-traffic-from-each-other" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;port isolated='yes'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p><span class="since">Since 6.1.0.</span> The <span class="docutils literal">port</span> element property <span class="docutils literal">isolated</span>, when set to
<span class="docutils literal">yes</span> (default setting is <span class="docutils literal">no</span>) is used to isolate this interface's network
traffic from that of other guest interfaces connected to the same network that
also have <span class="docutils literal">&lt;port <span class="pre">isolated='yes'/&gt;</span></span>. This setting is only supported for
emulated interface devices that use a standard tap device to connect to the
network via a Linux host bridge. This property can be inherited from a libvirt
network, so if all guests that will be connected to the network should be
isolated, it is better to put the setting in the network configuration. (NB:
this only prevents guests that have <span class="docutils literal"><span class="pre">isolated='yes'</span></span> from communicating with
each other; if there is a guest on the same bridge that doesn't have
<span class="docutils literal"><span class="pre">isolated='yes'</span></span>, even the isolated guests will be able to communicate with
it.)</p>
<p><span class="anchor"><a id="elementLink"/></span></p>
</div>
<div class="section" id="modifying-virtual-link-state">
<h4><a class="toc-backref" href="formatdomain.html#id60">Modifying virtual link state</a><a class="headerlink" href="formatdomain.html#modifying-virtual-link-state" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet0'/&gt;
    &lt;link state='down'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>This element provides means of setting state of the virtual network link.
Possible values for attribute <span class="docutils literal">state</span> are <span class="docutils literal">up</span> and <span class="docutils literal">down</span>. If <span class="docutils literal">down</span> is
specified as the value, the interface behaves as if it had the network cable
disconnected. Default behavior if this element is unspecified is to have the
link state <span class="docutils literal">up</span>. <span class="since">Since 0.9.5</span></p>
<p><span class="anchor"><a id="mtu"/></span></p>
</div>
<div class="section" id="mtu-configuration">
<h4><a class="toc-backref" href="formatdomain.html#id61">MTU configuration</a><a class="headerlink" href="formatdomain.html#mtu-configuration" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet0'/&gt;
    &lt;mtu size='1500'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>This element provides means of setting MTU of the virtual network link.
Currently there is just one attribute <span class="docutils literal">size</span> which accepts a non-negative
integer which specifies the MTU size for the interface. <span class="since">Since 3.1.0</span></p>
<p><span class="anchor"><a id="coalesce"/></span></p>
</div>
<div class="section" id="coalesce-settings">
<h4><a class="toc-backref" href="formatdomain.html#id62">Coalesce settings</a><a class="headerlink" href="formatdomain.html#coalesce-settings" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet0'/&gt;
    &lt;coalesce&gt;
      &lt;rx&gt;
        &lt;frames max='7'/&gt;
      &lt;/rx&gt;
    &lt;/coalesce&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>This element provides means of setting coalesce settings for some interface
devices (currently only type <span class="docutils literal">network</span> and <span class="docutils literal">bridge</span>. Currently there is just
one attribute, <span class="docutils literal">max</span>, to tweak, in element <span class="docutils literal">frames</span> for the <span class="docutils literal">rx</span> group,
which accepts a non-negative integer that specifies the maximum number of
packets that will be received before an interrupt. <span class="since">Since 3.3.0</span></p>
<p><span class="anchor"><a id="ipconfig"/></span></p>
</div>
<div class="section" id="ip-configuration">
<h4><a class="toc-backref" href="formatdomain.html#id63">IP configuration</a><a class="headerlink" href="formatdomain.html#ip-configuration" title="Link to this headline">¶</a></h4>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='network'&gt;
    &lt;source network='default'/&gt;
    &lt;target dev='vnet0'/&gt;
    &lt;ip address='192.168.122.5' prefix='24'/&gt;
    &lt;ip address='192.168.122.5' prefix='24' peer='10.0.0.10'/&gt;
    &lt;route family='ipv4' address='192.168.122.0' prefix='24' gateway='192.168.122.1'/&gt;
    &lt;route family='ipv4' address='192.168.122.8' gateway='192.168.122.1'/&gt;
  &lt;/interface&gt;
  ...
  &lt;hostdev mode='capabilities' type='net'&gt;
    &lt;source&gt;
      &lt;interface&gt;eth0&lt;/interface&gt;
    &lt;/source&gt;
    &lt;ip address='192.168.122.6' prefix='24'/&gt;
    &lt;route family='ipv4' address='192.168.122.0' prefix='24' gateway='192.168.122.1'/&gt;
    &lt;route family='ipv4' address='192.168.122.8' gateway='192.168.122.1'/&gt;
  &lt;/hostdev&gt;
  ...
&lt;/devices&gt;
...</pre>
<p><span class="since">Since 1.2.12</span> network devices and hostdev devices with network
capabilities can optionally be provided one or more IP addresses to set on the
network device in the guest. Note that some hypervisors or network device types
will simply ignore them or only use the first one. The <span class="docutils literal">family</span> attribute can
be set to either <span class="docutils literal">ipv4</span> or <span class="docutils literal">ipv6</span>, and the <span class="docutils literal">address</span> attribute contains
the IP address. The optional <span class="docutils literal">prefix</span> is the number of 1 bits in the netmask,
and will be automatically set if not specified - for IPv4 the default prefix is
determined according to the network "class" (A, B, or C - see RFC870), and for
IPv6 the default prefix is 64. The optional <span class="docutils literal">peer</span> attribute holds the IP
address of the other end of a point-to-point network device <span class="since">(since
2.1.0)</span> .</p>
<p><span class="since">Since 1.2.12</span> route elements can also be added to define IP routes to
add in the guest. The attributes of this element are described in the
documentation for the <span class="docutils literal">route</span> element in <a class="reference external" href="https://libvirt.org/formatnetwork.html#elementsStaticroute">network
definitions</a>. This is used by the LXC
driver.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='ethernet'&gt;
    &lt;source/&gt;
      &lt;ip address='192.168.123.1' prefix='24'/&gt;
      &lt;ip address='10.0.0.10' prefix='24' peer='192.168.122.5'/&gt;
      &lt;route family='ipv4' address='192.168.42.0' prefix='24' gateway='192.168.123.4'/&gt;
    &lt;source/&gt;
    ...
  &lt;/interface&gt;
  ...
&lt;/devices&gt;
...</pre>
<p><span class="since">Since 2.1.0</span> network devices of type "ethernet" can optionally be
provided one or more IP addresses and one or more routes to set on the <strong>host</strong>
side of the network device. These are configured as subelements of the
<span class="docutils literal">&lt;source&gt;</span> element of the interface, and have the same attributes as the
similarly named elements used to configure the guest side of the interface
(described above).</p>
<p><span class="anchor"><a id="elementVhostuser"/></span></p>
</div>
<div class="section" id="vhost-user-interface">
<h4><a class="toc-backref" href="formatdomain.html#id64">vhost-user interface</a><a class="headerlink" href="formatdomain.html#vhost-user-interface" title="Link to this headline">¶</a></h4>
<p><span class="since">Since 1.2.7</span> the vhost-user enables the communication between a QEMU
virtual machine and other userspace process using the Virtio transport protocol.
A char dev (e.g. Unix socket) is used for the control plane, while the data
plane is based on shared memory.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface type='vhostuser'&gt;
    &lt;mac address='52:54:00:3b:83:1a'/&gt;
    &lt;source type='unix' path='/tmp/vhost1.sock' mode='server'/&gt;
    &lt;model type='virtio'/&gt;
  &lt;/interface&gt;
  &lt;interface type='vhostuser'&gt;
    &lt;mac address='52:54:00:3b:83:1b'/&gt;
    &lt;source type='unix' path='/tmp/vhost2.sock' mode='client'&gt;
      &lt;reconnect enabled='yes' timeout='10'/&gt;
    &lt;/source&gt;
    &lt;model type='virtio'/&gt;
    &lt;driver queues='5'/&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>The <span class="docutils literal">&lt;source&gt;</span> element has to be specified along with the type of char device.
Currently, only type='unix' is supported, where the path (the directory path of
the socket) and mode attributes are required. Both <span class="docutils literal"><span class="pre">mode='server'</span></span> and
<span class="docutils literal"><span class="pre">mode='client'</span></span> are supported. vhost-user requires the virtio model type, thus
the <span class="docutils literal">&lt;model&gt;</span> element is mandatory. <span class="since">Since 4.1.0</span> the element has an
optional child element <span class="docutils literal">reconnect</span> which configures reconnect timeout if the
connection is lost. It has two attributes <span class="docutils literal">enabled</span> (which accepts <span class="docutils literal">yes</span> and
<span class="docutils literal">no</span>) and <span class="docutils literal">timeout</span> which specifies the amount of seconds after which
hypervisor tries to reconnect.</p>
<p><span class="anchor"><a id="elementNwfilter"/></span></p>
</div>
<div class="section" id="traffic-filtering-with-nwfilter">
<h4><a class="toc-backref" href="formatdomain.html#id65">Traffic filtering with NWFilter</a><a class="headerlink" href="formatdomain.html#traffic-filtering-with-nwfilter" title="Link to this headline">¶</a></h4>
<p><span class="since">Since 0.8.0</span> an <span class="docutils literal">nwfilter</span> profile can be assigned to a domain
interface, which allows configuring traffic filter rules for the virtual
machine. See the <a class="reference external" href="https://libvirt.org/formatnwfilter.html">nwfilter</a> documentation for more
complete details.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;interface ...&gt;
    ...
    &lt;filterref filter='clean-traffic'/&gt;
  &lt;/interface&gt;
  &lt;interface ...&gt;
    ...
    &lt;filterref filter='myfilter'&gt;
      &lt;parameter name='IP' value='104.207.129.11'/&gt;
      &lt;parameter name='IP6_ADDR' value='2001:19f0:300:2102::'/&gt;
      &lt;parameter name='IP6_MASK' value='64'/&gt;
      ...
    &lt;/filterref&gt;
  &lt;/interface&gt;
&lt;/devices&gt;
...</pre>
<p>The <span class="docutils literal">filter</span> attribute specifies the name of the nwfilter to use. Optional
<span class="docutils literal">&lt;parameter&gt;</span> elements may be specified for passing additional info to the
nwfilter via the <span class="docutils literal">name</span> and <span class="docutils literal">value</span> attributes. See the
<a class="reference external" href="https://libvirt.org/formatnwfilter.html#nwfconceptsvars">nwfilter</a> docs for info on parameters.</p>
<p><span class="anchor"><a id="elementsInput"/></span></p>
</div>
</div>
<div class="section" id="input-devices">
<h3><a class="toc-backref" href="formatdomain.html#id66">Input devices</a><a class="headerlink" href="formatdomain.html#input-devices" title="Link to this headline">¶</a></h3>
<p>Input devices allow interaction with the graphical framebuffer in the guest
virtual machine. When enabling the framebuffer, an input device is automatically
provided. It may be possible to add additional devices explicitly, for example,
to provide a graphics tablet for absolute cursor movement.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;input type='mouse' bus='usb'/&gt;
  &lt;input type='keyboard' bus='usb'/&gt;
  &lt;input type='mouse' bus='virtio'/&gt;
  &lt;input type='keyboard' bus='virtio'/&gt;
  &lt;input type='tablet' bus='virtio'/&gt;
  &lt;input type='passthrough' bus='virtio'&gt;
    &lt;source evdev='/dev/input/event1'/&gt;
  &lt;/input&gt;
&lt;/devices&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">input</span></dt>
<dd><p>The <span class="docutils literal">input</span> element has one mandatory attribute, the <span class="docutils literal">type</span> whose value
can be 'mouse', 'tablet', ( <span class="since">since 1.2.2</span> ) 'keyboard' or (
<span class="since">since 1.3.0</span> ) 'passthrough'. The tablet provides absolute cursor
movement, while the mouse uses relative movement. The optional <span class="docutils literal">bus</span>
attribute can be used to refine the exact device type. It takes values "xen"
(paravirtualized), "ps2" and "usb" or ( <span class="since">since 1.3.0</span> ) "virtio".</p>
</dd>
</dl>
<p>The <span class="docutils literal">input</span> element has an optional sub-element <span class="docutils literal">&lt;address&gt;</span> which can tie
the device to a particular PCI slot, <a class="reference external" href="formatdomain.html#elementsAddress">documented above</a>. On
S390, <span class="docutils literal">address</span> can be used to provide a CCW address for an input device (
<span class="since">since 4.2.0</span> ). For type <span class="docutils literal">passthrough</span>, the mandatory sub-element
<span class="docutils literal">source</span> must have an <span class="docutils literal">evdev</span> attribute containing the absolute path to the
event device passed through to guests. (KVM only) <span class="since">Since 5.2.0</span> , the
<span class="docutils literal">input</span> element accepts a <span class="docutils literal">model</span> attribute which has the values 'virtio',
'virtio-transitional' and 'virtio-non-transitional'. See <a class="reference external" href="formatdomain.html#elementsVirtioTransitional">Virtio transitional
devices</a> for more details.</p>
<p>The subelement <span class="docutils literal">driver</span> can be used to tune the virtio options of the device:
<a class="reference external" href="formatdomain.html#elementsVirtio">Virtio-specific options</a> can also be set. ( <span class="since">Since
3.5.0</span> )</p>
<p><span class="anchor"><a id="elementsHub"/></span></p>
</div>
<div class="section" id="hub-devices">
<h3><a class="toc-backref" href="formatdomain.html#id67">Hub devices</a><a class="headerlink" href="formatdomain.html#hub-devices" title="Link to this headline">¶</a></h3>
<p>A hub is a device that expands a single port into several so that there are more
ports available to connect devices to a host system.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;hub type='usb'/&gt;
&lt;/devices&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">hub</span></dt>
<dd><p>The <span class="docutils literal">hub</span> element has one mandatory attribute, the <span class="docutils literal">type</span> whose value can
only be 'usb'.</p>
</dd>
</dl>
<p>The <span class="docutils literal">hub</span> element has an optional sub-element <span class="docutils literal">&lt;address&gt;</span> with
<span class="docutils literal"><span class="pre">type='usb'</span></span>which can tie the device to a particular controller, <a class="reference external" href="formatdomain.html#elementsAddress">documented
above</a>.</p>
<p><span class="anchor"><a id="elementsGraphics"/></span></p>
</div>
<div class="section" id="graphical-framebuffers">
<h3><a class="toc-backref" href="formatdomain.html#id68">Graphical framebuffers</a><a class="headerlink" href="formatdomain.html#graphical-framebuffers" title="Link to this headline">¶</a></h3>
<p>A graphics device allows for graphical interaction with the guest OS. A guest
will typically have either a framebuffer or a text console configured to allow
interaction with the admin.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;graphics type='sdl' display=':0.0'/&gt;
  &lt;graphics type='vnc' port='5904' sharePolicy='allow-exclusive'&gt;
    &lt;listen type='address' address='1.2.3.4'/&gt;
  &lt;/graphics&gt;
  &lt;graphics type='rdp' autoport='yes' multiUser='yes' /&gt;
  &lt;graphics type='desktop' fullscreen='yes'/&gt;
  &lt;graphics type='spice'&gt;
    &lt;listen type='network' network='rednet'/&gt;
  &lt;/graphics&gt;
&lt;/devices&gt;
...</pre>
<dl>
<dt><span class="docutils literal">graphics</span></dt>
<dd><p>The <span class="docutils literal">graphics</span> element has a mandatory <span class="docutils literal">type</span> attribute which takes the
value <span class="docutils literal">sdl</span>, <span class="docutils literal">vnc</span>, <span class="docutils literal">spice</span>, <span class="docutils literal">rdp</span>, <span class="docutils literal">desktop</span> or <span class="docutils literal"><span class="pre">egl-headless</span></span>:</p>
<dl>
<dt><span class="docutils literal">sdl</span></dt>
<dd><p>This displays a window on the host desktop, it can take 3 optional
arguments: a <span class="docutils literal">display</span> attribute for the display to use, an <span class="docutils literal">xauth</span>
attribute for the authentication identifier, and an optional
<span class="docutils literal">fullscreen</span> attribute accepting values <span class="docutils literal">yes</span> or <span class="docutils literal">no</span>.</p>
<p>You can use a <span class="docutils literal">gl</span> with the <span class="docutils literal"><span class="pre">enable="yes"</span></span> property to enable OpenGL
support in SDL. Likewise you can explicitly disable OpenGL support with
<span class="docutils literal"><span class="pre">enable="no"</span></span>.</p>
</dd>
<dt><span class="docutils literal">vnc</span></dt>
<dd><p>Starts a VNC server. The <span class="docutils literal">port</span> attribute specifies the TCP port number
(with -1 as legacy syntax indicating that it should be auto-allocated).
The <span class="docutils literal">autoport</span> attribute is the new preferred syntax for indicating
auto-allocation of the TCP port to use. The <span class="docutils literal">passwd</span> attribute provides
a VNC password in clear text. If the <span class="docutils literal">passwd</span> attribute is set to an
empty string, then VNC access is disabled. The <span class="docutils literal">keymap</span> attribute
specifies the keymap to use. It is possible to set a limit on the validity
of the password by giving a timestamp
<span class="docutils literal"><span class="pre">passwdValidTo='2010-04-09T15:51:00'</span></span> assumed to be in UTC. The
<span class="docutils literal">connected</span> attribute allows control of connected client during password
changes. VNC accepts <span class="docutils literal">keep</span> value only <span class="since">since 0.9.3</span> . NB, this
may not be supported by all hypervisors.</p>
<p>The optional <span class="docutils literal">sharePolicy</span> attribute specifies vnc server display
sharing policy. <span class="docutils literal"><span class="pre">allow-exclusive</span></span> allows clients to ask for exclusive
access by dropping other connections. Connecting multiple clients in
parallel requires all clients asking for a shared session (vncviewer:
-Shared switch). This is the default value. <span class="docutils literal"><span class="pre">force-shared</span></span> disables
exclusive client access, every connection has to specify -Shared switch
for vncviewer. <span class="docutils literal">ignore</span> welcomes every connection unconditionally
<span class="since">since 1.0.6</span> .</p>
<p>Rather than using listen/port, QEMU supports a <span class="docutils literal">socket</span> attribute for
listening on a unix domain socket path <span class="since">Since 0.8.8</span> .</p>
<p>For VNC WebSocket functionality, <span class="docutils literal">websocket</span> attribute may be used to
specify port to listen on (with -1 meaning auto-allocation and
<span class="docutils literal">autoport</span> having no effect due to security reasons) <span class="since">Since
1.0.6</span> .</p>
<p>Although VNC doesn't support OpenGL natively, it can be paired with
graphics type <span class="docutils literal"><span class="pre">egl-headless</span></span> (see below) which will instruct QEMU to
open and use drm nodes for OpenGL rendering.</p>
</dd>
<dt><span class="docutils literal">spice</span> <span class="since">Since 0.8.6</span></dt>
<dd><p>Starts a SPICE server. The <span class="docutils literal">port</span> attribute specifies the TCP port
number (with -1 as legacy syntax indicating that it should be
auto-allocated), while <span class="docutils literal">tlsPort</span> gives an alternative secure port
number. The <span class="docutils literal">autoport</span> attribute is the new preferred syntax for
indicating auto-allocation of needed port numbers. The <span class="docutils literal">passwd</span>
attribute provides a SPICE password in clear text. If the <span class="docutils literal">passwd</span>
attribute is set to an empty string, then SPICE access is disabled. The
<span class="docutils literal">keymap</span> attribute specifies the keymap to use. It is possible to set a
limit on the validity of the password by giving a timestamp
<span class="docutils literal"><span class="pre">passwdValidTo='2010-04-09T15:51:00'</span></span> assumed to be in UTC.</p>
<p>The <span class="docutils literal">connected</span> attribute allows control of connected client during
password changes. SPICE accepts <span class="docutils literal">keep</span> to keep client connected,
<span class="docutils literal">disconnect</span> to disconnect client and <span class="docutils literal">fail</span> to fail changing password
. NB, this may not be supported by all hypervisors. <span class="since">Since 0.9.3</span></p>
<p>The <span class="docutils literal">defaultMode</span> attribute sets the default channel security policy,
valid values are <span class="docutils literal">secure</span>, <span class="docutils literal">insecure</span> and the default <span class="docutils literal">any</span> (which
is secure if possible, but falls back to insecure rather than erroring out
if no secure path is available). <span class="since">Since 0.9.12</span></p>
<p>When SPICE has both a normal and TLS secured TCP port configured, it can
be desirable to restrict what channels can be run on each port. This is
achieved by adding one or more <span class="docutils literal">&lt;channel&gt;</span> elements inside the main
<span class="docutils literal">&lt;graphics&gt;</span> element and setting the <span class="docutils literal">mode</span> attribute to either
<span class="docutils literal">secure</span> or <span class="docutils literal">insecure</span>. Setting the mode attribute overrides the
default value as set by the <span class="docutils literal">defaultMode</span> attribute. (Note that
specifying <span class="docutils literal">any</span> as mode discards the entry as the channel would inherit
the default mode anyways.) Valid channel names include <span class="docutils literal">main</span>,
<span class="docutils literal">display</span>, <span class="docutils literal">inputs</span>, <span class="docutils literal">cursor</span>, <span class="docutils literal">playback</span>, <span class="docutils literal">record</span> (all
<span class="since">since 0.8.6</span> ); <span class="docutils literal">smartcard</span> ( <span class="since">since 0.8.8</span> ); and
<span class="docutils literal">usbredir</span> ( <span class="since">since 0.9.12</span> ).</p>
<pre class="literal-block">&lt;graphics type='spice' port='-1' tlsPort='-1' autoport='yes'&gt;
  &lt;channel name='main' mode='secure'/&gt;
  &lt;channel name='record' mode='insecure'/&gt;
  &lt;image compression='auto_glz'/&gt;
  &lt;streaming mode='filter'/&gt;
  &lt;clipboard copypaste='no'/&gt;
  &lt;mouse mode='client'/&gt;
  &lt;filetransfer enable='no'/&gt;
  &lt;gl enable='yes' rendernode='/dev/dri/by-path/pci-0000:00:02.0-render'/&gt;
&lt;/graphics&gt;</pre>
<p>Spice supports variable compression settings for audio, images and
streaming. These settings are accessible via the <span class="docutils literal">compression</span> attribute
in all following elements: <span class="docutils literal">image</span> to set image compression (accepts
<span class="docutils literal">auto_glz</span>, <span class="docutils literal">auto_lz</span>, <span class="docutils literal">quic</span>, <span class="docutils literal">glz</span>, <span class="docutils literal">lz</span>, <span class="docutils literal">off</span>), <span class="docutils literal">jpeg</span>
for JPEG compression for images over wan (accepts <span class="docutils literal">auto</span>, <span class="docutils literal">never</span>,
<span class="docutils literal">always</span>), <span class="docutils literal">zlib</span> for configuring wan image compression (accepts
<span class="docutils literal">auto</span>, <span class="docutils literal">never</span>, <span class="docutils literal">always</span>) and <span class="docutils literal">playback</span> for enabling audio
stream compression (accepts <span class="docutils literal">on</span> or <span class="docutils literal">off</span>). <span class="since">Since 0.9.1</span></p>
<p>Streaming mode is set by the <span class="docutils literal">streaming</span> element, settings its <span class="docutils literal">mode</span>
attribute to one of <span class="docutils literal">filter</span>, <span class="docutils literal">all</span> or <span class="docutils literal">off</span>. <span class="since">Since 0.9.2</span></p>
<p>Copy &amp; Paste functionality (via Spice agent) is set by the <span class="docutils literal">clipboard</span>
element. It is enabled by default, and can be disabled by setting the
<span class="docutils literal">copypaste</span> property to <span class="docutils literal">no</span>. <span class="since">Since 0.9.3</span></p>
<p>Mouse mode is set by the <span class="docutils literal">mouse</span> element, setting its <span class="docutils literal">mode</span> attribute
to one of <span class="docutils literal">server</span> or <span class="docutils literal">client</span>. If no mode is specified, the qemu
default will be used (client mode). <span class="since">Since 0.9.11</span></p>
<p>File transfer functionality (via Spice agent) is set using the
<span class="docutils literal">filetransfer</span> element. It is enabled by default, and can be disabled by
setting the <span class="docutils literal">enable</span> property to <span class="docutils literal">no</span>. <span class="since">Since 1.2.2</span></p>
<p>Spice may provide accelerated server-side rendering with OpenGL. You can
enable or disable OpenGL support explicitly with the <span class="docutils literal">gl</span> element, by
setting the <span class="docutils literal">enable</span> property. (QEMU only, <span class="since">since 1.3.3</span> ). Note
that this only works locally, since this requires usage of UNIX sockets,
i.e. using <span class="docutils literal">listen</span> types 'socket' or 'none'. For accelerated OpenGL
with remote support, consider pairing this element with type
<span class="docutils literal"><span class="pre">egl-headless</span></span> (see below). However, this will deliver weaker
performance compared to native Spice OpenGL support.</p>
<p>By default, QEMU will pick the first available GPU DRM render node. You
may specify a DRM render node path to use instead. (QEMU only,
<span class="since">since 3.1.0</span> ).</p>
</dd>
<dt><span class="docutils literal">rdp</span></dt>
<dd><p>Starts a RDP server. The <span class="docutils literal">port</span> attribute specifies the TCP port number
(with -1 as legacy syntax indicating that it should be auto-allocated).
The <span class="docutils literal">autoport</span> attribute is the new preferred syntax for indicating
auto-allocation of the TCP port to use. In the VirtualBox driver, the
<span class="docutils literal">autoport</span> will make the hypervisor pick available port from 3389-3689
range when the VM is started. The chosen port will be reflected in the
<span class="docutils literal">port</span> attribute. The <span class="docutils literal">multiUser</span> attribute is a boolean deciding
whether multiple simultaneous connections to the VM are permitted. The
<span class="docutils literal">replaceUser</span> attribute is a boolean deciding whether the existing
connection must be dropped and a new connection must be established by the
VRDP server, when a new client connects in single connection mode.</p>
</dd>
<dt><span class="docutils literal">desktop</span></dt>
<dd><p>This value is reserved for VirtualBox domains for the moment. It displays
a window on the host desktop, similarly to "sdl", but using the VirtualBox
viewer. Just like "sdl", it accepts the optional attributes <span class="docutils literal">display</span>
and <span class="docutils literal">fullscreen</span>.</p>
</dd>
<dt><span class="docutils literal"><span class="pre">egl-headless</span></span> <span class="since">Since 4.6.0</span></dt>
<dd><p>This display type provides support for an OpenGL accelerated display
accessible both locally and remotely (for comparison, Spice's native
OpenGL support only works locally using UNIX sockets at the moment, but
has better performance). Since this display type doesn't provide any
window or graphical console like the other types, for practical reasons it
should be paired with either <span class="docutils literal">vnc</span> or <span class="docutils literal">spice</span> graphics types. This
display type is only supported by QEMU domains (needs QEMU <span class="since">2.10</span>
or newer). <span class="since">5.0.0</span> this element accepts a <span class="docutils literal">&lt;gl/&gt;</span> sub-element
with an optional attribute <span class="docutils literal">rendernode</span> which can be used to specify an
absolute path to a host's DRI device to be used for OpenGL rendering.</p>
<pre class="literal-block">&lt;graphics type='spice' autoport='yes'/&gt;
&lt;graphics type='egl-headless'&gt;
  &lt;gl rendernode='/dev/dri/renderD128'/&gt;
&lt;/graphics&gt;</pre>
</dd>
</dl>
</dd>
</dl>
<p>Graphics device uses a <span class="docutils literal">&lt;listen&gt;</span> to set up where the device should listen for
clients. It has a mandatory attribute <span class="docutils literal">type</span> which specifies the listen type.
Only <span class="docutils literal">vnc</span>, <span class="docutils literal">spice</span> and <span class="docutils literal">rdp</span> supports <span class="docutils literal">&lt;listen&gt;</span> element. <span class="since">Since
0.9.4</span> . Available types are:</p>
<dl>
<dt><span class="docutils literal">address</span></dt>
<dd><p>Tells a graphics device to use an address specified in the <span class="docutils literal">address</span>
attribute, which will contain either an IP address or hostname (which will be
resolved to an IP address via a DNS query) to listen on.</p>
<p>It is possible to omit the <span class="docutils literal">address</span> attribute in order to use an address
from config files <span class="since">Since 1.3.5</span> .</p>
<p>The <span class="docutils literal">address</span> attribute is duplicated as <span class="docutils literal">listen</span> attribute in
<span class="docutils literal">graphics</span> element for backward compatibility. If both are provided they
must be equal.</p>
</dd>
<dt><span class="docutils literal">network</span></dt>
<dd><p>This is used to specify an existing network in the <span class="docutils literal">network</span> attribute from
libvirt's list of configured networks. The named network configuration will
be examined to determine an appropriate listen address and the address will
be stored in live XML in <span class="docutils literal">address</span> attribute. For example, if the network
has an IPv4 address in its configuration (e.g. if it has a forward type of
<span class="docutils literal">route</span>, <span class="docutils literal">nat</span>, or no forward type (isolated)), the first IPv4 address
listed in the network's configuration will be used. If the network is
describing a host bridge, the first IPv4 address associated with that bridge
device will be used, and if the network is describing one of the 'direct'
(macvtap) modes, the first IPv4 address of the first forward dev will be
used.</p>
</dd>
<dt><span class="docutils literal">socket</span> <span class="since">since 2.0.0 (QEMU only)</span></dt>
<dd><p>This listen type tells a graphics server to listen on unix socket. Attribute
<span class="docutils literal">socket</span> contains a path to unix socket. If this attribute is omitted
libvirt will generate this path for you. Supported by graphics type <span class="docutils literal">vnc</span>
and <span class="docutils literal">spice</span>.</p>
<p>For <span class="docutils literal">vnc</span> graphics be backward compatible the <span class="docutils literal">socket</span> attribute of first
<span class="docutils literal">listen</span> element is duplicated as <span class="docutils literal">socket</span> attribute in <span class="docutils literal">graphics</span>
element. If <span class="docutils literal">graphics</span> element contains a <span class="docutils literal">socket</span> attribute all
<span class="docutils literal">listen</span> elements are ignored.</p>
</dd>
<dt><span class="docutils literal">none</span> <span class="since">since 2.0.0 (QEMU only)</span></dt>
<dd><p>This listen type doesn't have any other attribute. Libvirt supports passing a
file descriptor through our APIs virDomainOpenGraphics() and
virDomainOpenGraphicsFD(). No other listen types are allowed if this one is
used and the graphics device doesn't listen anywhere. You need to use one of
the two APIs to pass a FD to QEMU in order to connect to this graphics
device. Supported by graphics type <span class="docutils literal">vnc</span> and <span class="docutils literal">spice</span>.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsVideo"/></span></p>
</div>
<div class="section" id="video-devices">
<h3><a class="toc-backref" href="formatdomain.html#id69">Video devices</a><a class="headerlink" href="formatdomain.html#video-devices" title="Link to this headline">¶</a></h3>
<p>A video device.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;video&gt;
    &lt;model type='vga' vram='16384' heads='1'&gt;
      &lt;acceleration accel3d='yes' accel2d='yes'/&gt;
    &lt;/model&gt;
    &lt;driver name='qemu'/&gt;
  &lt;/video&gt;
&lt;/devices&gt;
...</pre>
<dl>
<dt><span class="docutils literal">video</span></dt>
<dd><p>The <span class="docutils literal">video</span> element is the container for describing video devices. For
backwards compatibility, if no <span class="docutils literal">video</span> is set but there is a <span class="docutils literal">graphics</span>
in domain xml, then libvirt will add a default <span class="docutils literal">video</span> according to the
guest type.</p>
<p>For a guest of type "kvm", the default <span class="docutils literal">video</span> is: <span class="docutils literal">type</span> with value
"cirrus", <span class="docutils literal">vram</span> with value "16384" and <span class="docutils literal">heads</span> with value "1". By
default, the first video device in domain xml is the primary one, but the
optional attribute <span class="docutils literal">primary</span> ( <span class="since">since 1.0.2</span> ) with value 'yes' can
be used to mark the primary in cases of multiple video device. The
non-primary must be type of "qxl" or ( <span class="since">since 2.4.0</span> ) "virtio".</p>
</dd>
<dt><span class="docutils literal">model</span></dt>
<dd><p>The <span class="docutils literal">model</span> element has a mandatory <span class="docutils literal">type</span> attribute which takes the
value "vga", "cirrus", "vmvga", "xen", "vbox", "qxl" ( <span class="since">since 0.8.6</span>
), "virtio" ( <span class="since">since 1.3.0</span> ), "gop" ( <span class="since">since 3.2.0</span> ), "bochs"
( <span class="since">since 5.6.0</span> ), "ramfb" ( <span class="since">since 5.9.0</span> ), or "none" (
<span class="since">since 4.6.0</span> ), depending on the hypervisor features available.</p>
<p>Note: The purpose of the type <span class="docutils literal">none</span> is to instruct libvirt not to add a
default video device in the guest (see the <span class="docutils literal">video</span> element description
above), since such behaviour is inconvenient in cases where GPU mediated
devices are meant to be the only rendering device within a guest. If this
is your use case specify a <span class="docutils literal">none</span> type <span class="docutils literal">video</span> device in the XML to stop
the default behaviour. Refer to <a class="reference external" href="formatdomain.html#host-device-assignment">Host device assignment</a> to see how to add a mediated device into a
guest.</p>
<p>You can provide the amount of video memory in kibibytes (blocks of 1024
bytes) using <span class="docutils literal">vram</span>. This is supported only for guest type of "vz", "qemu",
"vbox", "vmx" and "xen". If no value is provided the default is used. If the
size is not a power of two it will be rounded to closest one.</p>
<p>The number of screen can be set using <span class="docutils literal">heads</span>. This is supported only for
guests type of "vz", "kvm", "vbox" and "vmx".</p>
<p>For guest type of "kvm" or "qemu" and model type "qxl" there are optional
attributes. Attribute <span class="docutils literal">ram</span> ( <span class="since">since 1.0.2</span> ) specifies the size of
the primary bar, while the attribute <span class="docutils literal">vram</span> specifies the secondary bar
size. If <span class="docutils literal">ram</span> or <span class="docutils literal">vram</span> are not supplied a default value is used. The
<span class="docutils literal">ram</span> should also be rounded to power of two as <span class="docutils literal">vram</span>. There is also
optional attribute <span class="docutils literal">vgamem</span> ( <span class="since">since 1.2.11</span> ) to set the size of
VGA framebuffer for fallback mode of QXL device. Attribute <span class="docutils literal">vram64</span> (
<span class="since">since 1.3.3</span> ) extends secondary bar and makes it addressable as
64bit memory.</p>
<p><span class="since">Since 5.9.0</span> , the <span class="docutils literal">model</span> element may also have an optional
<span class="docutils literal">resolution</span> sub-element. The <span class="docutils literal">resolution</span> element has attributes <span class="docutils literal">x</span>
and <span class="docutils literal">y</span> to set the minimum resolution for the video device. This
sub-element is valid for model types "vga", "qxl", "bochs", "gop",
and "virtio".</p>
</dd>
<dt><span class="docutils literal">acceleration</span></dt>
<dd><p>Configure if video acceleration should be enabled.</p>
<dl class="simple">
<dt><span class="docutils literal">accel2d</span></dt>
<dd><p>Enable 2D acceleration (for vbox driver only, <span class="since">since 0.7.1</span> )</p>
</dd>
<dt><span class="docutils literal">accel3d</span></dt>
<dd><p>Enable 3D acceleration (for vbox driver <span class="since">since 0.7.1</span> , qemu driver
<span class="since">since 1.3.0</span> )</p>
</dd>
<dt><span class="docutils literal">rendernode</span></dt>
<dd><p>Absolute path to a host's DRI device to be used for rendering (for
'vhostuser' driver only, <span class="since">since 5.8.0</span> ). If none is specified,
libvirt will pick one available.</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">address</span></dt>
<dd><p>The optional <span class="docutils literal">address</span> sub-element can be used to tie the video device to a
particular PCI slot. On S390, <span class="docutils literal">address</span> can be used to provide the CCW
address for the video device ( <span class="since">since 4.2.0</span> ).</p>
</dd>
<dt><span class="docutils literal">driver</span></dt>
<dd><p>The subelement <span class="docutils literal">driver</span> can be used to tune the device:</p>
<dl class="simple">
<dt><span class="docutils literal">name</span></dt>
<dd><p>Specify the backend driver to use, either "qemu" or "vhostuser" depending
on the hypervisor features available ( <span class="since">since 5.8.0</span> ). "qemu" is
the default QEMU backend. "vhostuser" will use a separate vhost-user
process backend (for <span class="docutils literal">virtio</span> device).</p>
</dd>
<dt>virtio options</dt>
<dd><p><a class="reference external" href="formatdomain.html#elementsVirtio">Virtio-specific options</a> can also be set (
<span class="since">Since 3.5.0</span> )</p>
</dd>
<dt>VGA configuration</dt>
<dd><p>Control how the video devices exposed to the guest using the <span class="docutils literal">vgaconf</span>
attribute which takes the value "io", "on" or "off". At present, it's only
applicable to the bhyve's "gop" video model type ( <span class="since">Since 3.5.0</span> )</p>
</dd>
</dl>
</dd>
</dl>
<p><span class="anchor"><a id="elementsConsole"/></span></p>
</div>
<div class="section" id="consoles-serial-parallel-channel-devices">
<h3><a class="toc-backref" href="formatdomain.html#id70">Consoles, serial, parallel &amp; channel devices</a><a class="headerlink" href="formatdomain.html#consoles-serial-parallel-channel-devices" title="Link to this headline">¶</a></h3>
<p>A character device provides a way to interact with the virtual machine.
Paravirtualized consoles, serial ports, parallel ports and channels are all
classed as character devices and so represented using the same syntax.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;parallel type='pty'&gt;
    &lt;source path='/dev/pts/2'/&gt;
    &lt;target port='0'/&gt;
  &lt;/parallel&gt;
  &lt;serial type='pty'&gt;
    &lt;source path='/dev/pts/3'/&gt;
    &lt;target port='0'/&gt;
  &lt;/serial&gt;
  &lt;serial type='file'&gt;
    &lt;source path='/tmp/file' append='on'&gt;
      &lt;seclabel model='dac' relabel='no'/&gt;
    &lt;/source&gt;
    &lt;target port='0'/&gt;
  &lt;/serial&gt;
  &lt;console type='pty'&gt;
    &lt;source path='/dev/pts/4'/&gt;
    &lt;target port='0'/&gt;
  &lt;/console&gt;
  &lt;channel type='unix'&gt;
    &lt;source mode='bind' path='/tmp/guestfwd'/&gt;
    &lt;target type='guestfwd' address='10.0.2.1' port='4600'/&gt;
  &lt;/channel&gt;
&lt;/devices&gt;
...</pre>
<p>In each of these directives, the top-level element name (parallel, serial,
console, channel) describes how the device is presented to the guest. The guest
interface is configured by the <span class="docutils literal">target</span> element.</p>
<p>The interface presented to the host is given in the <span class="docutils literal">type</span> attribute of the
top-level element. The host interface is configured by the <span class="docutils literal">source</span> element.</p>
<p>The <span class="docutils literal">source</span> element may contain an optional <span class="docutils literal">seclabel</span> to override the way
that labelling is done on the socket path. If this element is not present, the
<a class="reference external" href="formatdomain.html#seclabel">security label is inherited from the per-domain setting</a>.</p>
<p>If the interface <span class="docutils literal">type</span> presented to the host is "file", then the <span class="docutils literal">source</span>
element may contain an optional attribute <span class="docutils literal">append</span> that specifies whether or
not the information in the file should be preserved on domain restart. Allowed
values are "on" and "off" (default). <span class="since">Since 1.3.1</span> .</p>
<p>Regardless of the <span class="docutils literal">type</span>, character devices can have an optional log file
associated with them. This is expressed via a <span class="docutils literal">log</span> sub-element, with a
<span class="docutils literal">file</span> attribute. There can also be an <span class="docutils literal">append</span> attribute which takes the
same values described above. <span class="since">Since 1.3.3</span> .</p>
<pre class="literal-block">...
&lt;log file="/var/log/libvirt/qemu/guestname-serial0.log" append="off"/&gt;
...</pre>
<p>Each character device element has an optional sub-element <span class="docutils literal">&lt;address&gt;</span> which
can tie the device to a particular <a class="reference external" href="formatdomain.html#elementsControllers">controller</a> or PCI
slot.</p>
<p>For character device with type <span class="docutils literal">unix</span> or <span class="docutils literal">tcp</span> the <span class="docutils literal">source</span> has an
optional element <span class="docutils literal">reconnect</span> which configures reconnect timeout if the
connection is lost. There are two attributes, <span class="docutils literal">enabled</span> where possible values
are "yes" and "no" and <span class="docutils literal">timeout</span> which is in seconds. The <span class="docutils literal">reconnect</span>
attribute is valid only for <span class="docutils literal">connect</span> mode. <span class="since">Since 3.7.0 (QEMU driver
only)</span> .</p>
<p><span class="anchor"><a id="elementsCharGuestInterface"/></span></p>
<div class="section" id="guest-interface">
<h4><a class="toc-backref" href="formatdomain.html#id71">Guest interface</a><a class="headerlink" href="formatdomain.html#guest-interface" title="Link to this headline">¶</a></h4>
<p>A character device presents itself to the guest as one of the following types.</p>
<p><span class="anchor"><a id="elementCharParallel"/></span></p>
<div class="section" id="parallel-port">
<h5><a class="toc-backref" href="formatdomain.html#id72">Parallel port</a><a class="headerlink" href="formatdomain.html#parallel-port" title="Link to this headline">¶</a></h5>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;parallel type='pty'&gt;
    &lt;source path='/dev/pts/2'/&gt;
    &lt;target port='0'/&gt;
  &lt;/parallel&gt;
&lt;/devices&gt;
...</pre>
<p><span class="docutils literal">target</span> can have a <span class="docutils literal">port</span> attribute, which specifies the port number. Ports
are numbered starting from 0. There are usually 0, 1 or 2 parallel ports.</p>
<p><span class="anchor"><a id="elementCharSerial"/></span></p>
</div>
<div class="section" id="serial-port">
<h5><a class="toc-backref" href="formatdomain.html#id73">Serial port</a><a class="headerlink" href="formatdomain.html#serial-port" title="Link to this headline">¶</a></h5>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;!-- Serial port --&gt;
  &lt;serial type='pty'&gt;
    &lt;source path='/dev/pts/3'/&gt;
    &lt;target port='0'/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;!-- USB serial port --&gt;
  &lt;serial type='pty'&gt;
    &lt;target type='usb-serial' port='0'&gt;
      &lt;model name='usb-serial'/&gt;
    &lt;/target&gt;
    &lt;address type='usb' bus='0' port='1'/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p>The <span class="docutils literal">target</span> element can have an optional <span class="docutils literal">port</span> attribute, which specifies
the port number (starting from 0), and an optional <span class="docutils literal">type</span> attribute: valid
values are, <span class="since">since 1.0.2</span> , <span class="docutils literal"><span class="pre">isa-serial</span></span> (usable with x86 guests),
<span class="docutils literal"><span class="pre">usb-serial</span></span> (usable whenever USB support is available) and <span class="docutils literal"><span class="pre">pci-serial</span></span>
(usable whenever PCI support is available); <span class="since">since 3.10.0</span> ,
<span class="docutils literal"><span class="pre">spapr-vio-serial</span></span> (usable with ppc64/pseries guests), <span class="docutils literal"><span class="pre">system-serial</span></span>
(usable with aarch64/virt and, <span class="since">since 4.7.0</span> , riscv/virt guests) and
<span class="docutils literal"><span class="pre">sclp-serial</span></span> (usable with s390 and s390x guests) are available as well.</p>
<p><span class="since">Since 3.10.0</span> , the <span class="docutils literal">target</span> element can have an optional <span class="docutils literal">model</span>
subelement; valid values for its <span class="docutils literal">name</span> attribute are: <span class="docutils literal"><span class="pre">isa-serial</span></span> (usable
with the <span class="docutils literal"><span class="pre">isa-serial</span></span> target type); <span class="docutils literal"><span class="pre">usb-serial</span></span> (usable with the
<span class="docutils literal"><span class="pre">usb-serial</span></span> target type); <span class="docutils literal"><span class="pre">pci-serial</span></span> (usable with the <span class="docutils literal"><span class="pre">pci-serial</span></span>
target type); <span class="docutils literal"><span class="pre">spapr-vty</span></span> (usable with the <span class="docutils literal"><span class="pre">spapr-vio-serial</span></span> target type);
<span class="docutils literal">pl011</span> and, <span class="since">since 4.7.0</span> , <span class="docutils literal">16550a</span> (usable with the
<span class="docutils literal"><span class="pre">system-serial</span></span> target type); <span class="docutils literal">sclpconsole</span> and <span class="docutils literal">sclplmconsole</span> (usable
with the <span class="docutils literal"><span class="pre">sclp-serial</span></span> target type). Providing a target model is usually
unnecessary: libvirt will automatically pick one that's suitable for the chosen
target type, and overriding that value is generally not recommended.</p>
<p>If any of the attributes is not specified by the user, libvirt will choose a
value suitable for most users.</p>
<p>Most target types support configuring the guest-visible device address as
<a class="reference external" href="formatdomain.html#elementsAddress">documented above</a>; more specifically, acceptable address
types are <span class="docutils literal">isa</span> (for <span class="docutils literal"><span class="pre">isa-serial</span></span>), <span class="docutils literal">usb</span> (for <span class="docutils literal"><span class="pre">usb-serial</span></span>), <span class="docutils literal">pci</span>
(for <span class="docutils literal"><span class="pre">pci-serial</span></span>) and <span class="docutils literal"><span class="pre">spapr-vio</span></span> (for <span class="docutils literal"><span class="pre">spapr-vio-serial</span></span>). The
<span class="docutils literal"><span class="pre">system-serial</span></span> and <span class="docutils literal"><span class="pre">sclp-serial</span></span> target types don't support specifying an
address.</p>
<p>For the relationship between serial ports and consoles, <a class="reference external" href="formatdomain.html#elementCharSerialAndConsole">see
below</a>.</p>
<p><span class="anchor"><a id="elementCharConsole"/></span></p>
</div>
<div class="section" id="console">
<h5><a class="toc-backref" href="formatdomain.html#id74">Console</a><a class="headerlink" href="formatdomain.html#console" title="Link to this headline">¶</a></h5>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;!-- Serial console --&gt;
  &lt;console type='pty'&gt;
    &lt;source path='/dev/pts/2'/&gt;
   &lt;target type='serial' port='0'/&gt;
  &lt;/console&gt;
&lt;/devices&gt;
...</pre>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;!-- KVM virtio console --&gt;
  &lt;console type='pty'&gt;
    &lt;source path='/dev/pts/5'/&gt;
    &lt;target type='virtio' port='0'/&gt;
  &lt;/console&gt;
&lt;/devices&gt;
...</pre>
<p>The <span class="docutils literal">console</span> element is used to represent interactive serial consoles.
Depending on the type of guest in use and the specifics of the configuration,
the <span class="docutils literal">console</span> element might represent the same device as an existing
<span class="docutils literal">serial</span> element or a separate device.</p>
<p>A <span class="docutils literal">target</span> subelement is supported and works the same way as with the
<span class="docutils literal">serial</span> element (<a class="reference external" href="formatdomain.html#elementCharSerial">see above</a> for details). Valid
values for the <span class="docutils literal">type</span> attribute are: <span class="docutils literal">serial</span> (described below); <span class="docutils literal">virtio</span>
(usable whenever VirtIO support is available); <span class="docutils literal">xen</span>, <span class="docutils literal">lxc</span> and <span class="docutils literal">openvz</span>
(available when the corresponding hypervisor is in use). <span class="docutils literal">sclp</span> and <span class="docutils literal">sclplm</span>
(usable for s390 and s390x QEMU guests) are supported for compatibility reasons
but should not be used for new guests: use the <span class="docutils literal">sclpconsole</span> and
<span class="docutils literal">sclplmconsole</span> target models, respectively, with the <span class="docutils literal">serial</span> element
instead.</p>
<p>Of the target types listed above, <span class="docutils literal">serial</span> is special in that it doesn't
represents a separate device, but rather the same device as the first <span class="docutils literal">serial</span>
element. Due to this, there can only be a single <span class="docutils literal">console</span> element with target
type <span class="docutils literal">serial</span> per guest.</p>
<p>Virtio consoles are usually accessible as <span class="docutils literal"><span class="pre">/dev/hvc[0-7]</span></span> from inside the
guest; for more information, see
<a class="reference external" href="https://fedoraproject.org/wiki/Features/VirtioSerial">https://fedoraproject.org/wiki/Features/VirtioSerial</a>. <span class="since">Since 0.8.3</span></p>
<p>For the relationship between serial ports and consoles, <a class="reference external" href="formatdomain.html#elementCharSerialAndConsole">see
below</a>.</p>
<p><span class="anchor"><a id="elementCharSerialAndConsole"/></span></p>
</div>
<div class="section" id="relationship-between-serial-ports-and-consoles">
<h5><a class="toc-backref" href="formatdomain.html#id75">Relationship between serial ports and consoles</a><a class="headerlink" href="formatdomain.html#relationship-between-serial-ports-and-consoles" title="Link to this headline">¶</a></h5>
<p>Due to historical reasons, the <span class="docutils literal">serial</span> and <span class="docutils literal">console</span> elements have
partially overlapping scopes.</p>
<p>In general, both elements are used to configure one or more serial consoles to
be used for interacting with the guest. The main difference between the two is
that <span class="docutils literal">serial</span> is used for emulated, usually native, serial consoles, whereas
<span class="docutils literal">console</span> is used for paravirtualized ones.</p>
<p>Both emulated and paravirtualized serial consoles have advantages and
disadvantages:</p>
<ul class="simple">
<li><p>emulated serial consoles are usually initialized much earlier than
paravirtualized ones, so they can be used to control the bootloader and
display both firmware and early boot messages;</p></li>
<li><p>on several platforms, there can only be a single emulated serial console per
guest but paravirtualized consoles don't suffer from the same limitation.</p></li>
</ul>
<p>A configuration such as:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;console type='pty'&gt;
    &lt;target type='serial'/&gt;
  &lt;/console&gt;
  &lt;console type='pty'&gt;
    &lt;target type='virtio'/&gt;
  &lt;/console&gt;
&lt;/devices&gt;
...</pre>
<p>will work on any platform and will result in one emulated serial console for
early boot logging / interactive / recovery use, and one paravirtualized serial
console to be used eg. as a side channel. Most people will be fine with having
just the first <span class="docutils literal">console</span> element in their configuration, but if a specific
configuration is desired then both elements should be specified.</p>
<p>Note that, due to the compatibility concerns mentioned earlier, all the
following configurations:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type='pty'/&gt;
&lt;/devices&gt;
...</pre>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;console type='pty'/&gt;
&lt;/devices&gt;
...</pre>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type='pty'/&gt;
  &lt;console type='pty'/&gt;
&lt;/devices&gt;
...</pre>
<p>will be treated the same and will result in a single emulated serial console
being available to the guest.</p>
<p><span class="anchor"><a id="elementCharChannel"/></span></p>
</div>
<div class="section" id="channel">
<h5><a class="toc-backref" href="formatdomain.html#id76">Channel</a><a class="headerlink" href="formatdomain.html#channel" title="Link to this headline">¶</a></h5>
<p>This represents a private communication channel between the host and the guest.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;channel type='unix'&gt;
    &lt;source mode='bind' path='/tmp/guestfwd'/&gt;
    &lt;target type='guestfwd' address='10.0.2.1' port='4600'/&gt;
  &lt;/channel&gt;

  &lt;!-- KVM virtio channel --&gt;
  &lt;channel type='pty'&gt;
    &lt;target type='virtio' name='arbitrary.virtio.serial.port.name'/&gt;
  &lt;/channel&gt;
  &lt;channel type='unix'&gt;
    &lt;source mode='bind' path='/var/lib/libvirt/qemu/f16x86_64.agent'/&gt;
    &lt;target type='virtio' name='org.qemu.guest_agent.0' state='connected'/&gt;
  &lt;/channel&gt;
  &lt;channel type='spicevmc'&gt;
    &lt;target type='virtio' name='com.redhat.spice.0'/&gt;
  &lt;/channel&gt;
&lt;/devices&gt;
...</pre>
<p>This can be implemented in a variety of ways. The specific type of channel is
given in the <span class="docutils literal">type</span> attribute of the <span class="docutils literal">target</span> element. Different channel
types have different <span class="docutils literal">target</span> attributes.</p>
<dl class="simple">
<dt><span class="docutils literal">guestfwd</span></dt>
<dd><p>TCP traffic sent by the guest to a given IP address and port is forwarded to
the channel device on the host. The <span class="docutils literal">target</span> element must have <span class="docutils literal">address</span>
and <span class="docutils literal">port</span> attributes. <span class="since">Since 0.7.3</span></p>
</dd>
<dt><span class="docutils literal">virtio</span></dt>
<dd><p>Paravirtualized virtio channel. Channel is exposed in the guest under
/dev/vport*, and if the optional element <span class="docutils literal">name</span> is specified,
/dev/virtio-ports/$name (for more info, please see
<a class="reference external" href="https://fedoraproject.org/wiki/Features/VirtioSerial">https://fedoraproject.org/wiki/Features/VirtioSerial</a>). The optional element
<span class="docutils literal">address</span> can tie the channel to a particular <span class="docutils literal"><span class="pre">type='virtio-serial'</span></span>
controller, <a class="reference external" href="formatdomain.html#elementsAddress">documented above</a>. With qemu, if <span class="docutils literal">name</span>
is "org.qemu.guest_agent.0", then libvirt can interact with a guest agent
installed in the guest, for actions such as guest shutdown or file system
quiescing. <span class="since">Since 0.7.7, guest agent interaction since 0.9.10</span>
Moreover, <span class="since">since 1.0.6</span> it is possible to have source path auto
generated for virtio unix channels. This is very useful in case of a qemu
guest agent, where users don't usually care about the source path since it's
libvirt who talks to the guest agent. In case users want to utilize this
feature, they should leave <span class="docutils literal">&lt;source&gt;</span> element out. <span class="since">Since 1.2.11</span>
the active XML for a virtio channel may contain an optional <span class="docutils literal">state</span>
attribute that reflects whether a process in the guest is active on the
channel. This is an output-only attribute. Possible values for the <span class="docutils literal">state</span>
attribute are <span class="docutils literal">connected</span> and <span class="docutils literal">disconnected</span>.</p>
</dd>
<dt><span class="docutils literal">xen</span></dt>
<dd><p>Paravirtualized Xen channel. Channel is exposed in the guest as a Xen console
but identified with a name. Setup and consumption of a Xen channel depends on
software and configuration in the guest. See the xen-pv-channel(7) man page
for more information. Channel source path semantics are the same as the virtio
target type. The <span class="docutils literal">state</span> attribute is not supported since Xen channels lack
the necessary probing mechanism. <span class="since">Since 2.3.0</span></p>
</dd>
<dt><span class="docutils literal">spicevmc</span></dt>
<dd><p>Paravirtualized SPICE channel. The domain must also have a SPICE server as a
<a class="reference external" href="formatdomain.html#elementsGraphics">graphics device</a>, at which point the host piggy-backs
messages across the <span class="docutils literal">main</span> channel. The <span class="docutils literal">target</span> element must be present,
with attribute <span class="docutils literal"><span class="pre">type='virtio'</span></span>; an optional attribute <span class="docutils literal">name</span> controls how
the guest will have access to the channel, and defaults to
<span class="docutils literal"><span class="pre">name='com.redhat.spice.0'</span></span>. The optional <span class="docutils literal">address</span> element can tie the
channel to a particular <span class="docutils literal"><span class="pre">type='virtio-serial'</span></span> controller. <span class="since">Since
0.8.8</span></p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsCharHostInterface"/></span></p>
</div>
</div>
<div class="section" id="host-interface">
<h4><a class="toc-backref" href="formatdomain.html#id77">Host interface</a><a class="headerlink" href="formatdomain.html#host-interface" title="Link to this headline">¶</a></h4>
<p>A character device presents itself to the host as one of the following types.</p>
<p><span class="anchor"><a id="elementsCharSTDIO"/></span></p>
<div class="section" id="domain-logfile">
<h5><a class="toc-backref" href="formatdomain.html#id78">Domain logfile</a><a class="headerlink" href="formatdomain.html#domain-logfile" title="Link to this headline">¶</a></h5>
<p>This disables all input on the character device, and sends output into the
virtual machine's logfile</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;console type='stdio'&gt;
    &lt;target port='1'/&gt;
  &lt;/console&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsCharFle"/></span></p>
</div>
<div class="section" id="device-logfile">
<h5><a class="toc-backref" href="formatdomain.html#id79">Device logfile</a><a class="headerlink" href="formatdomain.html#device-logfile" title="Link to this headline">¶</a></h5>
<p>A file is opened and all data sent to the character device is written to the
file.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="file"&gt;
    &lt;source path="/var/log/vm/vm-serial.log"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsCharVC"/></span></p>
</div>
<div class="section" id="virtual-console">
<h5><a class="toc-backref" href="formatdomain.html#id80">Virtual console</a><a class="headerlink" href="formatdomain.html#virtual-console" title="Link to this headline">¶</a></h5>
<p>Connects the character device to the graphical framebuffer in a virtual console.
This is typically accessed via a special hotkey sequence such as "ctrl+alt+3"</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type='vc'&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsCharNull"/></span></p>
</div>
<div class="section" id="null-device">
<h5><a class="toc-backref" href="formatdomain.html#id81">Null device</a><a class="headerlink" href="formatdomain.html#null-device" title="Link to this headline">¶</a></h5>
<p>Connects the character device to the void. No data is ever provided to the
input. All data written is discarded.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type='null'&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsCharPTY"/></span></p>
</div>
<div class="section" id="pseudo-tty">
<h5><a class="toc-backref" href="formatdomain.html#id82">Pseudo TTY</a><a class="headerlink" href="formatdomain.html#pseudo-tty" title="Link to this headline">¶</a></h5>
<p>A Pseudo TTY is allocated using /dev/ptmx. A suitable client such as 'virsh
console' can connect to interact with the serial port locally.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="pty"&gt;
    &lt;source path="/dev/pts/3"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p>NB special case if &lt;console type='pty'&gt;, then the TTY path is also duplicated as
an attribute tty='/dev/pts/3' on the top level &lt;console&gt; tag. This provides
compat with existing syntax for &lt;console&gt; tags.</p>
<p><span class="anchor"><a id="elementsCharHost"/></span></p>
</div>
<div class="section" id="host-device-proxy">
<h5><a class="toc-backref" href="formatdomain.html#id83">Host device proxy</a><a class="headerlink" href="formatdomain.html#host-device-proxy" title="Link to this headline">¶</a></h5>
<p>The character device is passed through to the underlying physical character
device. The device types must match, eg the emulated serial port should only be
connected to a host serial port - don't connect a serial port to a parallel
port.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="dev"&gt;
    &lt;source path="/dev/ttyS0"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsCharPipe"/></span></p>
</div>
<div class="section" id="named-pipe">
<h5><a class="toc-backref" href="formatdomain.html#id84">Named pipe</a><a class="headerlink" href="formatdomain.html#named-pipe" title="Link to this headline">¶</a></h5>
<p>The character device writes output to a named pipe. See pipe(7) for more info.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="pipe"&gt;
    &lt;source path="/tmp/mypipe"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsCharTCP"/></span></p>
</div>
<div class="section" id="tcp-client-server">
<h5><a class="toc-backref" href="formatdomain.html#id85">TCP client/server</a><a class="headerlink" href="formatdomain.html#tcp-client-server" title="Link to this headline">¶</a></h5>
<p>The character device acts as a TCP client connecting to a remote server.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="tcp"&gt;
    &lt;source mode="connect" host="0.0.0.0" service="2445"/&gt;
    &lt;protocol type="raw"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
 ...</pre>
<p>Or as a TCP server waiting for a client connection.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="tcp"&gt;
    &lt;source mode="bind" host="127.0.0.1" service="2445"/&gt;
    &lt;protocol type="raw"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p>Alternatively you can use <span class="docutils literal">telnet</span> instead of <span class="docutils literal">raw</span> TCP in order to utilize
the telnet protocol for the connection.</p>
<p><span class="since">Since 0.8.5,</span> some hypervisors support use of either <span class="docutils literal">telnets</span> (secure
telnet) or <span class="docutils literal">tls</span> (via secure sockets layer) as the transport protocol for
connections.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="tcp"&gt;
    &lt;source mode="connect" host="0.0.0.0" service="2445"/&gt;
    &lt;protocol type="telnet"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
  ...
  &lt;serial type="tcp"&gt;
    &lt;source mode="bind" host="127.0.0.1" service="2445"/&gt;
    &lt;protocol type="telnet"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p><span class="since">Since 2.4.0,</span> the optional attribute <span class="docutils literal">tls</span> can be used to control
whether a chardev TCP communication channel would utilize a hypervisor
configured TLS X.509 certificate environment in order to encrypt the data
channel. For the QEMU hypervisor, usage of a TLS environment can be controlled
on the host by the <span class="docutils literal">chardev_tls</span> and <span class="docutils literal">chardev_tls_x509_cert_dir</span> or
<span class="docutils literal">default_tls_x509_cert_dir</span> settings in the file /etc/libvirt/qemu.conf. If
<span class="docutils literal">chardev_tls</span> is enabled, then unless the <span class="docutils literal">tls</span> attribute is set to "no",
libvirt will use the host configured TLS environment. If <span class="docutils literal">chardev_tls</span> is
disabled, but the <span class="docutils literal">tls</span> attribute is set to "yes", then libvirt will attempt
to use the host TLS environment if either the <span class="docutils literal">chardev_tls_x509_cert_dir</span> or
<span class="docutils literal">default_tls_x509_cert_dir</span> TLS directory structure exists.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="tcp"&gt;
    &lt;source mode='connect' host="127.0.0.1" service="5555" tls="yes"/&gt;
    &lt;protocol type="raw"/&gt;
    &lt;target port="0"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsCharUDP"/></span></p>
</div>
<div class="section" id="udp-network-console">
<h5><a class="toc-backref" href="formatdomain.html#id86">UDP network console</a><a class="headerlink" href="formatdomain.html#udp-network-console" title="Link to this headline">¶</a></h5>
<p>The character device acts as a UDP netconsole service, sending and receiving
packets. This is a lossy service.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="udp"&gt;
    &lt;source mode="bind" host="0.0.0.0" service="2445"/&gt;
    &lt;source mode="connect" host="0.0.0.0" service="2445"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsCharUNIX"/></span></p>
</div>
<div class="section" id="unix-domain-socket-client-server">
<h5><a class="toc-backref" href="formatdomain.html#id87">UNIX domain socket client/server</a><a class="headerlink" href="formatdomain.html#unix-domain-socket-client-server" title="Link to this headline">¶</a></h5>
<p>The character device acts as a UNIX domain socket server, accepting connections
from local clients.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="unix"&gt;
    &lt;source mode="bind" path="/tmp/foo"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsCharSpiceport"/></span></p>
</div>
<div class="section" id="spice-channel">
<h5><a class="toc-backref" href="formatdomain.html#id88">Spice channel</a><a class="headerlink" href="formatdomain.html#spice-channel" title="Link to this headline">¶</a></h5>
<p>The character device is accessible through spice connection under a channel name
specified in the <span class="docutils literal">channel</span> attribute. <span class="since">Since 1.2.2</span></p>
<p>Note: depending on the hypervisor, spiceports might (or might not) be enabled on
domains with or without <a class="reference external" href="formatdomain.html#elementsGraphics">spice graphics</a>.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="spiceport"&gt;
    &lt;source channel="org.qemu.console.serial.0"/&gt;
    &lt;target port="1"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="elementsNmdm"/></span></p>
</div>
<div class="section" id="nmdm-device">
<h5><a class="toc-backref" href="formatdomain.html#id89">Nmdm device</a><a class="headerlink" href="formatdomain.html#nmdm-device" title="Link to this headline">¶</a></h5>
<p>The nmdm device driver, available on FreeBSD, provides two tty devices connected
together by a virtual null modem cable. <span class="since">Since 1.2.4</span></p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;serial type="nmdm"&gt;
    &lt;source master="/dev/nmdm0A" slave="/dev/nmdm0B"/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
...</pre>
<p>The <span class="docutils literal">source</span> element has these attributes:</p>
<dl class="simple">
<dt><span class="docutils literal">master</span></dt>
<dd><p>Master device of the pair, that is passed to the hypervisor. Device is
specified by a fully qualified path.</p>
</dd>
<dt><span class="docutils literal">slave</span></dt>
<dd><p>Slave device of the pair, that is passed to the clients for connection to the
guest console. Device is specified by a fully qualified path.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsSound"/></span></p>
</div>
</div>
</div>
<div class="section" id="sound-devices">
<h3><a class="toc-backref" href="formatdomain.html#id90">Sound devices</a><a class="headerlink" href="formatdomain.html#sound-devices" title="Link to this headline">¶</a></h3>
<p>A virtual sound card can be attached to the host via the <span class="docutils literal">sound</span> element.
<span class="since">Since 0.4.3</span></p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;sound model='es1370'/&gt;
&lt;/devices&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">sound</span></dt>
<dd><p>The <span class="docutils literal">sound</span> element has one mandatory attribute, <span class="docutils literal">model</span>, which specifies
what real sound device is emulated. Valid values are specific to the
underlying hypervisor, though typical choices are 'es1370', 'sb16', 'ac97',
'ich6' and 'usb'. ( <span class="since">'ac97' only since 0.6.0, 'ich6' only since
0.8.8, 'usb' only since 1.2.7</span> )</p>
</dd>
</dl>
<p><span class="since">Since 0.9.13</span> , a sound element with <span class="docutils literal">ich6</span> model can have optional
sub-elements <span class="docutils literal">&lt;codec&gt;</span> to attach various audio codecs to the audio device. If
not specified, a default codec will be attached to allow playback and recording.</p>
<p>Valid values are:</p>
<ul class="simple">
<li><p>'duplex' - advertise a line-in and a line-out</p></li>
<li><p>'micro' - advertise a speaker and a microphone</p></li>
<li><p>'output' - advertise a line-out <span class="since">Since 4.4.0</span></p></li>
</ul>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;sound model='ich6'&gt;
    &lt;codec type='micro'/&gt;
  &lt;/sound&gt;
&lt;/devices&gt;
...</pre>
<p>Each <span class="docutils literal">sound</span> element has an optional sub-element <span class="docutils literal">&lt;address&gt;</span> which can tie
the device to a particular PCI slot, <a class="reference external" href="formatdomain.html#elementsAddress">documented above</a>.</p>
<p><span class="since">Since 6.7.0</span>, a sound device could be optionally mapped to the specific
host audio backend using the <span class="docutils literal">&lt;audio&gt;</span> sub-element:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;sound model='ich7'&gt;
     &lt;audio id='1'&gt;
  &lt;/sound&gt;
&lt;/devices&gt;
...</pre>
<p>Where <span class="docutils literal">1</span> is an id of the <a class="reference external" href="formatdomain.html#elementsAudio">audio device</a>.
This is supported for bhyve only.</p>
<p><span class="anchor"><a id="elementsAudio"/></span></p>
</div>
<div class="section" id="audio-devices">
<h3><a class="toc-backref" href="formatdomain.html#id91">Audio devices</a><a class="headerlink" href="formatdomain.html#audio-devices" title="Link to this headline">¶</a></h3>
<p>A virtual audio device corresponds to a host audio backend that is mapped
to the guest sound device. <span class="since">Since 6.7.0, bhyve only</span></p>
<dl class="simple">
<dt><span class="docutils literal">type</span></dt>
<dd><p>The required <span class="docutils literal">type</span> attribute specifies audio backend type.
Currently, the only supported value is 'oss'.</p>
</dd>
<dt><span class="docutils literal">id</span></dt>
<dd><p>Integer id of the audio device. Must be greater than 0.</p>
</dd>
</dl>
<p>The 'oss' audio type supports additional configuration:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;audio type='oss' id='1'&gt;
    &lt;input dev='/dev/dsp0'/&gt;
    &lt;output dev='/dev/dsp0'/&gt;
  &lt;/audio&gt;
&lt;/devices&gt;</pre>
<dl class="simple">
<dt><span class="docutils literal">input</span></dt>
<dd><p>Input device. The required <span class="docutils literal">dev</span> attribute specifies device path.</p>
</dd>
<dt><span class="docutils literal">output</span></dt>
<dd><p>Output device. The required <span class="docutils literal">dev</span> attribute specifies device path.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsWatchdog"/></span></p>
</div>
<div class="section" id="watchdog-device">
<h3><a class="toc-backref" href="formatdomain.html#id92">Watchdog device</a><a class="headerlink" href="formatdomain.html#watchdog-device" title="Link to this headline">¶</a></h3>
<p>A virtual hardware watchdog device can be added to the guest via the
<span class="docutils literal">watchdog</span> element. <span class="since">Since 0.7.3, QEMU and KVM only</span></p>
<p>The watchdog device requires an additional driver and management daemon in the
guest. Just enabling the watchdog in the libvirt configuration does not do
anything useful on its own.</p>
<p>Currently libvirt does not support notification when the watchdog fires. This
feature is planned for a future version of libvirt.</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;watchdog model='i6300esb'/&gt;
&lt;/devices&gt;
...</pre>
<pre class="literal-block">  ...
  &lt;devices&gt;
    &lt;watchdog model='i6300esb' action='poweroff'/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre>
<dl>
<dt><span class="docutils literal">model</span></dt>
<dd><p>The required <span class="docutils literal">model</span> attribute specifies what real watchdog device is
emulated. Valid values are specific to the underlying hypervisor.</p>
<p>QEMU and KVM support:</p>
<ul class="simple">
<li><p>'i6300esb' - the recommended device, emulating a PCI Intel 6300ESB</p></li>
<li><p>'ib700' - emulating an ISA iBase IB700</p></li>
<li><p>'diag288' - emulating an S390 DIAG288 device <span class="since">Since 1.2.17</span></p></li>
</ul>
</dd>
<dt><span class="docutils literal">action</span></dt>
<dd><p>The optional <span class="docutils literal">action</span> attribute describes what action to take when the
watchdog expires. Valid values are specific to the underlying hypervisor.</p>
<p>QEMU and KVM support:</p>
<ul class="simple">
<li><p>'reset' - default, forcefully reset the guest</p></li>
<li><p>'shutdown' - gracefully shutdown the guest (not recommended)</p></li>
<li><p>'poweroff' - forcefully power off the guest</p></li>
<li><p>'pause' - pause the guest</p></li>
<li><p>'none' - do nothing</p></li>
<li><p>'dump' - automatically dump the guest <span class="since">Since 0.8.7</span></p></li>
<li><p>'inject-nmi' - inject a non-maskable interrupt into the guest
<span class="since">Since 1.2.17</span></p></li>
</ul>
<p>Note 1: the 'shutdown' action requires that the guest is responsive to ACPI
signals. In the sort of situations where the watchdog has expired, guests are
usually unable to respond to ACPI signals. Therefore using 'shutdown' is not
recommended.</p>
<p>Note 2: the directory to save dump files can be configured by
<span class="docutils literal">auto_dump_path</span> in file /etc/libvirt/qemu.conf.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsMemBalloon"/></span></p>
</div>
<div class="section" id="memory-balloon-device">
<h3><a class="toc-backref" href="formatdomain.html#id93">Memory balloon device</a><a class="headerlink" href="formatdomain.html#memory-balloon-device" title="Link to this headline">¶</a></h3>
<p>A virtual memory balloon device is added to all Xen and KVM/QEMU guests. It will
be seen as <span class="docutils literal">memballoon</span> element. It will be automatically added when
appropriate, so there is no need to explicitly add this element in the guest XML
unless a specific PCI slot needs to be assigned. <span class="since">Since 0.8.3, Xen, QEMU
and KVM only</span> Additionally, <span class="since">since 0.8.4</span> , if the memballoon device
needs to be explicitly disabled, <span class="docutils literal"><span class="pre">model='none'</span></span> may be used.</p>
<p>Example: automatically added device with KVM</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;memballoon model='virtio'/&gt;
&lt;/devices&gt;
...</pre>
<p>Example: manually added device with static PCI slot 2 requested</p>
<pre class="literal-block">  ...
  &lt;devices&gt;
    &lt;memballoon model='virtio'&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/&gt;
      &lt;stats period='10'/&gt;
      &lt;driver iommu='on' ats='on'/&gt;
    &lt;/memballoon&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre>
<dl>
<dt><span class="docutils literal">model</span></dt>
<dd><p>The required <span class="docutils literal">model</span> attribute specifies what type of balloon device is
provided. Valid values are specific to the virtualization platform</p>
<ul class="simple">
<li><p>'virtio' - default with QEMU/KVM</p></li>
<li><p>'virtio-transitional' <span class="since">Since 5.2.0</span></p></li>
<li><p>'virtio-non-transitional' <span class="since">Since 5.2.0</span></p></li>
<li><p>'xen' - default with Xen</p></li>
</ul>
<p>See <a class="reference external" href="formatdomain.html#elementsVirtioTransitional">Virtio transitional devices</a> for more
details.</p>
</dd>
<dt><span class="docutils literal">autodeflate</span></dt>
<dd><p>The optional <span class="docutils literal">autodeflate</span> attribute allows to enable/disable (values
"on"/"off", respectively) the ability of the QEMU virtio memory balloon to
release some memory at the last moment before a guest's process get killed by
Out of Memory killer. <span class="since">Since 1.3.1, QEMU and KVM only</span></p>
</dd>
<dt><span class="docutils literal">freePageReporting</span></dt>
<dd><p>The optional <span class="docutils literal">freePageReporting</span> attribute allows to enable/disable
("on"/"off", respectively) the ability of the QEMU virtio memory balloon to
return unused pages back to the hypervisor to be used by other guests or
processes. Please note that despite its name it has no effect on free memory
as reported by <span class="docutils literal">virDomainMemoryStats()</span> and/or <span class="docutils literal">virsh dommemstat</span>.
<span class="since">Since 6.9.0, QEMU and KVM only</span></p>
</dd>
<dt><span class="docutils literal">period</span></dt>
<dd><p>The optional <span class="docutils literal">period</span> allows the QEMU virtio memory balloon driver to
provide statistics through the <span class="docutils literal">virsh dommemstat           [domain]</span>
command. By default, collection is not enabled. In order to enable, use the
<span class="docutils literal">virsh dommemstat [domain] <span class="pre">--period</span>           [number]</span> command or
<span class="docutils literal">virsh edit</span> command to add the option to the XML definition. The
<span class="docutils literal">virsh dommemstat</span> will accept the options <span class="docutils literal"><span class="pre">--live</span></span>, <span class="docutils literal"><span class="pre">--current</span></span>, or
<span class="docutils literal"><span class="pre">--config</span></span>. If an option is not provided, the change for a running domain
will only be made to the active guest. If the QEMU driver is not at the right
revision, the attempt to set the period will fail. Large values (e.g. many
years) might be ignored. <span class="since">Since 1.1.1, requires QEMU 1.5</span></p>
</dd>
<dt><span class="docutils literal">driver</span></dt>
<dd><p>For model <span class="docutils literal">virtio</span> memballoon, <a class="reference external" href="formatdomain.html#elementsVirtio">Virtio-specific
options</a> can also be set. ( <span class="since">Since 3.5.0</span> )</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsRng"/></span></p>
</div>
<div class="section" id="random-number-generator-device">
<h3><a class="toc-backref" href="formatdomain.html#id94">Random number generator device</a><a class="headerlink" href="formatdomain.html#random-number-generator-device" title="Link to this headline">¶</a></h3>
<p>The virtual random number generator device allows the host to pass through
entropy to guest operating systems. <span class="since">Since 1.0.3</span></p>
<p>Example: usage of the RNG device:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;rng model='virtio'&gt;
    &lt;rate period="2000" bytes="1234"/&gt;
    &lt;backend model='random'&gt;/dev/random&lt;/backend&gt;
    &lt;!-- OR --&gt;
    &lt;backend model='egd' type='udp'&gt;
      &lt;source mode='bind' service='1234'/&gt;
      &lt;source mode='connect' host='1.2.3.4' service='1234'/&gt;
    &lt;/backend&gt;
    &lt;!-- OR --&gt;
    &lt;backend model='builtin'/&gt;
  &lt;/rng&gt;
&lt;/devices&gt;
...</pre>
<dl>
<dt><span class="docutils literal">model</span></dt>
<dd><p>The required <span class="docutils literal">model</span> attribute specifies what type of RNG device is
provided. Valid values are specific to the virtualization platform:</p>
<ul class="simple">
<li><p>'virtio' - supported by qemu and virtio-rng kernel module</p></li>
<li><p>'virtio-transitional' <span class="since">Since 5.2.0</span></p></li>
<li><p>'virtio-non-transitional' <span class="since">Since 5.2.0</span></p></li>
</ul>
<p>See <a class="reference external" href="formatdomain.html#elementsVirtioTransitional">Virtio transitional devices</a> for more
details.</p>
</dd>
<dt><span class="docutils literal">rate</span></dt>
<dd><p>The optional <span class="docutils literal">rate</span> element allows limiting the rate at which entropy can
be consumed from the source. The mandatory attribute <span class="docutils literal">bytes</span> specifies how
many bytes are permitted to be consumed per period. An optional <span class="docutils literal">period</span>
attribute specifies the duration of a period in milliseconds; if omitted, the
period is taken as 1000 milliseconds (1 second). <span class="since">Since 1.0.4</span></p>
</dd>
<dt><span class="docutils literal">backend</span></dt>
<dd><p>The <span class="docutils literal">backend</span> element specifies the source of entropy to be used for the
domain. The source model is configured using the <span class="docutils literal">model</span> attribute.
Supported source models are:</p>
<dl class="simple">
<dt><span class="docutils literal">random</span></dt>
<dd><p>This backend type expects a non-blocking character device as input. The
file name is specified as contents of the <span class="docutils literal">backend</span> element.
<span class="since">Since 1.3.4</span> any path is accepted. Before that <span class="docutils literal">/dev/random</span> and
<span class="docutils literal">/dev/hwrng</span> were the only accepted paths. When no file name is
specified, the hypervisor default is used. For QEMU, the default is
<span class="docutils literal">/dev/random</span>. However, the recommended source of entropy is
<span class="docutils literal">/dev/urandom</span> (as it doesn't have the limitations of <span class="docutils literal">/dev/random</span>).</p>
</dd>
<dt><span class="docutils literal">egd</span></dt>
<dd><p>This backend connects to a source using the EGD protocol. The source is
specified as a character device. Refer to <a class="reference external" href="formatdomain.html#elementsCharHostInterface">character device host
interface</a> for more information.</p>
</dd>
<dt><span class="docutils literal">builtin</span></dt>
<dd><p>This backend uses qemu builtin random generator, which uses
<span class="docutils literal">getrandom()</span> syscall as the source of entropy. ( <span class="since">Since 6.1.0
and QEMU 4.2</span> )</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">driver</span></dt>
<dd><p>The subelement <span class="docutils literal">driver</span> can be used to tune the device:</p>
<dl class="simple">
<dt>virtio options</dt>
<dd><p><a class="reference external" href="formatdomain.html#elementsVirtio">Virtio-specific options</a> can also be set. (
<span class="since">Since 3.5.0</span> )</p>
</dd>
</dl>
</dd>
</dl>
<p><span class="anchor"><a id="elementsTpm"/></span></p>
</div>
<div class="section" id="tpm-device">
<h3><a class="toc-backref" href="formatdomain.html#id95">TPM device</a><a class="headerlink" href="formatdomain.html#tpm-device" title="Link to this headline">¶</a></h3>
<p>The TPM device enables a QEMU guest to have access to TPM functionality. The TPM
device may either be a TPM 1.2 or a TPM 2.0.</p>
<p>The TPM passthrough device type provides access to the host's TPM for one QEMU
guest. No other software may be using the TPM device, typically /dev/tpm0, at
the time the QEMU guest is started. <span class="since">'passthrough' since 1.0.5</span></p>
<p>Example: usage of the TPM passthrough device</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;tpm model='tpm-tis'&gt;
    &lt;backend type='passthrough'&gt;
      &lt;device path='/dev/tpm0'/&gt;
    &lt;/backend&gt;
  &lt;/tpm&gt;
&lt;/devices&gt;
...</pre>
<p>The emulator device type gives access to a TPM emulator providing TPM
functionality for each VM. QEMU talks to it over a Unix socket. With the
emulator device type each guest gets its own private TPM. <span class="since">'emulator'
since 4.5.0</span> The state of the TPM emulator can be encrypted by providing an
<span class="docutils literal">encryption</span> element. <span class="since">'encryption' since 5.6.0</span></p>
<p>Example: usage of the TPM Emulator</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;tpm model='tpm-tis'&gt;
    &lt;backend type='emulator' version='2.0'&gt;
      &lt;encryption secret='6dd3e4a5-1d76-44ce-961f-f119f5aad935'/&gt;
    &lt;/backend&gt;
  &lt;/tpm&gt;
&lt;/devices&gt;
...</pre>
<dl>
<dt><span class="docutils literal">model</span></dt>
<dd><p>The <span class="docutils literal">model</span> attribute specifies what device model QEMU provides to the
guest. If no model name is provided, <span class="docutils literal"><span class="pre">tpm-tis</span></span> will automatically be chosen
for non-PPC64 architectures. <span class="since">Since 4.4.0</span> , another available choice
is the <span class="docutils literal"><span class="pre">tpm-crb</span></span>, which should only be used when the backend device is a
TPM 2.0. <span class="since">Since 6.1.0</span> , pSeries guests on PPC64 are supported and the
default is <span class="docutils literal"><span class="pre">tpm-spapr</span></span>. <span class="since">Since 6.5.0</span> , a new model called
<span class="docutils literal"><span class="pre">spapr-tpm-proxy</span></span> was added for pSeries guests. This model only works with
the <span class="docutils literal">passthrough</span> backend. It creates a TPM Proxy device that communicates
with an existing TPM Resource Manager in the host, for example
<span class="docutils literal">/dev/tpmrm0</span>, enabling the guest to run in secure virtual machine mode
with the help of an Ultravisor. Adding a TPM Proxy to a pSeries guest brings
no security benefits unless the guest is running on a PPC64 host that has an
Ultravisor and a TPM Resource Manager. Only one TPM Proxy device is allowed
per guest, but a TPM Proxy device can be added together with other TPM
devices.</p>
</dd>
<dt><span class="docutils literal">backend</span></dt>
<dd><p>The <span class="docutils literal">backend</span> element specifies the type of TPM device. The following types
are supported:</p>
<dl>
<dt><span class="docutils literal">passthrough</span></dt>
<dd><p>Use the host's TPM or TPM Resource Manager device.</p>
<p>This backend type requires exclusive access to a TPM device on the host.
An example for such a device is /dev/tpm0. The fully qualified file name
is specified by path attribute of the <span class="docutils literal">source</span> element. If no file name
is specified then /dev/tpm0 is automatically used. <span class="since">Since 6.5.0</span> ,
when choosing the <span class="docutils literal"><span class="pre">spapr-tpm-proxy</span></span> model, the file name specified is
expected to be a TPM Resource Manager device, e.g. <span class="docutils literal">/dev/tpmrm0</span>.</p>
</dd>
<dt><span class="docutils literal">emulator</span></dt>
<dd><p>For this backend type the 'swtpm' TPM Emulator must be installed on the
host. Libvirt will automatically start an independent TPM emulator for
each QEMU guest requesting access to it.</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">version</span></dt>
<dd><p>The <span class="docutils literal">version</span> attribute indicates the version of the TPM. By default a TPM
1.2 is created. This attribute only works with the <span class="docutils literal">emulator</span> backend. The
following versions are supported:</p>
<ul class="simple">
<li><p>'1.2' : creates a TPM 1.2</p></li>
<li><p>'2.0' : creates a TPM 2.0</p></li>
</ul>
</dd>
<dt><span class="docutils literal">persistent_state</span></dt>
<dd><p>The <span class="docutils literal">persistent_state</span> attribute indicates whether 'swtpm' TPM state is
kept or not when a transient domain is powered off or undefined. This
option can be used for preserving TPM state. By default the value is <span class="docutils literal">no</span>.
This attribute only works with the <span class="docutils literal">emulator</span> backend. The accepted values
are <span class="docutils literal">yes</span> and <span class="docutils literal">no</span>. <span class="since">Since 7.0.0</span></p>
</dd>
<dt><span class="docutils literal">encryption</span></dt>
<dd><p>The <span class="docutils literal">encryption</span> element allows the state of a TPM emulator to be
encrypted. The <span class="docutils literal">secret</span> must reference a secret object that holds the
passphrase from which the encryption key will be derived.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsNVRAM"/></span></p>
</div>
<div class="section" id="nvram-device">
<h3><a class="toc-backref" href="formatdomain.html#id96">NVRAM device</a><a class="headerlink" href="formatdomain.html#nvram-device" title="Link to this headline">¶</a></h3>
<p>nvram device is always added to pSeries guest on PPC64, and its address is
allowed to be changed. Element <span class="docutils literal">nvram</span> (only valid for pSeries guest,
<span class="since">since 1.0.5</span> ) is provided to enable the address setting.</p>
<p>Example: usage of NVRAM configuration</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;nvram&gt;
    &lt;address type='spapr-vio' reg='0x00003000'/&gt;
  &lt;/nvram&gt;
&lt;/devices&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal"><span class="pre">spapr-vio</span></span></dt>
<dd><p>VIO device address type, only valid for PPC64.</p>
</dd>
<dt><span class="docutils literal">reg</span></dt>
<dd><p>Device address</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsPanic"/></span></p>
</div>
<div class="section" id="panic-device">
<h3><a class="toc-backref" href="formatdomain.html#id97">panic device</a><a class="headerlink" href="formatdomain.html#panic-device" title="Link to this headline">¶</a></h3>
<p>panic device enables libvirt to receive panic notification from a QEMU guest.
<span class="since">Since 1.2.1, QEMU and KVM only</span></p>
<p>This feature is always enabled for:</p>
<ul class="simple">
<li><p>pSeries guests, since it's implemented by the guest firmware</p></li>
<li><p>S390 guests, since it's an integral part of the S390 architecture</p></li>
</ul>
<p>For the guest types listed above, libvirt automatically adds a <span class="docutils literal">panic</span> element
to the domain XML.</p>
<p>Example: usage of panic configuration</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;panic model='hyperv'/&gt;
  &lt;panic model='isa'&gt;
    &lt;address type='isa' iobase='0x505'/&gt;
  &lt;/panic&gt;
&lt;/devices&gt;
...</pre>
<dl class="simple">
<dt><span class="docutils literal">model</span></dt>
<dd><p>The optional <span class="docutils literal">model</span> attribute specifies what type of panic device is
provided. The panic model used when this attribute is missing depends on the
hypervisor and guest arch.</p>
<ul class="simple">
<li><p>'isa' - for ISA pvpanic device</p></li>
<li><p>'pseries' - default and valid only for pSeries guests.</p></li>
<li><p>'hyperv' - for Hyper-V crash CPU feature. <span class="since">Since 1.3.0, QEMU and
KVM only</span></p></li>
<li><p>'s390' - default for S390 guests. <span class="since">Since 1.3.5</span></p></li>
</ul>
</dd>
<dt><span class="docutils literal">address</span></dt>
<dd><p>address of panic. The default ioport is 0x505. Most users don't need to
specify an address, and doing so is forbidden altogether for s390, pseries
and hyperv models.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsShmem"/></span></p>
</div>
<div class="section" id="shared-memory-device">
<h3><a class="toc-backref" href="formatdomain.html#id98">Shared memory device</a><a class="headerlink" href="formatdomain.html#shared-memory-device" title="Link to this headline">¶</a></h3>
<p>A shared memory device allows to share a memory region between different virtual
machines and the host. <span class="since">Since 1.2.10, QEMU and KVM only</span></p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;shmem name='my_shmem0' role='peer'&gt;
    &lt;model type='ivshmem-plain'/&gt;
    &lt;size unit='M'&gt;4&lt;/size&gt;
  &lt;/shmem&gt;
  &lt;shmem name='shmem_server'&gt;
    &lt;model type='ivshmem-doorbell'/&gt;
    &lt;size unit='M'&gt;2&lt;/size&gt;
    &lt;server path='/tmp/socket-shmem'/&gt;
    &lt;msi vectors='32' ioeventfd='on'/&gt;
  &lt;/shmem&gt;
&lt;/devices&gt;
...</pre>
<dl>
<dt><span class="docutils literal">shmem</span></dt>
<dd><p>The <span class="docutils literal">shmem</span> element has one mandatory attribute, <span class="docutils literal">name</span> to identify the
shared memory. This attribute cannot be directory specific to <span class="docutils literal">.</span> or <span class="docutils literal">..</span>
as well as it cannot involve path separator <span class="docutils literal">/</span>.</p>
<p>The optional <span class="docutils literal">role</span> (<span class="since">since 6.6.0</span>) attribute specifies the shared
memory is migratable or not. The value can be either "master" or "peer", the
former will mean that upon migration, the data in the shared memory is
migrated with the domain. There should be only one "master" per shared
memory object. Migration with "peer" role is disabled. If migration of such
domain is required, the shmem device needs to be unplugged before migration
and plugged in at the destination upon successful migration. If the role not
specified, the hypervisor default is used. This attribute is currently
available only for <span class="docutils literal">model</span> type <span class="docutils literal"><span class="pre">ivshmem-plain</span></span> and
<span class="docutils literal"><span class="pre">ivshmem-doorbell</span></span>.</p>
</dd>
<dt><span class="docutils literal">model</span></dt>
<dd><p>Attribute <span class="docutils literal">type</span> of the optional element <span class="docutils literal">model</span> specifies the model of
the underlying device providing the <span class="docutils literal">shmem</span> device. The models currently
supported are <span class="docutils literal">ivshmem</span> (supports both server and server-less shmem, but is
deprecated by newer QEMU in favour of the -plain and -doorbell variants),
<span class="docutils literal"><span class="pre">ivshmem-plain</span></span> (only for server-less shmem) and <span class="docutils literal"><span class="pre">ivshmem-doorbell</span></span> (only
for shmem with the server).</p>
</dd>
<dt><span class="docutils literal">size</span></dt>
<dd><p>The optional <span class="docutils literal">size</span> element specifies the size of the shared memory. This
must be power of 2 and greater than or equal to 1 MiB.</p>
</dd>
<dt><span class="docutils literal">server</span></dt>
<dd><p>The optional <span class="docutils literal">server</span> element can be used to configure a server socket the
device is supposed to connect to. The optional <span class="docutils literal">path</span> attribute specifies
the absolute path to the unix socket and defaults to
<span class="docutils literal"><span class="pre">/var/lib/libvirt/shmem/$shmem-$name-sock</span></span>.</p>
</dd>
<dt><span class="docutils literal">msi</span></dt>
<dd><p>The optional <span class="docutils literal">msi</span> element enables/disables (values "on"/"off",
respectively) MSI interrupts. This option can currently be used only together
with the <span class="docutils literal">server</span> element. The <span class="docutils literal">vectors</span> attribute can be used to specify
the number of interrupt vectors. The <span class="docutils literal">ioeventd</span> attribute enables/disables
(values "on"/"off", respectively) ioeventfd.</p>
</dd>
</dl>
<p><span class="anchor"><a id="elementsMemory"/></span></p>
</div>
<div class="section" id="memory-devices">
<h3><a class="toc-backref" href="formatdomain.html#id99">Memory devices</a><a class="headerlink" href="formatdomain.html#memory-devices" title="Link to this headline">¶</a></h3>
<p>In addition to the initial memory assigned to the guest, memory devices allow
additional memory to be assigned to the guest in the form of memory modules. A
memory device can be hot-plugged or hot-unplugged depending on the guests'
memory resource needs. Some hypervisors may require NUMA configured for the
guest.</p>
<p>Example: usage of the memory devices</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;memory model='dimm' access='private' discard='yes'&gt;
    &lt;target&gt;
      &lt;size unit='KiB'&gt;524287&lt;/size&gt;
      &lt;node&gt;0&lt;/node&gt;
    &lt;/target&gt;
  &lt;/memory&gt;
  &lt;memory model='dimm'&gt;
    &lt;source&gt;
      &lt;pagesize unit='KiB'&gt;4096&lt;/pagesize&gt;
      &lt;nodemask&gt;1-3&lt;/nodemask&gt;
    &lt;/source&gt;
    &lt;target&gt;
      &lt;size unit='KiB'&gt;524287&lt;/size&gt;
      &lt;node&gt;1&lt;/node&gt;
    &lt;/target&gt;
  &lt;/memory&gt;
  &lt;memory model='nvdimm'&gt;
    &lt;uuid&gt;9066901e-c90a-46ad-8b55-c18868cf92ae&lt;/uuid&gt;
    &lt;source&gt;
      &lt;path&gt;/tmp/nvdimm&lt;/path&gt;
    &lt;/source&gt;
    &lt;target&gt;
      &lt;size unit='KiB'&gt;524288&lt;/size&gt;
      &lt;node&gt;1&lt;/node&gt;
      &lt;label&gt;
        &lt;size unit='KiB'&gt;128&lt;/size&gt;
      &lt;/label&gt;
      &lt;readonly/&gt;
    &lt;/target&gt;
  &lt;/memory&gt;
  &lt;memory model='nvdimm' access='shared'&gt;
    &lt;uuid&gt;e39080c8-7f99-4b12-9c43-d80014e977b8&lt;/uuid&gt;
    &lt;source&gt;
      &lt;path&gt;/dev/dax0.0&lt;/path&gt;
      &lt;alignsize unit='KiB'&gt;2048&lt;/alignsize&gt;
      &lt;pmem/&gt;
    &lt;/source&gt;
    &lt;target&gt;
      &lt;size unit='KiB'&gt;524288&lt;/size&gt;
      &lt;node&gt;1&lt;/node&gt;
      &lt;label&gt;
        &lt;size unit='KiB'&gt;128&lt;/size&gt;
      &lt;/label&gt;
    &lt;/target&gt;
  &lt;/memory&gt;
  &lt;memory model='virtio-pmem' access='shared'&gt;
    &lt;source&gt;
      &lt;path&gt;/tmp/virtio_pmem&lt;/path&gt;
    &lt;/source&gt;
    &lt;target&gt;
      &lt;size unit='KiB'&gt;524288&lt;/size&gt;
    &lt;/target&gt;
  &lt;/memory&gt;
&lt;/devices&gt;
...</pre>
<dl>
<dt><span class="docutils literal">model</span></dt>
<dd><p>Provide <span class="docutils literal">dimm</span> to add a virtual DIMM module to the guest. <span class="since">Since
1.2.14</span> Provide <span class="docutils literal">nvdimm</span> model that adds a Non-Volatile DIMM module.
<span class="since">Since 3.2.0</span> Provide <span class="docutils literal"><span class="pre">virtio-pmem</span></span> model to add a paravirtualized
persistent memory device. <span class="since">Since 7.1.0</span></p>
</dd>
<dt><span class="docutils literal">access</span></dt>
<dd><p>An optional attribute <span class="docutils literal">access</span> ( <span class="since">since 3.2.0</span> ) that provides
capability to fine tune mapping of the memory on per module basis. Values are
the same as <a class="reference external" href="formatdomain.html#elementsMemoryBacking">Memory Backing</a>: <span class="docutils literal">shared</span> and
<span class="docutils literal">private</span>. For <span class="docutils literal">nvdimm</span> model, if using real NVDIMM DAX device as
backend, <span class="docutils literal">shared</span> is required. For <span class="docutils literal"><span class="pre">virtio-pmem</span></span> model <span class="docutils literal">shared</span> is
required.</p>
</dd>
<dt><span class="docutils literal">discard</span></dt>
<dd><p>An optional attribute <span class="docutils literal">discard</span> ( <span class="since">since 4.4.0</span> ) that provides
capability to fine tune discard of data on per module basis. Accepted values
are <span class="docutils literal">yes</span> and <span class="docutils literal">no</span>. The feature is described here: <a class="reference external" href="formatdomain.html#elementsMemoryBacking">Memory
Backing</a>. This attribute is allowed only for
<span class="docutils literal"><span class="pre">model='dimm'</span></span>.</p>
</dd>
<dt><span class="docutils literal">uuid</span></dt>
<dd><p>For pSeries guests, an uuid can be set to identify the nvdimm module. If
absent, libvirt will generate an uuid automatically. This attribute is
allowed only for <span class="docutils literal"><span class="pre">model='nvdimm'</span></span> for pSeries guests. <span class="since">Since 6.2.0</span></p>
</dd>
<dt><span class="docutils literal">source</span></dt>
<dd><p>For model <span class="docutils literal">dimm</span> this element is optional and allows to fine tune the
source of the memory used for the given memory device. If the element is not
provided defaults configured via <span class="docutils literal">numatune</span> are used. If <span class="docutils literal">dimm</span> is
provided, then the following optional elements can be provided as well:</p>
<dl class="simple">
<dt><span class="docutils literal">pagesize</span></dt>
<dd><p>This element can be used to override the default host page size used for
backing the memory device. The configured value must correspond to a page
size supported by the host.</p>
</dd>
<dt><span class="docutils literal">nodemask</span></dt>
<dd><p>This element can be used to override the default set of NUMA nodes where
the memory would be allocated.</p>
</dd>
</dl>
<p>For model <span class="docutils literal">nvdimm</span> the <span class="docutils literal">source</span> element is mandatory. The mandatory
child element <span class="docutils literal">path</span> represents a path in the host that backs the nvdimm
module in the guest. The following optional elements may be used:</p>
<dl class="simple">
<dt><span class="docutils literal">alignsize</span></dt>
<dd><p>The <span class="docutils literal">alignsize</span> element defines the page size alignment used to mmap the
address range for the backend <span class="docutils literal">path</span>. If not supplied the host page size
is used. For example, to mmap a real NVDIMM device a 2M-aligned page may
be required, and host page size is 4KB, then we need to set this element
to 2MB. <span class="since">Since 5.0.0</span></p>
</dd>
<dt><span class="docutils literal">pmem</span></dt>
<dd><p>If persistent memory is supported and enabled by the hypervisor in order
to guarantee the persistence of writes to the vNVDIMM backend, then use
the <span class="docutils literal">pmem</span> element in order to utilize the feature. <span class="since">Since 5.0.0</span></p>
</dd>
</dl>
<p>For model <span class="docutils literal"><span class="pre">virtio-pmem</span></span> the <span class="docutils literal">source</span> element is mandatory. The following
optional elements may be used:</p>
<dl class="simple">
<dt><span class="docutils literal">path</span></dt>
<dd><p>Represents a path in the host that backs the virtio memory module in the
guest. It is mandatory.</p>
</dd>
</dl>
</dd>
<dt><span class="docutils literal">target</span></dt>
<dd><p>The mandatory <span class="docutils literal">target</span> element configures the placement and sizing of the
added memory from the perspective of the guest.</p>
<p>The mandatory <span class="docutils literal">size</span> subelement configures the size of the added memory as
a scaled integer.</p>
<p>The <span class="docutils literal">node</span> subelement configures the guest NUMA node to attach the memory
to. The element shall be used only if the guest has NUMA nodes configured.</p>
<p>The following optional elements may be used:</p>
<dl class="simple">
<dt><span class="docutils literal">label</span></dt>
<dd><p>For NVDIMM type devices one can use <span class="docutils literal">label</span> and its subelement <span class="docutils literal">size</span>
to configure the size of namespaces label storage within the NVDIMM
module. The <span class="docutils literal">size</span> element has usual meaning described
<a class="reference external" href="formatdomain.html#elementsMemoryAllocation">here</a>. <span class="docutils literal">label</span> is mandatory for pSeries
guests and optional for all other architectures. For QEMU domains the
following restrictions apply:</p>
<ol class="arabic simple">
<li><p>the minimum label size is 128KiB,</p></li>
<li><p>the remaining size (total-size - label-size), also called guest area,
will be aligned to 4KiB as default. For pSeries guests, the guest area
will be aligned down to 256MiB, and the minimum size of the guest area
must be at least 256MiB.</p></li>
</ol>
</dd>
<dt><span class="docutils literal">readonly</span></dt>
<dd><p>The <span class="docutils literal">readonly</span> element is used to mark the vNVDIMM as read-only. Only
the real NVDIMM device backend can guarantee the guest write persistence,
so other backend types should use the <span class="docutils literal">readonly</span> element. <span class="since">Since
5.0.0</span></p>
</dd>
</dl>
</dd>
</dl>
<p><span class="anchor"><a id="elementsIommu"/></span></p>
</div>
<div class="section" id="iommu-devices">
<h3><a class="toc-backref" href="formatdomain.html#id100">IOMMU devices</a><a class="headerlink" href="formatdomain.html#iommu-devices" title="Link to this headline">¶</a></h3>
<p>The <span class="docutils literal">iommu</span> element can be used to add an IOMMU device. <span class="since">Since 2.1.0</span></p>
<p>Example:</p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;iommu model='intel'&gt;
    &lt;driver intremap='on'/&gt;
  &lt;/iommu&gt;
&lt;/devices&gt;
...</pre>
<dl>
<dt><span class="docutils literal">model</span></dt>
<dd><p>Supported values are <span class="docutils literal">intel</span> (for Q35 guests) and, <span class="since">since 5.5.0</span> ,
<span class="docutils literal">smmuv3</span> (for ARM virt guests).</p>
</dd>
<dt><span class="docutils literal">driver</span></dt>
<dd><p>The <span class="docutils literal">driver</span> subelement can be used to configure additional options, some
of which might only be available for certain IOMMU models:</p>
<dl class="simple">
<dt><span class="docutils literal">intremap</span></dt>
<dd><p>The <span class="docutils literal">intremap</span> attribute with possible values <span class="docutils literal">on</span> and <span class="docutils literal">off</span> can be
used to turn on interrupt remapping, a part of the VT-d functionality.
Currently this requires split I/O APIC (<span class="docutils literal">&lt;ioapic <span class="pre">driver='qemu'/&gt;</span></span>).
<span class="since">Since 3.4.0</span> (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal">caching_mode</span></dt>
<dd><p>The <span class="docutils literal">caching_mode</span> attribute with possible values <span class="docutils literal">on</span> and <span class="docutils literal">off</span> can
be used to turn on the VT-d caching mode (useful for assigned devices).
<span class="since">Since 3.4.0</span> (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal">eim</span></dt>
<dd><p>The <span class="docutils literal">eim</span> attribute (with possible values <span class="docutils literal">on</span> and <span class="docutils literal">off</span>) can be
used to configure Extended Interrupt Mode. A q35 domain with split I/O
APIC (as described in <a class="reference external" href="formatdomain.html#elementsFeatures">hypervisor features</a>), and
both interrupt remapping and EIM turned on for the IOMMU, will be able to
use more than 255 vCPUs. <span class="since">Since 3.4.0</span> (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal">iotlb</span></dt>
<dd><p>The <span class="docutils literal">iotlb</span> attribute with possible values <span class="docutils literal">on</span> and <span class="docutils literal">off</span> can be
used to turn on the IOTLB used to cache address translation requests from
devices. <span class="since">Since 3.5.0</span> (QEMU/KVM only)</p>
</dd>
<dt><span class="docutils literal">aw_bits</span></dt>
<dd><p>The <span class="docutils literal">aw_bits</span> attribute can be used to set the address width to allow
mapping larger iova addresses in the guest. <span class="since">Since 6.5.0</span> (QEMU/KVM
only)</p>
</dd>
</dl>
</dd>
</dl>
<p><span class="anchor"><a id="vsock"/></span></p>
</div>
<div class="section" id="vsock">
<h3><a class="toc-backref" href="formatdomain.html#id101">Vsock</a><a class="headerlink" href="formatdomain.html#vsock" title="Link to this headline">¶</a></h3>
<p>A vsock host/guest interface. The <span class="docutils literal">model</span> attribute defaults to <span class="docutils literal">virtio</span>.
<span class="since">Since 5.2.0</span> <span class="docutils literal">model</span> can also be 'virtio-transitional' and
'virtio-non-transitional', see <a class="reference external" href="formatdomain.html#elementsVirtioTransitional">Virtio transitional
devices</a> for more details. The optional
attribute <span class="docutils literal">address</span> of the <span class="docutils literal">cid</span> element specifies the CID assigned to the
guest. If the attribute <span class="docutils literal">auto</span> is set to <span class="docutils literal">yes</span>, libvirt will assign a free
CID automatically on domain startup. <span class="since">Since 4.4.0</span>
The optional <span class="docutils literal">driver</span> element allows to specify virtio options, see
<a class="reference external" href="formatdomain.html#elementsVirtio">Virtio-specific options</a>  for more details. <span class="since">Since 7.1.0</span></p>
<pre class="literal-block">...
&lt;devices&gt;
  &lt;vsock model='virtio'&gt;
    &lt;cid auto='no' address='3'/&gt;
  &lt;/vsock&gt;
&lt;/devices&gt;
...</pre>
<p><span class="anchor"><a id="seclabel"/></span></p>
</div>
</div>
<div class="section" id="security-label">
<h2><a class="toc-backref" href="formatdomain.html#id102">Security label</a><a class="headerlink" href="formatdomain.html#security-label" title="Link to this headline">¶</a></h2>
<p>The <span class="docutils literal">seclabel</span> element allows control over the operation of the security
drivers. There are three basic modes of operation, 'dynamic' where libvirt
automatically generates a unique security label, 'static' where the
application/administrator chooses the labels, or 'none' where confinement is
disabled. With dynamic label generation, libvirt will always automatically
relabel any resources associated with the virtual machine. With static label
assignment, by default, the administrator or application must ensure labels are
set correctly on any resources, however, automatic relabeling can be enabled if
desired. <span class="since">'dynamic' since 0.6.1, 'static' since 0.6.2, and 'none' since
0.9.10.</span></p>
<p>If more than one security driver is used by libvirt, multiple <span class="docutils literal">seclabel</span> tags
can be used, one for each driver and the security driver referenced by each tag
can be defined using the attribute <span class="docutils literal">model</span></p>
<p>Valid input XML configurations for the top-level security label are:</p>
<pre class="literal-block">&lt;seclabel type='dynamic' model='selinux'/&gt;

&lt;seclabel type='dynamic' model='selinux'&gt;
  &lt;baselabel&gt;system_u:system_r:my_svirt_t:s0&lt;/baselabel&gt;
&lt;/seclabel&gt;

&lt;seclabel type='static' model='selinux' relabel='no'&gt;
  &lt;label&gt;system_u:system_r:svirt_t:s0:c392,c662&lt;/label&gt;
&lt;/seclabel&gt;

&lt;seclabel type='static' model='selinux' relabel='yes'&gt;
  &lt;label&gt;system_u:system_r:svirt_t:s0:c392,c662&lt;/label&gt;
&lt;/seclabel&gt;

&lt;seclabel type='none'/&gt;</pre>
<p>If no 'type' attribute is provided in the input XML, then the security driver
default setting will be used, which may be either 'none' or 'dynamic'. If a
'baselabel' is set but no 'type' is set, then the type is presumed to be
'dynamic'</p>
<p>When viewing the XML for a running guest with automatic resource relabeling
active, an additional XML element, <span class="docutils literal">imagelabel</span>, will be included. This is an
output-only element, so will be ignored in user supplied XML documents</p>
<dl class="simple">
<dt><span class="docutils literal">type</span></dt>
<dd><p>Either <span class="docutils literal">static</span>, <span class="docutils literal">dynamic</span> or <span class="docutils literal">none</span> to determine whether libvirt
automatically generates a unique security label or not.</p>
</dd>
<dt><span class="docutils literal">model</span></dt>
<dd><p>A valid security model name, matching the currently activated security model.
Model <span class="docutils literal">dac</span> is not available when guest is run by unprivileged user.</p>
</dd>
<dt><span class="docutils literal">relabel</span></dt>
<dd><p>Either <span class="docutils literal">yes</span> or <span class="docutils literal">no</span>. This must always be <span class="docutils literal">yes</span> if dynamic label
assignment is used. With static label assignment it will default to <span class="docutils literal">no</span>.</p>
</dd>
<dt><span class="docutils literal">label</span></dt>
<dd><p>If static labelling is used, this must specify the full security label to
assign to the virtual domain. The format of the content depends on the
security driver in use:</p>
<ul class="simple">
<li><p>SELinux: a SELinux context.</p></li>
<li><p>AppArmor: an AppArmor profile.</p></li>
<li><p>DAC: owner and group separated by colon. They can be defined both as
user/group names or uid/gid. The driver will first try to parse these
values as names, but a leading plus sign can used to force the driver to
parse them as uid or gid.</p></li>
</ul>
</dd>
<dt><span class="docutils literal">baselabel</span></dt>
<dd><p>If dynamic labelling is used, this can optionally be used to specify the base
security label that will be used to generate the actual label. The format of
the content depends on the security driver in use. The SELinux driver uses
only the <span class="docutils literal">type</span> field of the baselabel in the generated label. Other fields
are inherited from the parent process when using SELinux baselabels. (The
example above demonstrates the use of <span class="docutils literal">my_svirt_t</span> as the value for the
<span class="docutils literal">type</span> field.)</p>
</dd>
<dt><span class="docutils literal">imagelabel</span></dt>
<dd><p>This is an output only element, which shows the security label used on
resources associated with the virtual domain. The format of the content
depends on the security driver in use</p>
</dd>
</dl>
<p>When relabeling is in effect, it is also possible to fine-tune the labeling done
for specific source file names, by either disabling the labeling (useful if the
file lives on NFS or other file system that lacks security labeling) or
requesting an alternate label (useful when a management application creates a
special label to allow sharing of some, but not all, resources between domains),
<span class="since">since 0.9.9</span> . When a <span class="docutils literal">seclabel</span> element is attached to a specific
path rather than the top-level domain assignment, only the attribute <span class="docutils literal">relabel</span>
or the sub-element <span class="docutils literal">label</span> are supported. Additionally, <span class="since">since 1.1.2</span> ,
an output-only element <span class="docutils literal">labelskip</span> will be present for active domains on disks
where labeling was skipped due to the image being on a file system that lacks
security labeling.</p>
<p><span class="anchor"><a id="keywrap"/></span></p>
</div>
<div class="section" id="key-wrap">
<h2><a class="toc-backref" href="formatdomain.html#id103">Key Wrap</a><a class="headerlink" href="formatdomain.html#key-wrap" title="Link to this headline">¶</a></h2>
<p>The content of the optional <span class="docutils literal">keywrap</span> element specifies whether the guest will
be allowed to perform the S390 cryptographic key management operations. A clear
key can be protected by encrypting it under a unique wrapping key that is
generated for each guest VM running on the host. Two variations of wrapping keys
are generated: one version for encrypting protected keys using the DEA/TDEA
algorithm, and another version for keys encrypted using the AES algorithm. If a
<span class="docutils literal">keywrap</span> element is not included, the guest will be granted access to both
AES and DEA/TDEA key wrapping by default.</p>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;keywrap&gt;
    &lt;cipher name='aes' state='off'/&gt;
  &lt;/keywrap&gt;
  ...
&lt;/domain&gt;</pre>
<p>At least one <span class="docutils literal">cipher</span> element must be nested within the <span class="docutils literal">keywrap</span> element.</p>
<dl class="simple">
<dt><span class="docutils literal">cipher</span></dt>
<dd><p>The <span class="docutils literal">name</span> attribute identifies the algorithm for encrypting a protected
key. The values supported for this attribute are <span class="docutils literal">aes</span> for encryption under
the AES wrapping key, or <span class="docutils literal">dea</span> for encryption under the DEA/TDEA wrapping
key. The <span class="docutils literal">state</span> attribute indicates whether the cryptographic key
management operations should be turned on for the specified encryption
algorithm. The value can be set to <span class="docutils literal">on</span> or <span class="docutils literal">off</span>.</p>
</dd>
</dl>
<p>Note: DEA/TDEA is synonymous with DES/TDES.</p>
<p><span class="anchor"><a id="launchSecurity"/></span></p>
</div>
<div class="section" id="launch-security">
<h2><a class="toc-backref" href="formatdomain.html#id104">Launch Security</a><a class="headerlink" href="formatdomain.html#launch-security" title="Link to this headline">¶</a></h2>
<p>The contents of the <span class="docutils literal">&lt;launchSecurity <span class="pre">type='sev'&gt;</span></span> element is used to provide
the guest owners input used for creating an encrypted VM using the AMD SEV
feature (Secure Encrypted Virtualization). SEV is an extension to the AMD-V
architecture which supports running encrypted virtual machine (VMs) under the
control of KVM. Encrypted VMs have their pages (code and data) secured such that
only the guest itself has access to the unencrypted version. Each encrypted VM
is associated with a unique encryption key; if its data is accessed to a
different entity using a different key the encrypted guests data will be
incorrectly decrypted, leading to unintelligible data. For more information see
various input parameters and its format see the <a class="reference external" href="https://support.amd.com/TechDocs/55766_SEV-KM_API_Specification.pdf">SEV API
spec</a>
<span class="since">Since 4.4.0</span></p>
<pre class="literal-block">&lt;domain&gt;
  ...
  &lt;launchSecurity type='sev'&gt;
    &lt;policy&gt;0x0001&lt;/policy&gt;
    &lt;cbitpos&gt;47&lt;/cbitpos&gt;
    &lt;reducedPhysBits&gt;1&lt;/reducedPhysBits&gt;
    &lt;dhCert&gt;RBBBSDDD=FDDCCCDDDG&lt;/dhCert&gt;
    &lt;session&gt;AAACCCDD=FFFCCCDSDS&lt;/session&gt;
  &lt;/launchSecurity&gt;
  ...
&lt;/domain&gt;</pre>
<dl>
<dt><span class="docutils literal">cbitpos</span></dt>
<dd><p>The required <span class="docutils literal">cbitpos</span> element provides the C-bit (aka encryption bit)
location in guest page table entry. The value of <span class="docutils literal">cbitpos</span> is hypervisor
dependent and can be obtained through the <span class="docutils literal">sev</span> element from the domain
capabilities.</p>
</dd>
<dt><span class="docutils literal">reducedPhysBits</span></dt>
<dd><p>The required <span class="docutils literal">reducedPhysBits</span> element provides the physical address bit
reducation. Similar to <span class="docutils literal">cbitpos</span> the value of <span class="docutils literal"><span class="pre">reduced-phys-bit</span></span> is
hypervisor dependent and can be obtained through the <span class="docutils literal">sev</span> element from the
domain capabilities.</p>
</dd>
<dt><span class="docutils literal">policy</span></dt>
<dd><p>The required <span class="docutils literal">policy</span> element provides the guest policy which must be
maintained by the SEV firmware. This policy is enforced by the firmware and
restricts what configuration and operational commands can be performed on
this guest by the hypervisor. The guest policy provided during guest launch
is bound to the guest and cannot be changed throughout the lifetime of the
guest. The policy is also transmitted during snapshot and migration flows and
enforced on the destination platform. The guest policy is a 4 unsigned byte
with the fields shown in Table:</p>
<table>
<colgroup>
<col style="width: 6%"/>
<col style="width: 94%"/>
</colgroup>
<thead>
<tr><th class="head"><p>Bit(s)</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>0</p></td>
<td><p>Debugging of the guest is disallowed when set</p></td>
</tr>
<tr><td><p>1</p></td>
<td><p>Sharing keys with other guests is disallowed when set</p></td>
</tr>
<tr><td><p>2</p></td>
<td><p>SEV-ES is required when set</p></td>
</tr>
<tr><td><p>3</p></td>
<td><p>Sending the guest to another platform is disallowed when set</p></td>
</tr>
<tr><td><p>4</p></td>
<td><p>The guest must not be transmitted to another platform that is not in the domain when set.</p></td>
</tr>
<tr><td><p>5</p></td>
<td><p>The guest must not be transmitted to another platform that is not SEV capable when set.</p></td>
</tr>
<tr><td><p>6:15</p></td>
<td><p>reserved</p></td>
</tr>
<tr><td><p>16:32</p></td>
<td><p>The guest must not be transmitted to another platform with a lower firmware version.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><span class="docutils literal">dhCert</span></dt>
<dd><p>The optional <span class="docutils literal">dhCert</span> element provides the guest owners base64 encoded
Diffie-Hellman (DH) key. The key is used to negotiate a master secret key
between the SEV firmware and guest owner. This master secret key is then used
to establish a trusted channel between SEV firmware and guest owner.</p>
</dd>
<dt><span class="docutils literal">session</span></dt>
<dd><p>The optional <span class="docutils literal">session</span> element provides the guest owners base64 encoded
session blob defined in the SEV API spec. See SEV spec LAUNCH_START section
for the session blob format.</p>
</dd>
</dl>
<p><span class="anchor"><a id="examples"/></span></p>
</div>
</div>
<div class="section" id="example-configs">
<h1><a class="toc-backref" href="formatdomain.html#id105">Example configs</a><a class="headerlink" href="formatdomain.html#example-configs" title="Link to this headline">¶</a></h1>
<p>Example configurations for each driver are provide on the driver specific pages
listed below</p>
<ul class="simple">
<li><p><a class="reference external" href="https://libvirt.org/drvxen.html#xmlconfig">Xen examples</a></p></li>
<li><p><a class="reference external" href="https://libvirt.org/drvqemu.html#xmlconfig">QEMU/KVM examples</a></p></li>
</ul>
</div>
</div>
    </div>
    <div id="nav">
      <div id="home">
        <a href="https://libvirt.org/index.html">Home</a>
      </div>
      <div id="jumplinks">
        <ul>
          <li>
            <a href="https://libvirt.org/downloads.html">Download</a>
          </li>
          <li>
            <a href="https://libvirt.org/contribute.html">Contribute</a>
          </li>
          <li>
            <a href="https://libvirt.org/docs.html">Docs</a>
          </li>
        </ul>
      </div>
      <div id="search">
        <form id="simplesearch" action="https://www.google.com/search" enctype="application/x-www-form-urlencoded" method="get">
          <div>
            <input id="searchsite" name="sitesearch" type="hidden" value="libvirt.org"/>
            <input id="searchq" name="q" type="text" size="12" value=""/>
            <input name="submit" type="submit" value="Go"/>
          </div>
        </form>
        <div id="advancedsearch">
          <span>
            <input type="radio" name="what" id="whatwebsite" checked="checked" value="website"/>
            <label for="whatwebsite">Website</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatwiki" value="wiki"/>
            <label for="whatwiki">Wiki</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatdevs" value="devs"/>
            <label for="whatdevs">Developers list</label>
          </span>
          <span>
            <input type="radio" name="what" id="whatusers" value="users"/>
            <label for="whatusers">Users list</label>
          </span>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="contact">
        <h3>Contact</h3>
        <ul>
          <li>
            <a href="https://libvirt.org/contact.html#email">email</a>
          </li>
          <li>
            <a href="https://libvirt.org/contact.html#irc">irc</a>
          </li>
        </ul>
      </div>
      <div id="community">
        <h3>Community</h3>
        <ul>
          <li>
            <a href="https://twitter.com/hashtag/libvirt">twitter</a>
          </li>
          <li>
            <a href="https://stackoverflow.com/questions/tagged/libvirt">stackoverflow</a>
          </li>
          <li>
            <a href="https://serverfault.com/questions/tagged/libvirt">serverfault</a>
          </li>
        </ul>
      </div>
      <div id="contribute">
        <h3>Contribute</h3>
        <ul>
          <li>
            <a href="https://gitlab.com/libvirt/libvirt/-/blob/master/docs/formatdomain.rst">edit this page</a>
          </li>
        </ul>
      </div>
      <div id="conduct">
            Participants in the libvirt project agree to abide by <a href="https://libvirt.org/governance.html#codeofconduct">the project code of conduct</a></div>
      <br class="clear"/>
    </div>
  </body>
</html>
